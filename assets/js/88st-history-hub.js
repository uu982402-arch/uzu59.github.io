!function(){"use strict";const t="88st_tool_history_v1",e={margin:"마진",ev:"EV",odds:"배당↔확률",kelly:"Kelly"};function escapeHtml(t){return String(t||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/'/g,"&#039;")}function nowKSTLabel(t){try{const e=new Date(t),n=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0"),o=String(e.getHours()).padStart(2,"0");return`${n}.${s}.${a} ${o}:${String(e.getMinutes()).padStart(2,"0")}`}catch(t){return"-"}}function toast(t){if(!t)return;let e=document.getElementById("_88stToastHost");e||(e=document.createElement("div"),e.id="_88stToastHost",e.setAttribute("aria-live","polite"),document.body.appendChild(e));const n=document.createElement("div");n.className="stx-toast",n.textContent=t,e.appendChild(n),requestAnimationFrame(()=>n.classList.add("show")),window.setTimeout(()=>{n.classList.remove("show"),window.setTimeout(()=>n.remove(),260)},2100)}async function copyText(t){if(!t)return!1;try{return await navigator.clipboard.writeText(t),!0}catch(e){try{const e=document.createElement("textarea");return e.value=t,e.setAttribute("readonly","readonly"),e.style.position="fixed",e.style.opacity="0",e.style.left="-9999px",document.body.appendChild(e),e.select(),document.execCommand("copy"),e.remove(),!0}catch(t){return!1}}}function loadAll(){try{const e=localStorage.getItem(t),n=e?JSON.parse(e):[];return Array.isArray(n)?n.filter(t=>t&&"object"==typeof t&&t.ts&&t.url):[]}catch(t){return[]}}function saveAll(e){try{localStorage.setItem(t,JSON.stringify(e))}catch(t){}}function ensureModal(){if(document.getElementById("_88stHubModal"))return;const t=document.createElement("div");t.id="_88stHubModal",t.className="stx-modal",t.innerHTML='\n      <div class="stx-modal-backdrop" data-close="1"></div>\n      <div class="stx-modal-box" role="dialog" aria-modal="true" aria-label="최근 저장 전체">\n        <div class="stx-modal-head">\n          <div>\n            <div class="stx-modal-title">최근 저장 (전체)</div>\n            <div class="stx-modal-sub">저장한 계산 링크를 다시 열거나, 링크를 복사할 수 있어요.</div>\n          </div>\n          <button class="stx-icon-btn" type="button" data-close="1" aria-label="닫기">✕</button>\n        </div>\n        <div class="stx-modal-body">\n          <div class="stx-hist-list" id="_88stHubList"></div>\n        </div>\n        <div class="stx-modal-foot">\n          <button class="stx-btn danger" type="button" id="_88stHubClear">전체 삭제</button>\n          <div style="flex:1"></div>\n          <button class="stx-btn" type="button" data-close="1">닫기</button>\n        </div>\n      </div>\n    ',document.body.appendChild(t),t.addEventListener("click",t=>{const e=t.target;e instanceof HTMLElement&&"1"===e.dataset.close&&closeModal()}),document.addEventListener("keydown",t=>{"Escape"===t.key&&closeModal()});const e=document.getElementById("_88stHubClear");e&&e.addEventListener("click",()=>{saveAll([]),toast("전체 삭제 완료"),renderModalList(),renderInline()})}function openModal(){const t=document.getElementById("_88stHubModal");t&&t.classList.add("open")}function closeModal(){const t=document.getElementById("_88stHubModal");t&&t.classList.remove("open")}function renderModalList(){const t=document.getElementById("_88stHubList");if(!t)return;const n=loadAll();n.length?(t.innerHTML="",n.slice(0,20).forEach(n=>{const s=document.createElement("div");s.className="stx-hist-item";const a=nowKSTLabel(n.ts),o=e[n.tool]||n.tool||"도구",d=n.summary?escapeHtml(n.summary):"";s.innerHTML=`\n        <div class="stx-hist-meta">\n          <div class="stx-hist-time">${o} · ${a}</div>\n          <div class="stx-hist-sum">${d||"-"}</div>\n        </div>\n        <div class="stx-hist-actions">\n          <a class="stx-btn" href="${escapeHtml(n.url)}">열기</a>\n          <button class="stx-btn ghost" type="button" data-act="copy">링크</button>\n          <button class="stx-btn danger" type="button" data-act="del">삭제</button>\n        </div>\n      `;const i=s.querySelector('[data-act="copy"]'),l=s.querySelector('[data-act="del"]');i&&i.addEventListener("click",async()=>{toast(await copyText(n.url)?"링크 복사됨":"복사 실패")}),l&&l.addEventListener("click",()=>{saveAll(function prune(t){const e=t.filter(t=>t&&"object"==typeof t&&t.ts);return e.sort((t,e)=>(e.ts||0)-(t.ts||0)),e.slice(0,50)}(loadAll().filter(t=>t!==n))),toast("삭제 완료"),renderModalList(),renderInline()}),t.appendChild(s)})):t.innerHTML='\n        <div class="stx-empty">\n          <div class="stx-empty-title">저장된 항목이 없어요</div>\n          <div class="stx-empty-sub">계산기에서 <b>저장</b>을 누르면 여기에 표시됩니다.</div>\n        </div>\n      '}function renderInline(){const t=document.getElementById("_88stHistoryHub");if(!t)return;const n=Number(t.dataset.limit||6),s=loadAll();if(!s.length)return void(t.innerHTML='\n        <div class="stx-empty">\n          <div class="stx-empty-title">최근 저장이 비어 있어요</div>\n          <div class="stx-empty-sub">계산기에서 <b>저장</b>을 누르면 여기에 표시됩니다.</div>\n        </div>\n      ');const a=s.slice(0,Math.max(1,Math.min(12,n)));t.innerHTML='\n      <div class="stx-hub">\n        <div class="stx-hub-head">\n          <div>\n            <div class="stx-hub-title">최근 저장된 계산</div>\n            <div class="stx-hub-sub">클릭하면 저장 당시 링크로 열립니다.</div>\n          </div>\n          <div class="stx-hub-actions">\n            <button class="stx-btn ghost" type="button" id="_88stHubCopyLatest">최근 링크 복사</button>\n            <button class="stx-btn" type="button" id="_88stHubOpen">전체 보기</button>\n          </div>\n        </div>\n        <div class="stx-hist-list" id="_88stHubInlineList"></div>\n      </div>\n    ';const o=document.getElementById("_88stHubInlineList");if(!o)return;a.forEach(t=>{const n=document.createElement("div");n.className="stx-hist-item";const s=nowKSTLabel(t.ts),a=e[t.tool]||t.tool||"도구",d=t.summary?escapeHtml(t.summary):"";n.innerHTML=`\n        <div class="stx-hist-meta">\n          <div class="stx-hist-time">${a} · ${s}</div>\n          <div class="stx-hist-sum">${d||"-"}</div>\n        </div>\n        <div class="stx-hist-actions">\n          <a class="stx-btn" href="${escapeHtml(t.url)}">열기</a>\n          <button class="stx-btn ghost" type="button" data-act="copy">링크</button>\n        </div>\n      `;const i=n.querySelector('[data-act="copy"]');i&&i.addEventListener("click",async()=>{toast(await copyText(t.url)?"링크 복사됨":"복사 실패")}),o.appendChild(n)});const d=document.getElementById("_88stHubOpen");d&&d.addEventListener("click",()=>{ensureModal(),renderModalList(),openModal()});const i=document.getElementById("_88stHubCopyLatest");i&&i.addEventListener("click",async()=>{const t=s[0];toast(await copyText(t?t.url:"")?"최근 링크 복사됨":"복사 실패")})}function boot(){!function bindGlobalButton(){const t=document.getElementById("_88stGlobalHistoryBtn");t&&t.addEventListener("click",()=>{ensureModal(),renderModalList(),openModal()})}(),renderInline()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",boot):boot()}();