!function(){"use strict";const t="88st_tool_history_v1",e=(t,e=document)=>e.querySelector(t);function n(t){if(!t)return;let e=document.getElementById("_88stToastHost");e||(e=document.createElement("div"),e.id="_88stToastHost",e.setAttribute("aria-live","polite"),document.body.appendChild(e));const n=document.createElement("div");n.className="stx-toast",n.textContent=t,e.appendChild(n),requestAnimationFrame(()=>n.classList.add("show")),window.setTimeout(()=>{n.classList.remove("show"),window.setTimeout(()=>n.remove(),260)},2100)}async function s(t){if(!t)return!1;try{return await navigator.clipboard.writeText(t),!0}catch(e){try{const e=document.createElement("textarea");return e.value=t,e.setAttribute("readonly","readonly"),e.style.position="fixed",e.style.opacity="0",e.style.left="-9999px",document.body.appendChild(e),e.select(),document.execCommand("copy"),e.remove(),!0}catch(t){return!1}}}function o(){try{const e=localStorage.getItem(t),n=e?JSON.parse(e):[];return Array.isArray(n)?n:[]}catch(t){return[]}}function a(e){try{localStorage.setItem(t,JSON.stringify(e))}catch(t){}}function i(t){const e=t.filter(t=>t&&"object"==typeof t&&t.ts);return e.sort((t,e)=>(e.ts||0)-(t.ts||0)),e.slice(0,20)}async function c(){const t=document.getElementById("__88stToolConfig");if(!t)return null;let e=(t.textContent||"").trim();if(!e){const n=t.dataset&&t.dataset.src?String(t.dataset.src):"";if(n)try{const s=await fetch(n,{cache:"no-store"});s&&s.ok&&(e=(await s.text()).trim(),e&&(t.textContent=e))}catch(t){}}const n=function(t){try{return JSON.parse(t)}catch(t){return null}}(e||"");return n&&"object"==typeof n&&n.tool?(n.inputs=Array.isArray(n.inputs)?n.inputs:[],n.outputs=n.outputs&&"object"==typeof n.outputs?n.outputs:{},n.examples=Array.isArray(n.examples)?n.examples:[],n.shareParams=n.shareParams&&"object"==typeof n.shareParams?n.shareParams:{},n.title=n.title||"도구",n):null}function r(t){const e={};return t.inputs.forEach(t=>{const n="string"==typeof t?t:t.id;if(!n)return;const s=document.getElementById(n);s&&(e[n]=String(s.value??"").trim())}),e}function d(t){t&&"object"==typeof t&&Object.entries(t).forEach(([t,e])=>{const n=document.getElementById(t);n&&(n.value=null==e?"":String(e),n.dispatchEvent(new Event("input",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0})))})}function l(t,e){try{const n=new URL(window.location.href);return Object.values(t.shareParams).forEach(t=>{t&&n.searchParams.delete(t)}),Object.entries(t.shareParams).forEach(([t,s])=>{if(!s)return;const o=e[t];null!=o&&""!==o&&n.searchParams.set(s,o)}),n.searchParams.set("_s","1"),n.toString()}catch(t){return window.location.href}}function u(t,e,n){const s=String(t.tool||"");if("margin"===s){return`${"2"===e.mode?"2-way":"3-way"} ${[e.o1,e.o2,e.o3].filter(Boolean).join("/")} · 마진 ${n.margin||""||"-"}`}if("ev"===s){const t=e.odds||"-",s=e.p||"-",o=n.evPct||"";return`배당 ${t} · 승률 ${s}% · ${n.judge||""||"EV"} ${o||"-"}`}if("odds"===s){const t=e.odds||"-",s=e.prob||"-";return`배당 ${t} → ${n.probOut||""||"-"} · 확률 ${s}% → ${n.oddsOut||""||"-"}`}if("kelly"===s){return`배당 ${e.odds||"-"} · 확률 ${e.prob||"-"}% · ${e.frac||"-"}x · cap ${e.cap||"-"}% · 최종 ${n.kFinal||""||"-"}`}if("slot"===s){const t=(e.slotName||"").trim(),s=e.rtp||"-",o={low:"저",mid:"중",high:"고",vhigh:"초고"}[e.vol]||e.vol||"",a=e.bet||"-",i=e.spins||"-",c=n.loss||"-",r=n.total||"";return`${t?`슬롯 ${t}`:"슬롯"} · RTP ${s}% · ${o}변동 · ${a}×${i}${r?` · 총베팅 ${r}`:""} · 기대손실 ${c}`}return`${t.title}`}function m(){const t=document.getElementById("_88stHistModal");t&&t.classList.remove("open")}function p(t){const e=document.getElementById("_88stHistList");if(!e)return;const c=o(),r=c.filter(e=>e.tool===t.tool);r.length?(e.innerHTML="",r.slice(0,10).forEach((o,l)=>{const u=document.createElement("div");u.className="stx-hist-item";const b=function(t){try{const e=new Date(t),n=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${n}.${s}.${o} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`}catch(t){return"-"}}(o.ts),y=o.summary||"";var v;u.innerHTML=`\n        <div class="stx-hist-meta">\n          <div class="stx-hist-time">${b}</div>\n          <div class="stx-hist-sum">${v=y,String(v||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/'/g,"&#039;")}</div>\n        </div>\n        <div class="stx-hist-actions">\n          <button class="stx-btn" type="button" data-act="restore" data-i="${l}">복원</button>\n          <button class="stx-btn ghost" type="button" data-act="copy" data-i="${l}">링크</button>\n          <button class="stx-btn danger" type="button" data-act="del" data-i="${l}">삭제</button>\n        </div>\n      `,u.querySelectorAll("button").forEach(e=>{e.addEventListener("click",async()=>{const o=e.dataset.act,l=Number(e.dataset.i),u=r[l];if(u){if("restore"===o&&(d(u.inputs),n("복원 완료"),m()),"copy"===o){n(await s(u.url||"")?"공유 링크 복사됨":"복사 실패")}if("del"===o){a(i(c.filter(t=>t!==u))),n("삭제 완료"),p(t)}}})}),e.appendChild(u)})):e.innerHTML='\n        <div class="stx-empty">\n          <div class="stx-empty-title">아직 저장된 항목이 없어요</div>\n          <div class="stx-empty-sub">계산 후 <b>저장</b>을 누르면 여기에 쌓입니다.</div>\n        </div>\n      '}function b(t){const c=document.querySelector(".grid"),b=c?c.querySelector(":scope > .card:nth-child(2)"):null,y=b||document.querySelector(".hero")||document.body,v=document.createElement("div");if(v.className="stx-bar",v.innerHTML='\n      <div class="stx-left">\n        <div class="stx-chiprow" id="_88stExampleRow"></div>\n      </div>\n      <div class="stx-right">\n        <button type="button" class="stx-btn ghost" id="_88stShareBtn">공유</button>\n        <button type="button" class="stx-btn" id="_88stSaveBtn">저장</button>\n        <button type="button" class="stx-btn" id="_88stHistBtn">히스토리</button>\n      </div>\n    ',"odds"===t.tool&&c)c.insertAdjacentElement("beforebegin",v);else{const t=b?b.querySelector("h2"):null;t&&t.parentNode?t.insertAdjacentElement("afterend",v):y.appendChild(v)}const h=document.getElementById("_88stExampleRow");h&&t.examples.length?t.examples.slice(0,3).forEach(t=>{const e=document.createElement("button");e.type="button",e.className="stx-chip",e.textContent=t.label||"예시",e.addEventListener("click",()=>{d(t.values||{}),n("예시 입력 적용")}),h.appendChild(e)}):h&&(h.innerHTML='<span class="stx-chip stx-chip--muted" aria-hidden="true">예시</span>'),e("#_88stShareBtn").addEventListener("click",async()=>{const e=r(t),o=l(t,e);n(await s(o)?"공유 링크 복사됨":"복사 실패")}),e("#_88stSaveBtn").addEventListener("click",()=>{const e=r(t),s=function(t){const e={};return Object.entries(t.outputs).forEach(([t,n])=>{const s=document.querySelector(n);e[t]=s?String(s.textContent||"").trim():""}),e}(t),c=l(t,e);a(i([{tool:t.tool,title:t.title,ts:Date.now(),inputs:e,outputs:s,url:c,summary:u(t,e,s)},...o()])),n("저장 완료")}),e("#_88stHistBtn").addEventListener("click",()=>{!function(){if(document.getElementById("_88stHistModal"))return;const t=document.createElement("div");t.id="_88stHistModal",t.className="stx-modal",t.innerHTML='\n      <div class="stx-modal-backdrop" data-close="1"></div>\n      <div class="stx-modal-box" role="dialog" aria-modal="true" aria-label="최근 계산 히스토리">\n        <div class="stx-modal-head">\n          <div>\n            <div class="stx-modal-title">최근 저장</div>\n            <div class="stx-modal-sub">저장한 입력값을 빠르게 복원하거나 링크로 공유할 수 있어요.</div>\n          </div>\n          <button class="stx-icon-btn" type="button" data-close="1" aria-label="닫기">✕</button>\n        </div>\n        <div class="stx-modal-body">\n          <div class="stx-hist-list" id="_88stHistList"></div>\n        </div>\n        <div class="stx-modal-foot">\n          <button class="stx-btn ghost" type="button" id="_88stHistClear">전체 삭제</button>\n          <div style="flex:1"></div>\n          <button class="stx-btn" type="button" data-close="1">닫기</button>\n        </div>\n      </div>\n    ',document.body.appendChild(t),t.addEventListener("click",t=>{const e=t.target;e instanceof HTMLElement&&"1"===e.dataset.close&&m()}),document.addEventListener("keydown",t=>{"Escape"===t.key&&m()})}(),p(t);const e=document.getElementById("_88stHistClear");e&&!e.dataset.bound&&(e.dataset.bound="1",e.addEventListener("click",()=>{a(i(o().filter(e=>e.tool!==t.tool))),n("전체 삭제 완료"),p(t)})),function(){const t=document.getElementById("_88stHistModal");t&&t.classList.add("open")}()})}async function y(){const t=await c();t&&(!function(t){try{const e=new URL(window.location.href),n={};let s=!1;Object.entries(t.shareParams).forEach(([t,o])=>{if(!o)return;const a=e.searchParams.get(o);null!=a&&(n[t]=a,s=!0)}),s&&d(n)}catch(t){}}(t),b(t))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",y):y()}();