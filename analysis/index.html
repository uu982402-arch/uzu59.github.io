<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>ìŠ¤í¬ì¸  ë°°ë‹¹ ë¶„ì„ê¸° | 88 ì»¤ë®¤ë‹ˆí‹°</title>
<meta name="description" content="ì¢…ëª©(ì¶•êµ¬/ë†êµ¬/ì•¼êµ¬/ë°°êµ¬/eìŠ¤í¬ì¸ /í•˜í‚¤)ë³„ ë°°ë‹¹ ì…ë ¥ìœ¼ë¡œ ìŠ¹ë¦¬ í™•ë¥ (ë°°ë‹¹ ê¸°ë°˜Â·ì¶”ì •), ì˜¤ë²„ë¼ìš´ë“œ, ë§ˆì§„, ë°¸ë¥˜(EV), ê¶Œì¥ ë¹„ì¤‘(ë³´ìˆ˜ì  Kelly), ë©”ì¸/ì˜¤ë²„ì–¸ë”/í•¸ë”” ë§ˆì§„ì„ í†µí•© ê³„ì‚°í•˜ê³  íˆìŠ¤í† ë¦¬/ë¹„êµê¹Œì§€ ì§€ì›í•˜ëŠ” ë¶„ì„ê¸°ì…ë‹ˆë‹¤. (íŒë‹¨ ë³´ì¡°ìš©)" />
<link rel="canonical" href="https://88st.cloud/analysis/" />
<meta name="robots" content="index,follow" />

<style>
*{box-sizing:border-box}
:root{
  /* Theme (auto/preset) */
  --accent1:#d4af37;
  --accent2:#f5e27a;
  --accentRGB:212,175,55;
  --accentText:#000;
  --accentOn:#00121a;

  /* Glass intensity */
  --glassA:.84;
  --glassStrongA:.94;
  --glassSoftA:.26;
  --glassBorder:rgba(255,255,255,.06);

  /* Backward-compat */
  --gold: var(--accent1);
  --gold2: var(--accent2);

  --bg:#0b0b0b;
  --panel:#121212;
  --panel2:#0f0f0f;
--muted:#bdbdbd;

  --ok:#b7ffcf;
  --warn:#ffcf99;
  --bad:#ffb3b3;
  --chip:#1f1f1f;
}
html{scroll-behavior:smooth}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto;
  background:
    radial-gradient(1200px 500px at 50% -10%, rgba(var(--accentRGB),.14), transparent 55%),
    radial-gradient(900px 500px at 10% 20%, rgba(90,160,255,.08), transparent 60%),
    linear-gradient(180deg, #07070a, var(--bg));
  color:#fff;
}

/* ===== ìƒë‹¨ ê³µì§€/ì´ë²¤íŠ¸ ë°°ë„ˆ (ìë™ ìˆœí™˜) ===== */
.notice-bar{
  position:sticky;
  top:10px;
  z-index:1600;

  /* glass + rounded */
  width:min(980px, calc(100% - 24px));
  margin:10px auto 0;
  border-radius:999px;

  background:rgba(20,20,24,.38);
  border:1px solid rgba(255,255,255,.14);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);

  color:rgba(255,255,255,.92);
  font-weight:900;
  font-size:13px;
  padding:10px 12px;
  text-align:center;

  box-shadow:0 10px 30px rgba(0,0,0,.35);
  display:flex;
  align-items:center;
  gap:10px;

  transition:padding .18s ease, font-size .18s ease, box-shadow .18s ease,
             background .18s ease, border-color .18s ease, opacity .18s ease;
}
.notice-bar a{
  color:rgba(255,255,255,.92);
  text-decoration:none;
  flex:1;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.notice-toggle{
  flex:0 0 auto;
  width:34px;
  height:28px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.18);
  background:rgba(255,255,255,.08);
  color:#fff;
  font-weight:1000;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  line-height:1;
  transition:transform .18s ease, background .18s ease, border-color .18s ease;
}
.notice-toggle:hover{ background:rgba(255,255,255,.12); border-color:rgba(255,255,255,.26); }
.notice-toggle:active{ transform:scale(.98); }

.notice-icon{
  flex:0 0 auto;
  width:28px;
  height:28px;
  border-radius:999px;
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.16);
  display:flex;
  align-items:center;
  justify-content:center;
  line-height:1;
  box-shadow:0 6px 16px rgba(0,0,0,.22);
}
.notice-mini-text{
  display:none;
  font-weight:950;
  letter-spacing:-.2px;
}

/* (ì˜µì…˜) ì´ˆìŠ¬ë¦¼/ë¯¸ë‹ˆ í˜•íƒœ - ê¸°ì¡´ í´ë˜ìŠ¤ ìœ ì§€ */
.notice-bar.is-mini{
  padding:7px 10px;
  font-size:12px;
  background:rgba(20,20,24,.22);
  border-color:rgba(255,255,255,.10);
  opacity:.88;
  box-shadow:0 8px 22px rgba(0,0,0,.25);
}
.notice-bar.is-mini a{
  text-align:left;
  display:flex;
  align-items:center;
}
.notice-bar.is-mini #noticeText{ display:none; }
.notice-bar.is-mini .notice-mini-text{
  display:block;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.notice-bar.is-mini .notice-toggle{ display:none; }

/* ìŠ¤í¬ë¡¤/ì ‘í˜ ìƒíƒœ: ë” íˆ¬ëª… + ë” ì»´íŒ©íŠ¸ */
.notice-bar.is-collapsed{
  padding:7px 10px;
  font-size:12px;
  background:rgba(20,20,24,.20);
  border-color:rgba(255,255,255,.10);
  opacity:.88;
  box-shadow:0 8px 22px rgba(0,0,0,.25);
}

@media (max-width:520px){
  .notice-bar{ top:8px; width:calc(100% - 20px); margin:8px auto 0; }
  .notice-toggle{ width:32px; height:26px; }
}

/* ===== ì‚¬ì¹­ì£¼ì˜ íŒì—… (1ì¼ 1íšŒ) ===== */
.scam-popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.75);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:3000;
  padding:18px;
}
.scam-box{
  background:rgba(17,17,17,.95);
  border:1px solid rgba(255,255,255,.08);
  border-radius:18px;
  padding:22px;
  width:100%;
  max-width:380px;
  text-align:center;
  box-shadow:0 18px 60px rgba(0,0,0,.75);
  backdrop-filter: blur(10px);
}
.scam-box h3{ color:#ff6b6b; margin:0 0 10px; font-weight:900; }
.scam-box p{ font-size:13px; color:#ddd; line-height:1.55; margin:0; }
.scam-box .btn{
  margin-top:12px;
  padding:12px;
  border-radius:12px;
  background:linear-gradient(135deg,var(--gold),var(--gold2));
  color:#000;
  font-weight:900;
  cursor:pointer;
  user-select:none;
}

/* ìƒë‹¨ */
.header{ text-align:center; padding:14px 0 10px; }
.logo-link{display:inline-block;text-decoration:none}
.logo-img{
  display:block; margin:0 auto 6px;
  width:180px; max-width:72%; height:auto;
  filter:drop-shadow(0 0 10px rgba(var(--accentRGB),.25));
}
@media(max-width:480px){ .logo-img{width:150px;max-width:82%} }
.sub{ font-size:12px; color:#9a9a9a; }

/* ë ˆì´ì•„ì›ƒ */
.wrap{ max-width:980px; margin:0 auto; padding:10px 14px 34px; }
.card{
  background:rgba(18,18,18,.86);
  border:1px solid rgba(255,255,255,.06);
  border-radius:18px; padding:14px;
  box-shadow:0 10px 26px rgba(0,0,0,.45);
  margin-bottom:14px;
  backdrop-filter: blur(10px);
}
.title{ font-weight:900; color:var(--gold2); margin-bottom:10px; font-size:14px; display:flex; align-items:center; gap:8px; }
.badge{
  display:inline-block;
  padding:4px 8px;
  border-radius:999px;
  font-size:11px;
  font-weight:900;
  color:#000;
  background:linear-gradient(135deg,var(--gold),var(--gold2));
}
.note{ color:#bdbdbd; font-size:12px; line-height:1.5; margin-top:8px; }
.small-hint{ font-size:11px; color:#8f8f8f; margin-top:6px; line-height:1.4; }

/* ì»¨íŠ¸ë¡¤ */
.controls{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
@media(max-width:560px){ .controls{ grid-template-columns:1fr; } }
.select, .textinput{
  width:100%;
  padding:12px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.08);
  background:var(--panel2);
  color:#fff;
  outline:none;
  font-weight:800;
}
.textinput{ font-weight:700; }
.row2{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin-top:10px;
}
@media(max-width:560px){ .row2{ grid-template-columns:1fr; } }

/* ì…ë ¥ */
.grid{ display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px; }
@media(max-width:560px){ .grid{grid-template-columns:1fr} }
.field label{ display:block; font-size:12px; color:#bbb; margin:2px 0 6px; }
.field input{
  width:100%; padding:12px; border-radius:14px;
  border:1px solid rgba(255,255,255,.08);
  background:var(--panel2); color:#fff; outline:none;
}
.field input::placeholder{color:#555}

/* ì„¹ì…˜ ë°•ìŠ¤ */
.box{
  margin-top:12px;
  padding:12px;
  border-radius:16px;
  background:rgba(255,255,255,.03);
  border:1px solid rgba(255,255,255,.06);
}
.box-title{ font-weight:900; margin:0 0 8px; color:var(--gold2); font-size:13px; }
.box-head{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
.toggle{
  cursor:pointer; font-size:12px; color:#cfcfcf;
  user-select:none; padding:6px 10px; border-radius:999px;
  border:1px solid rgba(255,255,255,.08); background:rgba(0,0,0,.25);
}

/* ì•¡ì…˜ */
.actions{ display:flex; gap:10px; margin-top:12px; flex-wrap:wrap; }
.btn{
  flex:1; min-width:160px;
  border:none; border-radius:14px; padding:12px;
  font-weight:900; cursor:pointer;
}
.primary{ background:linear-gradient(135deg,#1da1f2,#78d6ff); color:#00121a; }
.secondary{ background:var(--chip); color:#fff; border:1px solid rgba(255,255,255,.06); }
.gold{ background:linear-gradient(135deg,var(--gold),var(--gold2)); color:#111; }

/* ê²°ê³¼ */
.result{
  background:rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.06);
  border-radius:16px;
  padding:12px;
  margin-top:12px;
}

/* ê²°ê³¼ ìš”ì•½ ì¹´ë“œ(ì²« í™”ë©´ ê°•ì¡°) */
.resultHero{
  border:1px solid rgba(255,255,255,.10);
  background:
    radial-gradient(600px 200px at 0% 0%, rgba(90,160,255,.10), transparent 55%),
    radial-gradient(600px 200px at 100% 0%, rgba(var(--accentRGB),.10), transparent 55%),
    rgba(255,255,255,.03);
  border-radius:18px;
  padding:14px;
  box-shadow: 0 14px 34px rgba(0,0,0,.35);
  margin-bottom:10px;
  animation:popIn .22s ease-out;
}
@keyframes popIn{ from{ transform:translateY(6px); opacity:0;} to{transform:none; opacity:1;} }
.heroTop{ display:flex; align-items:flex-start; justify-content:space-between; gap:12px; flex-wrap:wrap; }
.heroText{ min-width:240px; }
.heroTitle{ font-weight:1000; font-size:15px; color:#fff; letter-spacing:-.2px; }
.heroSub{ margin-top:3px; font-size:12px; color:#bdbdbd; line-height:1.35; }
.heroBadges{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:flex-end; }

.heroRight{ display:flex; flex-direction:column; align-items:flex-end; gap:8px; }
.heroConclusion{
  display:flex;
  align-items:center;
  gap:8px;
  padding:10px 12px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.25);
  max-width:340px;
}
.heroConclusion .cIcon{ font-size:16px; line-height:1; }
.heroConclusion .cText{ font-size:13px; font-weight:900; letter-spacing:-.2px; color:#fff; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.heroConclusion.good{ border-color: rgba(48,209,88,.35); background: rgba(48,209,88,.12); }
.heroConclusion.warn{ border-color: rgba(255,193,7,.35); background: rgba(255,193,7,.12); }
.heroConclusion.bad{ border-color: rgba(255,59,48,.35); background: rgba(255,59,48,.12); }
@media (max-width:520px){
  .heroRight{ width:100%; align-items:flex-start; }
  .heroBadges{ justify-content:flex-start; }
  .heroConclusion{ max-width:100%; width:100%; }
  .heroConclusion .cText{ white-space:normal; }
}
.chip.big{ padding:8px 12px; font-size:13px; }
.heroStats{
  margin-top:12px;
  display:grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap:10px;
}
.statCard{
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.22);
  border-radius:14px;
  padding:10px 10px;
}
.statK{ font-size:11px; color:#bdbdbd; }
.statV{ margin-top:4px; font-size:16px; font-weight:1000; color:#fff; letter-spacing:-.2px; }
.statS{ margin-top:2px; font-size:11px; color:#9a9a9a; }
.detailHead{
  margin:10px 0 4px;
  font-weight:900;
  font-size:13px;
  color:#fff;
  display:flex; align-items:center; gap:8px;
}
.detailHead:before{
  content:"";
  width:8px; height:8px; border-radius:99px;
  background:rgba(var(--accentRGB),.9);
  box-shadow:0 0 0 4px rgba(var(--accentRGB),.12);
}
@media (max-width:520px){
  .heroStats{ grid-template-columns: 1fr; }
  .heroText{ min-width: 0; }
  .heroBadges{ justify-content:flex-start; }
}

.kv{
  display:flex; justify-content:space-between; gap:10px;
  padding:8px 0; border-bottom:1px solid rgba(255,255,255,.06);
  font-size:13px;
}
.kv:last-child{border-bottom:none}
.k{color:#cfcfcf}
.v{font-weight:900}
.warn{color:var(--bad)}
.good{color:var(--ok)}
.mid{color:var(--warn)}

hr.sep{ border:none; height:1px; background:rgba(255,255,255,.06); margin:12px 0; }

.footer-links{ display:flex; gap:10px; margin-top:14px; flex-wrap:wrap; }
.linkbtn{
  flex:1; min-width:160px;
  display:block; text-align:center; padding:12px;
  border-radius:14px; text-decoration:none; font-weight:900;
  background:var(--chip); color:#fff;
  border:1px solid rgba(255,255,255,.06);
}

/* ì²´í¬ë¦¬ìŠ¤íŠ¸ */
.checklist{
  color:#cfcfcf;
  font-size:13px;
  line-height:1.55;
}
.checklist strong{ color:#fff; }

/* ë§ˆì§„ ëŒ€ì‹œë³´ë“œ */
.m-grid{
  display:grid; gap:10px;
  grid-template-columns:1fr 1fr 1fr;
}
@media(max-width:800px){ .m-grid{ grid-template-columns:1fr; } }
.m-card{
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.25);
  border-radius:16px;
  padding:12px;
}
.m-head{ display:flex; align-items:center; justify-content:space-between; gap:8px; }
.m-name{ font-weight:900; color:#fff; font-size:13px; }
.chip{
  display:inline-flex; align-items:center; gap:6px;
  padding:6px 10px;
  border-radius:999px;
  font-size:12px;
  font-weight:900;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.25);
}
.chip.ok{ color:var(--ok); }
.chip.mid{ color:var(--warn); }
.chip.bad{ color:var(--bad); }
.m-lines{ margin-top:10px; font-size:12px; color:#cfcfcf; line-height:1.45; }
.m-lines b{ color:#fff; }

/* íˆìŠ¤í† ë¦¬ */
.history-toolbar{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-top:8px;
}
.history-toolbar .btn{ min-width:0; flex:1; }

.history-toolbar .btn.danger{
  border-color:rgba(255,80,80,.35);
  color:#ffd1d1;
}
.history-toolbar .btn.danger:hover{
  border-color:rgba(255,80,80,.55);
  background:rgba(255,80,80,.08);
}
.history-filters{
  margin-top:10px;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  align-items:center;
}
.history-filters .seg{
  padding:8px 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(255,255,255,.03);
  color:#ddd;
  font-weight:900;
  cursor:pointer;
}
.history-filters .seg.on{
  background:linear-gradient(135deg, rgba(255,203,66,.22), rgba(255,176,60,.12));
  border-color:rgba(255,203,66,.35);
  color:#fff;
}
.pick-ind{
  margin-left:auto;
  padding:8px 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.08);
  background:rgba(255,255,255,.03);
  color:#cfcfcf;
  font-size:12px;
  font-weight:800;
}
.pick-ind b{ color:#fff; }
@media (max-width:420px){
  .pick-ind{ margin-left:0; }
}

.h-list{ margin-top:10px; display:grid; gap:10px; }
.h-item{
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.25);
  border-radius:16px;
  padding:10px 12px;
}
.h-top{
  display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
}
.h-title{
  font-weight:900; font-size:13px;
}
.h-sub{
  margin-top:4px;
  font-size:12px; color:#cfcfcf; line-height:1.4;
}
.h-actions{
  display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;
}
.h-actions button{
  border-radius:12px;
  padding:8px 10px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.25);
  color:#fff;
  font-weight:900;
  cursor:pointer;
  font-size:12px;
}
.h-actions button.primary2{
  background:linear-gradient(135deg,#1da1f2,#78d6ff);
  color:#00121a;
  border:none;
}
.h-actions .pick{
  display:flex; align-items:center; gap:6px; font-size:12px; color:#cfcfcf;
}
.h-actions input[type="checkbox"]{ transform:scale(1.15); }

/* ë¹„êµ ëª¨ë‹¬ */
.modal{
  position:fixed; inset:0;
  display:none;
  align-items:center; justify-content:center;
  z-index:3200;
  padding:16px;
  background:rgba(0,0,0,.75);
}
.modal-box{
  width:100%;
  max-width:980px;
  background:rgba(17,17,17,.95);
  border:1px solid rgba(255,255,255,.08);
  border-radius:18px;
  box-shadow:0 18px 60px rgba(0,0,0,.75);
  backdrop-filter: blur(10px);
  padding:14px;
}
.modal-head{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  margin-bottom:10px;
}
.modal-head .t{ font-weight:900; color:var(--gold2); }
.modal-close{
  cursor:pointer; user-select:none;
  padding:8px 10px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.25);
  font-weight:900;
}
.compare-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}
@media(max-width:760px){ .compare-grid{ grid-template-columns:1fr; } }
.compare-col{
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.25);
  border-radius:16px;
  padding:12px;
}
.compare-col .ct{ font-weight:900; margin-bottom:8px; }
.compare-col .line{ display:flex; justify-content:space-between; gap:10px; font-size:12px; padding:6px 0; border-bottom:1px solid rgba(255,255,255,.06); }
.compare-col .line:last-child{ border-bottom:none; }
.compare-col .line .k{ color:#cfcfcf; }
.compare-col .line .v{ font-weight:900; }
.compare-col .mini-actions{ display:flex; gap:8px; margin-top:10px; flex-wrap:wrap; }
.compare-col .mini-actions button{
  flex:1; min-width:120px;
  border:none; border-radius:12px; padding:10px;
  font-weight:900; cursor:pointer;
}
.compare-col .mini-actions .restore{ background:linear-gradient(135deg,#1da1f2,#78d6ff); color:#00121a; }
.compare-col .mini-actions .close{ background:#1f1f1f; color:#fff; border:1px solid rgba(255,255,255,.06); }

/* í† ìŠ¤íŠ¸ */
#toast88{
  position:fixed; left:50%; bottom:22px; transform:translateX(-50%);
  background:rgba(0,0,0,.85); color:#fff;
  padding:10px 12px; border-radius:12px; font-size:12px;
  z-index:4000; border:1px solid rgba(255,255,255,.08);
  opacity:0; pointer-events:none; transition:opacity .2s ease;
}

/* ===== ë¶„ì„ê¸° ì§„ì… ê´‘ê³  íŒì—… (Aì•ˆ: 1ì¼ 1íšŒ, 2ê°œ ë…¸ì¶œ) ===== */
.ad-popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.78);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:2600;
  padding:18px;
}
.ad-box{
  width:100%;
  max-width:420px;
  background:rgba(17,17,17,.95);
  border:1px solid rgba(255,255,255,.08);
  border-radius:18px;
  padding:18px;
  box-shadow:0 18px 60px rgba(0,0,0,.75);
  backdrop-filter: blur(10px);
}
.ad-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom:10px;
}
.ad-title{
  font-weight:900;
  color:var(--gold2);
  font-size:14px;
}
.ad-close{
  cursor:pointer;
  user-select:none;
  font-size:12px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.28);
  color:#fff;
}
.ad-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
@media(max-width:360px){
  .ad-grid{ grid-template-columns:1fr; }
}
.ad-item{
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.25);
  border-radius:14px;
  padding:12px;
  cursor:pointer;
}
.ad-item .name{ font-weight:900; font-size:13px; }
.ad-item .sub{ font-size:11px; color:#bdbdbd; margin-top:4px; line-height:1.4; }
.ad-item .badge{
  display:inline-block;
  margin-top:8px;
  font-size:11px;
  font-weight:900;
  padding:4px 8px;
  border-radius:999px;
  background:linear-gradient(135deg,var(--gold),var(--gold2));
  color:#111;
}
.ad-actions{
  display:flex;
  gap:10px;
  margin-top:12px;
}
.ad-actions .btnx{
  flex:1;
  text-align:center;
  padding:10px 12px;
  border-radius:14px;
  font-weight:900;
  cursor:pointer;
  border:1px solid rgba(255,255,255,.08);
  background:#1f1f1f;
  color:#fff;
  text-decoration:none;
}
.ad-actions .btnx.primary{
  background:linear-gradient(135deg,#1da1f2,#78d6ff);
  color:#00121a;
  border:none;
}
.ad-note{
  margin-top:10px;
  font-size:11px;
  color:#9a9a9a;
  line-height:1.4;
}

/* ===== UX Add-ons (non-breaking) ===== */
.save-badge{
  margin-left:auto;
  font-size:11px;
  font-weight:900;
  color:rgba(255,255,255,.86);
  letter-spacing:.2px;
  display:inline-flex;
  align-items:center;
  gap:6px;
}
.save-badge .dot{
  width:8px; height:8px; border-radius:999px;
  background:rgba(255,255,255,.55);
  box-shadow:0 0 0 3px rgba(255,255,255,.08);
}
.quick-nav{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-top:10px;
}
.quick-nav .chip{
  border:1px solid rgba(var(--accentRGB),.28);
  background:rgba(255,255,255,.06);
  color:#fff;
  padding:8px 10px;
  border-radius:999px;
  font-weight:900;
  font-size:12px;
  cursor:pointer;
  transition:transform .12s ease, background .12s ease;
}
.quick-nav .chip:hover{ transform:translateY(-1px); background:rgba(255,255,255,.09); }
.mini-guide{
  margin-top:10px;
  border:1px solid rgba(255,255,255,.08);
  background:rgba(255,255,255,.04);
  border-radius:14px;
  overflow:hidden;
}
.mini-guide .head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:10px 12px;
  cursor:pointer;
  user-select:none;
  font-weight:900;
}
.mini-guide .head .pill{
  font-size:11px;
  font-weight:900;
  background:rgba(var(--accentRGB),.18);
  border:1px solid rgba(var(--accentRGB),.28);
  padding:6px 10px;
  border-radius:999px;
}
.mini-guide .body{
  display:none;
  padding:10px 12px 12px;
  color:#d7d7d7;
  font-size:12px;
  line-height:1.5;
}
.mini-guide .body b{ color:#fff; }
.is-invalid{
  outline:2px solid rgba(255,90,90,.75) !important;
  box-shadow:0 0 0 6px rgba(255,90,90,.12) !important;
  border-color:rgba(255,90,90,.6) !important;
}
.modal-box.share{
  max-width:560px;
}
.share-canvas-wrap{
  margin-top:12px;
  background:rgba(0,0,0,.35);
  border:1px solid rgba(255,255,255,.10);
  border-radius:14px;
  padding:10px;
}
.share-canvas{
  width:100%;
  height:auto;
  border-radius:12px;
  display:block;
}
@media (max-width:560px){
  body{ padding-bottom: calc(env(safe-area-inset-bottom) + 72px); }
  .mobile-dock{
    position:fixed;
    left:0; right:0; bottom:0;
    z-index:1700;
    display:flex;
    gap:10px;
    padding:10px 12px calc(env(safe-area-inset-bottom) + 12px);
    background:linear-gradient(180deg, rgba(10,10,12,0), rgba(10,10,12,.72) 30%, rgba(10,10,12,.94));
    backdrop-filter: blur(10px);
  }
  .mobile-dock .dock-btn{
    flex:1;
    border:1px solid rgba(255,255,255,.10);
    background:rgba(255,255,255,.06);
    color:#fff;
    border-radius:14px;
    padding:12px 10px;
    font-weight:1000;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:8px;
    min-height:44px;
  }
  .mobile-dock .dock-btn.primary{
    background:linear-gradient(135deg, var(--gold), var(--gold2));
    color:#000;
    border-color:rgba(0,0,0,.08);
  }
}
@media (min-width:561px){
  .mobile-dock{ display:none; }
}



/* ===== Empty History Demo ===== */
.demo-empty{
  border:1px dashed rgba(255,255,255,.18);
  background:rgba(255,255,255,.03);
  padding:14px;
  border-radius:14px;
}
.demo-title{ font-weight:900; font-size:14px; margin-bottom:6px; }
.demo-desc{ font-size:12px; color:#cfcfcf; line-height:1.5; }
.demo-btns{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
.demo-btns .btn{ flex:1; min-width:170px; }
.demo-note{ margin-top:10px; font-size:11px; color:#9aa0a6; line-height:1.45; }

/* ===== First-Visit Onboarding ===== */
.onb-highlight{
  position:relative;
  z-index:9998 !important;
  border-radius:16px !important;
  box-shadow: 0 0 0 9999px rgba(0,0,0,.68), 0 0 0 2px rgba(255,255,255,.18) !important;
}
#onbPopover{
  position:fixed;
  z-index:9999;
  max-width:340px;
  width:calc(100vw - 36px);
  background:rgba(14,16,20,.96);
  border:1px solid rgba(255,255,255,.14);
  border-radius:16px;
  box-shadow: 0 10px 30px rgba(0,0,0,.45);
  padding:14px;
  display:none;
}
#onbPopover .onb-hd{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
}
#onbPopover .onb-title{
  font-weight:900; font-size:14px;
}
#onbPopover .onb-step{
  font-size:11px; color:#9aa0a6;
}
#onbPopover .onb-body{
  margin-top:8px;
  font-size:12px; color:#cfcfcf; line-height:1.55;
}
#onbPopover .onb-actions{
  display:flex; gap:8px; margin-top:12px; justify-content:flex-end; flex-wrap:wrap;
}
#onbPopover .onb-actions .btn{ min-width:0; }
#onbPopover .onb-skip{
  margin-right:auto;
  font-size:12px;
  background:transparent;
  border:1px solid rgba(255,255,255,.16);
  color:#cfcfcf;
}


/* ===== ì…ë ¥ ê²€ì¦ ===== */
.invalid{
  border-color: rgba(255,90,90,.95) !important;
  box-shadow: 0 0 0 3px rgba(255,90,90,.18) !important;
}
.input-warn{
  margin-top:10px;
  padding:10px 12px;
  border-radius:14px;
  background:rgba(255,90,90,.10);
  border:1px solid rgba(255,90,90,.25);
  color:#ffd1d1;
  font-size:12px;
  line-height:1.45;
  display:none;
}
.input-warn b{ color:#fff; }

/* ===== ìµœê·¼ ì…ë ¥ ìŠ¤ëƒ…ìƒ· ===== */
.snap-wrap{
  margin-top:12px;
  padding:10px 12px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.22);
}
.snap-head{
  font-size:12px;
  color:#cfcfcf;
  font-weight:800;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.snap-list{
  margin-top:8px;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.snap-chip{
  cursor:pointer;
  border:1px solid rgba(255,255,255,.16);
  background:rgba(255,255,255,.06);
  color:#fff;
  border-radius:999px;
  padding:6px 10px;
  font-size:12px;
  font-weight:800;
}
.snap-chip:hover{
  transform: translateY(-1px);
  border-color: rgba(255,255,255,.28);
}
.snap-meta{ color:#cfcfcf; font-weight:700; margin-left:6px; font-size:11px; }

/* ===== ë‚´ í†µê³„(ì„±ê³¼) ===== */
.perf-box{
  margin-top:12px;
  border-radius:16px;
  padding:12px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.22);
}
.perf-title{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  font-weight:900; font-size:13px;
}
.perf-sub{
  margin-top:6px;
  font-size:12px; color:#cfcfcf; line-height:1.45;
}
.perf-grid{
  margin-top:10px;
  display:grid;
  grid-template-columns: repeat(3, minmax(0,1fr));
  gap:10px;
}
.perf-tile{
  border:1px solid rgba(255,255,255,.10);
  background:rgba(255,255,255,.05);
  border-radius:14px;
  padding:10px;
}
.perf-k{ font-size:12px; color:#cfcfcf; font-weight:800; }
.perf-v{ margin-top:4px; font-size:16px; font-weight:900; }
.perf-n{ margin-top:4px; font-size:11px; color:#bfbfbf; font-weight:700; }

.outTag{
  display:inline-flex; align-items:center; gap:6px;
  border-radius:999px;
  padding:4px 10px;
  font-size:11px;
  font-weight:900;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.06);
  color:#fff;
}
.outTag.win{ border-color: rgba(67,226,164,.40); background: rgba(67,226,164,.12); }
.outTag.lose{ border-color: rgba(255,90,90,.40); background: rgba(255,90,90,.12); }
.outTag.void{ border-color: rgba(255,208,72,.40); background: rgba(255,208,72,.10); }
.outTag.none{ border-color: rgba(255,255,255,.14); background: rgba(255,255,255,.06); color:#cfcfcf; }

.outBtns{
  margin-top:8px;
  display:flex;
  gap:6px;
  flex-wrap:wrap;
}
.oBtn{
  cursor:pointer;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.06);
  color:#fff;
  border-radius:12px;
  padding:6px 10px;
  font-size:12px;
  font-weight:900;
}
.oBtn:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.24); }
.oBtn.on{ border-color: rgba(255,255,255,.40); background:rgba(255,255,255,.12); }

.h-outcome{
  margin-top:10px;
  padding-top:10px;
  border-top:1px dashed rgba(255,255,255,.12);
}
.h-outcome .row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  flex-wrap:wrap;
}
.h-outcome .row .label{ font-size:12px; color:#cfcfcf; font-weight:800; }

/* ===== ê²°ê³¼ ìƒë‹¨ ê¸°ë¡/ì‹ ë¢° ===== */
.trustLine{
  margin-top:10px;
  font-size:12px;
  color:#cfcfcf;
  line-height:1.45;
}
.trustLine b{ color:#fff; }

.heroReason{
  margin-top:8px;
  font-size:12px;
  color:#d9d9d9;
  line-height:1.45;
  padding:8px 10px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.08);
  background:rgba(255,255,255,.04);
}

.outcomeBar{
  margin-top:8px;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.outcomeBar .oBtn{ border-radius:999px; padding:8px 12px; }



/* ===== Settings spotlight (calcCard) ===== */
#calcCard{
  border:1px solid rgba(var(--accentRGB),.24) !important;
  background:
    radial-gradient(110% 160% at 12% 0%, rgba(var(--accentRGB),.16), rgba(0,0,0,0) 55%),
    linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.015));
  box-shadow: 0 18px 45px rgba(0,0,0,.62), 0 0 0 1px rgba(var(--accentRGB),.08) inset;
  position:relative;
  overflow:hidden;
}
#calcCard:before{
  content:"";
  position:absolute; inset:-2px;
  background:linear-gradient(90deg, rgba(var(--accentRGB),.30), rgba(255,255,255,0), rgba(var(--accentRGB),.12));
  opacity:.25;
  pointer-events:none;
  transform:skewX(-14deg) translateX(-40%);
  filter:blur(0px);
}
#calcCard .title{
  font-size:18px !important;
  letter-spacing:.2px;
}
#calcCard .pill-need{
  font-size:11px;
  font-weight:950;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(var(--accentRGB),.30);
  color:rgba(255,255,255,.92);
  background:rgba(var(--accentRGB),.10);
  display:inline-flex;
  align-items:center;
  gap:6px;
  white-space:nowrap;
  margin-left:6px;
}
#calcCard .controls-settings{
  margin-top:12px;
}
#calcCard .selectWrap{
  position:relative;
}
#calcCard .fieldLabel{
  display:flex;
  align-items:center;
  gap:8px;
  margin:0 0 6px 6px;
  font-size:12px;
  font-weight:900;
  color:rgba(255,255,255,.82);
}
#calcCard .stepBubble{
  width:18px; height:18px;
  border-radius:999px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-size:11px;
  font-weight:950;
  color:#111;
  background:linear-gradient(135deg, var(--gold), var(--gold2));
  box-shadow:0 8px 18px rgba(var(--accentRGB),.18);
}
#calcCard .select{
  border:1px solid rgba(var(--accentRGB),.30) !important;
  background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.02)) !important;
  padding:14px 12px !important;
  font-weight:900 !important;
}
#calcCard .select:focus{
  box-shadow:0 0 0 3px rgba(var(--accentRGB),.18);
}
#calcCard .settingsHint{
  margin-top:10px;
  padding:10px 12px;
  border-radius:14px;
  border:1px dashed rgba(255,255,255,.12);
  background:rgba(255,255,255,.03);
  font-size:12px;
  color:rgba(255,255,255,.78);
}
#calcCard .row2{
  margin-top:12px !important;
  padding-top:10px;
  border-top:1px solid rgba(255,255,255,.08);
}
@keyframes calcGlow{
  0%,100%{ box-shadow: 0 18px 45px rgba(0,0,0,.62), 0 0 0 1px rgba(var(--accentRGB),.08) inset; }
  50%{ box-shadow: 0 22px 55px rgba(0,0,0,.68), 0 0 0 1px rgba(var(--accentRGB),.14) inset, 0 0 26px rgba(var(--accentRGB),.08); }
}
#calcCard{ animation:calcGlow 4.2s ease-in-out infinite; }
@media (prefers-reduced-motion: reduce){
  #calcCard{ animation:none; }
  #calcCard:before{ display:none; }
}



/* 88 logo spotlight */
.logoImg, .logo-img{
  width:min(170px,52vw) !important;
  height:auto;
  display:block;
  padding:10px;
  border-radius:20px;
  background:rgba(20,20,24,var(--glassSoftA));
  border:1px solid rgba(255,255,255,.12);
  box-shadow:0 0 0 1px rgba(255,255,255,.06), 0 14px 40px rgba(0,0,0,.42), 0 0 26px rgba(var(--accentRGB), .22);
}
@media(max-width:480px){
  .logoImg, .logo-img{ width:min(150px,72vw) !important; padding:9px; }
}

</style>
<script src="../assets/theme-preset.js" defer></script>

<style id="v13_1_theme_override">
/* === v13.1 look unify (from main index) === */
:root{
  /* unify accent (blue) */
  --accent1:#5fb2ff !important;
  --accent2:#a8dcff !important;
  --accentRGB:95,178,255 !important;  /* for rgba(var(--accentRGB), .xx) */
  --accentText:#00121a !important;
  --accentOn:#00121a !important;

  /* unify tokens */
  --bg:#05060b !important;
  --panel:rgba(12,14,22,.62) !important;
  --glassA:.72 !important;
  --glassStrongA:.86 !important;
  --glassSoftA:.18 !important;
  --glassBorder:rgba(255,255,255,.10) !important;

  /* backward compat */
  --gold: var(--accent1) !important;
  --gold2: var(--accent2) !important;
}

/* premium midnight background */
body{
  background:
    radial-gradient(1200px 620px at 50% -10%, rgba(var(--accentRGB),.18), transparent 58%),
    radial-gradient(900px 540px at 15% 25%, rgba(120,170,255,.10), transparent 55%),
    radial-gradient(900px 640px at 85% 35%, rgba(80,140,255,.08), transparent 55%),
    linear-gradient(180deg, #05060b 0%, #060612 60%, #040408 100%) !important;
  color:#fff;
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,system-ui;
}

/* remove small label badges (TODAY/MAIN/NEW...) */
.title .badge,
.section-title .badge,
h1 .badge,
h2 .badge,
h3 .badge{ display:none !important; }

/* panel unification (safe selectors) */
.section, .panel, .box, .card, .wrap, .container, .hero, header{
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
}

/* inputs */
input, select, textarea{
  background: rgba(0,0,0,.28) !important;
  border:1px solid rgba(255,255,255,.14) !important;
  color:#fff !important;
  border-radius:14px !important;
  outline:none;
}
input:focus, select:focus, textarea:focus{
  border-color: rgba(var(--accentRGB), .38) !important;
  box-shadow: 0 0 0 3px rgba(var(--accentRGB), .12) !important;
}

/* buttons: less-blue, premium glass */
.btn, button, a.btn{
  background: rgba(255,255,255,.06) !important;
  border:1px solid rgba(255,255,255,.14) !important;
  color: rgba(255,255,255,.92) !important;
  box-shadow: 0 12px 34px rgba(0,0,0,.38) !important;
}
.btn:hover, button:hover, a.btn:hover{ filter: brightness(1.06); }
.btn.primary, .btn.go{
  border-color: rgba(var(--accentRGB), .22) !important;
  background: rgba(255,255,255,.08) !important;
}
.btn.secondary, .btn.ghost{
  background: rgba(0,0,0,.18) !important;
}

/* links */
a{ color:inherit; }
</style>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "í™ˆ",
      "item": "https://88st.cloud/"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "ë¶„ì„ê¸°",
      "item": "https://88st.cloud/analysis/"
    }
  ]
}
</script>
</head>

<body>

<!-- âœ… ìƒë‹¨ ê³µì§€/ì´ë²¤íŠ¸ ë°°ë„ˆ(ìë™ ìˆœí™˜) -->
<div class="notice-bar" id="noticeBar" role="region" aria-label="ìƒë‹¨ ê³µì§€">
  <span class="notice-icon" aria-hidden="true">ğŸ””</span>
  <a href="https://t.me/UZU59" target="_blank" rel="noopener" aria-label="ê³µì§€ ì—´ê¸° (í…”ë ˆê·¸ë¨)">
    <span id="noticeText"></span>
    <span class="notice-mini-text" id="noticeMiniText">ì‚¬ì¹­ ì£¼ì˜ Â· @UZU59</span>
  </a>
  <button class="notice-toggle" id="noticeToggle" type="button" aria-label="ê³µì§€ ì ‘ê¸°/í¼ì¹˜ê¸°" title="ê³µì§€ ì ‘ê¸°/í¼ì¹˜ê¸°">â–¾</button>
</div>

<!-- âœ… ì‚¬ì¹­ì£¼ì˜ íŒì—… (1ì¼ 1íšŒ) -->
<div class="scam-popup" id="scamPopup">
  <div class="scam-box">
    <h3>âš ï¸ ì‚¬ì¹­ ì£¼ì˜ ì•ˆë‚´</h3>
    <p>
      88 ì»¤ë®¤ë‹ˆí‹° ê³µì‹ ê´€ë¦¬ì í…”ë ˆê·¸ë¨ì€<br>
      <b>@UZU59</b> ë‹¨ í•˜ë‚˜ì…ë‹ˆë‹¤.<br><br>
      ê·¸ ì™¸ ê³„ì •ì€ ì‚¬ì¹­ì¼ ìˆ˜ ìˆìœ¼ë‹ˆ<br>
      ë°˜ë“œì‹œ ì£¼ì˜í•´ ì£¼ì„¸ìš”.
    </p>
    <div class="btn" onclick="closeScam()">í™•ì¸</div>
  </div>
</div>

<!-- âœ… ë¶„ì„ê¸° ì§„ì… ê´‘ê³  íŒì—… (1ì¼ 1íšŒ) -->
<div class="ad-popup" id="adPopup">
  <div class="ad-box">
    <div class="ad-head">
      <div class="ad-title">ğŸ ì§€ê¸ˆ ë§ì´ ì°¾ëŠ” ì¶”ì²œ ë†€ì´í„°</div>
      <div class="ad-close" onclick="closeAdPopup(true)">ì˜¤ëŠ˜ ê·¸ë§Œ ë³´ê¸°</div>
    </div>

    <div class="ad-grid" id="adGrid"></div>

    <div class="ad-actions">
      <a class="btnx primary" href="/#vendors" aria-label="ì¸ì¦ ë†€ì´í„° ë³´ê¸°">ì¸ì¦ ë†€ì´í„° ë³´ê¸°</a>
      <a class="btnx" href="https://t.me/UZU59" target="_blank" rel="noopener">ë¬¸ì˜</a>
    </div>

    <div class="ad-note">â€» íŒì—…ì€ 1ì¼ 1íšŒë§Œ í‘œì‹œë©ë‹ˆë‹¤. (ì›ì¹˜ ì•Šìœ¼ë©´ ë‹«ê¸°)</div>
    <div class="ad-close" style="margin-top:10px;text-align:center;" onclick="closeAdPopup(false)">ë‹«ê¸°</div>
  </div>
</div>


<div class="header">
  <a class="logo-link" href="/" aria-label="í™ˆìœ¼ë¡œ ì´ë™">
    <img src="/img/logo.png" alt="88 ì»¤ë®¤ë‹ˆí‹°" class="logo-img logoImg">
  </a>
  <div class="sub">ìŠ¤í¬ì¸  ë°°ë‹¹ ë¶„ì„ê¸° (ì™„ì „ì²´ Â· í†µí•© ë§ˆì§„/EV/íˆìŠ¤í† ë¦¬ Â· íŒë‹¨ ë³´ì¡°ìš©)</div>
</div>

<div class="wrap">

  <!-- âœ… ë°°íŒ… ì²´í¬ë¦¬ìŠ¤íŠ¸ (ëœë¤ 3ì¤„) -->
  <div class="card" id="checkCard">
    <div class="title"><span class="badge">CHECK</span>ë°°íŒ… ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸</div>
    <div class="checklist" id="checklistText"></div>
    <div class="history-toolbar">
      <button class="btn secondary" type="button" onclick="refreshChecklist()">ì²´í¬ë¦¬ìŠ¤íŠ¸ ìƒˆë¡œê³ ì¹¨</button>
      <button class="btn secondary" type="button" onclick="scrollToCalc()">ë¶„ì„ê¸°ë¡œ ì´ë™</button>
    </div>
    <div class="small-hint">â€» ê³¼ëª°ì… ë°©ì§€/ë¦¬ìŠ¤í¬ ê´€ë¦¬ìš© ì•ˆë‚´ì…ë‹ˆë‹¤.</div>
  </div>

  <!-- âœ… ì˜¤ëŠ˜ ë§ˆì§„ ë‚®ì€ TOP3 (ìë™) -->
  <div class="card">
    <div class="title"><span class="badge">TOP3</span>ì˜¤ëŠ˜ ë§ˆì§„ ë‚®ì€ ê³„ì‚° TOP3</div>
    <div class="small-hint">â€» ì˜¤ëŠ˜ ì €ì¥ëœ íˆìŠ¤í† ë¦¬ì—ì„œ â€œë§ˆì§„%â€ê°€ ê°€ì¥ ë‚®ì€ ìˆœìœ¼ë¡œ ìë™ ì •ë ¬ë©ë‹ˆë‹¤.</div>
    <div class="box" style="margin-top:10px;">
      <div class="box-title">ë©”ì¸ ë§ˆì§„ TOP3</div>
      <div id="topMain" class="small-hint"></div>
    </div>
    <div class="box">
      <div class="box-title">ì˜¤ë²„/ì–¸ë” ë§ˆì§„ TOP3</div>
      <div id="topOU" class="small-hint"></div>
    </div>
    <div class="box">
      <div class="box-title">í•¸ë””ìº¡ ë§ˆì§„ TOP3</div>
      <div id="topHC" class="small-hint"></div>
    </div>
  </div>

  <!-- âœ… ë§ˆì§„ ì„¤ëª…/ì˜ˆì‹œ -->
  <div class="card">
    <div class="title"><span class="badge">INFO</span>â€œë§ˆì§„ ë‚®ì€ ê²½ê¸°â€ ê¸°ì¤€ & ì˜ˆì‹œ</div>
    <div class="note" style="margin-top:0;">
      â€¢ ë§ˆì§„(ìˆ˜ìˆ˜ë£Œ)ì€ <b>ì˜¤ë²„ë¼ìš´ë“œ-1</b>ì„ %ë¡œ í‘œí˜„í•œ ê°’ì…ë‹ˆë‹¤.<br>
      â€¢ ì¢…ëª©/ìœ í˜•ë³„ë¡œ ì¼ë°˜ì ì¸ ë§ˆì§„ ë²”ìœ„ê°€ ë‹¬ë¼ì„œ, ì´ í˜ì´ì§€ëŠ” <b>ì¢…ëª©+ìœ í˜•ë³„ ê¸°ì¤€</b>ìœ¼ë¡œ â€œë‚®ìŒ/ë³´í†µ/ì£¼ì˜/ê³ ë§ˆì§„â€ì„ íŒì •í•©ë‹ˆë‹¤.<br>
      â€¢ ì•„ë˜ ê¸°ì¤€ì€ â€œëŒ€ëµì ì¸ ì²´ê°â€ì„ ë¹ ë¥´ê²Œ ë•ê¸° ìœ„í•œ ìš©ë„ì´ë©°, ì‹¤ì œ ë¼ì¸/ì—…ì²´/ì‹œì¥ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”.
    </div>
    <div class="box" style="margin-top:10px;">
      <div class="box-title">ì˜ˆì‹œ (ì¶•êµ¬ 1X2)</div>
      <div class="small-hint">
        ë°°ë‹¹: <b>1.70 / 3.20 / 3.40</b> â†’ ì˜¤ë²„ë¼ìš´ë“œê°€ ì»¤ì ¸ <b>ê³ ë§ˆì§„</b>ìœ¼ë¡œ ëœ° ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
        ë°˜ëŒ€ë¡œ ë™ì¼ ì‹œì¥ì—ì„œ ì˜¤ë²„ë¼ìš´ë“œê°€ 1.05 ê·¼ì²˜ë©´ ëŒ€ì²´ë¡œ <b>ë§ˆì§„ ë‚®ìŒ</b>ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.
      </div>
    </div>
  </div>

  <!-- âœ… ê³„ì‚°/ë¶„ì„ê¸° ì¹´ë“œ -->
  <div class="card" id="calcCard">
    <div class="title"><span class="badge">CALC</span>ë¶„ì„ê¸° ì„¤ì • <span class="pill-need">âœ¨ ë¨¼ì € ì„¤ì •</span> <span id="saveBadge" class="save-badge" aria-live="polite"></span></div>

    <div class="controls controls-settings">
      <div class="selectWrap">
        <div class="fieldLabel"><span class="stepBubble">1</span> ì¢…ëª©</div>
        <select id="sport" class="select" onchange="onSportChange()">
        <option value="soccer">ì¶•êµ¬</option>
        <option value="basketball">ë†êµ¬</option>
        <option value="baseball">ì•¼êµ¬</option>
        <option value="volleyball">ë°°êµ¬</option>
        <option value="esports">eìŠ¤í¬ì¸ </option>
        <option value="hockey">í•˜í‚¤</option>
      </select>
      </div>
      <div class="selectWrap">
        <div class="fieldLabel"><span class="stepBubble">2</span> ë¶„ì„ ë ˆë²¨</div>
        <select id="level" class="select" onchange="onLevelChange()">
        <option value="simple">ê°„ë‹¨</option>
        <option value="mid">ì¤‘ê¸‰</option>
        <option value="adv">ê³ ê¸‰</option>
      </select>
      </div>
    </div>
    <div class="settingsHint">ğŸ‘‡ ë¨¼ì € <b>ì¢…ëª©</b>ê³¼ <b>ë ˆë²¨</b>ì„ ì„ íƒí•˜ë©´, ì•„ë˜ ì…ë ¥ í¼(ë©”ì¸/ì˜¤ë²„Â·ì–¸ë”/í•¸ë””)ì´ ìë™ìœ¼ë¡œ ìµœì í™”ë©ë‹ˆë‹¤.</div>


    <!-- âœ… íŒ€/ë¦¬ê·¸ ì…ë ¥(ì„ íƒ) -->
    <div class="row2">
      <div>
        <input id="league" class="textinput" placeholder="ë¦¬ê·¸/ëŒ€íšŒëª… (ì„ íƒ)">
        <div class="small-hint">â€» ì…ë ¥í•˜ì§€ ì•Šì•„ë„ ë¶„ì„ ê°€ëŠ¥ / ê³µìœ  ì‹œ ì…ë ¥í•œ ë‚´ìš©ë§Œ í¬í•¨ë©ë‹ˆë‹¤.</div>
      </div>
      <div>
        <input id="teams" class="textinput" placeholder="íŒ€ëª… (ì„ íƒ) ì˜ˆ: ë§¨ì‹œí‹° vs ë¦¬ë²„í’€">
        <div class="small-hint">â€» íŒ€/ë¦¬ê·¸ëŠ” ì„ íƒì‚¬í•­ì…ë‹ˆë‹¤.</div>
      </div>
    </div>

    <div class="small-hint" id="sportHint" style="margin-top:10px;"></div>
    <div class="quick-nav" id="quickNav">
      <button class="chip" type="button" onclick="quickJump('main')">ë©”ì¸</button>
      <button class="chip" type="button" onclick="quickJump('total')">ì˜¤ë²„Â·ì–¸ë”</button>
      <button class="chip" type="button" onclick="quickJump('handicap')">í•¸ë””ìº¡</button>
      <button class="chip" type="button" onclick="quickJump('result')">ê²°ê³¼</button>
      <button class="chip" type="button" onclick="quickJump('history')">íˆìŠ¤í† ë¦¬</button>
    </div>

    <div class="mini-guide" id="miniGuide">
      <div class="head" onclick="toggleMiniGuide()">
        <div>ğŸ’¡ ì²˜ìŒì´ë©´ <b>10ì´ˆ ê°€ì´ë“œ</b></div>
        <div class="pill" id="miniGuidePill">ì—´ê¸°</div>
      </div>
      <div class="body" id="miniGuideBody">
        1) <b>ì¢…ëª©/ëª¨ë“œ</b> ì„ íƒ â†’ 2) <b>ë©”ì¸ ë°°ë‹¹</b> ì…ë ¥(í•„ìˆ˜) â†’ 3) ì˜¤ë²„Â·ì–¸ë”/í•¸ë””(ì„ íƒ) â†’ 4) <b>ì¤‘ê¸‰/ê³ ê¸‰</b>ì´ë©´ <b>ë‚´ ì˜ˆìƒ í™•ë¥ </b> ì…ë ¥ ì‹œ EV/ì¼ˆë¦¬ê¹Œì§€ ê³„ì‚°ë©ë‹ˆë‹¤.<br>
        â€¢ ê²°ê³¼ëŠ” <b>íŒë‹¨ ë³´ì¡°ìš©</b>ì´ë©°, ë§ˆì§„ì´ ë†’ì„ìˆ˜ë¡ ì¥ê¸° ê¸°ëŒ€ê°’ì´ ë¶ˆë¦¬í•´ì§ˆ ìˆ˜ ìˆì–´ìš”.<br>
        â€¢ íˆìŠ¤í† ë¦¬ í•­ëª© í´ë¦­í•˜ë©´ <b>ì…ë ¥ ìë™ ë³µì› + ì¬ê³„ì‚°</b>ë©ë‹ˆë‹¤.
      </div>
    </div>

    <!-- âœ… ìµœê·¼ ì…ë ¥ ìŠ¤ëƒ…ìƒ·(ìµœê·¼ 5ê°œ) -->
    <div class="snap-wrap" id="snapWrap" style="display:none;">
      <div class="snap-head">
        <div>ğŸ•˜ ìµœê·¼ ì…ë ¥</div>
        <div class="snap-meta" id="snapMeta"></div>
      </div>
      <div class="snap-list" id="snapList"></div>
    </div>




    <!-- ===== ë©”ì¸ ì‹œì¥ ===== -->
    <div class="box" id="mainBox">
      <div class="box-title" id="mainMarketTitle">ë©”ì¸ ë°°ë‹¹</div>

      <!-- 2-way -->
      <div id="main2" style="display:none;">
        <div class="grid">
          <div class="field">
            <label id="main2LabelA">ì„ íƒ A ë°°ë‹¹</label>
            <input id="main2OddsA" inputmode="decimal" placeholder="ì˜ˆ: 1.85">
          </div>
          <div class="field">
            <label id="main2LabelB">ì„ íƒ B ë°°ë‹¹</label>
            <input id="main2OddsB" inputmode="decimal" placeholder="ì˜ˆ: 2.05">
          </div>
        </div>
      </div>

      <!-- 3-way -->
      <div id="main3" style="display:none;">
        <div class="grid">
          <div class="field">
            <label id="main3LabelH">í™ˆ ë°°ë‹¹</label>
            <input id="main3OddsH" inputmode="decimal" placeholder="ì˜ˆ: 2.10">
          </div>
          <div class="field">
            <label id="main3LabelD">ë¬´ ë°°ë‹¹</label>
            <input id="main3OddsD" inputmode="decimal" placeholder="ì˜ˆ: 3.20">
          </div>
          <div class="field">
            <label id="main3LabelA">ì›ì • ë°°ë‹¹</label>
            <input id="main3OddsA" inputmode="decimal" placeholder="ì˜ˆ: 3.40">
          </div>
          <div class="field">
            <label> </label>
            <input disabled value="â€» ì¶•êµ¬ëŠ” 3ë°°ë‹¹ì´ ê¸°ë³¸ì…ë‹ˆë‹¤">
          </div>
        </div>
      </div>

      <!-- ì¤‘ê¸‰/ê³ ê¸‰: ë‚´ í™•ë¥ /ë² íŒ…ê¸ˆ -->
      <div id="valueInputs" style="display:none;">
        <div class="grid">
          <div class="field">
            <label id="myProbLabel">ë‚´ ì˜ˆìƒ í™•ë¥ (ì„ íƒ) %</label>
            <input id="myProb" inputmode="decimal" placeholder="ì˜ˆ: 55  ë˜ëŠ”  45,28,27">
            <div class="small-hint" id="myProbHint"></div>
          </div>
          <div class="field">
            <label>ë² íŒ…ê¸ˆ(ì„ íƒ)</label>
            <input id="stake" inputmode="numeric" placeholder="ì˜ˆ: 100000">
            <div class="small-hint">â€» ì…ë ¥ ì‹œ ê¸°ëŒ€ê°’(EV)ì„ ì› ë‹¨ìœ„ë¡œë„ í‘œì‹œí•©ë‹ˆë‹¤.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== í•¸ë””ìº¡ (ì •ë°€: ì–‘ìª½ ë°°ë‹¹) ===== -->
    <div class="box" id="handicapBox" style="display:none;">
      <div class="box-head">
        <div class="box-title" style="margin:0;">í•¸ë””ìº¡ (ì„ íƒ Â· ì •ë°€ ë§ˆì§„)</div>
        <div class="toggle" onclick="toggleBox('handicapBody')">ì ‘ê¸°/í¼ì¹˜ê¸°</div>
      </div>
      <div id="handicapBody">
        <div class="grid">
          <div class="field">
            <label id="handicapLineLabel">í•¸ë”” ë¼ì¸ (ì˜ˆ: -1.5, +3.5)</label>
            <input id="handicapLine" inputmode="decimal" placeholder="ì˜ˆ: -1.5">
          </div>
          <div class="field">
            <label id="handicapOddsALabel">í•¸ë”” ì„ íƒA ë°°ë‹¹</label>
            <input id="handicapOddsA" inputmode="decimal" placeholder="ì˜ˆ: 1.90">
          </div>
          <div class="field">
            <label id="handicapOddsBLabel">ë°˜ëŒ€(ì„ íƒB) ë°°ë‹¹</label>
            <input id="handicapOddsB" inputmode="decimal" placeholder="ì˜ˆ: 1.95">
          </div>
          <div class="field">
            <label>ì•„ì‹œì•ˆ(í‘¸ì‹œ) ê·¼ì‚¬(ì„ íƒ)</label>
            <input id="handicapPush" inputmode="decimal" placeholder="í‘¸ì‹œ í™•ë¥  % (ì˜ˆ: 2)">
          </div>
        </div>
        <div class="small-hint">
          â€» â€œì–‘ìª½ ë°°ë‹¹â€ì´ ìˆì–´ì•¼ í•¸ë”” ë§ˆì§„ì„ ì •ë°€ ê³„ì‚°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ë‹¨ì¼ ë°°ë‹¹ë§Œ ìˆìœ¼ë©´ ì°¸ê³  ìˆ˜ì¤€)
        </div>
      </div>
    </div>

    <!-- ===== ì˜¤ë²„ì–¸ë” ===== -->
    <div class="box" id="totalBox" style="display:none;">
      <div class="box-head">
        <div class="box-title" style="margin:0;">ì˜¤ë²„/ì–¸ë” (ì„ íƒ Â· ì•„ì‹œì•ˆ ê·¼ì‚¬ ì§€ì›)</div>
        <div class="toggle" onclick="toggleBox('totalBody')">ì ‘ê¸°/í¼ì¹˜ê¸°</div>
      </div>
      <div id="totalBody">
        <div class="grid">
          <div class="field">
            <label>ê¸°ì¤€ì  (ì˜ˆ: 2.5, 7.5, 2.0)</label>
            <input id="totalLine" inputmode="decimal" placeholder="ì˜ˆ: 2.5">
          </div>
          <div class="field">
            <label>ì˜¤ë²„ ë°°ë‹¹</label>
            <input id="overOdds" inputmode="decimal" placeholder="ì˜ˆ: 1.95">
          </div>
          <div class="field">
            <label>ì–¸ë” ë°°ë‹¹</label>
            <input id="underOdds" inputmode="decimal" placeholder="ì˜ˆ: 1.85">
          </div>
          <div class="field">
            <label>ì•„ì‹œì•ˆ(í‘¸ì‹œ) ê·¼ì‚¬(ì„ íƒ)</label>
            <input id="ouPush" inputmode="decimal" placeholder="í‘¸ì‹œ í™•ë¥  % (ì˜ˆ: 6)">
          </div>
          <div class="field">
            <label>ë‚´ ì˜ˆìƒ í™•ë¥ (ì˜¤ë²„) % (ê³ ê¸‰)</label>
            <input id="myOverProb" inputmode="decimal" placeholder="ì˜ˆ: 52">
          </div>
          <div class="field">
            <label> </label>
            <input disabled value="â€» í‘¸ì‹œ í™•ë¥  ë¯¸ì…ë ¥ ì‹œ ì¢…ëª© ê¸°ë³¸ê°’ìœ¼ë¡œ ê·¼ì‚¬í•©ë‹ˆë‹¤">
          </div>
        </div>
        <div class="small-hint">â€» ê³ ê¸‰ì—ì„œ ë‚´ ì˜ˆìƒ í™•ë¥ (ì˜¤ë²„)ì„ ë„£ìœ¼ë©´ ì˜¤ë²„ EV/ë¹„ì¤‘ ê³„ì‚°ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
      </div>
    </div>


    <div class="input-warn" id="inputWarn" aria-live="polite"></div>

    <div class="actions">
      <button class="btn primary" id="btnCalc" onclick="calc()">ê³„ì‚°í•˜ê¸°</button>
      <button class="btn secondary" onclick="resetAll()">ì´ˆê¸°í™”</button>
      <button class="btn gold" onclick="copyResult()">ê²°ê³¼ ë³µì‚¬</button>
      <button class="btn secondary" onclick="shareResult()">ê³µìœ </button>
      <button class="btn secondary" onclick="openShareCard()">ê³µìœ  ì¹´ë“œ</button>
    </div>

    <div class="note">
      â€» ë³¸ ë„êµ¬ëŠ” â€œíŒë‹¨ ë³´ì¡°ìš©â€ì…ë‹ˆë‹¤. ìŠ¹ë¥ ì„ ë³´ì¥í•˜ì§€ ì•Šìœ¼ë©°, ì†ì‹¤ì„ ê°ë‹¹ ê°€ëŠ¥í•œ ë²”ìœ„ ë‚´ì—ì„œ ì´ìš©í•˜ì„¸ìš”.
    </div>

    <!-- âœ… í†µí•© ë§ˆì§„ ëŒ€ì‹œë³´ë“œ -->
    <div class="box" style="margin-top:12px;">
      <div class="box-title">í†µí•© ë§ˆì§„ ëŒ€ì‹œë³´ë“œ (ë©”ì¸/OU/í•¸ë””)</div>
      <div class="m-grid" id="marginDash">
        <!-- JS ë Œë” -->
      </div>
      <div class="small-hint" style="margin-top:10px;">
        â€» ìƒ‰ìƒ: <span class="good">ë‚®ìŒ</span> / <span class="mid">ë³´í†µÂ·ì£¼ì˜</span> / <span class="warn">ê³ ë§ˆì§„</span>
      </div>
    </div>

    <div class="result" id="result" style="display:none;"></div>

    <div class="footer-links">
      <a class="linkbtn" href="/">í™ˆìœ¼ë¡œ</a>
      <a class="linkbtn" href="https://t.me/UZU59" target="_blank" rel="noopener">ë¬¸ì˜ (í…”ë ˆê·¸ë¨)</a>
    </div>
  </div>

  <!-- âœ… ìµœê·¼ ê³„ì‚° íˆìŠ¤í† ë¦¬ -->
  <div class="card" id="historyCard">
    <div class="title"><span class="badge">HISTORY</span>ìµœê·¼ ê³„ì‚° íˆìŠ¤í† ë¦¬</div>
    <div class="small-hint">
      â€¢ íˆìŠ¤í† ë¦¬ í•­ëª© í´ë¦­ â†’ <b>ì…ë ¥ ìë™ ë³µì› + ì¦‰ì‹œ ì¬ê³„ì‚°</b><br>
      â€¢ ì²´í¬ 2ê°œ ì„ íƒ â†’ <b>ë¹„êµ(2ê°œ ë‚˜ë€íˆ)</b> ê°€ëŠ¥
    </div>
    <div class="history-actions">
      <div class="history-toolbar">
        <button class="btn secondary danger" type="button" id="btnDeleteSelected" onclick="deleteSelected()" disabled>ì„ íƒ ì‚­ì œ</button>
        <button class="btn secondary" type="button" onclick="clearHistory()">ì „ì²´ ì‚­ì œ</button>
        <button class="btn secondary" type="button" id="btnCompare" onclick="openCompare()" disabled>ë¹„êµ</button>
        <button class="btn secondary" type="button" onclick="renderTop3()">TOP3</button>
      </div>

      <div class="history-filters" aria-label="íˆìŠ¤í† ë¦¬ í•„í„°">
        <button class="seg on" type="button" data-filter="all" onclick="setHistoryFilter('all', this)">ì „ì²´</button>
        <button class="seg" type="button" data-filter="rec" onclick="setHistoryFilter('rec', this)">ì¶”ì²œ</button>
        <button class="seg" type="button" data-filter="untracked" onclick="setHistoryFilter('untracked', this)">ë¯¸ê¸°ë¡</button>
        <div class="pick-ind">ì„ íƒ <b id="pickCount">0</b></div>
      </div>
    </div>
<div class="perf-box" id="perfBox" style="display:none;">
      <div class="perf-title">
        <div>ğŸ“Š ë‚´ ì„±ê³¼</div>
        <div class="snap-meta" id="perfMeta"></div>
      </div>
      <div class="perf-sub" id="perfSub"></div>
      <div class="perf-grid" id="perfGrid"></div>
    </div>

    <div class="h-list" id="historyList"></div>
  </div>
</div>

<!-- ë¹„êµ ëª¨ë‹¬ -->
<div class="modal" id="compareModal">
  <div class="modal-box">
    <div class="modal-head">
      <div class="t">ë¹„êµ (2ê°œ ë‚˜ë€íˆ)</div>
      <div class="modal-close" onclick="closeCompare()">ë‹«ê¸°</div>
    </div>
    <div class="small-hint" style="margin-bottom:10px;">
      íˆìŠ¤í† ë¦¬ì—ì„œ ì²´í¬ë°•ìŠ¤ë¡œ 2ê°œ ì„ íƒ í›„ â€œë¹„êµ ì—´ê¸°â€ë¥¼ ëˆ„ë¥´ì„¸ìš”.
    </div>
    <div class="compare-grid" id="compareGrid"></div>
  </div>
</div>


<!-- ê³µìœ  ì¹´ë“œ ëª¨ë‹¬ (ì´ë¯¸ì§€ ì €ì¥) -->
<div class="modal" id="shareCardModal" style="display:none;">
  <div class="modal-box share">
    <div class="modal-head">
      <div class="t">ê³µìœ  ì¹´ë“œ (ì´ë¯¸ì§€ ì €ì¥)</div>
      <div class="modal-close" onclick="closeShareCard()">ë‹«ê¸°</div>
    </div>
    <div class="small-hint" style="margin-bottom:10px;">
      ê²°ê³¼ê°€ ìƒì„±ëœ ìƒíƒœì—ì„œë§Œ ì¹´ë“œê°€ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤. (í…ìŠ¤íŠ¸/ë§í¬ë„ í•¨ê»˜ ë³µì‚¬ ê°€ëŠ¥)
    </div>
    <div class="share-canvas-wrap">
      <canvas id="shareCardCanvas" class="share-canvas" width="1080" height="1080" aria-label="ê³µìœ  ì¹´ë“œ ìº”ë²„ìŠ¤"></canvas>
    </div>
    <div class="history-toolbar" style="margin-top:12px;">
      <button class="btn secondary" type="button" onclick="copyShareLink()">ë§í¬ ë³µì‚¬</button>
      <button class="btn gold" type="button" onclick="downloadShareCard()">ì´ë¯¸ì§€ ì €ì¥</button>
      <button class="btn secondary" type="button" onclick="copyShareText()">ë¬¸êµ¬ ë³µì‚¬</button>
    </div>
  </div>
</div>

<!-- ëª¨ë°”ì¼ í•˜ë‹¨ ë„í¬ -->
<div class="mobile-dock" id="mobileDock" aria-label="ë¹ ë¥¸ ë™ì‘">
  <button class="dock-btn primary" type="button" onclick="calc()">ê³„ì‚°</button>
  <button class="dock-btn" type="button" onclick="copyResult()">ë³µì‚¬</button>
  <button class="dock-btn" type="button" onclick="openShareCard()">ì¹´ë“œ</button>
  <button class="dock-btn" type="button" onclick="quickJump('top')">ìœ„ë¡œ</button>
</div>

<div id="toast88"></div>

<script>
/* =========================
   ê³µì§€/ì‚¬ì¹­ì£¼ì˜
========================= */
const NOTICE_LIST = [
  "ğŸ”” 88 ì»¤ë®¤ë‹ˆí‹° ê³µì‹ ì•ˆë‚´ Â· ê´€ë¦¬ì ì‚¬ì¹­ ì£¼ì˜ (@UZU59)",
  "ğŸ“Š ë¶„ì„ê¸°: ìŠ¹ë¦¬ í™•ë¥ (ë°°ë‹¹ ê¸°ë°˜Â·ì¶”ì •) / ë§ˆì§„ / EV / Kellyê¹Œì§€",
  "â­ íˆìŠ¤í† ë¦¬ ì €ì¥ + TOP3 ìë™ ë…¸ì¶œ",
  "âš ï¸ ë³¸ í˜ì´ì§€ëŠ” íŒë‹¨ ë³´ì¡°ìš©ì´ë©° ê²°ê³¼ë¥¼ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤"
];
let noticeIndex = 0;
function rotateNotice(){
  const el = document.getElementById("noticeText");
  if(!el) return;
  el.innerText = NOTICE_LIST[noticeIndex];
  const mini = document.getElementById("noticeMiniText");
  if(mini) mini.innerText = "ì‚¬ì¹­ ì£¼ì˜ Â· @UZU59";
  noticeIndex = (noticeIndex + 1) % NOTICE_LIST.length;
}
rotateNotice();
setInterval(rotateNotice, 4000);

/* ê³µì§€ ë°°ë„ˆ: ìŠ¤í¬ë¡¤ ì‹œ ìë™ìœ¼ë¡œ ìŠ¬ë¦¼í•˜ê²Œ(ê°€ì‹œì„± + ì²« í™”ë©´ í™•ë³´) */
(function initNoticeBar(){
  const bar = document.getElementById("noticeBar");
  const tgl = document.getElementById("noticeToggle");
  if(!bar || !tgl) return;

  let manual = null; // null=ìë™, true=ì ‘í˜, false=í¼ì¹¨

  const apply = (collapsed)=>{
    bar.classList.toggle("is-collapsed", collapsed);
    tgl.innerText = collapsed ? "â–¾" : "â–´";
    tgl.setAttribute("aria-label", collapsed ? "ê³µì§€ í¼ì¹˜ê¸°" : "ê³µì§€ ì ‘ê¸°");
  };

  const onScroll = ()=>{
    if(manual !== null) return;
    const y = window.scrollY || document.documentElement.scrollTop || 0;
    apply(y > 18);
  };

  window.addEventListener("scroll", onScroll, {passive:true});
  onScroll();

  tgl.addEventListener("click", (e)=>{
    e.preventDefault();
    e.stopPropagation();
    const now = bar.classList.contains("is-collapsed");
    manual = !now; // ì‚¬ìš©ìê°€ ì„ íƒí•œ ìƒíƒœë¡œ ê³ ì •
    apply(!now);
  });
})();


/* ì‚¬ì¹­ì£¼ì˜ (1ì¼ 1íšŒ) */
(function(){
  const key="scam_popup_date";
  const today=new Date().toISOString().slice(0,10);
  if(localStorage.getItem(key)!==today){
    const pop=document.getElementById("scamPopup");
    if(pop) pop.style.display="flex";
  }
})();
function closeScam(){
  const today=new Date().toISOString().slice(0,10);
  localStorage.setItem("scam_popup_date",today);
  const pop=document.getElementById("scamPopup");
  if(pop) pop.style.display="none";
}

/* ìŠ¤í¬ë¡¤ */
function scrollToCalc(){
  document.getElementById("calcCard")?.scrollIntoView({behavior:"smooth", block:"start"});
}

/* =========================
   ì²´í¬ë¦¬ìŠ¤íŠ¸
========================= */
const CHECKLIST_POOL = [
  "ë¼ì¸ ê¸‰ë³€ ê²½ê¸°(ê°‘ìê¸° ë‚´ë ¤ê°„ ë°°ë‹¹)ëŠ” ì´ìœ ë¶€í„° í™•ì¸í•˜ê¸°",
  "ë§ˆì§„(ìˆ˜ìˆ˜ë£Œ) ë†’ì€ ê²½ê¸°ë©´ í•œ ë‹¨ê³„ ë³´ìˆ˜ì ìœ¼ë¡œ ì ‘ê·¼í•˜ê¸°",
  "1íšŒ ë°°íŒ…ê¸ˆì€ ìë³¸ì˜ 1~3% ë²”ìœ„ë¡œ ì œí•œí•˜ê¸°",
  "ì„ ë°œ/ê²°ì¥/ë¡œí…Œ ë‰´ìŠ¤ ì²´í¬ í›„ ë°°ë‹¹ ë³€ë™ ì¬í™•ì¸í•˜ê¸°",
  "ì—°íŒ¨/ì—°ìŠ¹ íŒ€ì€ 'ì‹œì¥ ê³¼ì—´' êµ¬ê°„ì¸ì§€ ë¨¼ì € ë³´ê¸°",
  "ë³€ë™ì„± í° ë¦¬ê·¸ëŠ” ë‹¨í´/ì†Œì•¡ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ê¸°",
  "ì•„ì‹œì•ˆ ë¼ì¸(í‘¸ì‹œ) ê°€ëŠ¥ êµ¬ê°„ì€ 'ë¬´íš¨ ë¦¬ìŠ¤í¬'ë„ ê°™ì´ ê³ ë ¤í•˜ê¸°"
];
function refreshChecklist(){
  const pool = [...CHECKLIST_POOL].sort(()=>Math.random()-0.5);
  const pick = pool.slice(0,3);
  const el = document.getElementById("checklistText");
  if(el) el.innerHTML = "â€¢ " + pick.join("<br>â€¢ ");
}
refreshChecklist();

/* =========================
   ìƒíƒœ/ì €ì¥(ê¸°ì¡´ ìœ ì§€ + í™•ì¥)
========================= */
const LS_KEY = "88_analysis_multi_v3";            // ì…ë ¥ ìƒíƒœ
const HIST_KEY = "88_analysis_history_v1";        // íˆìŠ¤í† ë¦¬
const SNAP_KEY = "88_analysis_snaps_v1";          // ìµœê·¼ ì…ë ¥ ìŠ¤ëƒ…ìƒ·
const SNAP_META_KEY = "88_analysis_snaps_meta_v1";
let LAST_TEXT = "";
let LAST_RECORD = null;

const SPORT_CFG = {
  soccer: {
    name: "ì¶•êµ¬",
    main: "3way",
    labels: {H:"í™ˆ", D:"ë¬´", A:"ì›ì •"},
    hint: "ì¶•êµ¬ëŠ” ê¸°ë³¸ 3ë°°ë‹¹(í™ˆ/ë¬´/ì›ì •). ì¤‘ê¸‰/ê³ ê¸‰ì—ì„œ ì˜¤ë²„ì–¸ë”ë¥¼ ê°™ì´ ë³´ëŠ” ê±¸ ì¶”ì²œí•©ë‹ˆë‹¤.",
    template: { openHandicap:false, openTotal:true },
    defaults: { ouPush: 6, hcPush: 2 }
  },
  basketball: {
    name:"ë†êµ¬",
    main:"2way",
    labels:{A:"ìŠ¹", B:"íŒ¨"},
    hint:"ë†êµ¬ëŠ” 2ë°°ë‹¹(ìŠ¹/íŒ¨) ì¤‘ì‹¬. ì¤‘ê¸‰/ê³ ê¸‰ì—ì„œëŠ” í•¸ë””+ì˜¤ë²„ì–¸ë”ë¥¼ í•¨ê»˜ ì¶”ì²œ.",
    template: { openHandicap:true, openTotal:true },
    defaults: { ouPush: 3, hcPush: 3 }
  },
  baseball: {
    name:"ì•¼êµ¬",
    main:"2way",
    labels:{A:"ìŠ¹", B:"íŒ¨"},
    hint:"ì•¼êµ¬ëŠ” ìŠ¹/íŒ¨(2ë°°ë‹¹) + ì˜¤ë²„ì–¸ë”/í•¸ë””(ëŸ°ë¼ì¸)ë¥¼ í•¨ê»˜ ë³´ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.",
    template: { openHandicap:true, openTotal:true },
    defaults: { ouPush: 4, hcPush: 2 }
  },
  volleyball: {
    name:"ë°°êµ¬",
    main:"2way",
    labels:{A:"ìŠ¹", B:"íŒ¨"},
    hint:"ë°°êµ¬ëŠ” 2ë°°ë‹¹(ìŠ¹/íŒ¨) ì¤‘ì‹¬. ì¤‘ê¸‰/ê³ ê¸‰ì—ì„œ í•¸ë””/OUë¥¼ í•¨ê»˜ í™•ì¸í•˜ì„¸ìš”.",
    template: { openHandicap:true, openTotal:true },
    defaults: { ouPush: 1, hcPush: 1 }
  },
  esports: {
    name:"eìŠ¤í¬ì¸ ",
    main:"2way",
    labels:{A:"ìŠ¹", B:"íŒ¨"},
    hint:"eìŠ¤í¬ì¸ ëŠ” ë§¤ì¹˜ ìŠ¹/íŒ¨(2ë°°ë‹¹) ì¤‘ì‹¬. ê³ ê¸‰ì—ì„œ EV/ë¹„ì¤‘ ê³„ì‚°ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.",
    template: { openHandicap:false, openTotal:false },
    defaults: { ouPush: 0, hcPush: 0 }
  },
  hockey: {
    name:"í•˜í‚¤",
    main:"2way",
    labels:{A:"ìŠ¹", B:"íŒ¨"},
    hint:"í•˜í‚¤ëŠ” 2ë°°ë‹¹(ìŠ¹/íŒ¨) ê¸°ë³¸. ì¤‘ê¸‰/ê³ ê¸‰ì—ì„œ ì˜¤ë²„ì–¸ë”ê°€ ë„ì›€ì´ ë©ë‹ˆë‹¤.",
    template: { openHandicap:false, openTotal:true },
    defaults: { ouPush: 4, hcPush: 2 }
  }
};

/* âœ… ì¢…ëª©/ìœ í˜•ë³„ â€œë§ˆì§„ ë‚®ìŒâ€ íŒì • ê¸°ì¤€ (ë§ˆì§„% ê¸°ì¤€) */
const MARGIN_RULE = {
  soccer:     { main:[6, 8, 10], ou:[5.5, 7.5, 9.5], hc:[5.5, 7.5, 9.5] },
  basketball: { main:[4, 6, 8],  ou:[4.5, 6.5, 8.5], hc:[4.5, 6.5, 8.5] },
  baseball:   { main:[4.5, 6.5, 8.5], ou:[4.5, 6.5, 8.5], hc:[4.5, 6.5, 8.5] },
  volleyball: { main:[4, 6, 8],  ou:[4, 6, 8],  hc:[4, 6, 8] },
  esports:    { main:[4, 6, 8],  ou:[4, 6, 8],  hc:[4, 6, 8] },
  hockey:     { main:[4.5, 6.5, 8.5], ou:[4.5, 6.5, 8.5], hc:[4.5, 6.5, 8.5] }
};

function $(id){ return document.getElementById(id); }
function val(id){ const el=$(id); return el?el.value:""; }
function setVal(id,v){ const el=$(id); if(el && v!=null) el.value=v; }
function todayStr(){ return new Date().toISOString().slice(0,10); }
function nowTimeStr(){
  const d=new Date();
  const hh=String(d.getHours()).padStart(2,"0");
  const mm=String(d.getMinutes()).padStart(2,"0");
  return `${hh}:${mm}`;
}

function saveState(){
  const state = {
    sport: val("sport"),
    level: val("level"),
    league: val("league"),
    teams: val("teams"),
    main2OddsA: val("main2OddsA"),
    main2OddsB: val("main2OddsB"),
    main3OddsH: val("main3OddsH"),
    main3OddsD: val("main3OddsD"),
    main3OddsA: val("main3OddsA"),
    myProb: val("myProb"),
    stake: val("stake"),
    handicapLine: val("handicapLine"),
    handicapOddsA: val("handicapOddsA"),
    handicapOddsB: val("handicapOddsB"),
    handicapPush: val("handicapPush"),
    totalLine: val("totalLine"),
    overOdds: val("overOdds"),
    underOdds: val("underOdds"),
    ouPush: val("ouPush"),
    myOverProb: val("myOverProb"),
    handicapCollapsed: isCollapsed("handicapBody"),
    totalCollapsed: isCollapsed("totalBody")
  };
  state.__savedAt = Date.now();
  localStorage.setItem(LS_KEY, JSON.stringify(state));
  updateSaveBadge(state.__savedAt);
  maybePushSnapshot(state, false);
  return state;
}
function loadState(){
  try{
    const raw = localStorage.getItem(LS_KEY);
    if(!raw) return;
    const s = JSON.parse(raw);

    if(s.sport) setVal("sport", s.sport);
    if(s.level) setVal("level", s.level);

    onSportChange(true);
    onLevelChange(true);

    setVal("league", s.league);
    setVal("teams", s.teams);
    setVal("main2OddsA", s.main2OddsA);
    setVal("main2OddsB", s.main2OddsB);
    setVal("main3OddsH", s.main3OddsH);
    setVal("main3OddsD", s.main3OddsD);
    setVal("main3OddsA", s.main3OddsA);
    setVal("myProb", s.myProb);
    setVal("stake", s.stake);
    setVal("handicapLine", s.handicapLine);
    setVal("handicapOddsA", s.handicapOddsA);
    setVal("handicapOddsB", s.handicapOddsB);
    setVal("handicapPush", s.handicapPush);
    setVal("totalLine", s.totalLine);
    setVal("overOdds", s.overOdds);
    setVal("underOdds", s.underOdds);
    setVal("ouPush", s.ouPush);
    setVal("myOverProb", s.myOverProb);

    if(typeof s.handicapCollapsed === "boolean") setCollapsed("handicapBody", s.handicapCollapsed);
    if(typeof s.totalCollapsed === "boolean") setCollapsed("totalBody", s.totalCollapsed);
  }catch(e){}
}

/* ì…ë ¥ ì´ë²¤íŠ¸ ìë™ ì €ì¥ */
[
  "sport","level","league","teams",
  "main2OddsA","main2OddsB","main3OddsH","main3OddsD","main3OddsA",
  "myProb","stake",
  "handicapLine","handicapOddsA","handicapOddsB","handicapPush",
  "totalLine","overOdds","underOdds","ouPush","myOverProb"
].forEach(id=>{
  const el=$(id);
  if(el) el.addEventListener("input", saveState);
});

/* =========================
   UI: í…œí”Œë¦¿ + ë‚œì´ë„
========================= */
function onSportChange(silent){
  const sport = val("sport");
  const cfg = SPORT_CFG[sport] || SPORT_CFG.soccer;

  $("sportHint").innerText = `ì„ íƒ ì¢…ëª©: ${cfg.name} Â· ${cfg.hint}`;

  const is3 = cfg.main === "3way";
  $("main2").style.display = is3 ? "none" : "block";
  $("main3").style.display = is3 ? "block" : "none";
  $("mainMarketTitle").innerText = is3 ? "ë©”ì¸ ë°°ë‹¹ (í™ˆ/ë¬´/ì›ì •)" : "ë©”ì¸ ë°°ë‹¹ (ìŠ¹/íŒ¨)";

  if(!is3){
    $("main2LabelA").innerText = `${cfg.labels.A} ë°°ë‹¹`;
    $("main2LabelB").innerText = `${cfg.labels.B} ë°°ë‹¹`;
  }else{
    $("main3LabelH").innerText = `${cfg.labels.H} ë°°ë‹¹`;
    $("main3LabelD").innerText = `${cfg.labels.D} ë°°ë‹¹`;
    $("main3LabelA").innerText = `${cfg.labels.A} ë°°ë‹¹`;
  }

  // í•¸ë”” ë¼ë²¨ ì—…ë°ì´íŠ¸
  $("handicapOddsALabel").innerText = `í•¸ë”” ${cfg.labels.A || "ì„ íƒA"} ë°°ë‹¹`;
  $("handicapOddsBLabel").innerText = `ë°˜ëŒ€ ${cfg.labels.B || "ì„ íƒB"} ë°°ë‹¹`;

  // ê¸°ë³¸ í‘¸ì‹œ ê·¼ì‚¬ê°’(ë¯¸ì…ë ¥ì¼ ë•Œë§Œ ì±„ì›Œë„£ê¸°)
  if(!val("ouPush")) setVal("ouPush", cfg.defaults.ouPush);
  if(!val("handicapPush")) setVal("handicapPush", cfg.defaults.hcPush);

  applyTemplate();
  updateMyProbHints(cfg, val("level"));

  if(!silent) hideResult();
  renderMarginDash(); // ì¢…ëª© ë°”ë€Œë©´ ê¸°ì¤€í‘œ/ëŒ€ì‹œë³´ë“œ ì¦‰ì‹œ ë°˜ì˜
  saveState();
}

function onLevelChange(silent){
  const level = val("level");
  $("valueInputs").style.display = (level === "simple") ? "none" : "block";
  $("handicapBox").style.display = (level === "simple") ? "none" : "block";
  $("totalBox").style.display = (level === "simple") ? "none" : "block";

  const cfg = SPORT_CFG[val("sport")] || SPORT_CFG.soccer;
  updateMyProbHints(cfg, level);
  applyTemplate();

  if(!silent) hideResult();
  renderMarginDash();
  saveState();
}

function updateMyProbHints(cfg, level){
  const is3 = cfg.main === "3way";
  if(level === "simple"){
    $("myProbLabel").innerText = "ë‚´ ì˜ˆìƒ í™•ë¥ (ì„ íƒ) %";
    $("myProbHint").innerText = "";
    return;
  }
  if(is3){
    $("myProbLabel").innerText = `ë‚´ ì˜ˆìƒ í™•ë¥ (${cfg.labels.H}/${cfg.labels.D}/${cfg.labels.A}) % (ì„ íƒ)`;
    $("myProbHint").innerText = `ì‰¼í‘œë¡œ 3ê°œ ì…ë ¥ (ì˜ˆ: 45,28,27) Â· í•© 100 ê¶Œì¥`;
  }else{
    $("myProbLabel").innerText = `ë‚´ ì˜ˆìƒ í™•ë¥ (${cfg.labels.A}) % (ì„ íƒ)`;
    $("myProbHint").innerText = `ì˜ˆ: 55 (ë‹¨ì¼ ê°’) Â· EV/ê¶Œì¥ë¹„ì¤‘ ê³„ì‚°ìš©`;
  }
}

/* í…œí”Œë¦¿: ì¢…ëª©ë³„ OU/í•¸ë”” ê¸°ë³¸ í¼ì¹¨ */
function applyTemplate(){
  const level = val("level");
  const cfg = SPORT_CFG[val("sport")] || SPORT_CFG.soccer;
  if(level === "simple") return;
  setCollapsed("handicapBody", !cfg.template.openHandicap);
  setCollapsed("totalBody", !cfg.template.openTotal);
}

/* ì ‘ê¸°/í¼ì¹˜ê¸° */
function toggleBox(id){
  const now = isCollapsed(id);
  setCollapsed(id, !now);
  saveState();
}
function isCollapsed(id){
  const el = $(id);
  return el ? el.style.display === "none" : false;
}
function setCollapsed(id, collapsed){
  const el = $(id);
  if(!el) return;
  el.style.display = collapsed ? "none" : "block";
}

/* =========================
   ê³„ì‚° ìœ í‹¸
========================= */
function parseOdds(v){
  if(!v) return null;
  const x = Number(String(v).replace(/,/g,".").trim());
  if(!isFinite(x) || x<=1) return null;
  return x;
}
function parsePct(v){
  if(v==null || v==="") return null;
  const x = Number(String(v).replace(/,/g,".").trim());
  if(!isFinite(x) || x<0 || x>100) return null;
  return x/100;
}
function parsePctList(str){
  if(!str) return null;
  const parts = str.split(",").map(s=>s.trim()).filter(Boolean);
  if(parts.length !== 3) return null;
  const p1=parsePct(parts[0]), p2=parsePct(parts[1]), p3=parsePct(parts[2]);
  if(p1==null || p2==null || p3==null) return null;
  return [p1,p2,p3];
}
function parseMoney(v){
  if(!v) return null;
  const x = Number(String(v).replace(/[^\d]/g,""));
  if(!isFinite(x) || x<=0) return null;
  return x;
}
function pct(x){ return (x*100).toFixed(1) + "%"; }
function money(x){
  const n = Math.round(x);
  return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + "ì›";
}
function expectedValue(stake, p, odds){
  return stake * (p*(odds-1) - (1-p));
}
function quarterKelly(p, odds){
  const b = odds - 1;
  const f = (p*odds - 1) / b;
  const q = f/4;
  return Math.max(0, Math.min(0.25, q));
}

/* 2-way + í‘¸ì‹œ ê·¼ì‚¬ (ì•„ì‹œì•ˆ ë¼ì¸) */
function compute2Way(oddsA, oddsB, pushP){ // pushP: 0~1
  const ia=1/oddsA, ib=1/oddsB;
  const sum = ia+ib;
  const push = Math.max(0, Math.min(0.35, pushP || 0)); // ì•ˆì „ë²”ìœ„
  const factor = (1 - push);
  const pA = (ia/sum) * factor;
  const pB = (ib/sum) * factor;
  const overAdj = sum / factor;          // push í¬í•¨ ë³´ì • ì˜¤ë²„ë¼ìš´ë“œ
  const marginPct = (overAdj - 1) * 100; // %
  return { over: overAdj, marginPct, probs:[pA,pB], push };
}

/* 3-way */
function compute3Way(odds1,odds2,odds3){
  const i1=1/odds1, i2=1/odds2, i3=1/odds3;
  const over=i1+i2+i3;
  const p1=i1/over, p2=i2/over, p3=i3/over;
  const marginPct=(over-1)*100;
  return { over, marginPct, probs:[p1,p2,p3] };
}

function classifyMargin(sport, type, marginPct){
  const rule = (MARGIN_RULE[sport] || MARGIN_RULE.soccer)[type] || [5,7,9];
  const [low, mid, high] = rule;
  if(marginPct <= low) return { label:`ë§ˆì§„ ë‚®ìŒ (${marginPct.toFixed(2)}%)`, cls:"ok" };
  if(marginPct <= mid) return { label:`ë³´í†µ (${marginPct.toFixed(2)}%)`, cls:"mid" };
  if(marginPct <= high) return { label:`ì£¼ì˜ (${marginPct.toFixed(2)}%)`, cls:"mid" };
  return { label:`ê³ ë§ˆì§„ (${marginPct.toFixed(2)}%)`, cls:"bad" };
}
function clsToTextColor(cls){
  if(cls==="ok") return "good";
  if(cls==="mid") return "mid";
  return "warn";
}

/* =========================
   +EV í”Œë˜ê·¸ ì €ì¥ (index ìë™í•„í„°ìš©)
========================= */
function setEvFlag(isPositive){
  const d = todayStr();
  localStorage.setItem("88_ev_date", d);
  localStorage.setItem("88_ev_positive", isPositive ? "1" : "0");
}

/* =========================
   ê³„ì‚° ë©”ì¸ (ê¸°ì¡´ ê¸°ëŠ¥ 100% ìœ ì§€ + í™•ì¥)
========================= */
function levelLabel(level){
  return level==="simple" ? "ê°„ë‹¨" : (level==="mid" ? "ì¤‘ê¸‰" : "ê³ ê¸‰");
}

function calc(){
  const sport = val("sport");
  const level = val("level");
  const cfg = SPORT_CFG[sport] || SPORT_CFG.soccer;
  const is3 = cfg.main === "3way";

  const rows = [];
  const copyLines = [];
  copyLines.push(`[88 ì»¤ë®¤ë‹ˆí‹°] ${cfg.name} ë¶„ì„ (${levelLabel(level)})`);

  const league = val("league").trim();
  const teams  = val("teams").trim();
  if(league) copyLines.push(`ë¦¬ê·¸: ${league}`);
  if(teams)  copyLines.push(`ê²½ê¸°: ${teams}`);

  // ê²°ê³¼/íˆìŠ¤í† ë¦¬ìš© ë©”íƒ€
  const record = {
    id: Date.now().toString(36) + Math.random().toString(36).slice(2,7),
    date: todayStr(),
    time: nowTimeStr(),
    sport, level, league, teams,
    inputs:{},
    markets:{},
    evPositive:false,
    bestEVPct:null
  };

  // ---- ë©”ì¸ ----
  let mainMargin = null;
  let mainOver = null;
  let mainProbs = null;

  if(!is3){
    const a = parseOdds(val("main2OddsA"));
    const b = parseOdds(val("main2OddsB"));
    if(a==null || b==null){ clearInvalid(); markInvalid(["main2OddsA","main2OddsB"]); return showError("ë©”ì¸ ë°°ë‹¹ì„ 1.01 ì´ìƒ ìˆ«ìë¡œ ì…ë ¥í•´ì¤˜."); }

    const out = compute2Way(a,b,0);
    mainOver = out.over;
    mainMargin = out.marginPct;
    mainProbs = out.probs;

    rows.push([`ìŠ¹ë¦¬ í™•ë¥ (ë°°ë‹¹ ê¸°ë°˜Â·ì¶”ì •, ${cfg.labels.A})`, pct(out.probs[0])]);
    rows.push([`ìŠ¹ë¦¬ í™•ë¥ (ë°°ë‹¹ ê¸°ë°˜Â·ì¶”ì •, ${cfg.labels.B})`, pct(out.probs[1])]);
    rows.push(["ì˜¤ë²„ë¼ìš´ë“œ(ë§ˆì§„ ì¶”ì •)", out.over.toFixed(4)]);

    const íŒì • = classifyMargin(sport,"main",out.marginPct);
    rows.push(["ë©”ì¸ ë§ˆì§„ íŒì •", `<span class="${clsToTextColor(íŒì •.cls)}">${íŒì •.label}</span>`]);

    copyLines.push(`ë©”ì¸ ë°°ë‹¹(${cfg.labels.A}/${cfg.labels.B}): ${a} / ${b}`);

    record.inputs.main2OddsA = val("main2OddsA");
    record.inputs.main2OddsB = val("main2OddsB");
    record.markets.main = { over: out.over, marginPct: out.marginPct };

    if(level !== "simple"){
      const myP = parsePct(val("myProb"));
      const stake = parseMoney(val("stake"));

      if(myP!=null){
        const evPer1 = (myP*(a-1) - (1-myP));
        rows.push([`ë‚´ ì˜ˆìƒ í™•ë¥ (${cfg.labels.A})`, pct(myP)]);
        rows.push(["EV(1ì›ë‹¹)", (evPer1*100).toFixed(2) + "%"]);
        copyLines.push(`ë‚´ ì˜ˆìƒ í™•ë¥ (${cfg.labels.A}): ${(myP*100).toFixed(1)}%`);
        if(stake!=null){
          rows.push(["ê¸°ëŒ€ê°’(EV)", money(expectedValue(stake, myP, a))]);
          copyLines.push(`ë² íŒ…ê¸ˆ: ${money(stake)}`);
        }
        if(level === "adv"){
          const k = quarterKelly(myP, a);
          rows.push(["ê¶Œì¥ ë¹„ì¤‘(ë³´ìˆ˜ì  1/4 Kelly)", (k*100).toFixed(1) + "%"]);
        }
        rows.push(["íŒë‹¨", evPer1>0 ? "ë°¸ë¥˜(+EV) ê°€ëŠ¥ì„±" : "ë°¸ë¥˜(-EV) ê°€ëŠ¥ì„±"]);

        record.bestEVPct = evPer1*100;
        record.evPositive = evPer1>0;
        setEvFlag(record.evPositive);
      }else{
        rows.push(["Tip", "ì¤‘ê¸‰/ê³ ê¸‰ì—ì„œëŠ” 'ë‚´ ì˜ˆìƒ í™•ë¥ 'ì„ ì…ë ¥í•˜ë©´ EVê°€ ê³„ì‚°ë©ë‹ˆë‹¤. (ì„ íƒì‚¬í•­)"]);
        setEvFlag(false);
      }
    }else{
      setEvFlag(false);
    }
  }else{
    const h = parseOdds(val("main3OddsH"));
    const d = parseOdds(val("main3OddsD"));
    const a = parseOdds(val("main3OddsA"));
    if(h==null || d==null || a==null){ clearInvalid(); markInvalid(["main3OddsH","main3OddsD","main3OddsA"]); return showError("ë©”ì¸ ë°°ë‹¹(í™ˆ/ë¬´/ì›ì •)ì„ 1.01 ì´ìƒ ìˆ«ìë¡œ ì…ë ¥í•´ì¤˜."); }

    const out = compute3Way(h,d,a);
    mainOver = out.over;
    mainMargin = out.marginPct;
    mainProbs = out.probs;

    rows.push([`ìŠ¹ë¦¬ í™•ë¥ (ë°°ë‹¹ ê¸°ë°˜Â·ì¶”ì •, ${cfg.labels.H})`, pct(out.probs[0])]);
    rows.push([`ìŠ¹ë¦¬ í™•ë¥ (ë°°ë‹¹ ê¸°ë°˜Â·ì¶”ì •, ${cfg.labels.D})`, pct(out.probs[1])]);
    rows.push([`ìŠ¹ë¦¬ í™•ë¥ (ë°°ë‹¹ ê¸°ë°˜Â·ì¶”ì •, ${cfg.labels.A})`, pct(out.probs[2])]);
    rows.push(["ì˜¤ë²„ë¼ìš´ë“œ(ë§ˆì§„ ì¶”ì •)", out.over.toFixed(4)]);

    const íŒì • = classifyMargin(sport,"main",out.marginPct);
    rows.push(["ë©”ì¸ ë§ˆì§„ íŒì •", `<span class="${clsToTextColor(íŒì •.cls)}">${íŒì •.label}</span>`]);

    copyLines.push(`ë©”ì¸ ë°°ë‹¹(${cfg.labels.H}/${cfg.labels.D}/${cfg.labels.A}): ${h} / ${d} / ${a}`);

    record.inputs.main3OddsH = val("main3OddsH");
    record.inputs.main3OddsD = val("main3OddsD");
    record.inputs.main3OddsA = val("main3OddsA");
    record.markets.main = { over: out.over, marginPct: out.marginPct };

    if(level !== "simple"){
      const my = parsePctList(val("myProb"));
      const stake = parseMoney(val("stake"));

      if(my){
        const evH = (my[0]*(h-1) - (1-my[0]));
        const evD = (my[1]*(d-1) - (1-my[1]));
        const evA = (my[2]*(a-1) - (1-my[2]));

        rows.push([`ë‚´ ì˜ˆìƒ í™•ë¥ (${cfg.labels.H}/${cfg.labels.D}/${cfg.labels.A})`,
          `${pct(my[0])} / ${pct(my[1])} / ${pct(my[2])}`]);

        rows.push(["EV(í™ˆ/ë¬´/ì›ì •, 1ì›ë‹¹)", `${(evH*100).toFixed(2)}% / ${(evD*100).toFixed(2)}% / ${(evA*100).toFixed(2)}%`]);

        const best = [
          {k:cfg.labels.H, ev:evH, odds:h, p:my[0]},
          {k:cfg.labels.D, ev:evD, odds:d, p:my[1]},
          {k:cfg.labels.A, ev:evA, odds:a, p:my[2]}
        ].sort((x,y)=>y.ev-x.ev)[0];

        rows.push(["ê°€ì¥ ë†’ì€ EV", `${best.k} (${(best.ev*100).toFixed(2)}%)`]);
        if(stake!=null) rows.push(["ê¸°ëŒ€ê°’(EV, ìµœê³  EV ê¸°ì¤€)", money(expectedValue(stake, best.p, best.odds))]);

        if(level === "adv"){
          rows.push(["ê¶Œì¥ ë¹„ì¤‘(ë³´ìˆ˜ì  1/4 Kelly, ìµœê³  EV ê¸°ì¤€)", (quarterKelly(best.p, best.odds)*100).toFixed(1) + "%"]);
        }
        rows.push(["íŒë‹¨", best.ev>0 ? "ë°¸ë¥˜(+EV) ê°€ëŠ¥ì„±" : "ë°¸ë¥˜(-EV) ê°€ëŠ¥ì„±"]);

        record.bestEVPct = best.ev*100;
        record.evPositive = best.ev>0;
        setEvFlag(record.evPositive);

        copyLines.push(`ë‚´ ì˜ˆìƒ í™•ë¥ : ${(my[0]*100).toFixed(1)}% / ${(my[1]*100).toFixed(1)}% / ${(my[2]*100).toFixed(1)}%`);
        if(stake!=null) copyLines.push(`ë² íŒ…ê¸ˆ: ${money(stake)}`);
      }else{
        rows.push(["Tip", "ì¤‘ê¸‰/ê³ ê¸‰ì—ì„œëŠ” ë‚´ ì˜ˆìƒ í™•ë¥ (ì˜ˆ: 45,28,27)ì„ ì…ë ¥í•˜ë©´ EVê°€ ê³„ì‚°ë©ë‹ˆë‹¤. (ì„ íƒì‚¬í•­)"]);
        setEvFlag(false);
      }
    }else{
      setEvFlag(false);
    }
  }

  // ---- ì˜¤ë²„ì–¸ë” (2-way + í‘¸ì‹œ ê·¼ì‚¬) ----
  let ouMargin = null;
  const tLine = val("totalLine").trim();
  const oOdds = parseOdds(val("overOdds"));
  const uOdds = parseOdds(val("underOdds"));
  const myOver = parsePct(val("myOverProb"));
  const ouPushPct = parsePct(val("ouPush")) ?? null; // ì…ë ¥ ê°’ì´ %ì´ë©´ parsePctê°€ 0~1ë¡œ
  // parsePct expects 0~100; but we want % input; ok

  if(tLine && oOdds!=null && uOdds!=null){
    // í‘¸ì‹œ í™•ë¥ : ì…ë ¥ê°’ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ì¢…ëª© ê¸°ë³¸ê°’
    let push = ouPushPct;
    if(push==null){
      const cfg2 = SPORT_CFG[sport] || SPORT_CFG.soccer;
      push = (cfg2.defaults.ouPush || 0) / 100;
    }
    const outOU = compute2Way(oOdds, uOdds, push);
    ouMargin = outOU.marginPct;

    rows.push([`ì˜¤ë²„/ì–¸ë”(ê¸°ì¤€ ${tLine}) ìŠ¹ë¦¬ í™•ë¥ (ë°°ë‹¹ ê¸°ë°˜Â·ì¶”ì •)`,
      `ì˜¤ë²„ ${pct(outOU.probs[0])} / ì–¸ë” ${pct(outOU.probs[1])}${outOU.push>0?` / í‘¸ì‹œ ${(outOU.push*100).toFixed(1)}%`:``}`]);
    rows.push([`ì˜¤ë²„/ì–¸ë” ì˜¤ë²„ë¼ìš´ë“œ(ë³´ì •)`, outOU.over.toFixed(4)]);
    const íŒì •OU = classifyMargin(sport,"ou",outOU.marginPct);
    rows.push([`ì˜¤ë²„/ì–¸ë” ë§ˆì§„ íŒì •`, `<span class="${clsToTextColor(íŒì •OU.cls)}">${íŒì •OU.label}</span>`]);

    copyLines.push(`ì˜¤ë²„ì–¸ë” ${tLine}: ì˜¤ë²„ ${oOdds} / ì–¸ë” ${uOdds}${outOU.push>0?` (í‘¸ì‹œ ê·¼ì‚¬ ${ (outOU.push*100).toFixed(1)}%)`:``}`);

    record.inputs.totalLine = val("totalLine");
    record.inputs.overOdds = val("overOdds");
    record.inputs.underOdds = val("underOdds");
    record.inputs.ouPush = val("ouPush");
    record.markets.ou = { over: outOU.over, marginPct: outOU.marginPct, push: outOU.push };

    if(level === "adv" && myOver!=null){
      const stake = parseMoney(val("stake")) || null;
      // í‘¸ì‹œ í¬í•¨ EV: EV = pWin*(odds-1) - pLose + pPush*0
      const pWin = myOver;
      const pPush = outOU.push; // ê·¼ì‚¬
      const pLose = Math.max(0, 1 - pWin - pPush);
      const evPer1 = (pWin*(oOdds-1) - pLose);

      rows.push([`ë‚´ ì˜ˆìƒ í™•ë¥ (ì˜¤ë²„)`, pct(myOver)]);
      rows.push([`ì˜¤ë²„ EV(1ì›ë‹¹, í‘¸ì‹œ ê·¼ì‚¬)`, (evPer1*100).toFixed(2) + "%"]);
      if(stake!=null) rows.push([`ì˜¤ë²„ ê¸°ëŒ€ê°’(EV)`, money(stake * evPer1)]);
      rows.push([`ì˜¤ë²„ ê¶Œì¥ ë¹„ì¤‘(1/4 Kelly, ì°¸ê³ )`, (quarterKelly(myOver, oOdds)*100).toFixed(1) + "%"]);
      rows.push([`ì˜¤ë²„ íŒë‹¨`, evPer1>0 ? "ë°¸ë¥˜(+EV) ê°€ëŠ¥ì„±" : "ë°¸ë¥˜(-EV) ê°€ëŠ¥ì„±"]);
    }
  }

  // ---- í•¸ë””ìº¡ (ì •ë°€ 2-way + í‘¸ì‹œ ê·¼ì‚¬) ----
  let hcMargin = null;
  const hLine = val("handicapLine").trim();
  const hOA = parseOdds(val("handicapOddsA"));
  const hOB = parseOdds(val("handicapOddsB"));
  const hcPushPct = parsePct(val("handicapPush")) ?? null;

  if(hLine && hOA!=null && hOB!=null){
    let push = hcPushPct;
    if(push==null){
      const cfg2 = SPORT_CFG[sport] || SPORT_CFG.soccer;
      push = (cfg2.defaults.hcPush || 0) / 100;
    }
    const outHC = compute2Way(hOA, hOB, push);
    hcMargin = outHC.marginPct;

    rows.push([`í•¸ë””ìº¡(ë¼ì¸ ${hLine}) ìŠ¹ë¦¬ í™•ë¥ (ë°°ë‹¹ ê¸°ë°˜Â·ì¶”ì •)`,
      `${cfg.labels.A||"A"} ${pct(outHC.probs[0])} / ${cfg.labels.B||"B"} ${pct(outHC.probs[1])}${outHC.push>0?` / í‘¸ì‹œ ${(outHC.push*100).toFixed(1)}%`:``}`]);
    rows.push([`í•¸ë””ìº¡ ì˜¤ë²„ë¼ìš´ë“œ(ë³´ì •)`, outHC.over.toFixed(4)]);
    const íŒì •HC = classifyMargin(sport,"hc",outHC.marginPct);
    rows.push([`í•¸ë””ìº¡ ë§ˆì§„ íŒì •`, `<span class="${clsToTextColor(íŒì •HC.cls)}">${íŒì •HC.label}</span>`]);

    copyLines.push(`í•¸ë”” ${hLine}: ${cfg.labels.A||"A"} ${hOA} / ${cfg.labels.B||"B"} ${hOB}${outHC.push>0?` (í‘¸ì‹œ ê·¼ì‚¬ ${ (outHC.push*100).toFixed(1)}%)`:``}`);

    record.inputs.handicapLine = val("handicapLine");
    record.inputs.handicapOddsA = val("handicapOddsA");
    record.inputs.handicapOddsB = val("handicapOddsB");
    record.inputs.handicapPush = val("handicapPush");
    record.markets.hc = { over: outHC.over, marginPct: outHC.marginPct, push: outHC.push };
  }

  // ---- ëŒ€ì‹œë³´ë“œ/íˆìŠ¤í† ë¦¬ ë°˜ì˜ ----
  // (í‘œí˜„/í†µê³„ìš©) í˜„ì¬ ê¸°ë¡ì˜ ë¶„ë¥˜ ë©”íƒ€ â€” ê³„ì‚° ë¡œì§ì—ëŠ” ì˜í–¥ ì—†ìŒ
  record.advice = adviceKeyFromMetrics(record.bestEVPct, record.markets?.main?.marginPct);
  LAST_RECORD = record;

  renderResult(cfg.name, level, rows, copyLines);
  renderMarginDash({sport, main:mainMargin, ou:ouMargin, hc:hcMargin});

  // íˆìŠ¤í† ë¦¬ ì €ì¥
  addHistory(record);

  // TOP3 ê°±ì‹ 
  renderTop3();

  const st = saveState();
  maybePushSnapshot(st, true);
  renderSnaps();
}

/* =========================
   ê²°ê³¼ ë Œë”(ê¸°ì¡´ ìœ ì§€)
========================= */
function renderResult(sportName, level, rows, copyLines){
  const box = $("result");

  // ---- ìš”ì•½ ì¹´ë“œ(ìƒë‹¨) ë°ì´í„° ì¶”ì¶œ ----
  const clean = (x)=>String(x ?? "").replace(/<[^>]*>/g,"").trim();
  const num = (x)=>{
    const t = clean(x).replace(/,/g,"").replace("%","");
    const n = parseFloat(t);
    return Number.isFinite(n) ? n : null;
  };

  const overRow = rows.find(([k])=>k==="ì˜¤ë²„ë¼ìš´ë“œ(ë§ˆì§„ ì¶”ì •)");
  const over = overRow ? num(overRow[1]) : null;
  const marginPct = (over!=null) ? (over - 1) * 100 : null;

  // ë©”ì¸ ë§ˆì§„ íŒì •(ë¼ë²¨/ìƒ‰ìƒ) ì¶”ì¶œ
  let marginLabel = null;
  let marginChip = "mid";
  const mRow = rows.find(([k])=>k==="ë©”ì¸ ë§ˆì§„ íŒì •");
  if(mRow){
    const raw = String(mRow[1] ?? "");
    marginLabel = clean(raw);
    const clsMatch = raw.match(/class="([^"]+)"/);
    const tcls = clsMatch ? clsMatch[1] : "";
    if(tcls.includes("good")) marginChip = "ok";
    else if(tcls.includes("warn")) marginChip = "bad";
    else marginChip = "mid";
  }

  // ì‹œì¥ ìµœê³  í™•ë¥ (ë©”ì¸) ì¶”ì¶œ
  const probRows = rows.filter(([k])=>String(k).includes("ìŠ¹ë¦¬ í™•ë¥ (ë°°ë‹¹ ê¸°ë°˜Â·ì¶”ì •"));
  let topProb = null;
  probRows.forEach(([k,v])=>{
    const p = num(v);
    if(p==null) return;
    const m = String(k).match(/,\s*([^)]+)\)/);
    const label = m ? m[1] : String(k);
    if(!topProb || p > topProb.p) topProb = { label, p };
  });

  // EV ì¶”ì¶œ(ê³ ê¸‰ëª¨ë“œì—ì„œë§Œ ì¡´ì¬í•  ìˆ˜ ìˆìŒ)
  const evRow = rows.find(([k])=>k==="EV(1ì›ë‹¹)");
  const evPct = evRow ? num(evRow[1]) : null;

  // ë°°ì§€(ìš”ì•½)
  let primary = { cls: marginChip, text: marginLabel ? `ë©”ì¸ ë§ˆì§„: ${marginLabel}` : "ê²°ê³¼ ìš”ì•½" };
  let secondary = null;

  if(evPct!=null){
    primary = { cls: (evPct>=0 ? "ok" : "bad"), text: `ë°¸ë¥˜(${evPct>=0?"+":"-"}EV) ${Math.abs(evPct).toFixed(2)}%` };
    if(marginLabel){
      secondary = { cls: marginChip, text: `ë©”ì¸ ë§ˆì§„: ${marginLabel}${marginPct!=null ? ` (${marginPct.toFixed(1)}%)` : ""}` };
    }
  }


  // í•œì¤„ ê²°ë¡ (í‘œí˜„ìš©: ë¡œì§ì€ ë³€ê²½í•˜ì§€ ì•Šê³ , ê³„ì‚°ëœ ê°’ìœ¼ë¡œë§Œ ì•ˆë‚´)
  let conclusion = { cls:"warn", icon:"âš ï¸", text:"ì£¼ì˜ Â· ì…ë ¥ê°’/ê·¼ê±°ë¥¼ í™•ì¸í•˜ì„¸ìš”" };
  if(evPct!=null){
    if(evPct >= 2){
      conclusion = { cls:"good", icon:"âœ…", text:`ì¶”ì²œ Â· +EV ${evPct.toFixed(2)}%` };
    }else if(evPct >= 0){
      conclusion = { cls:"warn", icon:"âš ï¸", text:`ì£¼ì˜ Â· ì†Œí­ +EV ${evPct.toFixed(2)}%` };
    }else{
      conclusion = { cls:"bad", icon:"â›”", text:`PASS Â· -EV ${Math.abs(evPct).toFixed(2)}%` };
    }
  }else if(marginPct!=null){
    if(marginPct <= 3){
      conclusion = { cls:"good", icon:"âœ…", text:`ì¶”ì²œ Â· ë§ˆì§„ ë‚®ìŒ ${marginPct.toFixed(1)}%` };
    }else if(marginPct <= 6){
      conclusion = { cls:"warn", icon:"âš ï¸", text:`ì£¼ì˜ Â· ë§ˆì§„ ë³´í†µ ${marginPct.toFixed(1)}%` };
    }else{
      conclusion = { cls:"bad", icon:"â›”", text:`PASS Â· ë§ˆì§„ ë†’ìŒ ${marginPct.toFixed(1)}%` };
    }
  }
  const adviceKey = (conclusion.cls==="good") ? "rec" : (conclusion.cls==="bad" ? "pass" : "caution");
  const trustHtml = buildTrustLineHtml(adviceKey);
  const canMark = !!(LAST_RECORD && LAST_RECORD.id);
  const reason = (()=>{
    const parts = [];
    if(evPct != null) parts.push(`EV ${(evPct>=0?"+":"")+evPct.toFixed(2)}%`);
    if(marginPct != null) parts.push(`ë§ˆì§„ ${marginPct.toFixed(1)}%`);
    if(topProb) parts.push(`ì‹œì¥ ${topProb.label} ${topProb.p.toFixed(1)}%`);

    if(!parts.length) return "";

    let tail = "";
    if(evPct != null){
      if(evPct >= 2) tail = " Â· ë°¸ë¥˜ êµ¬ê°„";
      else if(evPct >= 0) tail = " Â· ì†Œí­ ë°¸ë¥˜";
      else tail = " Â· -EV";
    }else if(marginPct != null){
      if(marginPct <= 3) tail = " Â· ë§ˆì§„ ë‚®ìŒ";
      else if(marginPct <= 6) tail = " Â· ë§ˆì§„ ë³´í†µ";
      else tail = " Â· ë§ˆì§„ ë†’ìŒ";
    }
    return "ê·¼ê±°: " + parts.join(" Â· ") + tail;
  })();


  const hero = `
    <div class="resultHero">
      <div class="heroTop">
        <div class="heroText">
          <div class="heroTitle">${sportName} Â· ${levelLabel(level)} ê²°ê³¼</div>
          <div class="heroSub">ì…ë ¥ê°’ ê¸°ë°˜ ìš”ì•½ Â· ì•„ë˜ ìƒì„¸í‘œë¡œ ê·¼ê±°ë¥¼ í™•ì¸í•˜ì„¸ìš”</div>
        </div>
        <div class="heroRight">
          <div class="heroBadges">
            <span class="chip big ${primary.cls}">${primary.text}</span>
            ${secondary ? `<span class="chip ${secondary.cls}">${secondary.text}</span>` : ``}
          </div>
          <div class="heroConclusion ${conclusion.cls}">
            <span class="cIcon">${conclusion.icon}</span>
            <span class="cText">${conclusion.text}</span>
          </div>
          <div class="trustLine">${trustHtml}</div>
          ${reason ? `<div class="heroReason">${reason}</div>` : ``}
          <div class="outcomeBar" ${canMark ? "" : "style=\"display:none;\""}>
            <button class="oBtn" type="button" onclick="markOutcome('W')">âœ… ì ì¤‘</button>
            <button class="oBtn" type="button" onclick="markOutcome('L')">âŒ ë¯¸ì ì¤‘</button>
            <button class="oBtn" type="button" onclick="markOutcome('V')">âšª ì·¨ì†Œ</button>
            <button class="oBtn" type="button" onclick="markOutcome('')">â†©ï¸ ë¯¸ê¸°ë¡</button>
          </div>
        </div>
      </div>

      <div class="heroStats">
        <div class="statCard">
          <div class="statK">ë©”ì¸ ë§ˆì§„</div>
          <div class="statV">${marginPct!=null ? marginPct.toFixed(1)+"%" : "â€”"}</div>
          <div class="statS">${over!=null ? "ì˜¤ë²„ë¼ìš´ë“œ "+over.toFixed(4) : "ì˜¤ë²„ë¼ìš´ë“œ â€”"}</div>
        </div>

        <div class="statCard">
          <div class="statK">ì‹œì¥ ìµœê³ í™•ë¥ </div>
          <div class="statV">${topProb ? `${topProb.label} ${topProb.p.toFixed(1)}%` : "â€”"}</div>
          <div class="statS">ë°°ë‹¹ ì—­ìˆ˜ ì •ê·œí™”</div>
        </div>

        <div class="statCard">
          <div class="statK">EV</div>
          <div class="statV">${evPct!=null ? ((evPct>=0?"+":"")+evPct.toFixed(2)+"%") : "ë¯¸ì…ë ¥"}</div>
          <div class="statS">${evPct!=null ? "ë‚´ ì˜ˆìƒ í™•ë¥  ê¸°ì¤€" : "ê³ ê¸‰ëª¨ë“œì—ì„œ ì…ë ¥"}</div>
        </div>
      </div>
    </div>
  `;

  const html = rows.map(([k,v])=>{
    // vê°€ HTML í¬í•¨í•  ìˆ˜ ìˆìœ¼ë‹ˆ ê·¸ëŒ€ë¡œ
    let cls = "";
    const s = String(v);
    if(k.includes("íŒë‹¨") && s.includes("-EV")) cls = "warn";
    if(k.includes("íŒë‹¨") && s.includes("+EV")) cls = "good";
    return `<div class="kv"><div class="k">${k}</div><div class="v ${cls}">${v}</div></div>`;
  }).join("");

  box.innerHTML = `
    ${hero}
    <div class="detailHead">ìƒì„¸ ì§€í‘œ</div>
    ${html}
    <hr class="sep">
    <div style="font-size:12px;color:#9a9a9a;line-height:1.5;">
      â€» â€œìŠ¹ë¦¬ í™•ë¥ (ë°°ë‹¹ ê¸°ë°˜Â·ì¶”ì •)â€ì€ ë°°ë‹¹ ì—­ìˆ˜ë¥¼ ì •ê·œí™”í•œ ê°’(ì‹œì¥ ê¸°ë°˜ ì¶”ì •)ì…ë‹ˆë‹¤.<br>
      â€» EV/ë¹„ì¤‘ì€ ì‚¬ìš©ìê°€ ì…ë ¥í•œ â€œë‚´ ì˜ˆìƒ í™•ë¥ â€ ê¸°ë°˜ì˜ ì°¸ê³  ì§€í‘œì´ë©° ìŠ¹ë¥ ì„ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
      â€» ì•„ì‹œì•ˆ(í‘¸ì‹œ) ê·¼ì‚¬ëŠ” ì‚¬ìš©ìê°€ ì…ë ¥í•œ í‘¸ì‹œ í™•ë¥ (ë˜ëŠ” ì¢…ëª© ê¸°ë³¸ê°’)ë¡œ ê·¼ì‚¬í•©ë‹ˆë‹¤.
    </div>
  `;
  box.style.display = "block";

  copyLines.push(`ì£¼ì†Œ: https://88st.cloud/analysis/`);
  LAST_TEXT = copyLines.join("\n") + "\n\n" + rows.map(r=>`${r[0]}: ${String(r[1]).replace(/<[^>]*>/g,"")}`).join("\n");
}
function showError(msg){
  const box = $("result");
  box.innerHTML = `<div class="kv"><div class="k">ì•ˆë‚´</div><div class="v warn">${msg}</div></div>`;
  box.style.display = "block";
  LAST_TEXT = `[88 ì»¤ë®¤ë‹ˆí‹°] ì•ˆë‚´\n${msg}\nì£¼ì†Œ: https://88st.cloud/analysis/`;
}
function hideResult(){
  const box = $("result");
  box.style.display = "none";
  box.innerHTML = "";
  LAST_TEXT = "";
}
function resetAll(){
  [
    "league","teams",
    "main2OddsA","main2OddsB","main3OddsH","main3OddsD","main3OddsA",
    "myProb","stake",
    "handicapLine","handicapOddsA","handicapOddsB","handicapPush",
    "totalLine","overOdds","underOdds","ouPush","myOverProb"
  ].forEach(id=>{ const el=$(id); if(el) el.value=""; });

  hideResult();
  localStorage.removeItem(LS_KEY);
  setEvFlag(false);
  renderMarginDash();
  toast("ì´ˆê¸°í™” ì™„ë£Œ");
}

/* =========================
   ë³µì‚¬/ê³µìœ  (ê¸°ì¡´ ìœ ì§€)
========================= */
async function copyResult(){
  if(!LAST_TEXT) return showError("ë¨¼ì € 'ê³„ì‚°í•˜ê¸°'ë¥¼ ëˆŒëŸ¬ ê²°ê³¼ë¥¼ ë§Œë“  ë’¤ ë³µì‚¬í•  ìˆ˜ ìˆì–´ìš”.");
  try{
    await navigator.clipboard.writeText(LAST_TEXT);
    toast("ê²°ê³¼ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
  }catch(e){
    prompt("ì•„ë˜ ë‚´ìš©ì„ ë³µì‚¬í•˜ì„¸ìš”:", LAST_TEXT);
  }
}
async function shareResult(){
  if(!LAST_TEXT) return showError("ë¨¼ì € 'ê³„ì‚°í•˜ê¸°'ë¥¼ ëˆŒëŸ¬ ê²°ê³¼ë¥¼ ë§Œë“  ë’¤ ê³µìœ í•  ìˆ˜ ìˆì–´ìš”.");
  try{
    if(navigator.share){
      await navigator.share({ title:"88 ì»¤ë®¤ë‹ˆí‹° ë¶„ì„ ê²°ê³¼", text: LAST_TEXT });
    }else{
      await copyResult();
    }
  }catch(e){}
}

/* =========================
   UX Add-ons (non-breaking)
========================= */
function updateSaveBadge(ts){
  const el = document.getElementById("saveBadge");
  if(!el) return;
  if(!ts){
    el.innerHTML = `<span class="dot"></span>ìë™ ì €ì¥`;
    return;
  }
  const d = new Date(ts);
  const hh = String(d.getHours()).padStart(2,"0");
  const mm = String(d.getMinutes()).padStart(2,"0");
  el.innerHTML = `<span class="dot"></span>ìë™ ì €ì¥ Â· ${hh}:${mm}`;
}

function toggleMiniGuide(){
  const body = document.getElementById("miniGuideBody");
  const pill = document.getElementById("miniGuidePill");
  if(!body || !pill) return;
  const isOpen = body.style.display === "block";
  const next = !isOpen;
  body.style.display = next ? "block" : "none";
  pill.textContent = next ? "ë‹«ê¸°" : "ì—´ê¸°";
  try{ localStorage.setItem("88_mini_guide_open", next ? "1":"0"); }catch(e){}
}

function restoreMiniGuide(){
  try{
    const v = localStorage.getItem("88_mini_guide_open");
    const body = document.getElementById("miniGuideBody");
    const pill = document.getElementById("miniGuidePill");
    if(!body || !pill) return;
    const open = v === "1";
    body.style.display = open ? "block" : "none";
    pill.textContent = open ? "ë‹«ê¸°" : "ì—´ê¸°";
  }catch(e){}
}

function clearInvalid(){
  document.querySelectorAll(".is-invalid").forEach(el=>el.classList.remove("is-invalid"));
}
function markInvalid(ids){
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.classList.add("is-invalid");
  });
  const first = document.querySelector(".is-invalid");
  if(first){
    try{ first.scrollIntoView({behavior:"smooth", block:"center"}); }catch(e){}
  }
}

function quickJump(which){
  if(which==="top"){
    try{ window.scrollTo({top:0, behavior:"smooth"}); }catch(e){ window.scrollTo(0,0); }
    return;
  }
  const map = {
    main: "mainBox",
    total: "totalBox",
    handicap: "handicapBox",
    result: "result",
    history: "historyList"
  };
  const id = map[which];
  const el = document.getElementById(id);
  if(!el) return;
  if(which==="total"){ setCollapsed("totalBody", false); }
  if(which==="handicap"){ setCollapsed("handicapBody", false); }
  try{ el.scrollIntoView({behavior:"smooth", block:"start"}); }catch(e){}
}

function openShareCard(){
  const modal = document.getElementById("shareCardModal");
  const resultBox = document.getElementById("result");
  if(!modal) return;
  if(!resultBox || resultBox.style.display==="none" || !resultBox.innerText.trim()){
    return showError("ë¨¼ì € 'ê³„ì‚°í•˜ê¸°'ë¡œ ê²°ê³¼ë¥¼ ë§Œë“  ë’¤ ê³µìœ  ì¹´ë“œë¥¼ ìƒì„±í•  ìˆ˜ ìˆì–´ìš”.");
  }
  modal.style.display = "flex";
  drawShareCard();
  try{ track("share_card_open", { page_path: location.pathname }); }catch(e){}
}
function closeShareCard(){
  const modal = document.getElementById("shareCardModal");
  if(modal) modal.style.display = "none";
}

function getShareLink(){
  const base = location.origin + location.pathname;
  let qs = "";
  try{ if(typeof getUtmQuery === "function") qs = getUtmQuery(); }catch(e){}
  return base + (qs || "");
}

function extractResultLines(){
  const box = document.getElementById("result");
  if(!box) return [];
  const kvs = box.querySelectorAll(".kv");
  const lines = [];
  kvs.forEach(kv=>{
    const k = kv.querySelector(".k")?.innerText?.trim();
    const v = kv.querySelector(".v")?.innerText?.trim();
    if(k && v) lines.push(`${k}: ${v}`);
  });
  return lines;
}

function roundRect(ctx, x, y, w, h, r, fill, stroke){
  const rr = Math.min(r, w/2, h/2);
  ctx.beginPath();
  ctx.moveTo(x+rr, y);
  ctx.arcTo(x+w, y, x+w, y+h, rr);
  ctx.arcTo(x+w, y+h, x, y+h, rr);
  ctx.arcTo(x, y+h, x, y, rr);
  ctx.arcTo(x, y, x+w, y, rr);
  ctx.closePath();
  if(fill) ctx.fill();
  if(stroke) ctx.stroke();
}

function drawShareCard(){
  const canvas = document.getElementById("shareCardCanvas");
  if(!canvas) return;
  const ctx = canvas.getContext("2d");
  const W = canvas.width, H = canvas.height;

  // bg
  const g = ctx.createLinearGradient(0,0,W,H);
  g.addColorStop(0, "#0b0b0b");
  g.addColorStop(0.55, "#121212");
  g.addColorStop(1, "#07070a");
  ctx.fillStyle = g; ctx.fillRect(0,0,W,H);

  // glow
  ctx.fillStyle = "rgba(var(--accentRGB),0.12)";
  ctx.beginPath(); ctx.arc(W*0.60, H*0.15, 330, 0, Math.PI*2); ctx.fill();
  ctx.fillStyle = "rgba(90,160,255,0.08)";
  ctx.beginPath(); ctx.arc(W*0.18, H*0.25, 260, 0, Math.PI*2); ctx.fill();

  // card
  const pad = 70;
  const r = 34;
  ctx.fillStyle = "rgba(255,255,255,0.06)";
  roundRect(ctx, pad, pad, W-pad*2, H-pad*2, r, true, false);
  ctx.strokeStyle = "rgba(255,255,255,0.10)";
  ctx.lineWidth = 2;
  roundRect(ctx, pad, pad, W-pad*2, H-pad*2, r, false, true);

  // header
  ctx.fillStyle = "#f5e27a";
  ctx.font = "900 54px system-ui, -apple-system, Segoe UI, Roboto";
  ctx.fillText("88 ë¶„ì„ ê²°ê³¼", pad+40, pad+95);

  ctx.fillStyle = "rgba(255,255,255,0.80)";
  ctx.font = "700 28px system-ui, -apple-system, Segoe UI, Roboto";
  const ts = new Date();
  ctx.fillText(ts.toLocaleString("ko-KR"), pad+40, pad+145);

  // badge (EV flag)
  let badgeText = "";
  try{
    const evEl = document.getElementById("evFlag");
    if(evEl && evEl.innerText) badgeText = evEl.innerText.trim();
  }catch(e){}
  if(badgeText){
    const bx = pad+40, by = pad+170, bw = 340, bh = 54;
    ctx.fillStyle = "rgba(var(--accentRGB),0.18)";
    roundRect(ctx, bx, by, bw, bh, 999, true, false);
    ctx.strokeStyle = "rgba(var(--accentRGB),0.35)";
    ctx.lineWidth = 2;
    roundRect(ctx, bx, by, bw, bh, 999, false, true);
    ctx.fillStyle = "#fff";
    ctx.font = "900 26px system-ui, -apple-system, Segoe UI, Roboto";
    ctx.fillText(badgeText, bx+18, by+36);
  }

  // lines
  const lines = extractResultLines().slice(0, 12);
  let y = pad + 270;
  ctx.fillStyle = "rgba(255,255,255,0.92)";
  ctx.font = "800 30px system-ui, -apple-system, Segoe UI, Roboto";
  lines.forEach((line)=>{
    const txt = line.length > 46 ? (line.slice(0,46) + "â€¦") : line;
    ctx.fillText("â€¢ " + txt, pad+40, y);
    y += 48;
  });

  // footer
  ctx.fillStyle = "rgba(255,255,255,0.75)";
  ctx.font = "800 26px system-ui, -apple-system, Segoe UI, Roboto";
  ctx.fillText("ë§í¬: " + getShareLink(), pad+40, H - pad - 70);

  ctx.fillStyle = "rgba(255,255,255,0.55)";
  ctx.font = "700 22px system-ui, -apple-system, Segoe UI, Roboto";
  ctx.fillText("â€» íŒë‹¨ ë³´ì¡°ìš© / ê²°ê³¼ë¥¼ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.", pad+40, H - pad - 30);
}

async function copyShareLink(){
  const link = getShareLink();
  try{
    await navigator.clipboard.writeText(link);
    toast("ë§í¬ë¥¼ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤");
    try{ track("share_link_copy", { page_path: location.pathname }); }catch(e){}
  }catch(e){
    toast("ë³µì‚¬ ì‹¤íŒ¨");
  }
}

async function copyShareText(){
  if(!LAST_TEXT) return showError("ë¨¼ì € 'ê³„ì‚°í•˜ê¸°'ë¡œ ê²°ê³¼ë¥¼ ë§Œë“  ë’¤ ë³µì‚¬í•  ìˆ˜ ìˆì–´ìš”.");
  try{
    await navigator.clipboard.writeText(LAST_TEXT + "\n" + getShareLink());
    toast("ë¬¸êµ¬ë¥¼ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤");
    try{ track("share_text_copy", { page_path: location.pathname }); }catch(e){}
  }catch(e){
    toast("ë³µì‚¬ ì‹¤íŒ¨");
  }
}

function downloadShareCard(){
  const canvas = document.getElementById("shareCardCanvas");
  if(!canvas) return;
  try{
    canvas.toBlob((blob)=>{
      if(!blob) return;
      const a = document.createElement("a");
      const url = URL.createObjectURL(blob);
      a.href = url;
      a.download = "88-analysis-card.png";
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(()=>URL.revokeObjectURL(url), 800);
      toast("ì´ë¯¸ì§€ë¥¼ ì €ì¥í–ˆìŠµë‹ˆë‹¤");
      try{ track("share_card_download", { page_path: location.pathname }); }catch(e){}
    }, "image/png", 1.0);
  }catch(e){
    toast("ì €ì¥ ì‹¤íŒ¨");
  }
}

function setupShareCardBackdropClose(){
  const modal = document.getElementById("shareCardModal");
  if(modal){
    modal.addEventListener("click", (e)=>{
      if(e.target === modal) closeShareCard();
    });
  }
}

/* =========================
   í† ìŠ¤íŠ¸
========================= */
let toastTimer=null;
function toast(msg){
  const el=document.getElementById("toast88");
  if(!el) return;
  el.textContent=msg;
  el.style.opacity="1";
  if(toastTimer) clearTimeout(toastTimer);
  toastTimer=setTimeout(()=>{ el.style.opacity="0"; }, 1400);
}

/* =========================
   ë§ˆì§„ ëŒ€ì‹œë³´ë“œ ë Œë”
========================= */
function renderMarginDash(last){
  const sport = last?.sport || val("sport") || "soccer";
  const cfg = SPORT_CFG[sport] || SPORT_CFG.soccer;

  // ì…ë ¥ì—ì„œ ì¦‰ì„ìœ¼ë¡œë„ ê³„ì‚° ê°€ëŠ¥(ê³„ì‚° ì „ì—ë„ ê¸°ë³¸ í‘œì‹œ)
  const is3 = (cfg.main==="3way");
  let main = null;
  try{
    if(is3){
      const h=parseOdds(val("main3OddsH")), d=parseOdds(val("main3OddsD")), a=parseOdds(val("main3OddsA"));
      if(h && d && a) main = compute3Way(h,d,a).marginPct;
    }else{
      const a=parseOdds(val("main2OddsA")), b=parseOdds(val("main2OddsB"));
      if(a && b) main = compute2Way(a,b,0).marginPct;
    }
  }catch(e){}

  let ou = null;
  try{
    const o=parseOdds(val("overOdds")), u=parseOdds(val("underOdds"));
    if(o && u){
      let push = parsePct(val("ouPush"));
      if(push==null) push=(cfg.defaults.ouPush||0)/100;
      ou = compute2Way(o,u,push).marginPct;
    }
  }catch(e){}

  let hc = null;
  try{
    const a=parseOdds(val("handicapOddsA")), b=parseOdds(val("handicapOddsB"));
    if(a && b){
      let push = parsePct(val("handicapPush"));
      if(push==null) push=(cfg.defaults.hcPush||0)/100;
      hc = compute2Way(a,b,push).marginPct;
    }
  }catch(e){}

  if(last){
    if(typeof last.main === "number") main = last.main;
    if(typeof last.ou === "number") ou = last.ou;
    if(typeof last.hc === "number") hc = last.hc;
  }

  const items = [
    { key:"main", title:"ë©”ì¸", margin: main },
    { key:"ou", title:"ì˜¤ë²„/ì–¸ë”", margin: ou },
    { key:"hc", title:"í•¸ë””ìº¡", margin: hc }
  ];

  const html = items.map(it=>{
    if(typeof it.margin !== "number"){
      return `
        <div class="m-card">
          <div class="m-head">
            <div class="m-name">${it.title}</div>
            <div class="chip mid">ë¯¸ì…ë ¥</div>
          </div>
          <div class="m-lines">ë°°ë‹¹ì„ ì…ë ¥í•˜ë©´ ë§ˆì§„/íŒì •ì´ í‘œì‹œë©ë‹ˆë‹¤.</div>
        </div>
      `;
    }
    const íŒì • = classifyMargin(sport, it.key, it.margin);
    return `
      <div class="m-card">
        <div class="m-head">
          <div class="m-name">${it.title}</div>
          <div class="chip ${íŒì •.cls}">${íŒì •.label}</div>
        </div>
        <div class="m-lines">
          ê¸°ì¤€(ë‚®ìŒ/ë³´í†µ/ì£¼ì˜): <b>${MARGIN_RULE[sport][it.key][0]}%</b> / <b>${MARGIN_RULE[sport][it.key][1]}%</b> / <b>${MARGIN_RULE[sport][it.key][2]}%</b>
        </div>
      </div>
    `;
  }).join("");

  const box = document.getElementById("marginDash");
  if(box) box.innerHTML = html;
}

/* =========================
   íˆìŠ¤í† ë¦¬ ì €ì¥/ë³µì›/ë¹„êµ
========================= */
function readHistory(){
  try{
    const raw = localStorage.getItem(HIST_KEY);
    if(!raw) return [];
    const arr = JSON.parse(raw);
    return Array.isArray(arr) ? arr : [];
  }catch(e){
    return [];
  }
}
function writeHistory(arr){
  localStorage.setItem(HIST_KEY, JSON.stringify(arr.slice(0,50)));
}
function addHistory(rec){
  // ë§ˆì§„ ì—†ìœ¼ë©´ ì €ì¥ ì•ˆí•¨? -> ìµœì†Œ ë©”ì¸ ìˆìœ¼ë‹ˆ ì €ì¥
  const arr = readHistory();
  arr.unshift(rec);
  writeHistory(arr);
  renderHistory();
}
function clearHistory(){
  if(!confirm("íˆìŠ¤í† ë¦¬ë¥¼ ëª¨ë‘ ì‚­ì œí• ê¹Œìš”?")) return;
  localStorage.removeItem(HIST_KEY);
  renderHistory();
  renderTop3();
  toast("íˆìŠ¤í† ë¦¬ ì‚­ì œ ì™„ë£Œ");
}


/* =========================
   ì •ì°©/ì •í™•ë„ ì²´ê°ìš© UX ë ˆì´ì–´
   - ê³„ì‚° ë¡œì§ ë³€ê²½ ì—†ìŒ
   - ì…ë ¥ ê²€ì¦/ìŠ¤ëƒ…ìƒ·/ë‚´ ì„±ê³¼(ìŠ¹íŒ¨ ê¸°ë¡)ë§Œ ì¶”ê°€
========================= */

// íŒë‹¨(ì¶”ì²œ/ì£¼ì˜/PASS) í‚¤
function adviceKeyFromMetrics(bestEVPct, mainMarginPct){
  const ev = (typeof bestEVPct==="number") ? bestEVPct : null; // %
  const m = (typeof mainMarginPct==="number") ? mainMarginPct : null; // %
  if(ev!=null){
    if(ev >= 2) return "rec";
    if(ev >= 0) return "caution";
    return "pass";
  }
  if(m!=null){
    if(m <= 3) return "rec";
    if(m <= 6) return "caution";
    return "pass";
  }
  return "caution";
}
function adviceKeyForRecord(h){
  return adviceKeyFromMetrics(h?.bestEVPct, h?.markets?.main?.marginPct);
}
function adviceInfoForKey(key){
  if(key==="rec") return { text:"ì¶”ì²œ", cls:"good" };
  if(key==="pass") return { text:"PASS", cls:"bad" };
  return { text:"ì£¼ì˜", cls:"warn" };
}

// ìŠ¹/íŒ¨/ì·¨ì†Œ ë¼ë²¨
function outcomeInfo(v){
  if(v==="W") return { text:"âœ… ì ì¤‘", cls:"win" };
  if(v==="L") return { text:"âŒ ë¯¸ì ì¤‘", cls:"lose" };
  if(v==="V") return { text:"âšª ì·¨ì†Œ", cls:"void" };
  return { text:"ë¯¸ê¸°ë¡", cls:"none" };
}

// íˆìŠ¤í† ë¦¬ ê²°ê³¼ ê¸°ë¡(ìŠ¹/íŒ¨/ì·¨ì†Œ)
function setOutcome(id, v){
  const arr = readHistory();
  const idx = arr.findIndex(x=>x.id===id);
  if(idx<0){
    toast("íˆìŠ¤í† ë¦¬ì—ì„œ í•­ëª©ì„ ì°¾ì§€ ëª»í–ˆì–´ìš”.");
    return;
  }
  const next = (v==="W"||v==="L"||v==="V") ? v : "";
  arr[idx].outcome = next || null;
  arr[idx].outcomeAt = next ? Date.now() : null;

  // advice ë©”íƒ€ê°€ ì—†ë˜ ì˜ˆì „ í•­ëª©ë„ ë³´ì •
  if(!arr[idx].advice){
    arr[idx].advice = adviceKeyForRecord(arr[idx]);
  }
  writeHistory(arr);
  renderHistory();         // ë‚´ë¶€ì—ì„œ renderPerfBoxë„ í˜¸ì¶œë¨
  refreshTrustLine();
  toast(next ? "ê²°ê³¼ ê¸°ë¡ ì™„ë£Œ" : "ê¸°ë¡ í•´ì œ ì™„ë£Œ");
}
function markOutcome(v){
  if(!LAST_RECORD || !LAST_RECORD.id){
    toast("ë¨¼ì € ê³„ì‚° ê²°ê³¼ë¥¼ ë§Œë“  ë’¤ ê¸°ë¡í•  ìˆ˜ ìˆì–´ìš”.");
    return;
  }
  setOutcome(LAST_RECORD.id, v);
}

// ë‚´ ì„±ê³¼ ì§‘ê³„
function computePerfStats(){
  const arr = readHistory();
  const init = ()=>({ w:0, l:0, v:0, n:0, rate:null });
  const out = { total:init(), by:{ rec:init(), caution:init(), pass:init() } };

  arr.forEach(h=>{
    const key = (h.advice || adviceKeyForRecord(h));
    const bucket = out.by[key] || out.by.caution;
    const tgtAll = out.total;

    const o = h.outcome;
    if(o==="W"){ bucket.w++; tgtAll.w++; }
    else if(o==="L"){ bucket.l++; tgtAll.l++; }
    else if(o==="V"){ bucket.v++; tgtAll.v++; }
  });

  const finalize = (b)=>{
    b.n = b.w + b.l;
    b.rate = (b.n>0) ? (b.w / b.n) : null;
    return b;
  };
  finalize(out.total);
  Object.keys(out.by).forEach(k=>finalize(out.by[k]));
  return out;
}
function pct(x){
  if(x==null) return "â€”";
  return Math.round(x*100) + "%";
}

// ë‚´ ì„±ê³¼ ë°•ìŠ¤ ë Œë”
function renderPerfBox(){
  const box = document.getElementById("perfBox");
  const grid = document.getElementById("perfGrid");
  const sub = document.getElementById("perfSub");
  const meta = document.getElementById("perfMeta");
  if(!box || !grid || !sub || !meta) return;

  const s = computePerfStats();
  const totalN = s.total.n;
  if(totalN<=0 && (s.total.v<=0)){
    box.style.display = "none";
    return;
  }
  box.style.display = "block";

  meta.textContent = `í‘œë³¸ ${totalN} Â· ì·¨ì†Œ ${s.total.v}`;
  sub.innerHTML = `ë‚´ê°€ <b>ê²°ê³¼(ì ì¤‘/ë¯¸ì ì¤‘)</b>ë¥¼ ì²´í¬í•œ í•­ëª©ë§Œ ì§‘ê³„ë©ë‹ˆë‹¤. í‘œë³¸ì´ ì ìœ¼ë©´ ìˆ˜ì¹˜ëŠ” ì°¸ê³ ìš©ì…ë‹ˆë‹¤.`;

  const makeTile = (label, key)=>{
    const b = s.by[key];
    const info = adviceInfoForKey(key);
    return `
      <div class="perf-tile">
        <div class="perf-k">${label} <span class="${info.cls}"><b>${info.text}</b></span></div>
        <div class="perf-v">${pct(b.rate)}</div>
        <div class="perf-n">n=${b.n} (ì ì¤‘ ${b.w} / ë¯¸ì ì¤‘ ${b.l})</div>
      </div>
    `;
  };

  grid.innerHTML = `
    ${makeTile("ì¶”ì²œì¼ ë•Œ", "rec")}
    ${makeTile("ì£¼ì˜ì¼ ë•Œ", "caution")}
    ${makeTile("PASSì¼ ë•Œ", "pass")}
  `;
}

// ê²°ê³¼ ìƒë‹¨ì— â€œë‚´ ê¸°ë¡ ê¸°ì¤€â€ ì‹ ë¢° ë¼ì¸
function buildTrustLineHtml(adviceKey){
  const s = computePerfStats();
  const b = s.by[adviceKey] || s.by.caution;
  const info = adviceInfoForKey(adviceKey);

  if(b.n < 10){
    return `ë‚´ ê¸°ë¡ ê¸°ì¤€: <b>í‘œë³¸ ë¶€ì¡±</b> (í˜„ì¬ n=${b.n}). ì•„ë˜ <b>ìƒì„¸ ì§€í‘œ</b>ê¹Œì§€ í™•ì¸í•˜ì„¸ìš”.`;
  }
  return `ë‚´ ê¸°ë¡ ê¸°ì¤€: <span class="${info.cls}"><b>${info.text}</b></span> êµ¬ê°„ ì ì¤‘ë¥  <b>${pct(b.rate)}</b> (n=${b.n}).`;
}
function refreshTrustLine(){
  const tl = document.querySelector(".trustLine");
  const hc = document.querySelector(".heroConclusion");
  if(!tl || !hc) return;
  let key = "caution";
  if(hc.classList.contains("good")) key = "rec";
  else if(hc.classList.contains("bad")) key = "pass";
  tl.innerHTML = buildTrustLineHtml(key);
}

// ===== ìµœê·¼ ì…ë ¥ ìŠ¤ëƒ…ìƒ·(ìµœê·¼ 5ê°œ) =====
function readSnaps(){
  try{
    const raw = localStorage.getItem(SNAP_KEY);
    if(!raw) return [];
    const arr = JSON.parse(raw);
    return Array.isArray(arr) ? arr : [];
  }catch(e){ return []; }
}
function writeSnaps(arr){
  localStorage.setItem(SNAP_KEY, JSON.stringify(arr.slice(0,5)));
}
function stateSig(state){
  // ë„ˆë¬´ ì¦ì€ ìŠ¤ëƒ…ìƒ·ì„ ë§‰ê¸° ìœ„í•œ ê°„ë‹¨ ì‹œê·¸ë‹ˆì²˜
  const keys = ["sport","level","league","teams","main2OddsA","main2OddsB","main3OddsH","main3OddsD","main3OddsA","totalLine","overOdds","underOdds","handicapLine","handicapOddsA","handicapOddsB","myProb","myOverProb"];
  const o = {};
  keys.forEach(k=>o[k]=state?.[k] ?? "");
  return JSON.stringify(o);
}
function maybePushSnapshot(state, force){
  if(!state) return;
  try{
    const now = Date.now();
    const sig = stateSig(state);
    const metaRaw = localStorage.getItem(SNAP_META_KEY);
    const meta = metaRaw ? JSON.parse(metaRaw) : {};
    const lastAt = meta?.lastAt || 0;
    const lastSig = meta?.lastSig || "";

    if(!force){
      if(now - lastAt < 20000) return;  // 20ì´ˆ ì¿¨ë‹¤ìš´
      if(sig === lastSig) return;
    }

    const arr = readSnaps();
    const id = now.toString(36) + Math.random().toString(36).slice(2,6);
    arr.unshift({
      id,
      at: now,
      sport: state.sport,
      level: state.level,
      league: state.league,
      teams: state.teams,
      state
    });
    writeSnaps(arr);

    localStorage.setItem(SNAP_META_KEY, JSON.stringify({ lastAt: now, lastSig: sig }));
  }catch(e){}
}
function renderSnaps(){
  const wrap = document.getElementById("snapWrap");
  const list = document.getElementById("snapList");
  const meta = document.getElementById("snapMeta");
  if(!wrap || !list || !meta) return;

  const arr = readSnaps();
  if(!view.length){
    wrap.style.display = "none";
    return;
  }
  wrap.style.display = "block";
  meta.textContent = `ì´ ${arr.length}ê°œ`;

  list.innerHTML = arr.map(s=>{
    const d = new Date(s.at);
    const hh = String(d.getHours()).padStart(2,"0");
    const mm = String(d.getMinutes()).padStart(2,"0");
    const cfg = SPORT_CFG[s.sport] || {name:s.sport||"-"};
    const lev = levelLabel(s.level);
    const label = `${hh}:${mm} Â· ${cfg.name} Â· ${lev}`;
    const extra = (s.teams || s.league) ? escapeHtml(s.teams || s.league) : "";
    return `<button class="snap-chip" type="button" onclick="restoreSnapshot('${s.id}')">${label}${extra?` <span class="snap-meta">Â· ${extra}</span>`:""}</button>`;
  }).join("");
}
function restoreSnapshot(id){
  const arr = readSnaps();
  const s = arr.find(x=>x.id===id);
  if(!s || !s.state){
    toast("ìŠ¤ëƒ…ìƒ·ì„ ì°¾ì§€ ëª»í–ˆì–´ìš”.");
    return;
  }
  const st = s.state;

  setVal("sport", st.sport || "soccer");
  setVal("level", st.level || "simple");
  setVal("league", st.league || "");
  setVal("teams", st.teams || "");

  setVal("main2OddsA", st.main2OddsA || "");
  setVal("main2OddsB", st.main2OddsB || "");
  setVal("main3OddsH", st.main3OddsH || "");
  setVal("main3OddsD", st.main3OddsD || "");
  setVal("main3OddsA", st.main3OddsA || "");

  setVal("totalLine", st.totalLine || "");
  setVal("overOdds", st.overOdds || "");
  setVal("underOdds", st.underOdds || "");
  setVal("ouPush", st.ouPush || "");

  setVal("handicapLine", st.handicapLine || "");
  setVal("handicapOddsA", st.handicapOddsA || "");
  setVal("handicapOddsB", st.handicapOddsB || "");
  setVal("handicapPush", st.handicapPush || "");

  setVal("myProb", st.myProb || "");
  setVal("myOverProb", st.myOverProb || "");
  setVal("stake", st.stake || "");

  // í¼ì¹¨ ìƒíƒœ ë³µì›
  if(typeof st.handicapCollapsed==="boolean"){
    setCollapsed("handicapBody", !!st.handicapCollapsed);
  }
  if(typeof st.totalCollapsed==="boolean"){
    setCollapsed("totalBody", !!st.totalCollapsed);
  }

  onSportChange(true);
  onLevelChange(true);
  hideResult();
  renderMarginDash();
  saveState();
  toast("ìµœê·¼ ì…ë ¥ì„ ë³µì›í–ˆì–´ìš”.");
  try{ quickJump("main"); }catch(e){}
}

// ===== ì…ë ¥ ê²€ì¦/ê°€ì´ë“œ(ì‹¤ìˆ˜ ê°ì†Œ) =====
let _vTimer = null;
function setupValidation(){
  const oddsIds = ["main2OddsA","main2OddsB","main3OddsH","main3OddsD","main3OddsA","overOdds","underOdds","handicapOddsA","handicapOddsB"];
  const probIds = ["myProb","myOverProb"];
  const allIds = oddsIds.concat(probIds).concat(["totalLine","handicapLine","ouPush","handicapPush","stake"]);

  const onAnyInput = ()=>{
    if(_vTimer) clearTimeout(_vTimer);
    _vTimer = setTimeout(()=>{ validateInputs(); }, 80);
  };

  allIds.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    el.addEventListener("input", (e)=>{
      const t = String(e.target.value || "");
      // ìˆ«ì ì…ë ¥ ì •ë¦¬: ì‰¼í‘œ -> ì , í—ˆìš©ë¬¸ìë§Œ
      let s = t.replace(/,/g,".").replace(/[^\d.]/g,"");
      // ì  2ê°œ ì´ìƒ ë°©ì§€
      const parts = s.split(".");
      if(parts.length>2){
        s = parts[0] + "." + parts.slice(1).join("");
      }
      e.target.value = s;
      onAnyInput();
    });
    el.addEventListener("blur", ()=>{ onAnyInput(); });
  });

  // ì´ˆê¸° ê²€ì¦
  validateInputs();
}
function setInvalid(id, on){
  const el = document.getElementById(id);
  if(!el) return;
  if(on) el.classList.add("invalid");
  else el.classList.remove("invalid");
}
function showInputWarn(msg){
  const box = document.getElementById("inputWarn");
  if(!box) return;
  if(!msg){
    box.style.display="none";
    box.innerHTML="";
    return;
  }
  box.style.display="block";
  box.innerHTML = msg;
}
function validateInputs(){
  // ê¸°ë³¸: ëª¨ë“  invalid ì œê±°
  ["main2OddsA","main2OddsB","main3OddsH","main3OddsD","main3OddsA","overOdds","underOdds","handicapOddsA","handicapOddsB","totalLine","handicapLine","myProb","myOverProb"].forEach(id=>setInvalid(id,false));

  const sport = val("sport");
  const cfg = SPORT_CFG[sport] || SPORT_CFG.soccer;
  const mainType = cfg.main;

  // ë©”ì¸ í•„ìˆ˜ ê²€ì¦
  let mainOk = true;
  let mainMsg = "";

  const oddsOk = (id)=>{
    const x = parseOdds(val(id));
    return (x!=null && x>=1.01 && x<=200);
  };

  if(mainType==="2way"){
    const aOk = oddsOk("main2OddsA");
    const bOk = oddsOk("main2OddsB");
    if(!aOk){ setInvalid("main2OddsA", true); mainOk=false; }
    if(!bOk){ setInvalid("main2OddsB", true); mainOk=false; }
    if(!mainOk) mainMsg = "ë©”ì¸ ë°°ë‹¹(2ê°œ)ì„ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”. ì˜ˆ: <b>1.85</b> / <b>2.05</b>";
  }else{
    const hOk = oddsOk("main3OddsH");
    const dOk = oddsOk("main3OddsD");
    const aOk = oddsOk("main3OddsA");
    if(!hOk){ setInvalid("main3OddsH", true); mainOk=false; }
    if(!dOk){ setInvalid("main3OddsD", true); mainOk=false; }
    if(!aOk){ setInvalid("main3OddsA", true); mainOk=false; }
    if(!mainOk) mainMsg = "ë©”ì¸ ë°°ë‹¹(3ê°œ)ì„ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”. ì˜ˆ: <b>2.10</b> / <b>3.20</b> / <b>3.40</b>";
  }

  // ì˜µì…˜ ì…ë ¥(ë¶€ë¶„ ì…ë ¥ ì‹œ ê²½ê³ )
  const totalAny = !!(val("totalLine") || val("overOdds") || val("underOdds"));
  const totalOk = !totalAny || (!!val("totalLine") && oddsOk("overOdds") && oddsOk("underOdds"));
  if(totalAny && !totalOk){
    if(!val("totalLine")) setInvalid("totalLine", true);
    if(!oddsOk("overOdds")) setInvalid("overOdds", true);
    if(!oddsOk("underOdds")) setInvalid("underOdds", true);
  }

  const hcAny = !!(val("handicapLine") || val("handicapOddsA") || val("handicapOddsB"));
  const hcOk = !hcAny || (!!val("handicapLine") && oddsOk("handicapOddsA") && oddsOk("handicapOddsB"));
  if(hcAny && !hcOk){
    if(!val("handicapLine")) setInvalid("handicapLine", true);
    if(!oddsOk("handicapOddsA")) setInvalid("handicapOddsA", true);
    if(!oddsOk("handicapOddsB")) setInvalid("handicapOddsB", true);
  }

  // í™•ë¥  ì…ë ¥(ì¤‘ê¸‰/ê³ ê¸‰ì—ì„œë§Œ ì˜ë¯¸)
  const level = val("level");
  const probOk = (id)=>{
    const t = String(val(id) || "").trim();
    if(!t) return true;
    const n = Number(t);
    return isFinite(n) && n>=0 && n<=100;
  };
  let probWarn = "";
  if(level!=="simple"){
    if(!probOk("myProb")){ setInvalid("myProb", true); probWarn = "ë‚´ ì˜ˆìƒ í™•ë¥ ì€ <b>0~100</b> ì‚¬ì´ ìˆ«ìë¡œ ì…ë ¥í•˜ì„¸ìš”."; }
    if(!probOk("myOverProb")){ setInvalid("myOverProb", true); probWarn = "ì˜¤ë²„ ì˜ˆìƒ í™•ë¥ ì€ <b>0~100</b> ì‚¬ì´ ìˆ«ìë¡œ ì…ë ¥í•˜ì„¸ìš”."; }
  }

  // ë²„íŠ¼ í™œì„±í™”/ì•ˆë‚´
  const btn = document.getElementById("btnCalc");
  if(btn) btn.disabled = !mainOk;

  const warnMsgs = [];
  if(!mainOk) warnMsgs.push(mainMsg);
  if(totalAny && !totalOk) warnMsgs.push("ì˜¤ë²„Â·ì–¸ë”ëŠ” <b>ê¸°ì¤€ì  + ì˜¤ë²„/ì–¸ë” ë°°ë‹¹</b>ì„ ëª¨ë‘ ì±„ìš°ë©´ ë¶„ì„ë©ë‹ˆë‹¤.");
  if(hcAny && !hcOk) warnMsgs.push("í•¸ë””ìº¡ì€ <b>ë¼ì¸ + ì–‘ìª½ ë°°ë‹¹</b>ì„ ëª¨ë‘ ì±„ìš°ë©´ ë¶„ì„ë©ë‹ˆë‹¤.");
  if(probWarn) warnMsgs.push(probWarn);

  showInputWarn(warnMsgs.length ? ("âš ï¸ ì…ë ¥ í™•ì¸<br>" + warnMsgs.map(s=>"â€¢ "+s).join("<br>")) : "");
  return mainOk;
}

/* íˆìŠ¤í† ë¦¬ UI */
let pickSet = new Set();
let historyFilter = "all";

function setHistoryFilter(f, btn){
  historyFilter = f;
  // í•„í„° ë°”ê¾¸ë©´ ì„ íƒì€ ì´ˆê¸°í™”(í˜¼ë™ ë°©ì§€)
  pickSet.clear();
  const wrap = document.querySelector(".history-filters");
  if(wrap){
    wrap.querySelectorAll(".seg").forEach(x=>x.classList.remove("on"));
  }
  if(btn) btn.classList.add("on");
  renderHistory();
}
function updatePickUI(){
  const n = pickSet.size;
  const c = document.getElementById("pickCount");
  if(c) c.textContent = String(n);
  const del = document.getElementById("btnDeleteSelected");
  if(del) del.disabled = (n===0);
  const cmp = document.getElementById("btnCompare");
  if(cmp) cmp.disabled = (n!==2);
}
function deleteSelected(){
  const ids = Array.from(pickSet);
  if(ids.length===0){
    toast("ì‚­ì œí•  í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”");
    return;
  }
  if(!confirm(`ì„ íƒí•œ ${ids.length}ê°œ í•­ëª©ì„ ì‚­ì œí• ê¹Œìš”?`)) return;

  let arr = readHistory();
  arr = arr.filter(x=>!pickSet.has(x.id));
  writeHistory(arr);
  pickSet.clear();

  renderHistory();
  renderTop3();
  toast("ì„ íƒ ì‚­ì œ ì™„ë£Œ");
}



function renderHistory(){
  const list = document.getElementById("historyList");
  if(!list) return;

  const arr = readHistory();

  // ì„ íƒ ì •ë¦¬(ì‚­ì œ/í•„í„° ë“±ìœ¼ë¡œ ì‚¬ë¼ì§„ í•­ëª© ì œê±°)
  const idset = new Set(arr.map(x=>x.id));
  pickSet = new Set(Array.from(pickSet).filter(id=>idset.has(id)));

  // í•„í„° ì ìš©
  let view = arr;
  if(historyFilter === "rec"){
    view = arr.filter(h => (h.advice || adviceKeyForRecord(h)) === "rec");
  }else if(historyFilter === "untracked"){
    view = arr.filter(h => !h.outcome);
  }
  if(!arr.length){
    list.innerHTML = `
      <div class="demo-empty">
        <div class="demo-title">${(arr.length && historyFilter!=="all") ? "ì¡°ê±´ì— ë§ëŠ” ê¸°ë¡ì´ ì—†ì–´ìš”." : "íˆìŠ¤í† ë¦¬ê°€ ë¹„ì–´ìˆì–´ìš”."}</div>
        <div class="demo-desc">${(arr.length && historyFilter!=="all") ? "í•„í„° ì¡°ê±´ì— ë§ëŠ” ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. <b>ì „ì²´</b>ë¡œ ë°”ê¾¸ê±°ë‚˜ ìƒˆë¡œ ê³„ì‚°í•´ë³´ì„¸ìš”." : "ì•„ë˜ <b>ì˜ˆì‹œ ë²„íŠ¼</b>ì„ ëˆŒëŸ¬ ì…ë ¥ì„ ìë™ ì±„ìš°ê³ , ë°”ë¡œ ê³„ì‚°ê¹Œì§€ ì‹¤í–‰í•´ë³¼ ìˆ˜ ìˆì–´ìš”."}</div>
        <div class="demo-btns">
          <button class="btn primary2" type="button" onclick="loadDemo('soccer')">âš½ ì¶•êµ¬ ì˜ˆì‹œë¡œ ê³„ì‚°</button>
          <button class="btn primary2" type="button" onclick="loadDemo('basketball')">ğŸ€ ë†êµ¬ ì˜ˆì‹œë¡œ ê³„ì‚°</button>
        </div>
        <div class="demo-note">â€» ì˜ˆì‹œëŠ” ìƒ˜í”Œ ë°ì´í„°ì´ë©°, ì‹¤ì œ ê²°ê³¼/ìŠ¹ë¥ ì„ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
      </div>`;
    renderPerfBox();
    updatePickUI();
    return;
  }

  list.innerHTML = view.map(h=>{
    const cfg = SPORT_CFG[h.sport] || {name:h.sport||"-"};
    const mMain = h.markets?.main?.marginPct;
    const mOU = h.markets?.ou?.marginPct;
    const mHC = h.markets?.hc?.marginPct;

    const mainTag = (typeof mMain==="number") ? classifyMargin(h.sport,"main",mMain) : null;
    const ouTag = (typeof mOU==="number") ? classifyMargin(h.sport,"ou",mOU) : null;
    const hcTag = (typeof mHC==="number") ? classifyMargin(h.sport,"hc",mHC) : null;

    const evTxt = (typeof h.bestEVPct==="number") ? `${h.bestEVPct.toFixed(2)}%` : "-";
    const evCls = (h.evPositive) ? "good" : "warn";

    const checked = pickSet.has(h.id) ? "checked" : "";

    const adviceKey = (h.advice || adviceKeyForRecord(h));
    const adviceInfo = adviceInfoForKey(adviceKey);

    const out = outcomeInfo(h.outcome);

    return `
      <div class="h-item" onclick="onHistoryClick(event,'${h.id}')">
        <div class="h-top">
          <div>
            <div class="h-title">${h.time} Â· ${cfg.name} Â· ${levelLabel(h.level)} ${h.teams?`Â· ${escapeHtml(h.teams)}`:""}</div>
            <div class="h-sub">
              ë©”ì¸: ${mainTag?`<span class="${clsToTextColor(mainTag.cls)}">${mainTag.label}</span>`:"-"} /
              OU: ${ouTag?`<span class="${clsToTextColor(ouTag.cls)}">${ouTag.label}</span>`:"-"} /
              í•¸ë””: ${hcTag?`<span class="${clsToTextColor(hcTag.cls)}">${hcTag.label}</span>`:"-"}
              <br>
              ìµœê³  EV: <span class="${evCls}"><b>${evTxt}</b></span> Â·
              íŒë‹¨: <span class="${adviceInfo.cls}"><b>${adviceInfo.text}</b></span>
            </div>

            <div class="h-outcome" onclick="event.stopPropagation()">
              <div class="row">
                <div class="label">ê²°ê³¼ ê¸°ë¡</div>
                <span class="outTag ${out.cls}">${out.text}</span>
              </div>
              <div class="outBtns">
                <button class="oBtn ${h.outcome==='W'?'on':''}" type="button" onclick="setOutcome('${h.id}','W')">âœ… ì ì¤‘</button>
                <button class="oBtn ${h.outcome==='L'?'on':''}" type="button" onclick="setOutcome('${h.id}','L')">âŒ ë¯¸ì ì¤‘</button>
                <button class="oBtn ${h.outcome==='V'?'on':''}" type="button" onclick="setOutcome('${h.id}','V')">âšª ì·¨ì†Œ</button>
                <button class="oBtn ${(!h.outcome)?'on':''}" type="button" onclick="setOutcome('${h.id}','')">â†©ï¸ ë¯¸ê¸°ë¡</button>
              </div>
            </div>

          </div>

          <div class="h-actions" onclick="event.stopPropagation()">
            <button class="primary2" type="button" onclick="restoreFromHistory('${h.id}', true)">ë³µì›+ì¬ê³„ì‚°</button>
            <button type="button" onclick="restoreFromHistory('${h.id}', false)">ë³µì›ë§Œ</button>
            <label class="pick">
              <input type="checkbox" ${checked} onchange="togglePick('${h.id}', this.checked)">
              ë¹„êµ
            </label>
          </div>
        </div>
      </div>
    `;
  }).join("");

  renderPerfBox();
  updatePickUI();
}

/* íˆìŠ¤í† ë¦¬ í´ë¦­(ì•„ì´í…œ ì˜ì—­) -> ì¦‰ì‹œ ë³µì›+ì¬ê³„ì‚° */
function onHistoryClick(evt, id){
  // ë‚´ë¶€ ë²„íŠ¼ í´ë¦­ì€ stopPropagation ì²˜ë¦¬ë˜ì–´ ì—¬ê¸° ì•ˆ ì˜´
  restoreFromHistory(id, true);
}

function togglePick(id, on){
  if(on) pickSet.add(id);
  else pickSet.delete(id);
  updatePickUI();
}

function restoreFromHistory(id, doCalc){
  const arr = readHistory();
  const h = arr.find(x=>x.id===id);
  if(!h) return;

  // ê¸°ë³¸ ì…€ë ‰íŠ¸
  setVal("sport", h.sport);
  setVal("level", h.level);
  onSportChange(true);
  onLevelChange(true);

  // í…ìŠ¤íŠ¸
  setVal("league", h.league || "");
  setVal("teams", h.teams || "");

  // ë©”ì¸
  if(h.inputs.main2OddsA!=null) setVal("main2OddsA", h.inputs.main2OddsA);
  if(h.inputs.main2OddsB!=null) setVal("main2OddsB", h.inputs.main2OddsB);
  if(h.inputs.main3OddsH!=null) setVal("main3OddsH", h.inputs.main3OddsH);
  if(h.inputs.main3OddsD!=null) setVal("main3OddsD", h.inputs.main3OddsD);
  if(h.inputs.main3OddsA!=null) setVal("main3OddsA", h.inputs.main3OddsA);

  // EV ì…ë ¥
  if(h.inputs.myProb!=null) setVal("myProb", h.inputs.myProb);
  if(h.inputs.stake!=null) setVal("stake", h.inputs.stake);

  // í•¸ë””
  if(h.inputs.handicapLine!=null) setVal("handicapLine", h.inputs.handicapLine);
  if(h.inputs.handicapOddsA!=null) setVal("handicapOddsA", h.inputs.handicapOddsA);
  if(h.inputs.handicapOddsB!=null) setVal("handicapOddsB", h.inputs.handicapOddsB);
  if(h.inputs.handicapPush!=null) setVal("handicapPush", h.inputs.handicapPush);

  // OU
  if(h.inputs.totalLine!=null) setVal("totalLine", h.inputs.totalLine);
  if(h.inputs.overOdds!=null) setVal("overOdds", h.inputs.overOdds);
  if(h.inputs.underOdds!=null) setVal("underOdds", h.inputs.underOdds);
  if(h.inputs.ouPush!=null) setVal("ouPush", h.inputs.ouPush);
  if(h.inputs.myOverProb!=null) setVal("myOverProb", h.inputs.myOverProb);

  saveState();
  renderMarginDash();

  // ìŠ¤í¬ë¡¤
  scrollToCalc();

  if(doCalc){
    calc();
    toast("ë³µì› í›„ ì¬ê³„ì‚° ì™„ë£Œ");
  }else{
    toast("ì…ë ¥ ë³µì› ì™„ë£Œ");
  }
}

/* ë¹„êµ ëª¨ë‹¬ */
function openCompare(){
  const ids = Array.from(pickSet);
  if(ids.length !== 2){
    toast("ë¹„êµí•  í•­ëª© 2ê°œë¥¼ ì²´í¬í•´ ì£¼ì„¸ìš”");
    return;
  }
  const arr = readHistory();
  const a = arr.find(x=>x.id===ids[0]);
  const b = arr.find(x=>x.id===ids[1]);
  if(!a || !b){
    toast("ì„ íƒí•œ í•­ëª©ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤");
    return;
  }

  const grid = document.getElementById("compareGrid");
  if(!grid) return;

  grid.innerHTML = `
    ${renderCompareCol(a, "A")}
    ${renderCompareCol(b, "B")}
  `;

  document.getElementById("compareModal").style.display="flex";
}
function closeCompare(){
  document.getElementById("compareModal").style.display="none";
}
function renderCompareCol(h, tag){
  const cfg = SPORT_CFG[h.sport] || SPORT_CFG.soccer;

  const mainM = h.markets?.main?.marginPct;
  const ouM = h.markets?.ou?.marginPct;
  const hcM = h.markets?.hc?.marginPct;

  const mainTag = (typeof mainM==="number") ? classifyMargin(h.sport,"main",mainM) : null;
  const ouTag = (typeof ouM==="number") ? classifyMargin(h.sport,"ou",ouM) : null;
  const hcTag = (typeof hcM==="number") ? classifyMargin(h.sport,"hc",hcM) : null;

  const evTxt = (typeof h.bestEVPct==="number") ? `${h.bestEVPct.toFixed(2)}%` : "-";

  return `
    <div class="compare-col">
      <div class="ct">${tag} Â· ${h.time} Â· ${cfg.name} Â· ${levelLabel(h.level)}</div>
      <div class="line"><div class="k">ë¦¬ê·¸</div><div class="v">${h.league?escapeHtml(h.league):"-"}</div></div>
      <div class="line"><div class="k">ê²½ê¸°</div><div class="v">${h.teams?escapeHtml(h.teams):"-"}</div></div>
      <div class="line"><div class="k">ë©”ì¸ ë§ˆì§„</div><div class="v">${mainTag?`<span class="${clsToTextColor(mainTag.cls)}">${mainTag.label}</span>`:"-"}</div></div>
      <div class="line"><div class="k">OU ë§ˆì§„</div><div class="v">${ouTag?`<span class="${clsToTextColor(ouTag.cls)}">${ouTag.label}</span>`:"-"}</div></div>
      <div class="line"><div class="k">í•¸ë”” ë§ˆì§„</div><div class="v">${hcTag?`<span class="${clsToTextColor(hcTag.cls)}">${hcTag.label}</span>`:"-"}</div></div>
      <div class="line"><div class="k">ìµœê³  EV</div><div class="v">${h.evPositive?`<span class="good">${evTxt}</span>`:`<span class="warn">${evTxt}</span>`}</div></div>

      <div class="mini-actions">
        <button class="restore" type="button" onclick="restoreFromHistory('${h.id}', true)">ì´ í•­ëª© ë³µì›+ì¬ê³„ì‚°</button>
        <button class="close" type="button" onclick="closeCompare()">ë‹«ê¸°</button>
      </div>
    </div>
  `;
}

/* ì•ˆì „í•œ í…ìŠ¤íŠ¸ í‘œì‹œ */
function escapeHtml(s){
  return String(s)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/* =========================
   TOP3 ë Œë” (ë©”ì¸/OU/í•¸ë”” ê°ê°)
========================= */
function renderTop3(){
  const arr = readHistory().filter(x=>x.date===todayStr());
  const topMain = arr.filter(x=>typeof x.markets?.main?.marginPct==="number")
    .sort((a,b)=>a.markets.main.marginPct - b.markets.main.marginPct).slice(0,3);
  const topOU = arr.filter(x=>typeof x.markets?.ou?.marginPct==="number")
    .sort((a,b)=>a.markets.ou.marginPct - b.markets.ou.marginPct).slice(0,3);
  const topHC = arr.filter(x=>typeof x.markets?.hc?.marginPct==="number")
    .sort((a,b)=>a.markets.hc.marginPct - b.markets.hc.marginPct).slice(0,3);

  renderTopList("topMain", topMain, "main");
  renderTopList("topOU", topOU, "ou");
  renderTopList("topHC", topHC, "hc");
}
function renderTopList(id, list, type){
  const el = document.getElementById(id);
  if(!el) return;
  if(!list.length){
    el.innerHTML = "ì˜¤ëŠ˜ ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.";
    return;
  }
  el.innerHTML = list.map((h,i)=>{
    const cfg = SPORT_CFG[h.sport] || SPORT_CFG.soccer;
    const m = h.markets[type].marginPct;
    const tag = classifyMargin(h.sport, type, m);
    const text = `${i+1}) ${h.time} Â· ${cfg.name}${h.teams?` Â· ${escapeHtml(h.teams)}`:""} Â· ${tag.label}`;
    return `<div style="padding:6px 0;border-bottom:1px solid rgba(255,255,255,.06);">
      <a href="#calcCard" onclick="restoreFromHistory('${h.id}', true)" style="color:#fff;text-decoration:none;">
        <span class="${clsToTextColor(tag.cls)}"><b>${text}</b></span>
      </a>
    </div>`;
  }).join("").replace(/border-bottom:1px solid rgba\(255,255,255,.06\);\"><\/div>$/,"\">");
}

/* =========================
   ì´ˆê¸° êµ¬ë™
========================= */

/* =========================
   ë¶„ì„ê¸° ì§„ì… ê´‘ê³  íŒì—… (Aì•ˆ)
   - 1ì¼ 1íšŒ í‘œì‹œ
   - ë©”ì¸(index)ì—ì„œ ì €ì¥ëœ í´ë¦­ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì¸ê¸° ìˆœ ìš°ì„ 
========================= */
(function initAdPopup(){
  const KEY = "88_analysis_adpopup_date";
  const today = new Date().toISOString().slice(0,10);

  try{
    if(localStorage.getItem(KEY) === today) return;
  }catch(e){}

  // index.html í´ë¦­ ì§‘ê³„(ìˆìœ¼ë©´ í™œìš©)
  let clickMap = {};
  try{
    clickMap = JSON.parse(localStorage.getItem("88_card_clicks") || "{}") || {};
  }catch(e){ clickMap = {}; }

  // ë©”ì¸ í˜ì´ì§€ ìƒë‹¨ ìš°ì„  ì—…ì²´ + ê´‘ê³ ëª¨ì§‘ í¬í•¨
  const ads = [
    {key:"card1", title:"SPEED Bet", sub:"ê³ ì•¡ì „ìš© Â· ì…ê¸ˆí”ŒëŸ¬ìŠ¤ ì§€ì›", href:"./#vendors", badge:"ì¶”ì²œ"},
    {key:"card2", title:"OK Bet", sub:"ê³ ì•¡ì „ìš© Â· í˜ì´ë°±/ì¶œì„", href:"./#vendors", badge:"ì¶”ì²œ"},
    {key:"card3", title:"ì–´ëŠë‚ ", sub:"ê³ ì•¡ì „ìš©Â· ë¯¸ë‹ˆê²Œì„ Â· ë¬´ì œì œ ", href:"./#vendors", badge:"ì¶”ì²œ"},
    {key:"card7", title:"ê´‘ê³  ëª¨ì§‘", sub:"ì—¬ê¸°ì— ê´‘ê³ ê°€ ë…¸ì¶œë©ë‹ˆë‹¤", href:"./#vendors", badge:"AD"},
    {key:"card8", title:"ê´‘ê³  ëª¨ì§‘", sub:"ë¬¸ì˜ í›„ ë“±ë¡ ê°€ëŠ¥", href:"./#vendors", badge:"AD"}
  ];

  const ranked = [...ads].sort((a,b)=>{
    const ca = Number(clickMap[a.key] || 0);
    const cb = Number(clickMap[b.key] || 0);
    return cb - ca;
  });

  const picks = ranked.slice(0,2);
  const grid = document.getElementById("adGrid");
  const pop = document.getElementById("adPopup");
  if(!grid || !pop) return;

  grid.innerHTML = picks.map(x=>`
    <div class="ad-item" onclick="goAd('${x.href}')">
      <div class="name">${x.title}</div>
      <div class="sub">${x.sub}</div>
      <div class="badge">${x.badge}</div>
    </div>
  `).join("");

  pop.style.display = "flex";
})();

function goAd(href){
  location.href = href;
}
function closeAdPopup(disableToday){
  const pop = document.getElementById("adPopup");
  if(pop) pop.style.display = "none";
  if(disableToday){
    try{
      const today = new Date().toISOString().slice(0,10);
      localStorage.setItem("88_analysis_adpopup_date", today);
    }catch(e){}
  }
}



/* ===== Demo Loader (for empty history) ===== */
function loadDemo(kind){
  try{
    if(kind==="soccer"){
      setVal("sport","soccer");
      onSportChange(true);

      setVal("level","simple");
      onLevelChange(true);

      setVal("league","í”„ë¦¬ë¯¸ì–´ë¦¬ê·¸ (ì˜ˆì‹œ)");
      setVal("teams","í™ˆíŒ€ vs ì›ì •íŒ€");

      // 3-way ë©”ì¸ ë°°ë‹¹
      setVal("main3OddsH","1.95");
      setVal("main3OddsD","3.55");
      setVal("main3OddsA","3.95");

      // ì˜¤ë²„/ì–¸ë” ì˜ˆì‹œ
      setVal("totalLine","2.5");
      setVal("overOdds","1.90");
      setVal("underOdds","1.95");

      // í•¸ë”” ì˜ˆì‹œ
      setVal("handicapLine","-0.5");
      setVal("handicapOddsA","1.88");
      setVal("handicapOddsB","1.96");

    }else if(kind==="basketball"){
      setVal("sport","basketball");
      onSportChange(true);

      setVal("level","simple");
      onLevelChange(true);

      setVal("league","NBA (ì˜ˆì‹œ)");
      setVal("teams","í™ˆíŒ€ vs ì›ì •íŒ€");

      // 2-way ë©”ì¸ ë°°ë‹¹
      setVal("main2OddsA","1.78");
      setVal("main2OddsB","2.05");

      // ì˜¤ë²„/ì–¸ë” ì˜ˆì‹œ
      setVal("totalLine","223.5");
      setVal("overOdds","1.91");
      setVal("underOdds","1.91");

      // í•¸ë”” ì˜ˆì‹œ
      setVal("handicapLine","-3.5");
      setVal("handicapOddsA","1.92");
      setVal("handicapOddsB","1.90");
    }

    // ë°”ë¡œ ê³„ì‚° + ê²°ê³¼ë¡œ ì´ë™
    calc();
    quickJump("result");
  }catch(e){
    console.error(e);
    toast("ì˜ˆì‹œ ë¡œë”©ì— ì‹¤íŒ¨í–ˆì–´ìš”");
  }
}

/* ===== First-Visit Onboarding (3 tooltips) ===== */
const ONB_KEY = "onboard88_analysis_v1_done";
let onbIdx = 0;
const onbSteps = [
  {
    target: "mainBox",
    title: "ë°°ë‹¹ë¶€í„° ì…ë ¥",
    body: "ë©”ì¸ ë°°ë‹¹ì„ ë¨¼ì € ì…ë ¥í•´ìš”. (ì¶•êµ¬ëŠ” í™ˆ/ë¬´/ì›ì •, ë‹¤ë¥¸ ì¢…ëª©ì€ ìŠ¹/íŒ¨) â€” ì…ë ¥í•˜ë©´ ì•„ë˜ ê²°ê³¼ê°€ ë” ì •í™•í•˜ê²Œ ì •ë¦¬ë¼ìš”."
  },
  {
    target: "btnCalc",
    title: "ê³„ì‚°í•˜ê¸°",
    body: "ë°°ë‹¹ ì…ë ¥ í›„ <b>ê³„ì‚°í•˜ê¸°</b>ë¥¼ ëˆŒëŸ¬ ê²°ê³¼ë¥¼ í™•ì¸í•´ìš”. ê²°ê³¼ëŠ” ìë™ìœ¼ë¡œ íˆìŠ¤í† ë¦¬ì— ì €ì¥ë©ë‹ˆë‹¤."
  },
  {
    target: "historyCard",
    title: "íˆìŠ¤í† ë¦¬ë¡œ ì¬ê³„ì‚°/ë¹„êµ",
    body: "ì €ì¥ëœ íˆìŠ¤í† ë¦¬ë¥¼ í´ë¦­í•˜ë©´ <b>ì…ë ¥ ë³µì› + ì¦‰ì‹œ ì¬ê³„ì‚°</b>ë¼ìš”. ì²´í¬ 2ê°œ ì„ íƒ â†’ ë¹„êµ(2ê°œ ë‚˜ë€íˆ)ë„ ê°€ëŠ¥í•´ìš”."
  }
];

function onbHighlightClear(){
  document.querySelectorAll(".onb-highlight").forEach(el=>el.classList.remove("onb-highlight"));
}

function onbPositionPopover(targetEl){
  const pop = document.getElementById("onbPopover");
  if(!pop || !targetEl) return;

  const r = targetEl.getBoundingClientRect();
  const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
  const vh = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);

  const margin = 12;
  const popW = Math.min(340, vw - 36);
  pop.style.width = popW + "px";

  // ê¸°ë³¸: íƒ€ê²Ÿ ì•„ë˜ ìš°ì¸¡ ì •ë ¬, ê³µê°„ ë¶€ì¡±í•˜ë©´ ìœ„ë¡œ
  let top = r.bottom + 12;
  let left = Math.min(vw - popW - margin, Math.max(margin, r.left));

  // ì•„ë˜ ê³µê°„ ë¶€ì¡±í•˜ë©´ ìœ„ë¡œ
  const popH = pop.offsetHeight || 180;
  if(top + popH > vh - margin){
    top = Math.max(margin, r.top - popH - 12);
  }

  pop.style.top = top + "px";
  pop.style.left = left + "px";
}

function onbRender(){
  const pop = document.getElementById("onbPopover");
  const t = document.getElementById("onbTitle");
  const s = document.getElementById("onbStep");
  const b = document.getElementById("onbBody");
  if(!pop || !t || !s || !b) return;

  const step = onbSteps[onbIdx];
  const el = document.getElementById(step.target);
  if(!el){
    // íƒ€ê²Ÿì´ ì—†ìœ¼ë©´ ìŠ¤í‚µ
    onbNext();
    return;
  }

  onbHighlightClear();
  el.classList.add("onb-highlight");

  t.innerText = step.title;
  s.innerText = `${onbIdx+1}/${onbSteps.length}`;
  b.innerHTML = step.body;

  pop.style.display = "block";
  // ë‚´ìš©ì´ ë°”ë€ ë’¤ ë†’ì´ë¥¼ ê³„ì‚°í•˜ê¸° ìœ„í•´ ë‹¤ìŒ í”„ë ˆì„ì—ì„œ ìœ„ì¹˜ ê³„ì‚°
  requestAnimationFrame(()=>onbPositionPopover(el));
}

function onbStart(){
  try{
    const qs = new URLSearchParams(location.search);
    if(qs.get('onboard')==='1') localStorage.removeItem(ONB_KEY);
  }catch(e){}
  if(localStorage.getItem(ONB_KEY)==="1") return;
  onbIdx = 0;
  onbRender();
  // ìŠ¤í¬ë¡¤/ë¦¬ì‚¬ì´ì¦ˆ ì‹œ íŒì—… ìœ„ì¹˜ ìœ ì§€
  window.addEventListener("scroll", onbOnScroll, {passive:true});
  window.addEventListener("resize", onbOnScroll, {passive:true});
  document.addEventListener("keydown", onbOnKey);
}

function onbFinish(){
  localStorage.setItem(ONB_KEY,"1");
  onbClose();
}

function onbClose(){
  const pop = document.getElementById("onbPopover");
  if(pop) pop.style.display = "none";
  onbHighlightClear();
  window.removeEventListener("scroll", onbOnScroll);
  window.removeEventListener("resize", onbOnScroll);
  document.removeEventListener("keydown", onbOnKey);
}

function onbOnScroll(){
  const step = onbSteps[onbIdx];
  const el = document.getElementById(step.target);
  if(!el) return;
  onbPositionPopover(el);
}
function onbOnKey(e){
  if(e.key==="Escape") onbSkip();
  if(e.key==="ArrowRight" || e.key==="Enter") onbNext();
  if(e.key==="ArrowLeft") onbPrev();
}

function onbNext(){
  if(onbIdx >= onbSteps.length - 1){
    onbFinish();
    return;
  }
  onbIdx++;
  // íƒ€ê²Ÿì´ í™”ë©´ ë°–ì´ë©´ í•´ë‹¹ ìœ„ì¹˜ë¡œ ìŠ¤í¬ë¡¤
  const el = document.getElementById(onbSteps[onbIdx].target);
  if(el){
    try{ el.scrollIntoView({behavior:"smooth", block:"center"}); }catch(e){ el.scrollIntoView(); }
    setTimeout(onbRender, 200);
  }else{
    onbRender();
  }
}

function onbPrev(){
  if(onbIdx <= 0){
    onbIdx = 0;
    onbRender();
    return;
  }
  onbIdx--;
  const el = document.getElementById(onbSteps[onbIdx].target);
  if(el){
    try{ el.scrollIntoView({behavior:"smooth", block:"center"}); }catch(e){ el.scrollIntoView(); }
    setTimeout(onbRender, 200);
  }else{
    onbRender();
  }
}

function onbSkip(){
  onbFinish();
}

function boot(){
  loadState();
  if(!localStorage.getItem(LS_KEY)){
    setVal("sport","soccer");
    setVal("level","simple");
  }
  onSportChange(true);
  onLevelChange(true);
  renderHistory();
  renderTop3();
  renderMarginDash();
  restoreMiniGuide();
  // ì²« ë°©ë¬¸ì 1íšŒ ì˜¨ë³´ë”©(3ìŠ¤í…)
  setTimeout(()=>{ try{ onbStart(); }catch(e){} }, 450);
  setupShareCardBackdropClose();
  setupValidation();
  renderSnaps();
  renderPerfBox();
  // ì…ë ¥ ì¤‘ ë¹¨ê°„ í•˜ì´ë¼ì´íŠ¸ ìë™ í•´ì œ
  document.querySelectorAll("input,select").forEach(el=>{
    el.addEventListener("input", ()=>el.classList.remove("is-invalid"));
    el.addEventListener("change", ()=>el.classList.remove("is-invalid"));
  });
  // ì €ì¥ ë°°ì§€ ì´ˆê¸°í™”
  try{
    const raw = localStorage.getItem(LS_KEY);
    if(raw){
      const st = JSON.parse(raw);
      updateSaveBadge(st && st.__savedAt);
    }else{
      updateSaveBadge(null);
    }
  }catch(e){
    updateSaveBadge(null);
  }

}
boot();
</script>

<!-- First-Visit Onboarding Popover -->
<div id="onbPopover" role="dialog" aria-modal="true" aria-label="ì²˜ìŒ ì´ìš© ê°€ì´ë“œ">
  <div class="onb-hd">
    <div class="onb-title" id="onbTitle">ì²˜ìŒ ì´ìš© ê°€ì´ë“œ</div>
    <div class="onb-step" id="onbStep">1/3</div>
  </div>
  <div class="onb-body" id="onbBody"></div>
  <div class="onb-actions">
    <button class="btn onb-skip" type="button" onclick="onbSkip()">ê±´ë„ˆë›°ê¸°</button>
    <button class="btn secondary" type="button" onclick="onbPrev()">ì´ì „</button>
    <button class="btn primary" type="button" onclick="onbNext()">ë‹¤ìŒ</button>
  </div>
</div>

<section aria-label="ê´€ë ¨ ë§í¬" class="rel-links">
  <h2>ê´€ë ¨ ë§í¬</h2>
  <div class="rel-grid">
    <a href="/" data-cta="rel_home">ë©”ì¸</a>
    <a href="/#oddsAnalyzerSection" data-cta="rel_odds">ë°°ë‹¹ êµ¬ì¡° ë¶„ì„ê¸°</a>
    <a href="/tool-margin/" data-cta="rel_margin">ë§ˆì§„ ê³„ì‚°ê¸°</a>
    <a href="/tool-ev/" data-cta="rel_ev">EV ê³„ì‚°ê¸°</a>
    <a href="/tool-odds/" data-cta="rel_odds2">ë°°ë‹¹â†”í™•ë¥  ë³€í™˜</a>
    <a href="/#vendorTop" data-cta="rel_vendors">ë³´ì¦Â·ì¸ì¦ ì—…ì²´</a>
    <a href="/bonus-checklist/" data-cta="rel_bonus">ì…í”Œ ì²´í¬ë¦¬ìŠ¤íŠ¸</a>
    <a href="/landing-a/" data-cta="rel_landing_a">ì…í”ŒÂ·ë³´ë„ˆìŠ¤ ì•ˆë‚´</a>
  </div>
</section>
<style>
  .rel-links{max-width:1080px;margin:26px auto 34px;padding:14px 14px 16px;border-radius:18px;
    border:1px solid rgba(255,255,255,.10);background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));
    box-shadow:0 14px 40px rgba(0,0,0,.35);}
  .rel-links h2{margin:0 0 10px;font-size:13px;letter-spacing:.02em;color:rgba(245,226,122,.92);font-weight:900;}
  .rel-grid{display:flex;flex-wrap:wrap;gap:8px;}
  .rel-grid a{text-decoration:none;color:rgba(255,255,255,.82);font-size:12px;padding:8px 10px;border-radius:999px;
    border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.18);}
  .rel-grid a:hover{border-color:rgba(245,226,122,.25);color:rgba(245,226,122,.92);}
</style>
</body>
</html>
