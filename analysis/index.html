<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>ìŠ¤í¬ì¸  ë°°ë‹¹ ë¶„ì„ê¸° | 88 ì»¤ë®¤ë‹ˆí‹°</title>
<meta name="description" content="ì¢…ëª©(ì¶•êµ¬/ë†êµ¬/ì•¼êµ¬/ë°°êµ¬/eìŠ¤í¬ì¸ /í•˜í‚¤)ë³„ ë°°ë‹¹ ì…ë ¥ìœ¼ë¡œ ìŠ¹ë¦¬ í™•ë¥ (ë°°ë‹¹ ê¸°ë°˜Â·ì¶”ì •), ì˜¤ë²„ë¼ìš´ë“œ, ë§ˆì§„, ë°¸ë¥˜(EV), ê¶Œì¥ ë¹„ì¤‘(ë³´ìˆ˜ì  Kelly), ë©”ì¸/ì˜¤ë²„ì–¸ë”/í•¸ë”” ë§ˆì§„ì„ í†µí•© ê³„ì‚°í•˜ê³  íˆìŠ¤í† ë¦¬/ë¹„êµê¹Œì§€ ì§€ì›í•˜ëŠ” ë¶„ì„ê¸°ì…ë‹ˆë‹¤. (íŒë‹¨ ë³´ì¡°ìš©)" />
<link rel="canonical" href="https://88st.cloud/analysis/" />
<meta name="robots" content="index,follow" />

<style>
*{box-sizing:border-box}
:root{
  --bg:#0b0b0b;
  --panel:#121212;
  --panel2:#0f0f0f;
  --gold:#d4af37;
  --gold2:#f5e27a;
  --muted:#bdbdbd;

  --ok:#b7ffcf;
  --warn:#ffcf99;
  --bad:#ffb3b3;
  --chip:#1f1f1f;
}
html{scroll-behavior:smooth}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto;
  background:
    radial-gradient(1200px 500px at 50% -10%, rgba(212,175,55,.14), transparent 55%),
    radial-gradient(900px 500px at 10% 20%, rgba(90,160,255,.08), transparent 60%),
    linear-gradient(180deg, #07070a, var(--bg));
  color:#fff;
}

/* ===== ìƒë‹¨ ê³µì§€/ì´ë²¤íŠ¸ ë°°ë„ˆ (ìë™ ìˆœí™˜) ===== */
.notice-bar{
  position:sticky;
  top:0;
  z-index:1600;
  background:linear-gradient(135deg,var(--gold),var(--gold2));
  color:#000;
  font-weight:900;
  font-size:13px;
  padding:10px 12px;
  text-align:center;
  box-shadow:0 10px 30px rgba(0,0,0,.35);
}
.notice-bar a{ color:#000; text-decoration:none; }

/* ===== ì‚¬ì¹­ì£¼ì˜ íŒì—… (1ì¼ 1íšŒ) ===== */
.scam-popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.75);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:3000;
  padding:18px;
}
.scam-box{
  background:rgba(17,17,17,.95);
  border:1px solid rgba(255,255,255,.08);
  border-radius:18px;
  padding:22px;
  width:100%;
  max-width:380px;
  text-align:center;
  box-shadow:0 18px 60px rgba(0,0,0,.75);
  backdrop-filter: blur(10px);
}
.scam-box h3{ color:#ff6b6b; margin:0 0 10px; font-weight:900; }
.scam-box p{ font-size:13px; color:#ddd; line-height:1.55; margin:0; }
.scam-box .btn{
  margin-top:12px;
  padding:12px;
  border-radius:12px;
  background:linear-gradient(135deg,var(--gold),var(--gold2));
  color:#000;
  font-weight:900;
  cursor:pointer;
  user-select:none;
}

/* ìƒë‹¨ */
.header{ text-align:center; padding:14px 0 10px; }
.logo-link{display:inline-block;text-decoration:none}
.logo-img{
  display:block; margin:0 auto 6px;
  width:180px; max-width:72%; height:auto;
  filter:drop-shadow(0 0 10px rgba(212,175,55,.25));
}
@media(max-width:480px){ .logo-img{width:150px;max-width:82%} }
.sub{ font-size:12px; color:#9a9a9a; }

/* ë ˆì´ì•„ì›ƒ */
.wrap{ max-width:980px; margin:0 auto; padding:10px 14px 34px; }
.card{
  background:rgba(18,18,18,.86);
  border:1px solid rgba(255,255,255,.06);
  border-radius:18px; padding:14px;
  box-shadow:0 10px 26px rgba(0,0,0,.45);
  margin-bottom:14px;
  backdrop-filter: blur(10px);
}
.title{ font-weight:900; color:var(--gold2); margin-bottom:10px; font-size:14px; display:flex; align-items:center; gap:8px; }
.badge{
  display:inline-block;
  padding:4px 8px;
  border-radius:999px;
  font-size:11px;
  font-weight:900;
  color:#000;
  background:linear-gradient(135deg,var(--gold),var(--gold2));
}
.note{ color:#bdbdbd; font-size:12px; line-height:1.5; margin-top:8px; }
.small-hint{ font-size:11px; color:#8f8f8f; margin-top:6px; line-height:1.4; }

/* ì»¨íŠ¸ë¡¤ */
.controls{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
@media(max-width:560px){ .controls{ grid-template-columns:1fr; } }
.select, .textinput{
  width:100%;
  padding:12px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.08);
  background:var(--panel2);
  color:#fff;
  outline:none;
  font-weight:800;
}
.textinput{ font-weight:700; }
.row2{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin-top:10px;
}
@media(max-width:560px){ .row2{ grid-template-columns:1fr; } }

/* ì…ë ¥ */
.grid{ display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px; }
@media(max-width:560px){ .grid{grid-template-columns:1fr} }
.field label{ display:block; font-size:12px; color:#bbb; margin:2px 0 6px; }
.field input{
  width:100%; padding:12px; border-radius:14px;
  border:1px solid rgba(255,255,255,.08);
  background:var(--panel2); color:#fff; outline:none;
}
.field input::placeholder{color:#555}

/* ì„¹ì…˜ ë°•ìŠ¤ */
.box{
  margin-top:12px;
  padding:12px;
  border-radius:16px;
  background:rgba(255,255,255,.03);
  border:1px solid rgba(255,255,255,.06);
}
.box-title{ font-weight:900; margin:0 0 8px; color:var(--gold2); font-size:13px; }
.box-head{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
.toggle{
  cursor:pointer; font-size:12px; color:#cfcfcf;
  user-select:none; padding:6px 10px; border-radius:999px;
  border:1px solid rgba(255,255,255,.08); background:rgba(0,0,0,.25);
}

/* ì•¡ì…˜ */
.actions{ display:flex; gap:10px; margin-top:12px; flex-wrap:wrap; }
.btn{
  flex:1; min-width:160px;
  border:none; border-radius:14px; padding:12px;
  font-weight:900; cursor:pointer;
}
.primary{ background:linear-gradient(135deg,#1da1f2,#78d6ff); color:#00121a; }
.secondary{ background:var(--chip); color:#fff; border:1px solid rgba(255,255,255,.06); }
.gold{ background:linear-gradient(135deg,var(--gold),var(--gold2)); color:#111; }

/* ê²°ê³¼ */
.result{
  background:rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.06);
  border-radius:16px;
  padding:12px;
  margin-top:12px;
}
.kv{
  display:flex; justify-content:space-between; gap:10px;
  padding:8px 0; border-bottom:1px solid rgba(255,255,255,.06);
  font-size:13px;
}
.kv:last-child{border-bottom:none}
.k{color:#cfcfcf}
.v{font-weight:900}
.warn{color:var(--bad)}
.good{color:var(--ok)}
.mid{color:var(--warn)}

hr.sep{ border:none; height:1px; background:rgba(255,255,255,.06); margin:12px 0; }

.footer-links{ display:flex; gap:10px; margin-top:14px; flex-wrap:wrap; }
.linkbtn{
  flex:1; min-width:160px;
  display:block; text-align:center; padding:12px;
  border-radius:14px; text-decoration:none; font-weight:900;
  background:var(--chip); color:#fff;
  border:1px solid rgba(255,255,255,.06);
}

/* ì²´í¬ë¦¬ìŠ¤íŠ¸ */
.checklist{
  color:#cfcfcf;
  font-size:13px;
  line-height:1.55;
}
.checklist strong{ color:#fff; }

/* ë§ˆì§„ ëŒ€ì‹œë³´ë“œ */
.m-grid{
  display:grid; gap:10px;
  grid-template-columns:1fr 1fr 1fr;
}
@media(max-width:800px){ .m-grid{ grid-template-columns:1fr; } }
.m-card{
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.25);
  border-radius:16px;
  padding:12px;
}
.m-head{ display:flex; align-items:center; justify-content:space-between; gap:8px; }
.m-name{ font-weight:900; color:#fff; font-size:13px; }
.chip{
  display:inline-flex; align-items:center; gap:6px;
  padding:6px 10px;
  border-radius:999px;
  font-size:12px;
  font-weight:900;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.25);
}
.chip.ok{ color:var(--ok); }
.chip.mid{ color:var(--warn); }
.chip.bad{ color:var(--bad); }
.m-lines{ margin-top:10px; font-size:12px; color:#cfcfcf; line-height:1.45; }
.m-lines b{ color:#fff; }

/* íˆìŠ¤í† ë¦¬ */
.history-toolbar{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-top:8px;
}
.history-toolbar .btn{ min-width:0; flex:1; }
.h-list{ margin-top:10px; display:grid; gap:10px; }
.h-item{
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.25);
  border-radius:16px;
  padding:10px 12px;
}
.h-top{
  display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
}
.h-title{
  font-weight:900; font-size:13px;
}
.h-sub{
  margin-top:4px;
  font-size:12px; color:#cfcfcf; line-height:1.4;
}
.h-actions{
  display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;
}
.h-actions button{
  border-radius:12px;
  padding:8px 10px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.25);
  color:#fff;
  font-weight:900;
  cursor:pointer;
  font-size:12px;
}
.h-actions button.primary2{
  background:linear-gradient(135deg,#1da1f2,#78d6ff);
  color:#00121a;
  border:none;
}
.h-actions .pick{
  display:flex; align-items:center; gap:6px; font-size:12px; color:#cfcfcf;
}
.h-actions input[type="checkbox"]{ transform:scale(1.15); }

/* ë¹„êµ ëª¨ë‹¬ */
.modal{
  position:fixed; inset:0;
  display:none;
  align-items:center; justify-content:center;
  z-index:3200;
  padding:16px;
  background:rgba(0,0,0,.75);
}
.modal-box{
  width:100%;
  max-width:980px;
  background:rgba(17,17,17,.95);
  border:1px solid rgba(255,255,255,.08);
  border-radius:18px;
  box-shadow:0 18px 60px rgba(0,0,0,.75);
  backdrop-filter: blur(10px);
  padding:14px;
}
.modal-head{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  margin-bottom:10px;
}
.modal-head .t{ font-weight:900; color:var(--gold2); }
.modal-close{
  cursor:pointer; user-select:none;
  padding:8px 10px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.25);
  font-weight:900;
}
.compare-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}
@media(max-width:760px){ .compare-grid{ grid-template-columns:1fr; } }
.compare-col{
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.25);
  border-radius:16px;
  padding:12px;
}
.compare-col .ct{ font-weight:900; margin-bottom:8px; }
.compare-col .line{ display:flex; justify-content:space-between; gap:10px; font-size:12px; padding:6px 0; border-bottom:1px solid rgba(255,255,255,.06); }
.compare-col .line:last-child{ border-bottom:none; }
.compare-col .line .k{ color:#cfcfcf; }
.compare-col .line .v{ font-weight:900; }
.compare-col .mini-actions{ display:flex; gap:8px; margin-top:10px; flex-wrap:wrap; }
.compare-col .mini-actions button{
  flex:1; min-width:120px;
  border:none; border-radius:12px; padding:10px;
  font-weight:900; cursor:pointer;
}
.compare-col .mini-actions .restore{ background:linear-gradient(135deg,#1da1f2,#78d6ff); color:#00121a; }
.compare-col .mini-actions .close{ background:#1f1f1f; color:#fff; border:1px solid rgba(255,255,255,.06); }

/* í† ìŠ¤íŠ¸ */
#toast88{
  position:fixed; left:50%; bottom:22px; transform:translateX(-50%);
  background:rgba(0,0,0,.85); color:#fff;
  padding:10px 12px; border-radius:12px; font-size:12px;
  z-index:4000; border:1px solid rgba(255,255,255,.08);
  opacity:0; pointer-events:none; transition:opacity .2s ease;
}

/* ===== ë¶„ì„ê¸° ì§„ì… ê´‘ê³  íŒì—… (Aì•ˆ: 1ì¼ 1íšŒ, 2ê°œ ë…¸ì¶œ) ===== */
.ad-popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.78);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:2600;
  padding:18px;
}
.ad-box{
  width:100%;
  max-width:420px;
  background:rgba(17,17,17,.95);
  border:1px solid rgba(255,255,255,.08);
  border-radius:18px;
  padding:18px;
  box-shadow:0 18px 60px rgba(0,0,0,.75);
  backdrop-filter: blur(10px);
}
.ad-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom:10px;
}
.ad-title{
  font-weight:900;
  color:var(--gold2);
  font-size:14px;
}
.ad-close{
  cursor:pointer;
  user-select:none;
  font-size:12px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(0,0,0,.28);
  color:#fff;
}
.ad-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
@media(max-width:360px){
  .ad-grid{ grid-template-columns:1fr; }
}
.ad-item{
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.25);
  border-radius:14px;
  padding:12px;
  cursor:pointer;
}
.ad-item .name{ font-weight:900; font-size:13px; }
.ad-item .sub{ font-size:11px; color:#bdbdbd; margin-top:4px; line-height:1.4; }
.ad-item .badge{
  display:inline-block;
  margin-top:8px;
  font-size:11px;
  font-weight:900;
  padding:4px 8px;
  border-radius:999px;
  background:linear-gradient(135deg,var(--gold),var(--gold2));
  color:#111;
}
.ad-actions{
  display:flex;
  gap:10px;
  margin-top:12px;
}
.ad-actions .btnx{
  flex:1;
  text-align:center;
  padding:10px 12px;
  border-radius:14px;
  font-weight:900;
  cursor:pointer;
  border:1px solid rgba(255,255,255,.08);
  background:#1f1f1f;
  color:#fff;
  text-decoration:none;
}
.ad-actions .btnx.primary{
  background:linear-gradient(135deg,#1da1f2,#78d6ff);
  color:#00121a;
  border:none;
}
.ad-note{
  margin-top:10px;
  font-size:11px;
  color:#9a9a9a;
  line-height:1.4;
}
</style>
</head>

<body>

<!-- âœ… ìƒë‹¨ ê³µì§€/ì´ë²¤íŠ¸ ë°°ë„ˆ(ìë™ ìˆœí™˜) -->
<div class="notice-bar">
  <a href="https://t.me/UZU59" target="_blank" rel="noopener">
    <span id="noticeText"></span>
  </a>
</div>

<!-- âœ… ì‚¬ì¹­ì£¼ì˜ íŒì—… (1ì¼ 1íšŒ) -->
<div class="scam-popup" id="scamPopup">
  <div class="scam-box">
    <h3>âš ï¸ ì‚¬ì¹­ ì£¼ì˜ ì•ˆë‚´</h3>
    <p>
      88 ì»¤ë®¤ë‹ˆí‹° ê³µì‹ ê´€ë¦¬ì í…”ë ˆê·¸ë¨ì€<br>
      <b>@UZU59</b> ë‹¨ í•˜ë‚˜ì…ë‹ˆë‹¤.<br><br>
      ê·¸ ì™¸ ê³„ì •ì€ ì‚¬ì¹­ì¼ ìˆ˜ ìˆìœ¼ë‹ˆ<br>
      ë°˜ë“œì‹œ ì£¼ì˜í•´ ì£¼ì„¸ìš”.
    </p>
    <div class="btn" onclick="closeScam()">í™•ì¸</div>
  </div>
</div>

<!-- âœ… ë¶„ì„ê¸° ì§„ì… ê´‘ê³  íŒì—… (1ì¼ 1íšŒ) -->
<div class="ad-popup" id="adPopup">
  <div class="ad-box">
    <div class="ad-head">
      <div class="ad-title">ğŸ ì§€ê¸ˆ ë§ì´ ì°¾ëŠ” ì¶”ì²œ ë†€ì´í„°</div>
      <div class="ad-close" onclick="closeAdPopup(true)">ì˜¤ëŠ˜ ê·¸ë§Œ ë³´ê¸°</div>
    </div>

    <div class="ad-grid" id="adGrid"></div>

    <div class="ad-actions">
      <a class="btnx primary" href="/#vendors" aria-label="ì¸ì¦ ë†€ì´í„° ë³´ê¸°">ì¸ì¦ ë†€ì´í„° ë³´ê¸°</a>
      <a class="btnx" href="https://t.me/UZU59" target="_blank" rel="noopener">ë¬¸ì˜</a>
    </div>

    <div class="ad-note">â€» íŒì—…ì€ 1ì¼ 1íšŒë§Œ í‘œì‹œë©ë‹ˆë‹¤. (ì›ì¹˜ ì•Šìœ¼ë©´ ë‹«ê¸°)</div>
    <div class="ad-close" style="margin-top:10px;text-align:center;" onclick="closeAdPopup(false)">ë‹«ê¸°</div>
  </div>
</div>


<div class="header">
  <a class="logo-link" href="/" aria-label="í™ˆìœ¼ë¡œ ì´ë™">
    <img src="img/logo-88-community" alt="88 ì»¤ë®¤ë‹ˆí‹°" class="logo-img">
  </a>
  <div class="sub">ìŠ¤í¬ì¸  ë°°ë‹¹ ë¶„ì„ê¸° (ì™„ì „ì²´ Â· í†µí•© ë§ˆì§„/EV/íˆìŠ¤í† ë¦¬ Â· íŒë‹¨ ë³´ì¡°ìš©)</div>
</div>

<div class="wrap">

  <!-- âœ… ë°°íŒ… ì²´í¬ë¦¬ìŠ¤íŠ¸ (ëœë¤ 3ì¤„) -->
  <div class="card" id="checkCard">
    <div class="title"><span class="badge">CHECK</span>ë°°íŒ… ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸</div>
    <div class="checklist" id="checklistText"></div>
    <div class="history-toolbar">
      <button class="btn secondary" type="button" onclick="refreshChecklist()">ì²´í¬ë¦¬ìŠ¤íŠ¸ ìƒˆë¡œê³ ì¹¨</button>
      <button class="btn secondary" type="button" onclick="scrollToCalc()">ë¶„ì„ê¸°ë¡œ ì´ë™</button>
    </div>
    <div class="small-hint">â€» ê³¼ëª°ì… ë°©ì§€/ë¦¬ìŠ¤í¬ ê´€ë¦¬ìš© ì•ˆë‚´ì…ë‹ˆë‹¤.</div>
  </div>

  <!-- âœ… ì˜¤ëŠ˜ ë§ˆì§„ ë‚®ì€ TOP3 (ìë™) -->
  <div class="card">
    <div class="title"><span class="badge">TOP3</span>ì˜¤ëŠ˜ ë§ˆì§„ ë‚®ì€ ê³„ì‚° TOP3</div>
    <div class="small-hint">â€» ì˜¤ëŠ˜(ë¡œì»¬ ê¸°ì¤€) ì €ì¥ëœ íˆìŠ¤í† ë¦¬ì—ì„œ â€œë§ˆì§„%â€ê°€ ê°€ì¥ ë‚®ì€ ìˆœìœ¼ë¡œ ìë™ ì •ë ¬ë©ë‹ˆë‹¤.</div>
    <div class="box" style="margin-top:10px;">
      <div class="box-title">ë©”ì¸ ë§ˆì§„ TOP3</div>
      <div id="topMain" class="small-hint"></div>
    </div>
    <div class="box">
      <div class="box-title">ì˜¤ë²„/ì–¸ë” ë§ˆì§„ TOP3</div>
      <div id="topOU" class="small-hint"></div>
    </div>
    <div class="box">
      <div class="box-title">í•¸ë””ìº¡ ë§ˆì§„ TOP3</div>
      <div id="topHC" class="small-hint"></div>
    </div>
  </div>

  <!-- âœ… ë§ˆì§„ ì„¤ëª…/ì˜ˆì‹œ -->
  <div class="card">
    <div class="title"><span class="badge">INFO</span>â€œë§ˆì§„ ë‚®ì€ ê²½ê¸°â€ ê¸°ì¤€ & ì˜ˆì‹œ</div>
    <div class="note" style="margin-top:0;">
      â€¢ ë§ˆì§„(ìˆ˜ìˆ˜ë£Œ)ì€ <b>ì˜¤ë²„ë¼ìš´ë“œ-1</b>ì„ %ë¡œ í‘œí˜„í•œ ê°’ì…ë‹ˆë‹¤.<br>
      â€¢ ì¢…ëª©/ìœ í˜•ë³„ë¡œ ì¼ë°˜ì ì¸ ë§ˆì§„ ë²”ìœ„ê°€ ë‹¬ë¼ì„œ, ì´ í˜ì´ì§€ëŠ” <b>ì¢…ëª©+ìœ í˜•ë³„ ê¸°ì¤€</b>ìœ¼ë¡œ â€œë‚®ìŒ/ë³´í†µ/ì£¼ì˜/ê³ ë§ˆì§„â€ì„ íŒì •í•©ë‹ˆë‹¤.<br>
      â€¢ ì•„ë˜ ê¸°ì¤€ì€ â€œëŒ€ëµì ì¸ ì²´ê°â€ì„ ë¹ ë¥´ê²Œ ë•ê¸° ìœ„í•œ ìš©ë„ì´ë©°, ì‹¤ì œ ë¼ì¸/ì—…ì²´/ì‹œì¥ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”.
    </div>
    <div class="box" style="margin-top:10px;">
      <div class="box-title">ì˜ˆì‹œ (ì¶•êµ¬ 1X2)</div>
      <div class="small-hint">
        ë°°ë‹¹: <b>1.70 / 3.20 / 3.40</b> â†’ ì˜¤ë²„ë¼ìš´ë“œê°€ ì»¤ì ¸ <b>ê³ ë§ˆì§„</b>ìœ¼ë¡œ ëœ° ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
        ë°˜ëŒ€ë¡œ ë™ì¼ ì‹œì¥ì—ì„œ ì˜¤ë²„ë¼ìš´ë“œê°€ 1.05 ê·¼ì²˜ë©´ ëŒ€ì²´ë¡œ <b>ë§ˆì§„ ë‚®ìŒ</b>ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.
      </div>
    </div>
  </div>

  <!-- âœ… ê³„ì‚°/ë¶„ì„ê¸° ì¹´ë“œ -->
  <div class="card" id="calcCard">
    <div class="title"><span class="badge">CALC</span>ë¶„ì„ê¸° ì„¤ì •</div>

    <div class="controls">
      <select id="sport" class="select" onchange="onSportChange()">
        <option value="soccer">ì¶•êµ¬</option>
        <option value="basketball">ë†êµ¬</option>
        <option value="baseball">ì•¼êµ¬</option>
        <option value="volleyball">ë°°êµ¬</option>
        <option value="esports">eìŠ¤í¬ì¸ </option>
        <option value="hockey">í•˜í‚¤</option>
      </select>

      <select id="level" class="select" onchange="onLevelChange()">
        <option value="simple">ê°„ë‹¨</option>
        <option value="mid">ì¤‘ê¸‰</option>
        <option value="adv">ê³ ê¸‰</option>
      </select>
    </div>

    <!-- âœ… íŒ€/ë¦¬ê·¸ ì…ë ¥(ì„ íƒ) -->
    <div class="row2">
      <div>
        <input id="league" class="textinput" placeholder="ë¦¬ê·¸/ëŒ€íšŒëª… (ì„ íƒ)">
        <div class="small-hint">â€» ì…ë ¥í•˜ì§€ ì•Šì•„ë„ ë¶„ì„ ê°€ëŠ¥ / ê³µìœ  ì‹œ ì…ë ¥í•œ ë‚´ìš©ë§Œ í¬í•¨ë©ë‹ˆë‹¤.</div>
      </div>
      <div>
        <input id="teams" class="textinput" placeholder="íŒ€ëª… (ì„ íƒ) ì˜ˆ: ë§¨ì‹œí‹° vs ë¦¬ë²„í’€">
        <div class="small-hint">â€» íŒ€/ë¦¬ê·¸ëŠ” ì„ íƒì‚¬í•­ì…ë‹ˆë‹¤.</div>
      </div>
    </div>

    <div class="small-hint" id="sportHint" style="margin-top:10px;"></div>

    <!-- ===== ë©”ì¸ ì‹œì¥ ===== -->
    <div class="box">
      <div class="box-title" id="mainMarketTitle">ë©”ì¸ ë°°ë‹¹</div>

      <!-- 2-way -->
      <div id="main2" style="display:none;">
        <div class="grid">
          <div class="field">
            <label id="main2LabelA">ì„ íƒ A ë°°ë‹¹</label>
            <input id="main2OddsA" inputmode="decimal" placeholder="ì˜ˆ: 1.85">
          </div>
          <div class="field">
            <label id="main2LabelB">ì„ íƒ B ë°°ë‹¹</label>
            <input id="main2OddsB" inputmode="decimal" placeholder="ì˜ˆ: 2.05">
          </div>
        </div>
      </div>

      <!-- 3-way -->
      <div id="main3" style="display:none;">
        <div class="grid">
          <div class="field">
            <label id="main3LabelH">í™ˆ ë°°ë‹¹</label>
            <input id="main3OddsH" inputmode="decimal" placeholder="ì˜ˆ: 2.10">
          </div>
          <div class="field">
            <label id="main3LabelD">ë¬´ ë°°ë‹¹</label>
            <input id="main3OddsD" inputmode="decimal" placeholder="ì˜ˆ: 3.20">
          </div>
          <div class="field">
            <label id="main3LabelA">ì›ì • ë°°ë‹¹</label>
            <input id="main3OddsA" inputmode="decimal" placeholder="ì˜ˆ: 3.40">
          </div>
          <div class="field">
            <label> </label>
            <input disabled value="â€» ì¶•êµ¬ëŠ” 3ë°°ë‹¹ì´ ê¸°ë³¸ì…ë‹ˆë‹¤">
          </div>
        </div>
      </div>

      <!-- ì¤‘ê¸‰/ê³ ê¸‰: ë‚´ í™•ë¥ /ë² íŒ…ê¸ˆ -->
      <div id="valueInputs" style="display:none;">
        <div class="grid">
          <div class="field">
            <label id="myProbLabel">ë‚´ ì˜ˆìƒ í™•ë¥ (ì„ íƒ) %</label>
            <input id="myProb" inputmode="decimal" placeholder="ì˜ˆ: 55  ë˜ëŠ”  45,28,27">
            <div class="small-hint" id="myProbHint"></div>
          </div>
          <div class="field">
            <label>ë² íŒ…ê¸ˆ(ì„ íƒ)</label>
            <input id="stake" inputmode="numeric" placeholder="ì˜ˆ: 100000">
            <div class="small-hint">â€» ì…ë ¥ ì‹œ ê¸°ëŒ€ê°’(EV)ì„ ì› ë‹¨ìœ„ë¡œë„ í‘œì‹œí•©ë‹ˆë‹¤.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== í•¸ë””ìº¡ (ì •ë°€: ì–‘ìª½ ë°°ë‹¹) ===== -->
    <div class="box" id="handicapBox" style="display:none;">
      <div class="box-head">
        <div class="box-title" style="margin:0;">í•¸ë””ìº¡ (ì„ íƒ Â· ì •ë°€ ë§ˆì§„)</div>
        <div class="toggle" onclick="toggleBox('handicapBody')">ì ‘ê¸°/í¼ì¹˜ê¸°</div>
      </div>
      <div id="handicapBody">
        <div class="grid">
          <div class="field">
            <label id="handicapLineLabel">í•¸ë”” ë¼ì¸ (ì˜ˆ: -1.5, +3.5)</label>
            <input id="handicapLine" inputmode="decimal" placeholder="ì˜ˆ: -1.5">
          </div>
          <div class="field">
            <label id="handicapOddsALabel">í•¸ë”” ì„ íƒA ë°°ë‹¹</label>
            <input id="handicapOddsA" inputmode="decimal" placeholder="ì˜ˆ: 1.90">
          </div>
          <div class="field">
            <label id="handicapOddsBLabel">ë°˜ëŒ€(ì„ íƒB) ë°°ë‹¹</label>
            <input id="handicapOddsB" inputmode="decimal" placeholder="ì˜ˆ: 1.95">
          </div>
          <div class="field">
            <label>ì•„ì‹œì•ˆ(í‘¸ì‹œ) ê·¼ì‚¬(ì„ íƒ)</label>
            <input id="handicapPush" inputmode="decimal" placeholder="í‘¸ì‹œ í™•ë¥  % (ì˜ˆ: 2)">
          </div>
        </div>
        <div class="small-hint">
          â€» â€œì–‘ìª½ ë°°ë‹¹â€ì´ ìˆì–´ì•¼ í•¸ë”” ë§ˆì§„ì„ ì •ë°€ ê³„ì‚°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ë‹¨ì¼ ë°°ë‹¹ë§Œ ìˆìœ¼ë©´ ì°¸ê³  ìˆ˜ì¤€)
        </div>
      </div>
    </div>

    <!-- ===== ì˜¤ë²„ì–¸ë” ===== -->
    <div class="box" id="totalBox" style="display:none;">
      <div class="box-head">
        <div class="box-title" style="margin:0;">ì˜¤ë²„/ì–¸ë” (ì„ íƒ Â· ì•„ì‹œì•ˆ ê·¼ì‚¬ ì§€ì›)</div>
        <div class="toggle" onclick="toggleBox('totalBody')">ì ‘ê¸°/í¼ì¹˜ê¸°</div>
      </div>
      <div id="totalBody">
        <div class="grid">
          <div class="field">
            <label>ê¸°ì¤€ì  (ì˜ˆ: 2.5, 7.5, 2.0)</label>
            <input id="totalLine" inputmode="decimal" placeholder="ì˜ˆ: 2.5">
          </div>
          <div class="field">
            <label>ì˜¤ë²„ ë°°ë‹¹</label>
            <input id="overOdds" inputmode="decimal" placeholder="ì˜ˆ: 1.95">
          </div>
          <div class="field">
            <label>ì–¸ë” ë°°ë‹¹</label>
            <input id="underOdds" inputmode="decimal" placeholder="ì˜ˆ: 1.85">
          </div>
          <div class="field">
            <label>ì•„ì‹œì•ˆ(í‘¸ì‹œ) ê·¼ì‚¬(ì„ íƒ)</label>
            <input id="ouPush" inputmode="decimal" placeholder="í‘¸ì‹œ í™•ë¥  % (ì˜ˆ: 6)">
          </div>
          <div class="field">
            <label>ë‚´ ì˜ˆìƒ í™•ë¥ (ì˜¤ë²„) % (ê³ ê¸‰)</label>
            <input id="myOverProb" inputmode="decimal" placeholder="ì˜ˆ: 52">
          </div>
          <div class="field">
            <label> </label>
            <input disabled value="â€» í‘¸ì‹œ í™•ë¥  ë¯¸ì…ë ¥ ì‹œ ì¢…ëª© ê¸°ë³¸ê°’ìœ¼ë¡œ ê·¼ì‚¬í•©ë‹ˆë‹¤">
          </div>
        </div>
        <div class="small-hint">â€» ê³ ê¸‰ì—ì„œ ë‚´ ì˜ˆìƒ í™•ë¥ (ì˜¤ë²„)ì„ ë„£ìœ¼ë©´ ì˜¤ë²„ EV/ë¹„ì¤‘ ê³„ì‚°ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
      </div>
    </div>

    <div class="actions">
      <button class="btn primary" onclick="calc()">ê³„ì‚°í•˜ê¸°</button>
      <button class="btn secondary" onclick="resetAll()">ì´ˆê¸°í™”</button>
      <button class="btn gold" onclick="copyResult()">ê²°ê³¼ ë³µì‚¬</button>
      <button class="btn secondary" onclick="shareResult()">ê³µìœ </button>
    </div>

    <div class="note">
      â€» ë³¸ ë„êµ¬ëŠ” â€œíŒë‹¨ ë³´ì¡°ìš©â€ì…ë‹ˆë‹¤. ìŠ¹ë¥ ì„ ë³´ì¥í•˜ì§€ ì•Šìœ¼ë©°, ì†ì‹¤ì„ ê°ë‹¹ ê°€ëŠ¥í•œ ë²”ìœ„ ë‚´ì—ì„œ ì´ìš©í•˜ì„¸ìš”.
    </div>

    <!-- âœ… í†µí•© ë§ˆì§„ ëŒ€ì‹œë³´ë“œ -->
    <div class="box" style="margin-top:12px;">
      <div class="box-title">í†µí•© ë§ˆì§„ ëŒ€ì‹œë³´ë“œ (ë©”ì¸/OU/í•¸ë””)</div>
      <div class="m-grid" id="marginDash">
        <!-- JS ë Œë” -->
      </div>
      <div class="small-hint" style="margin-top:10px;">
        â€» ìƒ‰ìƒ: <span class="good">ë‚®ìŒ</span> / <span class="mid">ë³´í†µÂ·ì£¼ì˜</span> / <span class="warn">ê³ ë§ˆì§„</span>
      </div>
    </div>

    <div class="result" id="result" style="display:none;"></div>

    <div class="footer-links">
      <a class="linkbtn" href="/">í™ˆìœ¼ë¡œ</a>
      <a class="linkbtn" href="https://t.me/UZU59" target="_blank" rel="noopener">ë¬¸ì˜ (í…”ë ˆê·¸ë¨)</a>
    </div>
  </div>

  <!-- âœ… ìµœê·¼ ê³„ì‚° íˆìŠ¤í† ë¦¬ -->
  <div class="card">
    <div class="title"><span class="badge">HISTORY</span>ìµœê·¼ ê³„ì‚° íˆìŠ¤í† ë¦¬ (ë¡œì»¬ ì €ì¥)</div>
    <div class="small-hint">
      â€¢ íˆìŠ¤í† ë¦¬ í•­ëª© í´ë¦­ â†’ <b>ì…ë ¥ ìë™ ë³µì› + ì¦‰ì‹œ ì¬ê³„ì‚°</b><br>
      â€¢ ì²´í¬ 2ê°œ ì„ íƒ â†’ <b>ë¹„êµ(2ê°œ ë‚˜ë€íˆ)</b> ê°€ëŠ¥
    </div>
    <div class="history-toolbar">
      <button class="btn secondary" type="button" onclick="clearHistory()">íˆìŠ¤í† ë¦¬ ì „ì²´ ì‚­ì œ</button>
      <button class="btn secondary" type="button" onclick="openCompare()">ë¹„êµ ì—´ê¸°</button>
      <button class="btn secondary" type="button" onclick="renderTop3()">TOP3 ìƒˆë¡œê³ ì¹¨</button>
    </div>
    <div class="h-list" id="historyList"></div>
  </div>
</div>

<!-- ë¹„êµ ëª¨ë‹¬ -->
<div class="modal" id="compareModal">
  <div class="modal-box">
    <div class="modal-head">
      <div class="t">ë¹„êµ (2ê°œ ë‚˜ë€íˆ)</div>
      <div class="modal-close" onclick="closeCompare()">ë‹«ê¸°</div>
    </div>
    <div class="small-hint" style="margin-bottom:10px;">
      íˆìŠ¤í† ë¦¬ì—ì„œ ì²´í¬ë°•ìŠ¤ë¡œ 2ê°œ ì„ íƒ í›„ â€œë¹„êµ ì—´ê¸°â€ë¥¼ ëˆ„ë¥´ì„¸ìš”.
    </div>
    <div class="compare-grid" id="compareGrid"></div>
  </div>
</div>

<div id="toast88"></div>

<script>
/* =========================
   ê³µì§€/ì‚¬ì¹­ì£¼ì˜
========================= */
const NOTICE_LIST = [
  "ğŸ”” 88 ì»¤ë®¤ë‹ˆí‹° ê³µì‹ ì•ˆë‚´ Â· ê´€ë¦¬ì ì‚¬ì¹­ ì£¼ì˜ (@UZU59)",
  "ğŸ“Š ë¶„ì„ê¸°: ìŠ¹ë¦¬ í™•ë¥ (ë°°ë‹¹ ê¸°ë°˜Â·ì¶”ì •) / ë§ˆì§„ / EV / Kellyê¹Œì§€",
  "â­ íˆìŠ¤í† ë¦¬ ì €ì¥ + TOP3 ìë™ ë…¸ì¶œ",
  "âš ï¸ ë³¸ í˜ì´ì§€ëŠ” íŒë‹¨ ë³´ì¡°ìš©ì´ë©° ê²°ê³¼ë¥¼ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤"
];
let noticeIndex = 0;
function rotateNotice(){
  const el = document.getElementById("noticeText");
  if(!el) return;
  el.innerText = NOTICE_LIST[noticeIndex];
  noticeIndex = (noticeIndex + 1) % NOTICE_LIST.length;
}
rotateNotice();
setInterval(rotateNotice, 4000);

/* ì‚¬ì¹­ì£¼ì˜ (1ì¼ 1íšŒ) */
(function(){
  const key="scam_popup_date";
  const today=new Date().toISOString().slice(0,10);
  if(localStorage.getItem(key)!==today){
    const pop=document.getElementById("scamPopup");
    if(pop) pop.style.display="flex";
  }
})();
function closeScam(){
  const today=new Date().toISOString().slice(0,10);
  localStorage.setItem("scam_popup_date",today);
  const pop=document.getElementById("scamPopup");
  if(pop) pop.style.display="none";
}

/* ìŠ¤í¬ë¡¤ */
function scrollToCalc(){
  document.getElementById("calcCard")?.scrollIntoView({behavior:"smooth", block:"start"});
}

/* =========================
   ì²´í¬ë¦¬ìŠ¤íŠ¸
========================= */
const CHECKLIST_POOL = [
  "ë¼ì¸ ê¸‰ë³€ ê²½ê¸°(ê°‘ìê¸° ë‚´ë ¤ê°„ ë°°ë‹¹)ëŠ” ì´ìœ ë¶€í„° í™•ì¸í•˜ê¸°",
  "ë§ˆì§„(ìˆ˜ìˆ˜ë£Œ) ë†’ì€ ê²½ê¸°ë©´ í•œ ë‹¨ê³„ ë³´ìˆ˜ì ìœ¼ë¡œ ì ‘ê·¼í•˜ê¸°",
  "1íšŒ ë°°íŒ…ê¸ˆì€ ìë³¸ì˜ 1~3% ë²”ìœ„ë¡œ ì œí•œí•˜ê¸°",
  "ì„ ë°œ/ê²°ì¥/ë¡œí…Œ ë‰´ìŠ¤ ì²´í¬ í›„ ë°°ë‹¹ ë³€ë™ ì¬í™•ì¸í•˜ê¸°",
  "ì—°íŒ¨/ì—°ìŠ¹ íŒ€ì€ 'ì‹œì¥ ê³¼ì—´' êµ¬ê°„ì¸ì§€ ë¨¼ì € ë³´ê¸°",
  "ë³€ë™ì„± í° ë¦¬ê·¸ëŠ” ë‹¨í´/ì†Œì•¡ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ê¸°",
  "ì•„ì‹œì•ˆ ë¼ì¸(í‘¸ì‹œ) ê°€ëŠ¥ êµ¬ê°„ì€ 'ë¬´íš¨ ë¦¬ìŠ¤í¬'ë„ ê°™ì´ ê³ ë ¤í•˜ê¸°"
];
function refreshChecklist(){
  const pool = [...CHECKLIST_POOL].sort(()=>Math.random()-0.5);
  const pick = pool.slice(0,3);
  const el = document.getElementById("checklistText");
  if(el) el.innerHTML = "â€¢ " + pick.join("<br>â€¢ ");
}
refreshChecklist();

/* =========================
   ìƒíƒœ/ì €ì¥(ê¸°ì¡´ ìœ ì§€ + í™•ì¥)
========================= */
const LS_KEY = "88_analysis_multi_v3";            // ì…ë ¥ ìƒíƒœ
const HIST_KEY = "88_analysis_history_v1";        // íˆìŠ¤í† ë¦¬
let LAST_TEXT = "";

const SPORT_CFG = {
  soccer: {
    name: "ì¶•êµ¬",
    main: "3way",
    labels: {H:"í™ˆ", D:"ë¬´", A:"ì›ì •"},
    hint: "ì¶•êµ¬ëŠ” ê¸°ë³¸ 3ë°°ë‹¹(í™ˆ/ë¬´/ì›ì •). ì¤‘ê¸‰/ê³ ê¸‰ì—ì„œ ì˜¤ë²„ì–¸ë”ë¥¼ ê°™ì´ ë³´ëŠ” ê±¸ ì¶”ì²œí•©ë‹ˆë‹¤.",
    template: { openHandicap:false, openTotal:true },
    defaults: { ouPush: 6, hcPush: 2 }
  },
  basketball: {
    name:"ë†êµ¬",
    main:"2way",
    labels:{A:"ìŠ¹", B:"íŒ¨"},
    hint:"ë†êµ¬ëŠ” 2ë°°ë‹¹(ìŠ¹/íŒ¨) ì¤‘ì‹¬. ì¤‘ê¸‰/ê³ ê¸‰ì—ì„œëŠ” í•¸ë””+ì˜¤ë²„ì–¸ë”ë¥¼ í•¨ê»˜ ì¶”ì²œ.",
    template: { openHandicap:true, openTotal:true },
    defaults: { ouPush: 3, hcPush: 3 }
  },
  baseball: {
    name:"ì•¼êµ¬",
    main:"2way",
    labels:{A:"ìŠ¹", B:"íŒ¨"},
    hint:"ì•¼êµ¬ëŠ” ìŠ¹/íŒ¨(2ë°°ë‹¹) + ì˜¤ë²„ì–¸ë”/í•¸ë””(ëŸ°ë¼ì¸)ë¥¼ í•¨ê»˜ ë³´ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.",
    template: { openHandicap:true, openTotal:true },
    defaults: { ouPush: 4, hcPush: 2 }
  },
  volleyball: {
    name:"ë°°êµ¬",
    main:"2way",
    labels:{A:"ìŠ¹", B:"íŒ¨"},
    hint:"ë°°êµ¬ëŠ” 2ë°°ë‹¹(ìŠ¹/íŒ¨) ì¤‘ì‹¬. ì¤‘ê¸‰/ê³ ê¸‰ì—ì„œ í•¸ë””/OUë¥¼ í•¨ê»˜ í™•ì¸í•˜ì„¸ìš”.",
    template: { openHandicap:true, openTotal:true },
    defaults: { ouPush: 1, hcPush: 1 }
  },
  esports: {
    name:"eìŠ¤í¬ì¸ ",
    main:"2way",
    labels:{A:"ìŠ¹", B:"íŒ¨"},
    hint:"eìŠ¤í¬ì¸ ëŠ” ë§¤ì¹˜ ìŠ¹/íŒ¨(2ë°°ë‹¹) ì¤‘ì‹¬. ê³ ê¸‰ì—ì„œ EV/ë¹„ì¤‘ ê³„ì‚°ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.",
    template: { openHandicap:false, openTotal:false },
    defaults: { ouPush: 0, hcPush: 0 }
  },
  hockey: {
    name:"í•˜í‚¤",
    main:"2way",
    labels:{A:"ìŠ¹", B:"íŒ¨"},
    hint:"í•˜í‚¤ëŠ” 2ë°°ë‹¹(ìŠ¹/íŒ¨) ê¸°ë³¸. ì¤‘ê¸‰/ê³ ê¸‰ì—ì„œ ì˜¤ë²„ì–¸ë”ê°€ ë„ì›€ì´ ë©ë‹ˆë‹¤.",
    template: { openHandicap:false, openTotal:true },
    defaults: { ouPush: 4, hcPush: 2 }
  }
};

/* âœ… ì¢…ëª©/ìœ í˜•ë³„ â€œë§ˆì§„ ë‚®ìŒâ€ íŒì • ê¸°ì¤€ (ë§ˆì§„% ê¸°ì¤€) */
const MARGIN_RULE = {
  soccer:     { main:[6, 8, 10], ou:[5.5, 7.5, 9.5], hc:[5.5, 7.5, 9.5] },
  basketball: { main:[4, 6, 8],  ou:[4.5, 6.5, 8.5], hc:[4.5, 6.5, 8.5] },
  baseball:   { main:[4.5, 6.5, 8.5], ou:[4.5, 6.5, 8.5], hc:[4.5, 6.5, 8.5] },
  volleyball: { main:[4, 6, 8],  ou:[4, 6, 8],  hc:[4, 6, 8] },
  esports:    { main:[4, 6, 8],  ou:[4, 6, 8],  hc:[4, 6, 8] },
  hockey:     { main:[4.5, 6.5, 8.5], ou:[4.5, 6.5, 8.5], hc:[4.5, 6.5, 8.5] }
};

function $(id){ return document.getElementById(id); }
function val(id){ const el=$(id); return el?el.value:""; }
function setVal(id,v){ const el=$(id); if(el && v!=null) el.value=v; }
function todayStr(){ return new Date().toISOString().slice(0,10); }
function nowTimeStr(){
  const d=new Date();
  const hh=String(d.getHours()).padStart(2,"0");
  const mm=String(d.getMinutes()).padStart(2,"0");
  return `${hh}:${mm}`;
}

function saveState(){
  const state = {
    sport: val("sport"),
    level: val("level"),
    league: val("league"),
    teams: val("teams"),
    main2OddsA: val("main2OddsA"),
    main2OddsB: val("main2OddsB"),
    main3OddsH: val("main3OddsH"),
    main3OddsD: val("main3OddsD"),
    main3OddsA: val("main3OddsA"),
    myProb: val("myProb"),
    stake: val("stake"),
    handicapLine: val("handicapLine"),
    handicapOddsA: val("handicapOddsA"),
    handicapOddsB: val("handicapOddsB"),
    handicapPush: val("handicapPush"),
    totalLine: val("totalLine"),
    overOdds: val("overOdds"),
    underOdds: val("underOdds"),
    ouPush: val("ouPush"),
    myOverProb: val("myOverProb"),
    handicapCollapsed: isCollapsed("handicapBody"),
    totalCollapsed: isCollapsed("totalBody")
  };
  localStorage.setItem(LS_KEY, JSON.stringify(state));
}
function loadState(){
  try{
    const raw = localStorage.getItem(LS_KEY);
    if(!raw) return;
    const s = JSON.parse(raw);

    if(s.sport) setVal("sport", s.sport);
    if(s.level) setVal("level", s.level);

    onSportChange(true);
    onLevelChange(true);

    setVal("league", s.league);
    setVal("teams", s.teams);
    setVal("main2OddsA", s.main2OddsA);
    setVal("main2OddsB", s.main2OddsB);
    setVal("main3OddsH", s.main3OddsH);
    setVal("main3OddsD", s.main3OddsD);
    setVal("main3OddsA", s.main3OddsA);
    setVal("myProb", s.myProb);
    setVal("stake", s.stake);
    setVal("handicapLine", s.handicapLine);
    setVal("handicapOddsA", s.handicapOddsA);
    setVal("handicapOddsB", s.handicapOddsB);
    setVal("handicapPush", s.handicapPush);
    setVal("totalLine", s.totalLine);
    setVal("overOdds", s.overOdds);
    setVal("underOdds", s.underOdds);
    setVal("ouPush", s.ouPush);
    setVal("myOverProb", s.myOverProb);

    if(typeof s.handicapCollapsed === "boolean") setCollapsed("handicapBody", s.handicapCollapsed);
    if(typeof s.totalCollapsed === "boolean") setCollapsed("totalBody", s.totalCollapsed);
  }catch(e){}
}

/* ì…ë ¥ ì´ë²¤íŠ¸ ìë™ ì €ì¥ */
[
  "sport","level","league","teams",
  "main2OddsA","main2OddsB","main3OddsH","main3OddsD","main3OddsA",
  "myProb","stake",
  "handicapLine","handicapOddsA","handicapOddsB","handicapPush",
  "totalLine","overOdds","underOdds","ouPush","myOverProb"
].forEach(id=>{
  const el=$(id);
  if(el) el.addEventListener("input", saveState);
});

/* =========================
   UI: í…œí”Œë¦¿ + ë‚œì´ë„
========================= */
function onSportChange(silent){
  const sport = val("sport");
  const cfg = SPORT_CFG[sport] || SPORT_CFG.soccer;

  $("sportHint").innerText = `ì„ íƒ ì¢…ëª©: ${cfg.name} Â· ${cfg.hint}`;

  const is3 = cfg.main === "3way";
  $("main2").style.display = is3 ? "none" : "block";
  $("main3").style.display = is3 ? "block" : "none";
  $("mainMarketTitle").innerText = is3 ? "ë©”ì¸ ë°°ë‹¹ (í™ˆ/ë¬´/ì›ì •)" : "ë©”ì¸ ë°°ë‹¹ (ìŠ¹/íŒ¨)";

  if(!is3){
    $("main2LabelA").innerText = `${cfg.labels.A} ë°°ë‹¹`;
    $("main2LabelB").innerText = `${cfg.labels.B} ë°°ë‹¹`;
  }else{
    $("main3LabelH").innerText = `${cfg.labels.H} ë°°ë‹¹`;
    $("main3LabelD").innerText = `${cfg.labels.D} ë°°ë‹¹`;
    $("main3LabelA").innerText = `${cfg.labels.A} ë°°ë‹¹`;
  }

  // í•¸ë”” ë¼ë²¨ ì—…ë°ì´íŠ¸
  $("handicapOddsALabel").innerText = `í•¸ë”” ${cfg.labels.A || "ì„ íƒA"} ë°°ë‹¹`;
  $("handicapOddsBLabel").innerText = `ë°˜ëŒ€ ${cfg.labels.B || "ì„ íƒB"} ë°°ë‹¹`;

  // ê¸°ë³¸ í‘¸ì‹œ ê·¼ì‚¬ê°’(ë¯¸ì…ë ¥ì¼ ë•Œë§Œ ì±„ì›Œë„£ê¸°)
  if(!val("ouPush")) setVal("ouPush", cfg.defaults.ouPush);
  if(!val("handicapPush")) setVal("handicapPush", cfg.defaults.hcPush);

  applyTemplate();
  updateMyProbHints(cfg, val("level"));

  if(!silent) hideResult();
  renderMarginDash(); // ì¢…ëª© ë°”ë€Œë©´ ê¸°ì¤€í‘œ/ëŒ€ì‹œë³´ë“œ ì¦‰ì‹œ ë°˜ì˜
  saveState();
}

function onLevelChange(silent){
  const level = val("level");
  $("valueInputs").style.display = (level === "simple") ? "none" : "block";
  $("handicapBox").style.display = (level === "simple") ? "none" : "block";
  $("totalBox").style.display = (level === "simple") ? "none" : "block";

  const cfg = SPORT_CFG[val("sport")] || SPORT_CFG.soccer;
  updateMyProbHints(cfg, level);
  applyTemplate();

  if(!silent) hideResult();
  renderMarginDash();
  saveState();
}

function updateMyProbHints(cfg, level){
  const is3 = cfg.main === "3way";
  if(level === "simple"){
    $("myProbLabel").innerText = "ë‚´ ì˜ˆìƒ í™•ë¥ (ì„ íƒ) %";
    $("myProbHint").innerText = "";
    return;
  }
  if(is3){
    $("myProbLabel").innerText = `ë‚´ ì˜ˆìƒ í™•ë¥ (${cfg.labels.H}/${cfg.labels.D}/${cfg.labels.A}) % (ì„ íƒ)`;
    $("myProbHint").innerText = `ì‰¼í‘œë¡œ 3ê°œ ì…ë ¥ (ì˜ˆ: 45,28,27) Â· í•© 100 ê¶Œì¥`;
  }else{
    $("myProbLabel").innerText = `ë‚´ ì˜ˆìƒ í™•ë¥ (${cfg.labels.A}) % (ì„ íƒ)`;
    $("myProbHint").innerText = `ì˜ˆ: 55 (ë‹¨ì¼ ê°’) Â· EV/ê¶Œì¥ë¹„ì¤‘ ê³„ì‚°ìš©`;
  }
}

/* í…œí”Œë¦¿: ì¢…ëª©ë³„ OU/í•¸ë”” ê¸°ë³¸ í¼ì¹¨ */
function applyTemplate(){
  const level = val("level");
  const cfg = SPORT_CFG[val("sport")] || SPORT_CFG.soccer;
  if(level === "simple") return;
  setCollapsed("handicapBody", !cfg.template.openHandicap);
  setCollapsed("totalBody", !cfg.template.openTotal);
}

/* ì ‘ê¸°/í¼ì¹˜ê¸° */
function toggleBox(id){
  const now = isCollapsed(id);
  setCollapsed(id, !now);
  saveState();
}
function isCollapsed(id){
  const el = $(id);
  return el ? el.style.display === "none" : false;
}
function setCollapsed(id, collapsed){
  const el = $(id);
  if(!el) return;
  el.style.display = collapsed ? "none" : "block";
}

/* =========================
   ê³„ì‚° ìœ í‹¸
========================= */
function parseOdds(v){
  if(!v) return null;
  const x = Number(String(v).replace(/,/g,".").trim());
  if(!isFinite(x) || x<=1) return null;
  return x;
}
function parsePct(v){
  if(v==null || v==="") return null;
  const x = Number(String(v).replace(/,/g,".").trim());
  if(!isFinite(x) || x<0 || x>100) return null;
  return x/100;
}
function parsePctList(str){
  if(!str) return null;
  const parts = str.split(",").map(s=>s.trim()).filter(Boolean);
  if(parts.length !== 3) return null;
  const p1=parsePct(parts[0]), p2=parsePct(parts[1]), p3=parsePct(parts[2]);
  if(p1==null || p2==null || p3==null) return null;
  return [p1,p2,p3];
}
function parseMoney(v){
  if(!v) return null;
  const x = Number(String(v).replace(/[^\d]/g,""));
  if(!isFinite(x) || x<=0) return null;
  return x;
}
function pct(x){ return (x*100).toFixed(1) + "%"; }
function money(x){
  const n = Math.round(x);
  return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + "ì›";
}
function expectedValue(stake, p, odds){
  return stake * (p*(odds-1) - (1-p));
}
function quarterKelly(p, odds){
  const b = odds - 1;
  const f = (p*odds - 1) / b;
  const q = f/4;
  return Math.max(0, Math.min(0.25, q));
}

/* 2-way + í‘¸ì‹œ ê·¼ì‚¬ (ì•„ì‹œì•ˆ ë¼ì¸) */
function compute2Way(oddsA, oddsB, pushP){ // pushP: 0~1
  const ia=1/oddsA, ib=1/oddsB;
  const sum = ia+ib;
  const push = Math.max(0, Math.min(0.35, pushP || 0)); // ì•ˆì „ë²”ìœ„
  const factor = (1 - push);
  const pA = (ia/sum) * factor;
  const pB = (ib/sum) * factor;
  const overAdj = sum / factor;          // push í¬í•¨ ë³´ì • ì˜¤ë²„ë¼ìš´ë“œ
  const marginPct = (overAdj - 1) * 100; // %
  return { over: overAdj, marginPct, probs:[pA,pB], push };
}

/* 3-way */
function compute3Way(odds1,odds2,odds3){
  const i1=1/odds1, i2=1/odds2, i3=1/odds3;
  const over=i1+i2+i3;
  const p1=i1/over, p2=i2/over, p3=i3/over;
  const marginPct=(over-1)*100;
  return { over, marginPct, probs:[p1,p2,p3] };
}

function classifyMargin(sport, type, marginPct){
  const rule = (MARGIN_RULE[sport] || MARGIN_RULE.soccer)[type] || [5,7,9];
  const [low, mid, high] = rule;
  if(marginPct <= low) return { label:`ë§ˆì§„ ë‚®ìŒ (${marginPct.toFixed(2)}%)`, cls:"ok" };
  if(marginPct <= mid) return { label:`ë³´í†µ (${marginPct.toFixed(2)}%)`, cls:"mid" };
  if(marginPct <= high) return { label:`ì£¼ì˜ (${marginPct.toFixed(2)}%)`, cls:"mid" };
  return { label:`ê³ ë§ˆì§„ (${marginPct.toFixed(2)}%)`, cls:"bad" };
}
function clsToTextColor(cls){
  if(cls==="ok") return "good";
  if(cls==="mid") return "mid";
  return "warn";
}

/* =========================
   +EV í”Œë˜ê·¸ ì €ì¥ (index ìë™í•„í„°ìš©)
========================= */
function setEvFlag(isPositive){
  const d = todayStr();
  localStorage.setItem("88_ev_date", d);
  localStorage.setItem("88_ev_positive", isPositive ? "1" : "0");
}

/* =========================
   ê³„ì‚° ë©”ì¸ (ê¸°ì¡´ ê¸°ëŠ¥ 100% ìœ ì§€ + í™•ì¥)
========================= */
function levelLabel(level){
  return level==="simple" ? "ê°„ë‹¨" : (level==="mid" ? "ì¤‘ê¸‰" : "ê³ ê¸‰");
}

function calc(){
  const sport = val("sport");
  const level = val("level");
  const cfg = SPORT_CFG[sport] || SPORT_CFG.soccer;
  const is3 = cfg.main === "3way";

  const rows = [];
  const copyLines = [];
  copyLines.push(`[88 ì»¤ë®¤ë‹ˆí‹°] ${cfg.name} ë¶„ì„ (${levelLabel(level)})`);

  const league = val("league").trim();
  const teams  = val("teams").trim();
  if(league) copyLines.push(`ë¦¬ê·¸: ${league}`);
  if(teams)  copyLines.push(`ê²½ê¸°: ${teams}`);

  // ê²°ê³¼/íˆìŠ¤í† ë¦¬ìš© ë©”íƒ€
  const record = {
    id: Date.now().toString(36) + Math.random().toString(36).slice(2,7),
    date: todayStr(),
    time: nowTimeStr(),
    sport, level, league, teams,
    inputs:{},
    markets:{},
    evPositive:false,
    bestEVPct:null
  };

  // ---- ë©”ì¸ ----
  let mainMargin = null;
  let mainOver = null;
  let mainProbs = null;

  if(!is3){
    const a = parseOdds(val("main2OddsA"));
    const b = parseOdds(val("main2OddsB"));
    if(a==null || b==null) return showError("ë©”ì¸ ë°°ë‹¹ì„ 1.01 ì´ìƒ ìˆ«ìë¡œ ì…ë ¥í•´ì¤˜.");

    const out = compute2Way(a,b,0);
    mainOver = out.over;
    mainMargin = out.marginPct;
    mainProbs = out.probs;

    rows.push([`ìŠ¹ë¦¬ í™•ë¥ (ë°°ë‹¹ ê¸°ë°˜Â·ì¶”ì •, ${cfg.labels.A})`, pct(out.probs[0])]);
    rows.push([`ìŠ¹ë¦¬ í™•ë¥ (ë°°ë‹¹ ê¸°ë°˜Â·ì¶”ì •, ${cfg.labels.B})`, pct(out.probs[1])]);
    rows.push(["ì˜¤ë²„ë¼ìš´ë“œ(ë§ˆì§„ ì¶”ì •)", out.over.toFixed(4)]);

    const íŒì • = classifyMargin(sport,"main",out.marginPct);
    rows.push(["ë©”ì¸ ë§ˆì§„ íŒì •", `<span class="${clsToTextColor(íŒì •.cls)}">${íŒì •.label}</span>`]);

    copyLines.push(`ë©”ì¸ ë°°ë‹¹(${cfg.labels.A}/${cfg.labels.B}): ${a} / ${b}`);

    record.inputs.main2OddsA = val("main2OddsA");
    record.inputs.main2OddsB = val("main2OddsB");
    record.markets.main = { over: out.over, marginPct: out.marginPct };

    if(level !== "simple"){
      const myP = parsePct(val("myProb"));
      const stake = parseMoney(val("stake"));

      if(myP!=null){
        const evPer1 = (myP*(a-1) - (1-myP));
        rows.push([`ë‚´ ì˜ˆìƒ í™•ë¥ (${cfg.labels.A})`, pct(myP)]);
        rows.push(["EV(1ì›ë‹¹)", (evPer1*100).toFixed(2) + "%"]);
        copyLines.push(`ë‚´ ì˜ˆìƒ í™•ë¥ (${cfg.labels.A}): ${(myP*100).toFixed(1)}%`);
        if(stake!=null){
          rows.push(["ê¸°ëŒ€ê°’(EV)", money(expectedValue(stake, myP, a))]);
          copyLines.push(`ë² íŒ…ê¸ˆ: ${money(stake)}`);
        }
        if(level === "adv"){
          const k = quarterKelly(myP, a);
          rows.push(["ê¶Œì¥ ë¹„ì¤‘(ë³´ìˆ˜ì  1/4 Kelly)", (k*100).toFixed(1) + "%"]);
        }
        rows.push(["íŒë‹¨", evPer1>0 ? "ë°¸ë¥˜(+EV) ê°€ëŠ¥ì„±" : "ë°¸ë¥˜(-EV) ê°€ëŠ¥ì„±"]);

        record.bestEVPct = evPer1*100;
        record.evPositive = evPer1>0;
        setEvFlag(record.evPositive);
      }else{
        rows.push(["Tip", "ì¤‘ê¸‰/ê³ ê¸‰ì—ì„œëŠ” 'ë‚´ ì˜ˆìƒ í™•ë¥ 'ì„ ì…ë ¥í•˜ë©´ EVê°€ ê³„ì‚°ë©ë‹ˆë‹¤. (ì„ íƒì‚¬í•­)"]);
        setEvFlag(false);
      }
    }else{
      setEvFlag(false);
    }
  }else{
    const h = parseOdds(val("main3OddsH"));
    const d = parseOdds(val("main3OddsD"));
    const a = parseOdds(val("main3OddsA"));
    if(h==null || d==null || a==null) return showError("ë©”ì¸ ë°°ë‹¹(í™ˆ/ë¬´/ì›ì •)ì„ 1.01 ì´ìƒ ìˆ«ìë¡œ ì…ë ¥í•´ì¤˜.");

    const out = compute3Way(h,d,a);
    mainOver = out.over;
    mainMargin = out.marginPct;
    mainProbs = out.probs;

    rows.push([`ìŠ¹ë¦¬ í™•ë¥ (ë°°ë‹¹ ê¸°ë°˜Â·ì¶”ì •, ${cfg.labels.H})`, pct(out.probs[0])]);
    rows.push([`ìŠ¹ë¦¬ í™•ë¥ (ë°°ë‹¹ ê¸°ë°˜Â·ì¶”ì •, ${cfg.labels.D})`, pct(out.probs[1])]);
    rows.push([`ìŠ¹ë¦¬ í™•ë¥ (ë°°ë‹¹ ê¸°ë°˜Â·ì¶”ì •, ${cfg.labels.A})`, pct(out.probs[2])]);
    rows.push(["ì˜¤ë²„ë¼ìš´ë“œ(ë§ˆì§„ ì¶”ì •)", out.over.toFixed(4)]);

    const íŒì • = classifyMargin(sport,"main",out.marginPct);
    rows.push(["ë©”ì¸ ë§ˆì§„ íŒì •", `<span class="${clsToTextColor(íŒì •.cls)}">${íŒì •.label}</span>`]);

    copyLines.push(`ë©”ì¸ ë°°ë‹¹(${cfg.labels.H}/${cfg.labels.D}/${cfg.labels.A}): ${h} / ${d} / ${a}`);

    record.inputs.main3OddsH = val("main3OddsH");
    record.inputs.main3OddsD = val("main3OddsD");
    record.inputs.main3OddsA = val("main3OddsA");
    record.markets.main = { over: out.over, marginPct: out.marginPct };

    if(level !== "simple"){
      const my = parsePctList(val("myProb"));
      const stake = parseMoney(val("stake"));

      if(my){
        const evH = (my[0]*(h-1) - (1-my[0]));
        const evD = (my[1]*(d-1) - (1-my[1]));
        const evA = (my[2]*(a-1) - (1-my[2]));

        rows.push([`ë‚´ ì˜ˆìƒ í™•ë¥ (${cfg.labels.H}/${cfg.labels.D}/${cfg.labels.A})`,
          `${pct(my[0])} / ${pct(my[1])} / ${pct(my[2])}`]);

        rows.push(["EV(í™ˆ/ë¬´/ì›ì •, 1ì›ë‹¹)", `${(evH*100).toFixed(2)}% / ${(evD*100).toFixed(2)}% / ${(evA*100).toFixed(2)}%`]);

        const best = [
          {k:cfg.labels.H, ev:evH, odds:h, p:my[0]},
          {k:cfg.labels.D, ev:evD, odds:d, p:my[1]},
          {k:cfg.labels.A, ev:evA, odds:a, p:my[2]}
        ].sort((x,y)=>y.ev-x.ev)[0];

        rows.push(["ê°€ì¥ ë†’ì€ EV", `${best.k} (${(best.ev*100).toFixed(2)}%)`]);
        if(stake!=null) rows.push(["ê¸°ëŒ€ê°’(EV, ìµœê³  EV ê¸°ì¤€)", money(expectedValue(stake, best.p, best.odds))]);

        if(level === "adv"){
          rows.push(["ê¶Œì¥ ë¹„ì¤‘(ë³´ìˆ˜ì  1/4 Kelly, ìµœê³  EV ê¸°ì¤€)", (quarterKelly(best.p, best.odds)*100).toFixed(1) + "%"]);
        }
        rows.push(["íŒë‹¨", best.ev>0 ? "ë°¸ë¥˜(+EV) ê°€ëŠ¥ì„±" : "ë°¸ë¥˜(-EV) ê°€ëŠ¥ì„±"]);

        record.bestEVPct = best.ev*100;
        record.evPositive = best.ev>0;
        setEvFlag(record.evPositive);

        copyLines.push(`ë‚´ ì˜ˆìƒ í™•ë¥ : ${(my[0]*100).toFixed(1)}% / ${(my[1]*100).toFixed(1)}% / ${(my[2]*100).toFixed(1)}%`);
        if(stake!=null) copyLines.push(`ë² íŒ…ê¸ˆ: ${money(stake)}`);
      }else{
        rows.push(["Tip", "ì¤‘ê¸‰/ê³ ê¸‰ì—ì„œëŠ” ë‚´ ì˜ˆìƒ í™•ë¥ (ì˜ˆ: 45,28,27)ì„ ì…ë ¥í•˜ë©´ EVê°€ ê³„ì‚°ë©ë‹ˆë‹¤. (ì„ íƒì‚¬í•­)"]);
        setEvFlag(false);
      }
    }else{
      setEvFlag(false);
    }
  }

  // ---- ì˜¤ë²„ì–¸ë” (2-way + í‘¸ì‹œ ê·¼ì‚¬) ----
  let ouMargin = null;
  const tLine = val("totalLine").trim();
  const oOdds = parseOdds(val("overOdds"));
  const uOdds = parseOdds(val("underOdds"));
  const myOver = parsePct(val("myOverProb"));
  const ouPushPct = parsePct(val("ouPush")) ?? null; // ì…ë ¥ ê°’ì´ %ì´ë©´ parsePctê°€ 0~1ë¡œ
  // parsePct expects 0~100; but we want % input; ok

  if(tLine && oOdds!=null && uOdds!=null){
    // í‘¸ì‹œ í™•ë¥ : ì…ë ¥ê°’ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ì¢…ëª© ê¸°ë³¸ê°’
    let push = ouPushPct;
    if(push==null){
      const cfg2 = SPORT_CFG[sport] || SPORT_CFG.soccer;
      push = (cfg2.defaults.ouPush || 0) / 100;
    }
    const outOU = compute2Way(oOdds, uOdds, push);
    ouMargin = outOU.marginPct;

    rows.push([`ì˜¤ë²„/ì–¸ë”(ê¸°ì¤€ ${tLine}) ìŠ¹ë¦¬ í™•ë¥ (ë°°ë‹¹ ê¸°ë°˜Â·ì¶”ì •)`,
      `ì˜¤ë²„ ${pct(outOU.probs[0])} / ì–¸ë” ${pct(outOU.probs[1])}${outOU.push>0?` / í‘¸ì‹œ ${(outOU.push*100).toFixed(1)}%`:``}`]);
    rows.push([`ì˜¤ë²„/ì–¸ë” ì˜¤ë²„ë¼ìš´ë“œ(ë³´ì •)`, outOU.over.toFixed(4)]);
    const íŒì •OU = classifyMargin(sport,"ou",outOU.marginPct);
    rows.push([`ì˜¤ë²„/ì–¸ë” ë§ˆì§„ íŒì •`, `<span class="${clsToTextColor(íŒì •OU.cls)}">${íŒì •OU.label}</span>`]);

    copyLines.push(`ì˜¤ë²„ì–¸ë” ${tLine}: ì˜¤ë²„ ${oOdds} / ì–¸ë” ${uOdds}${outOU.push>0?` (í‘¸ì‹œ ê·¼ì‚¬ ${ (outOU.push*100).toFixed(1)}%)`:``}`);

    record.inputs.totalLine = val("totalLine");
    record.inputs.overOdds = val("overOdds");
    record.inputs.underOdds = val("underOdds");
    record.inputs.ouPush = val("ouPush");
    record.markets.ou = { over: outOU.over, marginPct: outOU.marginPct, push: outOU.push };

    if(level === "adv" && myOver!=null){
      const stake = parseMoney(val("stake")) || null;
      // í‘¸ì‹œ í¬í•¨ EV: EV = pWin*(odds-1) - pLose + pPush*0
      const pWin = myOver;
      const pPush = outOU.push; // ê·¼ì‚¬
      const pLose = Math.max(0, 1 - pWin - pPush);
      const evPer1 = (pWin*(oOdds-1) - pLose);

      rows.push([`ë‚´ ì˜ˆìƒ í™•ë¥ (ì˜¤ë²„)`, pct(myOver)]);
      rows.push([`ì˜¤ë²„ EV(1ì›ë‹¹, í‘¸ì‹œ ê·¼ì‚¬)`, (evPer1*100).toFixed(2) + "%"]);
      if(stake!=null) rows.push([`ì˜¤ë²„ ê¸°ëŒ€ê°’(EV)`, money(stake * evPer1)]);
      rows.push([`ì˜¤ë²„ ê¶Œì¥ ë¹„ì¤‘(1/4 Kelly, ì°¸ê³ )`, (quarterKelly(myOver, oOdds)*100).toFixed(1) + "%"]);
      rows.push([`ì˜¤ë²„ íŒë‹¨`, evPer1>0 ? "ë°¸ë¥˜(+EV) ê°€ëŠ¥ì„±" : "ë°¸ë¥˜(-EV) ê°€ëŠ¥ì„±"]);
    }
  }

  // ---- í•¸ë””ìº¡ (ì •ë°€ 2-way + í‘¸ì‹œ ê·¼ì‚¬) ----
  let hcMargin = null;
  const hLine = val("handicapLine").trim();
  const hOA = parseOdds(val("handicapOddsA"));
  const hOB = parseOdds(val("handicapOddsB"));
  const hcPushPct = parsePct(val("handicapPush")) ?? null;

  if(hLine && hOA!=null && hOB!=null){
    let push = hcPushPct;
    if(push==null){
      const cfg2 = SPORT_CFG[sport] || SPORT_CFG.soccer;
      push = (cfg2.defaults.hcPush || 0) / 100;
    }
    const outHC = compute2Way(hOA, hOB, push);
    hcMargin = outHC.marginPct;

    rows.push([`í•¸ë””ìº¡(ë¼ì¸ ${hLine}) ìŠ¹ë¦¬ í™•ë¥ (ë°°ë‹¹ ê¸°ë°˜Â·ì¶”ì •)`,
      `${cfg.labels.A||"A"} ${pct(outHC.probs[0])} / ${cfg.labels.B||"B"} ${pct(outHC.probs[1])}${outHC.push>0?` / í‘¸ì‹œ ${(outHC.push*100).toFixed(1)}%`:``}`]);
    rows.push([`í•¸ë””ìº¡ ì˜¤ë²„ë¼ìš´ë“œ(ë³´ì •)`, outHC.over.toFixed(4)]);
    const íŒì •HC = classifyMargin(sport,"hc",outHC.marginPct);
    rows.push([`í•¸ë””ìº¡ ë§ˆì§„ íŒì •`, `<span class="${clsToTextColor(íŒì •HC.cls)}">${íŒì •HC.label}</span>`]);

    copyLines.push(`í•¸ë”” ${hLine}: ${cfg.labels.A||"A"} ${hOA} / ${cfg.labels.B||"B"} ${hOB}${outHC.push>0?` (í‘¸ì‹œ ê·¼ì‚¬ ${ (outHC.push*100).toFixed(1)}%)`:``}`);

    record.inputs.handicapLine = val("handicapLine");
    record.inputs.handicapOddsA = val("handicapOddsA");
    record.inputs.handicapOddsB = val("handicapOddsB");
    record.inputs.handicapPush = val("handicapPush");
    record.markets.hc = { over: outHC.over, marginPct: outHC.marginPct, push: outHC.push };
  }

  // ---- ëŒ€ì‹œë³´ë“œ/íˆìŠ¤í† ë¦¬ ë°˜ì˜ ----
  renderResult(cfg.name, level, rows, copyLines);
  renderMarginDash({sport, main:mainMargin, ou:ouMargin, hc:hcMargin});

  // íˆìŠ¤í† ë¦¬ ì €ì¥
  addHistory(record);

  // TOP3 ê°±ì‹ 
  renderTop3();

  saveState();
}

/* =========================
   ê²°ê³¼ ë Œë”(ê¸°ì¡´ ìœ ì§€)
========================= */
function renderResult(sportName, level, rows, copyLines){
  const box = $("result");
  const html = rows.map(([k,v])=>{
    // vê°€ HTML í¬í•¨í•  ìˆ˜ ìˆìœ¼ë‹ˆ ê·¸ëŒ€ë¡œ
    let cls = "";
    const s = String(v);
    if(k.includes("íŒë‹¨") && s.includes("-EV")) cls = "warn";
    if(k.includes("íŒë‹¨") && s.includes("+EV")) cls = "good";
    return `<div class="kv"><div class="k">${k}</div><div class="v ${cls}">${v}</div></div>`;
  }).join("");

  box.innerHTML = `
    <div style="font-weight:900;margin-bottom:6px;">${sportName} Â· ${levelLabel(level)} ê²°ê³¼</div>
    ${html}
    <hr class="sep">
    <div style="font-size:12px;color:#9a9a9a;line-height:1.5;">
      â€» â€œìŠ¹ë¦¬ í™•ë¥ (ë°°ë‹¹ ê¸°ë°˜Â·ì¶”ì •)â€ì€ ë°°ë‹¹ ì—­ìˆ˜ë¥¼ ì •ê·œí™”í•œ ê°’(ì‹œì¥ ê¸°ë°˜ ì¶”ì •)ì…ë‹ˆë‹¤.<br>
      â€» EV/ë¹„ì¤‘ì€ ì‚¬ìš©ìê°€ ì…ë ¥í•œ â€œë‚´ ì˜ˆìƒ í™•ë¥ â€ ê¸°ë°˜ì˜ ì°¸ê³  ì§€í‘œì´ë©° ìŠ¹ë¥ ì„ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
      â€» ì•„ì‹œì•ˆ(í‘¸ì‹œ) ê·¼ì‚¬ëŠ” ì‚¬ìš©ìê°€ ì…ë ¥í•œ í‘¸ì‹œ í™•ë¥ (ë˜ëŠ” ì¢…ëª© ê¸°ë³¸ê°’)ë¡œ ê·¼ì‚¬í•©ë‹ˆë‹¤.
    </div>
  `;
  box.style.display = "block";

  copyLines.push(`ì£¼ì†Œ: https://88st.cloud/analysis/`);
  LAST_TEXT = copyLines.join("\n") + "\n\n" + rows.map(r=>`${r[0]}: ${String(r[1]).replace(/<[^>]*>/g,"")}`).join("\n");
}
function showError(msg){
  const box = $("result");
  box.innerHTML = `<div class="kv"><div class="k">ì•ˆë‚´</div><div class="v warn">${msg}</div></div>`;
  box.style.display = "block";
  LAST_TEXT = `[88 ì»¤ë®¤ë‹ˆí‹°] ì•ˆë‚´\n${msg}\nì£¼ì†Œ: https://88st.cloud/analysis/`;
}
function hideResult(){
  const box = $("result");
  box.style.display = "none";
  box.innerHTML = "";
  LAST_TEXT = "";
}
function resetAll(){
  [
    "league","teams",
    "main2OddsA","main2OddsB","main3OddsH","main3OddsD","main3OddsA",
    "myProb","stake",
    "handicapLine","handicapOddsA","handicapOddsB","handicapPush",
    "totalLine","overOdds","underOdds","ouPush","myOverProb"
  ].forEach(id=>{ const el=$(id); if(el) el.value=""; });

  hideResult();
  localStorage.removeItem(LS_KEY);
  setEvFlag(false);
  renderMarginDash();
  toast("ì´ˆê¸°í™” ì™„ë£Œ");
}

/* =========================
   ë³µì‚¬/ê³µìœ  (ê¸°ì¡´ ìœ ì§€)
========================= */
async function copyResult(){
  if(!LAST_TEXT) return showError("ë¨¼ì € 'ê³„ì‚°í•˜ê¸°'ë¥¼ ëˆŒëŸ¬ ê²°ê³¼ë¥¼ ë§Œë“  ë’¤ ë³µì‚¬í•  ìˆ˜ ìˆì–´ìš”.");
  try{
    await navigator.clipboard.writeText(LAST_TEXT);
    toast("ê²°ê³¼ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
  }catch(e){
    prompt("ì•„ë˜ ë‚´ìš©ì„ ë³µì‚¬í•˜ì„¸ìš”:", LAST_TEXT);
  }
}
async function shareResult(){
  if(!LAST_TEXT) return showError("ë¨¼ì € 'ê³„ì‚°í•˜ê¸°'ë¥¼ ëˆŒëŸ¬ ê²°ê³¼ë¥¼ ë§Œë“  ë’¤ ê³µìœ í•  ìˆ˜ ìˆì–´ìš”.");
  try{
    if(navigator.share){
      await navigator.share({ title:"88 ì»¤ë®¤ë‹ˆí‹° ë¶„ì„ ê²°ê³¼", text: LAST_TEXT });
    }else{
      await copyResult();
    }
  }catch(e){}
}

/* =========================
   í† ìŠ¤íŠ¸
========================= */
let toastTimer=null;
function toast(msg){
  const el=document.getElementById("toast88");
  if(!el) return;
  el.textContent=msg;
  el.style.opacity="1";
  if(toastTimer) clearTimeout(toastTimer);
  toastTimer=setTimeout(()=>{ el.style.opacity="0"; }, 1400);
}

/* =========================
   ë§ˆì§„ ëŒ€ì‹œë³´ë“œ ë Œë”
========================= */
function renderMarginDash(last){
  const sport = last?.sport || val("sport") || "soccer";
  const cfg = SPORT_CFG[sport] || SPORT_CFG.soccer;

  // ì…ë ¥ì—ì„œ ì¦‰ì„ìœ¼ë¡œë„ ê³„ì‚° ê°€ëŠ¥(ê³„ì‚° ì „ì—ë„ ê¸°ë³¸ í‘œì‹œ)
  const is3 = (cfg.main==="3way");
  let main = null;
  try{
    if(is3){
      const h=parseOdds(val("main3OddsH")), d=parseOdds(val("main3OddsD")), a=parseOdds(val("main3OddsA"));
      if(h && d && a) main = compute3Way(h,d,a).marginPct;
    }else{
      const a=parseOdds(val("main2OddsA")), b=parseOdds(val("main2OddsB"));
      if(a && b) main = compute2Way(a,b,0).marginPct;
    }
  }catch(e){}

  let ou = null;
  try{
    const o=parseOdds(val("overOdds")), u=parseOdds(val("underOdds"));
    if(o && u){
      let push = parsePct(val("ouPush"));
      if(push==null) push=(cfg.defaults.ouPush||0)/100;
      ou = compute2Way(o,u,push).marginPct;
    }
  }catch(e){}

  let hc = null;
  try{
    const a=parseOdds(val("handicapOddsA")), b=parseOdds(val("handicapOddsB"));
    if(a && b){
      let push = parsePct(val("handicapPush"));
      if(push==null) push=(cfg.defaults.hcPush||0)/100;
      hc = compute2Way(a,b,push).marginPct;
    }
  }catch(e){}

  if(last){
    if(typeof last.main === "number") main = last.main;
    if(typeof last.ou === "number") ou = last.ou;
    if(typeof last.hc === "number") hc = last.hc;
  }

  const items = [
    { key:"main", title:"ë©”ì¸", margin: main },
    { key:"ou", title:"ì˜¤ë²„/ì–¸ë”", margin: ou },
    { key:"hc", title:"í•¸ë””ìº¡", margin: hc }
  ];

  const html = items.map(it=>{
    if(typeof it.margin !== "number"){
      return `
        <div class="m-card">
          <div class="m-head">
            <div class="m-name">${it.title}</div>
            <div class="chip mid">ë¯¸ì…ë ¥</div>
          </div>
          <div class="m-lines">ë°°ë‹¹ì„ ì…ë ¥í•˜ë©´ ë§ˆì§„/íŒì •ì´ í‘œì‹œë©ë‹ˆë‹¤.</div>
        </div>
      `;
    }
    const íŒì • = classifyMargin(sport, it.key, it.margin);
    return `
      <div class="m-card">
        <div class="m-head">
          <div class="m-name">${it.title}</div>
          <div class="chip ${íŒì •.cls}">${íŒì •.label}</div>
        </div>
        <div class="m-lines">
          ê¸°ì¤€(ë‚®ìŒ/ë³´í†µ/ì£¼ì˜): <b>${MARGIN_RULE[sport][it.key][0]}%</b> / <b>${MARGIN_RULE[sport][it.key][1]}%</b> / <b>${MARGIN_RULE[sport][it.key][2]}%</b>
        </div>
      </div>
    `;
  }).join("");

  const box = document.getElementById("marginDash");
  if(box) box.innerHTML = html;
}

/* =========================
   íˆìŠ¤í† ë¦¬ ì €ì¥/ë³µì›/ë¹„êµ
========================= */
function readHistory(){
  try{
    const raw = localStorage.getItem(HIST_KEY);
    if(!raw) return [];
    const arr = JSON.parse(raw);
    return Array.isArray(arr) ? arr : [];
  }catch(e){
    return [];
  }
}
function writeHistory(arr){
  localStorage.setItem(HIST_KEY, JSON.stringify(arr.slice(0,50)));
}
function addHistory(rec){
  // ë§ˆì§„ ì—†ìœ¼ë©´ ì €ì¥ ì•ˆí•¨? -> ìµœì†Œ ë©”ì¸ ìˆìœ¼ë‹ˆ ì €ì¥
  const arr = readHistory();
  arr.unshift(rec);
  writeHistory(arr);
  renderHistory();
}
function clearHistory(){
  if(!confirm("íˆìŠ¤í† ë¦¬ë¥¼ ëª¨ë‘ ì‚­ì œí• ê¹Œìš”? (ë¸Œë¼ìš°ì € ë¡œì»¬ ì €ì¥)")) return;
  localStorage.removeItem(HIST_KEY);
  renderHistory();
  renderTop3();
  toast("íˆìŠ¤í† ë¦¬ ì‚­ì œ ì™„ë£Œ");
}

/* íˆìŠ¤í† ë¦¬ UI */
let comparePick = new Set();

function renderHistory(){
  const list = document.getElementById("historyList");
  if(!list) return;

  const arr = readHistory();
  if(!arr.length){
    list.innerHTML = `<div class="small-hint">ì•„ì§ ì €ì¥ëœ íˆìŠ¤í† ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤. ê³„ì‚°ì„ í•œ ë²ˆ ì‹¤í–‰í•´ë³´ì„¸ìš”.</div>`;
    return;
  }

  list.innerHTML = arr.map((h, idx)=>{
    const cfg = SPORT_CFG[h.sport] || SPORT_CFG.soccer;

    const mMain = h.markets?.main?.marginPct;
    const mOU = h.markets?.ou?.marginPct;
    const mHC = h.markets?.hc?.marginPct;

    const mainTag = (typeof mMain==="number") ? classifyMargin(h.sport,"main",mMain) : null;
    const ouTag = (typeof mOU==="number") ? classifyMargin(h.sport,"ou",mOU) : null;
    const hcTag = (typeof mHC==="number") ? classifyMargin(h.sport,"hc",mHC) : null;

    const evTxt = (typeof h.bestEVPct==="number") ? `${h.bestEVPct.toFixed(2)}%` : "-";
    const evCls = (h.evPositive) ? "good" : "warn";

    const checked = comparePick.has(h.id) ? "checked" : "";

    return `
      <div class="h-item" onclick="onHistoryClick(event,'${h.id}')">
        <div class="h-top">
          <div>
            <div class="h-title">${h.time} Â· ${cfg.name} Â· ${levelLabel(h.level)} ${h.teams?`Â· ${escapeHtml(h.teams)}`:""}</div>
            <div class="h-sub">
              ë©”ì¸: ${mainTag?`<span class="${clsToTextColor(mainTag.cls)}">${mainTag.label}</span>`:"-"} /
              OU: ${ouTag?`<span class="${clsToTextColor(ouTag.cls)}">${ouTag.label}</span>`:"-"} /
              í•¸ë””: ${hcTag?`<span class="${clsToTextColor(hcTag.cls)}">${hcTag.label}</span>`:"-"}
              <br>
              ìµœê³  EV: <span class="${evCls}"><b>${evTxt}</b></span>
            </div>
          </div>
          <div class="h-actions" onclick="event.stopPropagation()">
            <button class="primary2" type="button" onclick="restoreFromHistory('${h.id}', true)">ë³µì›+ì¬ê³„ì‚°</button>
            <button type="button" onclick="restoreFromHistory('${h.id}', false)">ë³µì›ë§Œ</button>
            <label class="pick">
              <input type="checkbox" ${checked} onchange="togglePick('${h.id}', this.checked)">
              ë¹„êµ
            </label>
          </div>
        </div>
      </div>
    `;
  }).join("");
}

/* íˆìŠ¤í† ë¦¬ í´ë¦­(ì•„ì´í…œ ì˜ì—­) -> ì¦‰ì‹œ ë³µì›+ì¬ê³„ì‚° */
function onHistoryClick(evt, id){
  // ë‚´ë¶€ ë²„íŠ¼ í´ë¦­ì€ stopPropagation ì²˜ë¦¬ë˜ì–´ ì—¬ê¸° ì•ˆ ì˜´
  restoreFromHistory(id, true);
}

function togglePick(id, on){
  if(on){
    if(comparePick.size>=2){
      toast("ë¹„êµëŠ” 2ê°œë§Œ ì„ íƒ ê°€ëŠ¥");
      // ì²´í¬ ë˜ëŒë¦¬ê¸°
      renderHistory();
      return;
    }
    comparePick.add(id);
  }else{
    comparePick.delete(id);
  }
}

function restoreFromHistory(id, doCalc){
  const arr = readHistory();
  const h = arr.find(x=>x.id===id);
  if(!h) return;

  // ê¸°ë³¸ ì…€ë ‰íŠ¸
  setVal("sport", h.sport);
  setVal("level", h.level);
  onSportChange(true);
  onLevelChange(true);

  // í…ìŠ¤íŠ¸
  setVal("league", h.league || "");
  setVal("teams", h.teams || "");

  // ë©”ì¸
  if(h.inputs.main2OddsA!=null) setVal("main2OddsA", h.inputs.main2OddsA);
  if(h.inputs.main2OddsB!=null) setVal("main2OddsB", h.inputs.main2OddsB);
  if(h.inputs.main3OddsH!=null) setVal("main3OddsH", h.inputs.main3OddsH);
  if(h.inputs.main3OddsD!=null) setVal("main3OddsD", h.inputs.main3OddsD);
  if(h.inputs.main3OddsA!=null) setVal("main3OddsA", h.inputs.main3OddsA);

  // EV ì…ë ¥
  if(h.inputs.myProb!=null) setVal("myProb", h.inputs.myProb);
  if(h.inputs.stake!=null) setVal("stake", h.inputs.stake);

  // í•¸ë””
  if(h.inputs.handicapLine!=null) setVal("handicapLine", h.inputs.handicapLine);
  if(h.inputs.handicapOddsA!=null) setVal("handicapOddsA", h.inputs.handicapOddsA);
  if(h.inputs.handicapOddsB!=null) setVal("handicapOddsB", h.inputs.handicapOddsB);
  if(h.inputs.handicapPush!=null) setVal("handicapPush", h.inputs.handicapPush);

  // OU
  if(h.inputs.totalLine!=null) setVal("totalLine", h.inputs.totalLine);
  if(h.inputs.overOdds!=null) setVal("overOdds", h.inputs.overOdds);
  if(h.inputs.underOdds!=null) setVal("underOdds", h.inputs.underOdds);
  if(h.inputs.ouPush!=null) setVal("ouPush", h.inputs.ouPush);
  if(h.inputs.myOverProb!=null) setVal("myOverProb", h.inputs.myOverProb);

  saveState();
  renderMarginDash();

  // ìŠ¤í¬ë¡¤
  scrollToCalc();

  if(doCalc){
    calc();
    toast("ë³µì› í›„ ì¬ê³„ì‚° ì™„ë£Œ");
  }else{
    toast("ì…ë ¥ ë³µì› ì™„ë£Œ");
  }
}

/* ë¹„êµ ëª¨ë‹¬ */
function openCompare(){
  const ids = Array.from(comparePick);
  if(ids.length !== 2){
    toast("ë¹„êµí•  í•­ëª© 2ê°œë¥¼ ì²´í¬í•´ ì£¼ì„¸ìš”");
    return;
  }
  const arr = readHistory();
  const a = arr.find(x=>x.id===ids[0]);
  const b = arr.find(x=>x.id===ids[1]);
  if(!a || !b){
    toast("ì„ íƒí•œ í•­ëª©ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤");
    return;
  }

  const grid = document.getElementById("compareGrid");
  if(!grid) return;

  grid.innerHTML = `
    ${renderCompareCol(a, "A")}
    ${renderCompareCol(b, "B")}
  `;

  document.getElementById("compareModal").style.display="flex";
}
function closeCompare(){
  document.getElementById("compareModal").style.display="none";
}
function renderCompareCol(h, tag){
  const cfg = SPORT_CFG[h.sport] || SPORT_CFG.soccer;

  const mainM = h.markets?.main?.marginPct;
  const ouM = h.markets?.ou?.marginPct;
  const hcM = h.markets?.hc?.marginPct;

  const mainTag = (typeof mainM==="number") ? classifyMargin(h.sport,"main",mainM) : null;
  const ouTag = (typeof ouM==="number") ? classifyMargin(h.sport,"ou",ouM) : null;
  const hcTag = (typeof hcM==="number") ? classifyMargin(h.sport,"hc",hcM) : null;

  const evTxt = (typeof h.bestEVPct==="number") ? `${h.bestEVPct.toFixed(2)}%` : "-";

  return `
    <div class="compare-col">
      <div class="ct">${tag} Â· ${h.time} Â· ${cfg.name} Â· ${levelLabel(h.level)}</div>
      <div class="line"><div class="k">ë¦¬ê·¸</div><div class="v">${h.league?escapeHtml(h.league):"-"}</div></div>
      <div class="line"><div class="k">ê²½ê¸°</div><div class="v">${h.teams?escapeHtml(h.teams):"-"}</div></div>
      <div class="line"><div class="k">ë©”ì¸ ë§ˆì§„</div><div class="v">${mainTag?`<span class="${clsToTextColor(mainTag.cls)}">${mainTag.label}</span>`:"-"}</div></div>
      <div class="line"><div class="k">OU ë§ˆì§„</div><div class="v">${ouTag?`<span class="${clsToTextColor(ouTag.cls)}">${ouTag.label}</span>`:"-"}</div></div>
      <div class="line"><div class="k">í•¸ë”” ë§ˆì§„</div><div class="v">${hcTag?`<span class="${clsToTextColor(hcTag.cls)}">${hcTag.label}</span>`:"-"}</div></div>
      <div class="line"><div class="k">ìµœê³  EV</div><div class="v">${h.evPositive?`<span class="good">${evTxt}</span>`:`<span class="warn">${evTxt}</span>`}</div></div>

      <div class="mini-actions">
        <button class="restore" type="button" onclick="restoreFromHistory('${h.id}', true)">ì´ í•­ëª© ë³µì›+ì¬ê³„ì‚°</button>
        <button class="close" type="button" onclick="closeCompare()">ë‹«ê¸°</button>
      </div>
    </div>
  `;
}

/* ì•ˆì „í•œ í…ìŠ¤íŠ¸ í‘œì‹œ */
function escapeHtml(s){
  return String(s)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/* =========================
   TOP3 ë Œë” (ë©”ì¸/OU/í•¸ë”” ê°ê°)
========================= */
function renderTop3(){
  const arr = readHistory().filter(x=>x.date===todayStr());
  const topMain = arr.filter(x=>typeof x.markets?.main?.marginPct==="number")
    .sort((a,b)=>a.markets.main.marginPct - b.markets.main.marginPct).slice(0,3);
  const topOU = arr.filter(x=>typeof x.markets?.ou?.marginPct==="number")
    .sort((a,b)=>a.markets.ou.marginPct - b.markets.ou.marginPct).slice(0,3);
  const topHC = arr.filter(x=>typeof x.markets?.hc?.marginPct==="number")
    .sort((a,b)=>a.markets.hc.marginPct - b.markets.hc.marginPct).slice(0,3);

  renderTopList("topMain", topMain, "main");
  renderTopList("topOU", topOU, "ou");
  renderTopList("topHC", topHC, "hc");
}
function renderTopList(id, list, type){
  const el = document.getElementById(id);
  if(!el) return;
  if(!list.length){
    el.innerHTML = "ì˜¤ëŠ˜ ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.";
    return;
  }
  el.innerHTML = list.map((h,i)=>{
    const cfg = SPORT_CFG[h.sport] || SPORT_CFG.soccer;
    const m = h.markets[type].marginPct;
    const tag = classifyMargin(h.sport, type, m);
    const text = `${i+1}) ${h.time} Â· ${cfg.name}${h.teams?` Â· ${escapeHtml(h.teams)}`:""} Â· ${tag.label}`;
    return `<div style="padding:6px 0;border-bottom:1px solid rgba(255,255,255,.06);">
      <a href="#calcCard" onclick="restoreFromHistory('${h.id}', true)" style="color:#fff;text-decoration:none;">
        <span class="${clsToTextColor(tag.cls)}"><b>${text}</b></span>
      </a>
    </div>`;
  }).join("").replace(/border-bottom:1px solid rgba\(255,255,255,.06\);\"><\/div>$/,"\">");
}

/* =========================
   ì´ˆê¸° êµ¬ë™
========================= */

/* =========================
   ë¶„ì„ê¸° ì§„ì… ê´‘ê³  íŒì—… (Aì•ˆ)
   - 1ì¼ 1íšŒ í‘œì‹œ
   - ë©”ì¸(index)ì—ì„œ ì €ì¥ëœ í´ë¦­ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì¸ê¸° ìˆœ ìš°ì„ 
========================= */
(function initAdPopup(){
  const KEY = "88_analysis_adpopup_date";
  const today = new Date().toISOString().slice(0,10);

  try{
    if(localStorage.getItem(KEY) === today) return;
  }catch(e){}

  // index.html í´ë¦­ ì§‘ê³„(ìˆìœ¼ë©´ í™œìš©)
  let clickMap = {};
  try{
    clickMap = JSON.parse(localStorage.getItem("88_card_clicks") || "{}") || {};
  }catch(e){ clickMap = {}; }

  // ë©”ì¸ í˜ì´ì§€ ìƒë‹¨ ìš°ì„  ì—…ì²´ + ê´‘ê³ ëª¨ì§‘ í¬í•¨
  const ads = [
    {key:"card1", title:"B WIN", sub:"ê³ ì•¡ì „ìš© Â· ì…ê¸ˆí”ŒëŸ¬ìŠ¤ ì§€ì›", href:"./#vendors", badge:"ì¶”ì²œ"},
    {key:"card2", title:"CAPS", sub:"ê³ ì•¡ì „ìš© Â· í˜ì´ë°±/ì¶œì„", href:"./#vendors", badge:"ì¶”ì²œ"},
    {key:"card3", title:"BETZY", sub:"ìŠ¤í¬ì¸ /ë¯¸ê²œ Â· í˜ì´ë°±", href:"./#vendors", badge:"ì¶”ì²œ"},
    {key:"card7", title:"ê´‘ê³  ëª¨ì§‘", sub:"ì—¬ê¸°ì— ê´‘ê³ ê°€ ë…¸ì¶œë©ë‹ˆë‹¤", href:"./#vendors", badge:"AD"},
    {key:"card8", title:"ê´‘ê³  ëª¨ì§‘", sub:"ë¬¸ì˜ í›„ ë“±ë¡ ê°€ëŠ¥", href:"./#vendors", badge:"AD"}
  ];

  const ranked = [...ads].sort((a,b)=>{
    const ca = Number(clickMap[a.key] || 0);
    const cb = Number(clickMap[b.key] || 0);
    return cb - ca;
  });

  const picks = ranked.slice(0,2);
  const grid = document.getElementById("adGrid");
  const pop = document.getElementById("adPopup");
  if(!grid || !pop) return;

  grid.innerHTML = picks.map(x=>`
    <div class="ad-item" onclick="goAd('${x.href}')">
      <div class="name">${x.title}</div>
      <div class="sub">${x.sub}</div>
      <div class="badge">${x.badge}</div>
    </div>
  `).join("");

  pop.style.display = "flex";
})();

function goAd(href){
  location.href = href;
}
function closeAdPopup(disableToday){
  const pop = document.getElementById("adPopup");
  if(pop) pop.style.display = "none";
  if(disableToday){
    try{
      const today = new Date().toISOString().slice(0,10);
      localStorage.setItem("88_analysis_adpopup_date", today);
    }catch(e){}
  }
}


function boot(){
  loadState();
  if(!localStorage.getItem(LS_KEY)){
    setVal("sport","soccer");
    setVal("level","simple");
  }
  onSportChange(true);
  onLevelChange(true);
  renderHistory();
  renderTop3();
  renderMarginDash();
}
boot();
</script>
</body>
</html>
