<!DOCTYPE html>
<html data-theme="light" lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>

  <title>OPS Console | 88ST</title>
  <meta name="robots" content="noindex,nofollow,noarchive,nosnippet"/>
  <link rel="canonical" href="https://88st.cloud/ops/"/>

  <link href="/favicon.ico" rel="icon" type="image/x-icon"/>
  <link href="/favicon.ico" rel="shortcut icon" type="image/x-icon"/>

  <!-- Base styling (keeps look consistent with the rest of the site) -->
  <link href="/assets/css/x.9d7841e705c5.css" rel="stylesheet"/>
  <link rel="stylesheet" href="/assets/css/hdr.shell.v1.20260221.css?v=119"/>

  <!-- Global asset loader (cache-busted via build.ver.js) -->
  <script defer src="/assets/js/build.ver.js?v=v20260224-1845"></script>
  <script defer src="/assets/js/build.loader.js?v=v20260224-1845"></script>

  <style>
    :root{ --opsMax: 1040px; }
    body{ margin:0; min-height:100vh; display:flex; }
    .opsWrap{ width:100%; max-width:var(--opsMax); margin:0 auto; padding:28px 16px 64px; }
    .opsCard{ border-radius:18px; border:1px solid rgba(255,255,255,.08); background: rgba(20,20,24,.55); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); box-shadow: 0 18px 50px rgba(0,0,0,.35); }
    [data-theme="light"] .opsCard{ background: rgba(255,255,255,.72); border-color: rgba(0,0,0,.08); box-shadow: 0 18px 50px rgba(0,0,0,.12); }

    .opsLock{ padding:22px 18px; max-width:520px; margin:40px auto 0; }
    .opsTitle{ display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:-.02em; font-size:18px; }
    .opsBadge{ font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid rgba(255,255,255,.15); opacity:.9; }
    [data-theme="light"] .opsBadge{ border-color: rgba(0,0,0,.12); }
    .opsSub{ margin-top:10px; opacity:.78; line-height:1.45; font-size:13px; }

    .opsRow{ display:flex; gap:10px; margin-top:14px; }
    .opsRow input{ flex:1; height:44px; border-radius:12px; padding:0 12px; border:1px solid rgba(255,255,255,.12); background: rgba(0,0,0,.18); color: inherit; outline:none; }
    [data-theme="light"] .opsRow input{ background: rgba(255,255,255,.8); border-color: rgba(0,0,0,.12); }

    .opsBtn{ height:44px; border-radius:12px; padding:0 14px; border:1px solid rgba(255,255,255,.14); background: rgba(255,255,255,.06); color: inherit; font-weight:700; cursor:pointer; }
    [data-theme="light"] .opsBtn{ background: rgba(0,0,0,.04); border-color: rgba(0,0,0,.12); }
    .opsBtn.primary{ background: rgba(121, 83, 255, .30); border-color: rgba(121, 83, 255, .55); }
    [data-theme="light"] .opsBtn.primary{ background: rgba(121, 83, 255, .16); }
    .opsBtn:active{ transform: translateY(1px); }

    .opsMsg{ margin-top:10px; font-size:13px; opacity:.85; }
    .opsErr{ color: #ff6b6b; }
    [data-theme="light"] .opsErr{ color: #c51f1f; }

    .opsConsole{ margin-top:18px; padding:18px; }
    .opsTop{ display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; }
    .opsTop .left{ display:flex; align-items:center; gap:10px; }
    .opsTop .ttl{ font-size:16px; font-weight:800; letter-spacing:-.02em; }
    .opsTop .meta{ opacity:.75; font-size:12px; }

    .opsGrid{ margin-top:14px; display:grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap:10px; }
    @media (max-width: 860px){ .opsGrid{ grid-template-columns: repeat(2, minmax(0, 1fr)); } }
    @media (max-width: 520px){ .opsGrid{ grid-template-columns: 1fr; } }

    .opsLink{ display:flex; justify-content:space-between; align-items:center; gap:10px; padding:12px 12px; border-radius:14px; border:1px solid rgba(255,255,255,.12); background: rgba(0,0,0,.12); text-decoration:none; color:inherit; }
    [data-theme="light"] .opsLink{ background: rgba(255,255,255,.65); border-color: rgba(0,0,0,.10); }
    .opsLink .name{ font-weight:800; }
    .opsLink .path{ font-size:12px; opacity:.75; }
    .opsLink .go{ font-weight:900; opacity:.7; }

    .opsSection{ margin-top:16px; padding:14px; }
    .opsSection h2{ margin:0; font-size:14px; letter-spacing:-.02em; }
    .opsSection .hint{ margin-top:6px; font-size:12px; opacity:.75; line-height:1.45; }

    .opsFlex{ margin-top:10px; display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .opsToggle{ display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:14px; border:1px solid rgba(255,255,255,.12); background: rgba(0,0,0,.10); }
    [data-theme="light"] .opsToggle{ background: rgba(255,255,255,.65); border-color: rgba(0,0,0,.10); }
    .opsToggle input{ width:18px; height:18px; }

    .opsTable{ width:100%; border-collapse:separate; border-spacing:0 8px; margin-top:10px; }
    .opsTable th{ text-align:left; font-size:12px; opacity:.75; padding:0 8px; }
    .opsTable td{ padding:0 8px; }
    .opsTable input, .opsTable select{ width:100%; height:38px; border-radius:12px; padding:0 10px; border:1px solid rgba(255,255,255,.12); background: rgba(0,0,0,.14); color:inherit; outline:none; }
    [data-theme="light"] .opsTable input, [data-theme="light"] .opsTable select{ background: rgba(255,255,255,.82); border-color: rgba(0,0,0,.12); }

    .opsMiniBtn{ height:38px; border-radius:12px; padding:0 12px; border:1px solid rgba(255,255,255,.14); background: rgba(255,255,255,.06); color:inherit; font-weight:800; cursor:pointer; }
    [data-theme="light"] .opsMiniBtn{ background: rgba(0,0,0,.04); border-color: rgba(0,0,0,.12); }

    .opsArea{ width:100%; min-height:140px; border-radius:14px; padding:10px 12px; border:1px solid rgba(255,255,255,.12); background: rgba(0,0,0,.14); color:inherit; outline:none; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:12px; line-height:1.45; }
    [data-theme="light"] .opsArea{ background: rgba(255,255,255,.82); border-color: rgba(0,0,0,.12); }

    .opsFooter{ margin-top:14px; opacity:.7; font-size:12px; }
    .opsFooter code{ opacity:1; }
  </style>
</head>

<body>
  <main class="opsWrap">
    <!-- LOCK SCREEN -->
    <section id="opsLock" class="opsCard opsLock" aria-label="OPS Console ì ê¸ˆ í™”ë©´">
      <div class="opsTitle">
        <span aria-hidden="true">ğŸ”’</span>
        <span>88ST OPS Console</span>
        <span class="opsBadge">PRIVATE</span>
      </div>
      <div class="opsSub">
        ì ‘ê·¼ ì œí•œ ì˜ì—­ì…ë‹ˆë‹¤. ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•Šìœ¼ë©´ ì½˜ì†”ì´ í‘œì‹œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
      </div>
      <div class="opsRow">
        <input id="opsPw" type="password" inputmode="text" autocomplete="off" autocapitalize="off" spellcheck="false" placeholder="ë¹„ë°€ë²ˆí˜¸"/>
        <button id="opsEnter" class="opsBtn primary" type="button">ì…ì¥</button>
      </div>
      <div id="opsMsg" class="opsMsg"></div>
    </section>

    <!-- CONSOLE -->
    <section id="opsConsole" class="opsCard opsConsole" hidden aria-label="OPS Console">
      <div class="opsTop">
        <div class="left">
          <div>
            <div class="ttl">ìš´ì˜ ì½˜ì†”</div>
            <div class="meta" id="opsMeta">ì„¸ì…˜ ì¸ì¦ë¨</div>
          </div>
        </div>
        <div class="opsFlex">
          <button id="opsOpenHome" class="opsBtn" type="button">í™ˆ ì—´ê¸°</button>
          <button id="opsLogout" class="opsBtn" type="button">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
      </div>

      <!-- QUICK LINKS -->
      <div class="opsGrid" id="opsLinks"></div>

      <!-- PATCH RULES -->
      <section class="opsCard opsSection" style="margin-top:14px;">
        <h2>ì „ì—­ íŒ¨ì¹˜ ë£°(ì„ íƒ)</h2>
        <div class="hint">
          ì½”ë“œ ìˆ˜ì • ì—†ì´ <b>íŠ¹ì • ìš”ì†Œì˜ í…ìŠ¤íŠ¸/HTML/ì†ì„±(href ë“±)/í‘œì‹œ ì—¬ë¶€</b>ë¥¼ ë°”ê¾¸ëŠ” ë£°ì…‹ì…ë‹ˆë‹¤.
          ì €ì¥í•˜ë©´ ì´ ë¸Œë¼ìš°ì €ì—ì„œë§Œ ì „ í˜ì´ì§€ì— ì ìš©ë©ë‹ˆë‹¤(ë¡œì»¬ í…ŒìŠ¤íŠ¸). ì „ì²´ ì‚¬ìš©ìì—ê²Œ ì ìš©í•˜ë ¤ë©´ ë°°í¬í˜• ì„¤ì • íŒŒì¼(<code>/assets/config/ops.dom.patch.json</code>)ë¡œ ë‚´ë³´ë‚´ì„œ êµì²´í•˜ì„¸ìš”.
        </div>

        <div class="opsFlex">
          <label class="opsToggle">
            <input id="opsEnabled" type="checkbox"/>
            <span>íŒ¨ì¹˜ í™œì„±í™”</span>
          </label>
          <button id="opsAddRule" class="opsMiniBtn" type="button">+ ë£° ì¶”ê°€</button>
          <button id="opsSave" class="opsMiniBtn" type="button">ì €ì¥</button>
          <button id="opsExport" class="opsMiniBtn" type="button">ë‚´ë³´ë‚´ê¸°</button>
          <button id="opsImport" class="opsMiniBtn" type="button">ê°€ì ¸ì˜¤ê¸°</button>
          <button id="opsClear" class="opsMiniBtn" type="button">ì´ˆê¸°í™”</button>
          <span style="flex:1"></span>
          <button id="opsLoadDeploy" class="opsMiniBtn" type="button">ë°°í¬ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°</button>
          <button id="opsExportDeploy" class="opsMiniBtn" type="button">ë°°í¬ìš© JSON ë§Œë“¤ê¸°</button>
          <button id="opsDownloadDeploy" class="opsMiniBtn" type="button">ë°°í¬íŒŒì¼ ë‹¤ìš´ë¡œë“œ</button>
        </div>

        <table class="opsTable" aria-label="íŒ¨ì¹˜ ë£° í…Œì´ë¸”">
          <thead>
            <tr>
              <th style="width:34%">selector</th>
              <th style="width:16%">type</th>
              <th style="width:14%">attr</th>
              <th>value</th>
              <th style="width:86px">ê´€ë¦¬</th>
            </tr>
          </thead>
          <tbody id="opsRules"></tbody>
        </table>

        <textarea id="opsJson" class="opsArea" spellcheck="false" placeholder="(ì˜µì…˜) JSON ì˜ì—­ â€” ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸°ìš©"></textarea>
        <div id="opsPatchMsg" class="opsMsg"></div>
        <div class="opsFooter">ë°°í¬ ê²½ë¡œ: <code>/assets/config/ops.dom.patch.json</code> Â· ì ìš© ëª¨ë“œ: <code>merge</code>(ê¸°ë³¸) / <code>override</code>(ë¡œì»¬ ì „ìš©)</div>
      </section>


      <!-- CERT LANDING CONFIG -->
      <section class="opsCard opsSection" style="margin-top:14px;">
        <h2>ì¸ì¦ ëœë”© ì„¤ì •(ë°°í¬)</h2>
        <div class="hint">
          <b>/cert ëª¨ë‹¬ + ì „ìš© URL(/cert/vegas/, /cert/777/)</b>ì—ì„œ ì‚¬ìš©í•˜ëŠ” <b>join ë§í¬/ê°€ì…ì½”ë“œ/í…”ë ˆê·¸ë¨</b>ì„ ë°°í¬í˜• ì„¤ì • íŒŒì¼ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤.
          ì•„ë˜ ê°’ë§Œ ë°”ê¿”ì„œ <code>/assets/config/cert.landing.json</code> íŒŒì¼ì„ êµì²´í•˜ë©´ <b>ì½”ë“œ ìˆ˜ì • 0</b>ìœ¼ë¡œ ì „ì²´ ì ìš©ë©ë‹ˆë‹¤.
        </div>

        <div class="opsFlex">
          <button id="opsCertLoad" class="opsMiniBtn" type="button">ë°°í¬ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°</button>
          <button id="opsCertMake" class="opsMiniBtn" type="button">ë°°í¬ìš© JSON ë§Œë“¤ê¸°</button>
          <button id="opsCertCopy" class="opsMiniBtn" type="button">JSON ë³µì‚¬</button>
          <button id="opsCertDownload" class="opsMiniBtn" type="button">ë°°í¬íŒŒì¼ ë‹¤ìš´ë¡œë“œ</button>
        </div>

        <table class="opsTable" aria-label="ì¸ì¦ ëœë”© ì„¤ì • í…Œì´ë¸”">
          <thead>
            <tr>
              <th style="width:16%">vendor</th>
              <th style="width:16%">code</th>
              <th>join_url</th>
              <th style="width:24%">telegram</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><b>VEGAS</b><div style="opacity:.75;font-size:12px;">/cert/vegas/</div></td>
              <td><input id="certVegasCode" value="6789" /></td>
              <td><input id="certVegasJoin" value="https://las403.com" /></td>
              <td rowspan="2"><input id="certTelegram" value="https://t.me/UZU59" /></td>
            </tr>
            <tr>
              <td><b>777 Bet</b><div style="opacity:.75;font-size:12px;">/cert/777/</div></td>
              <td><input id="cert777Code" value="6767" /></td>
              <td><input id="cert777Join" value="https://82clf.com/?code=6767" /></td>
            </tr>
          </tbody>
        </table>

        <textarea id="opsCertJson" class="opsArea" spellcheck="false" placeholder="(ìë™) ë°°í¬ìš© JSON â€” í•„ìš” ì‹œ í¸ì§‘ ê°€ëŠ¥"></textarea>
        <div id="opsCertMsg" class="opsMsg"></div>
        <div class="opsFooter">ë°°í¬ ê²½ë¡œ: <code>/assets/config/cert.landing.json</code> Â· ìºì‹œ: <code>no-store</code>(Worker)</div>
      </section>

      <!-- DANGER ZONE -->
      <section class="opsCard opsSection" style="margin-top:14px;">
        <h2>ìš´ì˜ ìœ í‹¸ë¦¬í‹°</h2>
        <div class="hint">ìµœê·¼ ì €ì¥/ì…ë ¥/ì„¸ì…˜ ë°ì´í„° ë“±, ë¸Œë¼ìš°ì € ë¡œì»¬ ìƒíƒœë¥¼ ë¹ ë¥´ê²Œ ì •ë¦¬í•©ë‹ˆë‹¤.</div>
        <div class="opsFlex">
          <button id="opsClearRecent" class="opsMiniBtn" type="button">ìµœê·¼ ì‚¬ìš© ì´ˆê¸°í™”</button>
          <button id="opsClearPersist" class="opsMiniBtn" type="button">ìµœê·¼ ì…ë ¥ ì´ˆê¸°í™”</button>
          <button id="opsHardReload" class="opsMiniBtn" type="button">ê°•ë ¥ ìƒˆë¡œê³ ì¹¨</button>
        </div>
        <div class="opsFooter">
          ì ìš© í‚¤: <code>vvip_ops_dom_patch_v1</code> Â· ì„¸ì…˜ í‚¤: <code>vvip_ops_authed_v1</code>
        </div>
      
      <!-- SMOKE CHECK -->
      <section class="opsCard opsSection" style="margin-top:14px;">
        <h2>ì „ì²´ í˜ì´ì§€ CTA ìŠ¤ëª¨í¬ ì²´í¬</h2>
        <div class="hint">
          ë°°í¬ ì „ ìë™ ì ê²€ìš©ì…ë‹ˆë‹¤. ì£¼ìš” í˜ì´ì§€ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì—´ì–´ <b>JS ì—ëŸ¬/í•„ìˆ˜ í•¨ìˆ˜/CTA í´ë¦­ ê°€ëŠ¥/ì¸ì¦ ëª¨ë‹¬ ì˜¤í”ˆ</b>ì„ ë¹ ë¥´ê²Œ í™•ì¸í•©ë‹ˆë‹¤.
          (ë³´ì•ˆ í—¤ë”ë¡œ iframe í…ŒìŠ¤íŠ¸ê°€ ë¶ˆê°€í•˜ì—¬, ì‘ì€ íŒì—… ì°½ 1ê°œë¥¼ ì¬ì‚¬ìš©í•©ë‹ˆë‹¤.)
        </div>
        <div class="opsFlex">
          <button id="opsSmokeRun" class="opsMiniBtn" type="button">ì „ì²´ ì ê²€ ì‹¤í–‰</button>
          <button id="opsSmokeStop" class="opsMiniBtn" type="button" disabled>ì¤‘ì§€</button>
          <span id="opsSmokeStatus" class="opsMsg" style="margin:0;"></span>
        </div>

        <table class="opsTable" aria-label="ìŠ¤ëª¨í¬ ì²´í¬ ê²°ê³¼">
          <thead>
            <tr>
              <th style="width:24%">page</th>
              <th style="width:10%">status</th>
              <th style="width:10%">errors</th>
              <th style="width:14%">CTA (click/total)</th>
              <th style="width:14%">cert modal</th>
              <th>note</th>
            </tr>
          </thead>
          <tbody id="opsSmokeBody"></tbody>
        </table>

        <textarea id="opsSmokeJson" class="opsArea" spellcheck="false" placeholder="(ìë™) ìƒì„¸ ê²°ê³¼ JSON â€” í•„ìš” ì‹œ ë³µì‚¬í•´ì„œ ê³µìœ /ë³´ê´€"></textarea>
      </section>

</section>
    </section>
  </main>

  <script>
    (function(){
      const HASH_HEX = '23c9221f8d58970a191a4762e4c9ca052c08c905b44e293ee4b2f6ed2a9b1755'; // sha256("88st0617!")
      const AUTH_KEY = 'vvip_ops_authed_v1';
      const LOCK_KEY = 'vvip_ops_lock_v1';
      const PATCH_KEY = 'vvip_ops_dom_patch_v1';
      const DEPLOY_URL = '/assets/config/ops.dom.patch.json';
      const CERT_DEPLOY_URL = '/assets/config/cert.landing.json';
      const BUILD_VER = (window.__BUILD_VER || '0') + '';

      const $ = (id)=>document.getElementById(id);
      const lock = $('opsLock');
      const consoleEl = $('opsConsole');
      const msg = $('opsMsg');
      const pw = $('opsPw');
      const enter = $('opsEnter');

      function safeParse(s, fallback){
        try{ return JSON.parse(s); }catch(_){ return fallback; }
      }

      function setMsg(text, isErr){
        msg.textContent = text || '';
        msg.className = 'opsMsg' + (isErr ? ' opsErr' : '');
      }

      function getLock(){
        try{ return safeParse(localStorage.getItem(LOCK_KEY) || '', {fails:0, until:0}); }catch(e){ return {fails:0, until:0}; }
      }

      function setLock(v){
        try{ localStorage.setItem(LOCK_KEY, JSON.stringify(v)); }catch(e){}
      }

      function isLocked(){
        const l = getLock();
        const until = Number(l.until||0);
        return until && Date.now() < until;
      }

      function lockLeftMs(){
        const l = getLock();
        return Math.max(0, Number(l.until||0) - Date.now());
      }

      function toHex(buf){
        const bytes = new Uint8Array(buf);
        let out = '';
        for(let i=0;i<bytes.length;i++) out += bytes[i].toString(16).padStart(2,'0');
        return out;
      }

      async function sha256Hex(text){
        const enc = new TextEncoder();
        const data = enc.encode(text);
        const hash = await crypto.subtle.digest('SHA-256', data);
        return toHex(hash);
      }

      function showConsole(){
        lock.hidden = true;
        consoleEl.hidden = false;
        try{ $('opsMeta').textContent = 'ì„¸ì…˜ ì¸ì¦ë¨ Â· ' + new Date().toLocaleString(); }catch(e){}
        initConsole();
      }

      function logout(){
        try{ sessionStorage.removeItem(AUTH_KEY); }catch(e){}
        consoleEl.hidden = true;
        lock.hidden = false;
        pw.value = '';
        setMsg('ë¡œê·¸ì•„ì›ƒë¨', false);
      }

      async function handleEnter(){
        if(isLocked()){
          const s = Math.ceil(lockLeftMs()/1000);
          setMsg('ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš” ('+s+'s)', true);
          return;
        }

        const v = (pw.value||'').trim();
        if(!v){
          setMsg('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.', true);
          return;
        }

        try{
          if(!('crypto' in window) || !crypto.subtle){
            setMsg('ì´ ë¸Œë¼ìš°ì €ëŠ” ë³´ì•ˆ í•´ì‹œ ê²€ì¦ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', true);
            return;
          }
          const hx = await sha256Hex(v);
          if(hx === HASH_HEX){
            try{ sessionStorage.setItem(AUTH_KEY, '1'); }catch(e){}
            setLock({fails:0, until:0});
            setMsg('', false);
            showConsole();
          }else{
            const l = getLock();
            const nextFails = Number(l.fails||0) + 1;
            // 6íšŒ ì‹¤íŒ¨ ì‹œ 60ì´ˆ ë½
            const until = (nextFails >= 6) ? (Date.now() + 60*1000) : 0;
            setLock({fails: nextFails, until});
            setMsg(until ? 'ì‹¤íŒ¨ê°€ ëˆ„ì ë˜ì–´ ì ì‹œ ì ê¸ˆ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.', true);
          }
        }catch(e){
          setMsg('ê²€ì¦ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', true);
        }
      }

      // --- Console features ---
      const linkItems = [
        {name:'í™ˆ', path:'/'},
        {name:'ë¶„ì„ ëŒ€ì‹œë³´ë“œ', path:'/analysis/'},
        {name:'ì¸ì¦ì‚¬ì´íŠ¸', path:'/cert/'},
        {name:'EV ê³„ì‚°ê¸°', path:'/tool-ev/'},
        {name:'ë§ˆì§„ ê³„ì‚°ê¸°', path:'/tool-margin/'},
        {name:'ë°°ë‹¹ ë¹„êµ', path:'/tool-odds/'},
        {name:'ìŠ¬ë¡¯ ë¶„ì„ê¸°', path:'/tool-slot/'},
        {name:'ë¯¸ë‹ˆê²Œì„ ë¶„ì„ê¸°', path:'/tool-minigame/'},
        {name:'ì¹´ì§€ë…¸ ì „ëµ', path:'/casino-strategy/'},
        {name:'ì¹´ì§€ë…¸', path:'/casino/'},
        {name:'ë¯¸ë‹ˆê²Œì„', path:'/minigame/'},
        {name:'ìŠ¬ë¡¯', path:'/slot/'},
        {name:'ê°€ì´ë“œ', path:'/guide/'},
        {name:'ê³„ì‚°ê¸° í—ˆë¸Œ', path:'/calc/'},
        {name:'ê¸°ë¡', path:'/logbook/'},
        {name:'ìš´ì„¸ ë¸Œë¦¬í•‘', path:'/fortune/'},
        {name:'ëœë”© A', path:'/landing-a/'},
        {name:'ëœë”© B', path:'/landing-b/'},
        {name:'ëœë”© C', path:'/landing-c/'},
        {name:'ëœë”© D', path:'/landing-d/'},
        {name:'ëœë”© E', path:'/landing-e/'},
        {name:'ëœë”© F', path:'/landing-f/'}
      ];

      function esc(s){
        return String(s==null?'':s).replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));
      }

      function readPatch(){
        try{
          const raw = localStorage.getItem(PATCH_KEY);
          if(!raw) return {enabled:false, rules:[]};
          const cfg = safeParse(raw, {enabled:false, rules:[]});
          if(!cfg || typeof cfg !== 'object') return {enabled:false, rules:[]};
          cfg.enabled = (cfg.enabled === true);
          cfg.rules = Array.isArray(cfg.rules) ? cfg.rules : [];
          return cfg;
        }catch(e){
          return {enabled:false, rules:[]};
        }
      }

      function writePatch(cfg){
        try{ localStorage.setItem(PATCH_KEY, JSON.stringify(cfg)); }catch(e){}
      }

      function patchMsg(text, isErr){
        const el = $('opsPatchMsg');
        el.textContent = text || '';
        el.className = 'opsMsg' + (isErr ? ' opsErr' : '');
      }

      function ensureRuleShape(r){
        return {
          selector: String(r && r.selector || ''),
          type: String(r && r.type || 'text'),
          attr: String(r && r.attr || ''),
          value: (r && r.value!=null) ? String(r.value) : ''
        };
      }

      function renderLinks(){
        const box = $('opsLinks');
        box.innerHTML = linkItems.map(x=>{
          const name = esc(x.name);
          const path = esc(x.path);
          return `
            <a class="opsLink" href="${path}" target="_blank" rel="noopener">
              <div>
                <div class="name">${name}</div>
                <div class="path">${path}</div>
              </div>
              <div class="go">â†’</div>
            </a>
          `;
        }).join('');
      }

      function rowHtml(idx, r){
        const rule = ensureRuleShape(r);
        const sel = esc(rule.selector);
        const type = esc(rule.type);
        const attr = esc(rule.attr);
        const val = esc(rule.value);

        const opts = [
          ['text','setText'],
          ['html','setHTML'],
          ['attr','setAttr'],
          ['hide','hide'],
          ['show','show'],
          ['addClass','addClass'],
          ['removeClass','removeClass'],
        ].map(([v,label])=>`<option value="${v}" ${v===type?'selected':''}>${label}</option>`).join('');

        return `
          <tr data-i="${idx}">
            <td><input data-k="selector" value="${sel}" placeholder="ì˜ˆ: a[href='/cert/']"/></td>
            <td>
              <select data-k="type">${opts}</select>
            </td>
            <td><input data-k="attr" value="${attr}" placeholder="href"/></td>
            <td><input data-k="value" value="${val}" placeholder="ê°’"/></td>
            <td><button class="opsMiniBtn" data-act="del" type="button">ì‚­ì œ</button></td>
          </tr>
        `;
      }

      function renderRules(cfg){
        $('opsEnabled').checked = !!cfg.enabled;
        const body = $('opsRules');
        const rules = Array.isArray(cfg.rules) ? cfg.rules : [];
        body.innerHTML = rules.map((r,i)=>rowHtml(i,r)).join('');

        // dynamic UI: hide attr/value depending on type
        body.querySelectorAll('tr').forEach(tr=>{
          const typeSel = tr.querySelector('select[data-k="type"]');
          const attrIn = tr.querySelector('input[data-k="attr"]');
          const valIn = tr.querySelector('input[data-k="value"]');
          const sync = ()=>{
            const t = (typeSel.value||'').trim();
            const needsAttr = (t === 'attr');
            const needsVal = !(t === 'hide' || t === 'show');
            attrIn.disabled = !needsAttr;
            attrIn.style.opacity = needsAttr ? '1' : '.45';
            valIn.disabled = !needsVal;
            valIn.style.opacity = needsVal ? '1' : '.45';
          };
          typeSel.addEventListener('change', sync);
          sync();
        });
      }

      function collectRules(){
        const rows = Array.from($('opsRules').querySelectorAll('tr'));
        const rules = rows.map(tr=>{
          const get = (k)=>{
            const el = tr.querySelector('[data-k="'+k+'"]');
            return el ? el.value : '';
          };
          return ensureRuleShape({
            selector: get('selector'),
            type: get('type'),
            attr: get('attr'),
            value: get('value')
          });
        }).filter(r=>r.selector.trim());
        return rules.slice(0, 60);
      }

      function savePatch(){
        const cfg = {
          enabled: $('opsEnabled').checked === true,
          rules: collectRules()
        };
        writePatch(cfg);
        $('opsJson').value = JSON.stringify(cfg, null, 2);
        patchMsg('ì €ì¥ ì™„ë£Œ. (ë‹¤ë¥¸ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œ ì ìš©)', false);
      }

      function exportPatch(){
        const cfg = {
          enabled: $('opsEnabled').checked === true,
          rules: collectRules()
        };
        const text = JSON.stringify(cfg, null, 2);
        $('opsJson').value = text;
        try{
          navigator.clipboard.writeText(text);
          patchMsg('í´ë¦½ë³´ë“œë¡œ ë³µì‚¬ë¨', false);
        }catch(e){
          patchMsg('ë‚´ë³´ë‚´ê¸° ìƒì„±ë¨ (í…ìŠ¤íŠ¸ ì˜ì—­ì—ì„œ ë³µì‚¬)', false);
        }
      }

      async function loadDeploy(){
        try{
          if(!('fetch' in window)) { patchMsg('fetch ë¯¸ì§€ì› ë¸Œë¼ìš°ì €', true); return; }
          const url = DEPLOY_URL + (DEPLOY_URL.indexOf('?')>=0 ? '&' : '?') + 'v=' + encodeURIComponent(BUILD_VER) + '&t=' + Date.now();
          const res = await fetch(url, {cache:'no-store', credentials:'same-origin'});
          if(!res || !res.ok){ patchMsg('ë°°í¬ ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (íŒŒì¼ì´ ì—†ê±°ë‚˜ ì‘ë‹µ ì˜¤ë¥˜)', true); return; }
          const cfg = await res.json().catch(()=>null);
          if(!cfg || typeof cfg !== 'object'){ patchMsg('ë°°í¬ JSON íŒŒì‹± ì‹¤íŒ¨', true); return; }
          cfg.enabled = (cfg.enabled === true);
          cfg.mode = String(cfg.mode || 'merge');
          cfg.rules = Array.isArray(cfg.rules) ? cfg.rules : [];
          cfg.rules = cfg.rules.map(ensureRuleShape);

          // Load into UI (but do not auto-save to localStorage)
          renderRules(cfg);
          $('opsJson').value = JSON.stringify(cfg, null, 2);
          patchMsg('ë°°í¬ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ (ì €ì¥ ì‹œ ë¡œì»¬ì—ë„ ì ìš©)', false);
        }catch(e){
          patchMsg('ë°°í¬ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨', true);
        }
      }

      function buildDeployConfig(){
        return {
          enabled: $('opsEnabled').checked === true,
          mode: 'merge',
          rules: collectRules(),
          meta: {
            updatedAt: new Date().toISOString(),
            by: '88st.ops.console'
          }
        };
      }

      function exportDeploy(){
        const cfg = buildDeployConfig();
        const text = JSON.stringify(cfg, null, 2);
        $('opsJson').value = text;
        try{
          navigator.clipboard.writeText(text);
          patchMsg('ë°°í¬ìš© JSON ìƒì„± + í´ë¦½ë³´ë“œ ë³µì‚¬ë¨', false);
        }catch(e){
          patchMsg('ë°°í¬ìš© JSON ìƒì„±ë¨ (í…ìŠ¤íŠ¸ ì˜ì—­ì—ì„œ ë³µì‚¬)', false);
        }
      }

      function downloadDeploy(){
        const cfg = buildDeployConfig();
        const text = JSON.stringify(cfg, null, 2);
        $('opsJson').value = text;
        try{
          const blob = new Blob([text], {type:'application/json;charset=utf-8'});
          const a = document.createElement('a');
          a.href = URL.createObjectURL(blob);
          a.download = 'ops.dom.patch.json';
          document.body.appendChild(a);
          a.click();
          setTimeout(()=>{ try{ URL.revokeObjectURL(a.href); }catch(e){} try{ a.remove(); }catch(e){} }, 200);
          patchMsg('ë°°í¬íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì‹œì‘ë¨ (ops.dom.patch.json)', false);
        }catch(e){
          patchMsg('ë‹¤ìš´ë¡œë“œ ìƒì„± ì‹¤íŒ¨ (í…ìŠ¤íŠ¸ë¥¼ ìˆ˜ë™ ì €ì¥í•˜ì„¸ìš”)', true);
        }
      }


      // --- CERT Landing deploy config (join/code/telegram) ---
      let certBase = null;

      const certMsg = (text, isErr) => {
        const el = $('opsCertMsg');
        if (!el) return;
        el.textContent = text || '';
        el.className = 'opsMsg' + (isErr ? ' opsErr' : '');
      };

      const pickVendor = (cfg, slug, idFallback) => {
        try{
          const vmap = (cfg && cfg.vendors) ? cfg.vendors : {};
          if (vmap && vmap[slug]) return vmap[slug];
          // try find by landing_path or id
          for (const k in vmap){
            const v = vmap[k];
            if (!v) continue;
            if ((v.slug && String(v.slug).toLowerCase() === String(slug).toLowerCase()) ||
                (v.landing_path && v.landing_path === `/cert/${slug}/`) ||
                (idFallback && v.id === idFallback)) return v;
          }
        }catch(e){}
        return null;
      };

      function readCertUi(){
        const telegram = String(($('certTelegram')?.value || '')).trim() || 'https://t.me/UZU59';
        const vegasCode = String(($('certVegasCode')?.value || '')).trim();
        const vegasJoin = String(($('certVegasJoin')?.value || '')).trim();
        const s777Code = String(($('cert777Code')?.value || '')).trim();
        const s777Join = String(($('cert777Join')?.value || '')).trim();
        return { telegram, vegasCode, vegasJoin, s777Code, s777Join };
      }

      function buildCertDeployConfig(){
        const ui = readCertUi();
        const now = new Date();
        const yyyy = now.getFullYear();
        const mm = String(now.getMonth()+1).padStart(2,'0');
        const dd = String(now.getDate()).padStart(2,'0');

        // preserve benefit/notice if present in loaded config; otherwise keep sensible defaults
        const base = certBase || {};
        const vVegas = pickVendor(base, 'vegas', 'card1') || {};
        const v777 = pickVendor(base, '777', 'card3') || {};

        return {
          enabled: true,
          version: `${yyyy}-${mm}-${dd}`,
          telegram: ui.telegram,
          vendors: {
            vegas: {
              id: 'card1',
              slug: 'vegas',
              title: vVegas.title || 'VEGAS',
              code: ui.vegasCode || vVegas.code || '6789',
              join_url: ui.vegasJoin || vVegas.join_url || 'https://las403.com',
              landing_path: '/cert/vegas/',
              hero_image: '/img/landing/vegas-landing.webp',
              thumb_image: '/img/img1.webp',
              benefit: vVegas.benefit || 'ìŠ¤í¬ì¸ Â·ê³ ì•¡ì „ìš© ì…í”Œ ìµœëŒ€ 30% í˜ì´ë°± / ì¹´ì§€ë…¸ ì…í”Œ',
              notice: vVegas.notice || 'ê°€ì…ì½”ë“œ ë¯¸ì…ë ¥ ì‹œ í˜œíƒ ì ìš© ë¶ˆê°€'
            },
            "777": {
              id: 'card3',
              slug: '777',
              title: v777.title || '777 Bet',
              code: ui.s777Code || v777.code || '6767',
              join_url: ui.s777Join || v777.join_url || 'https://82clf.com/?code=6767',
              landing_path: '/cert/777/',
              hero_image: '/img/landing/777-landing.webp',
              thumb_image: '/img/img2.webp',
              benefit: v777.benefit || 'ê°€ì…ì½”ë“œ 6767 ì „ìš© í˜œíƒ / ìŠ¤í¬ì¸ Â·ì¹´ì§€ë…¸ ì´ìš© ê°€ëŠ¥',
              notice: v777.notice || 'ê°€ì…ì½”ë“œ ë¯¸ì…ë ¥ ì‹œ í˜œíƒ ì ìš© ë¶ˆê°€'
            }
          },
          meta: {
            updatedAt: new Date().toISOString(),
            by: '88st.ops.console'
          }
        };
      }

      async function opsCertLoad(){
        try{
          const url = CERT_DEPLOY_URL + (CERT_DEPLOY_URL.indexOf('?')>=0 ? '&' : '?') + 't=' + Date.now();
          const res = await fetch(url, {cache:'no-store', credentials:'same-origin'});
          if(!res || !res.ok){ certMsg('ë°°í¬ ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (íŒŒì¼ì´ ì—†ê±°ë‚˜ ì‘ë‹µ ì˜¤ë¥˜)', true); return; }
          const cfg = await res.json().catch(()=>null);
          if(!cfg || typeof cfg !== 'object'){ certMsg('ë°°í¬ JSON íŒŒì‹± ì‹¤íŒ¨', true); return; }
          certBase = cfg;

          const vVegas = pickVendor(cfg, 'vegas', 'card1') || {};
          const v777 = pickVendor(cfg, '777', 'card3') || {};
          if($('certTelegram')) $('certTelegram').value = String(cfg.telegram || 'https://t.me/UZU59');
          if($('certVegasCode')) $('certVegasCode').value = String(vVegas.code || '6789');
          if($('certVegasJoin')) $('certVegasJoin').value = String(vVegas.join_url || 'https://las403.com');
          if($('cert777Code')) $('cert777Code').value = String(v777.code || '6767');
          if($('cert777Join')) $('cert777Join').value = String(v777.join_url || 'https://82clf.com/?code=6767');

          $('opsCertJson').value = JSON.stringify(cfg, null, 2);
          certMsg('ë°°í¬ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ', false);
        }catch(e){
          certMsg('ë°°í¬ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨', true);
        }
      }

      function opsCertMake(){
        const cfg = buildCertDeployConfig();
        const text = JSON.stringify(cfg, null, 2);
        $('opsCertJson').value = text;
        certMsg('ë°°í¬ìš© JSON ìƒì„±ë¨', false);
        return text;
      }

      function opsCertCopy(){
        const text = opsCertMake();
        try{
          navigator.clipboard.writeText(text);
          certMsg('JSONì´ í´ë¦½ë³´ë“œë¡œ ë³µì‚¬ë¨', false);
        }catch(e){
          certMsg('ë³µì‚¬ ì‹¤íŒ¨ â€” í…ìŠ¤íŠ¸ ì˜ì—­ì—ì„œ ìˆ˜ë™ ë³µì‚¬í•˜ì„¸ìš”', true);
        }
      }

      function opsCertDownload(){
        const text = opsCertMake();
        try{
          const blob = new Blob([text], {type:'application/json;charset=utf-8'});
          const a = document.createElement('a');
          a.href = URL.createObjectURL(blob);
          a.download = 'cert.landing.json';
          document.body.appendChild(a);
          a.click();
          setTimeout(()=>{ try{ URL.revokeObjectURL(a.href); }catch(e){} try{ a.remove(); }catch(e){} }, 200);
          certMsg('ë°°í¬íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì‹œì‘ë¨ (cert.landing.json)', false);
        }catch(e){
          certMsg('ë‹¤ìš´ë¡œë“œ ìƒì„± ì‹¤íŒ¨ (í…ìŠ¤íŠ¸ë¥¼ ìˆ˜ë™ ì €ì¥í•˜ì„¸ìš”)', true);
        }
      }


      function importPatch(){
        const raw = ($('opsJson').value||'').trim();
        if(!raw){ patchMsg('ê°€ì ¸ì˜¬ JSONì´ ì—†ìŠµë‹ˆë‹¤.', true); return; }
        try{
          const cfg = safeParse(raw, null);
          if(!cfg || typeof cfg !== 'object') throw new Error('bad');
          cfg.enabled = (cfg.enabled === true);
          cfg.rules = Array.isArray(cfg.rules) ? cfg.rules : [];
          cfg.rules = cfg.rules.map(ensureRuleShape);
          writePatch(cfg);
          renderRules(cfg);
          patchMsg('ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ. (ë‹¤ë¥¸ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œ ì ìš©)', false);
        }catch(e){
          patchMsg('JSON í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.', true);
        }
      }

      function clearPatch(){
        if(!confirm('íŒ¨ì¹˜ ë£°ì„ ì´ˆê¸°í™”í• ê¹Œìš”?')) return;
        const cfg = {enabled:false, rules:[]};
        writePatch(cfg);
        $('opsJson').value = JSON.stringify(cfg, null, 2);
        renderRules(cfg);
        patchMsg('ì´ˆê¸°í™” ì™„ë£Œ', false);
      }

      function addRule(){
        const cfg = readPatch();
        cfg.rules = Array.isArray(cfg.rules) ? cfg.rules : [];
        cfg.rules.push({selector:'', type:'text', attr:'', value:''});
        renderRules(cfg);
        patchMsg('', false);
      }

      function initConsole(){
        renderLinks();

        // patch controls
        const cfg = readPatch();
        renderRules(cfg);
        $('opsJson').value = JSON.stringify(cfg, null, 2);

        $('opsAddRule').addEventListener('click', addRule);
        $('opsSave').addEventListener('click', savePatch);
        $('opsExport').addEventListener('click', exportPatch);
        $('opsImport').addEventListener('click', importPatch);
        $('opsClear').addEventListener('click', clearPatch);

        $('opsLoadDeploy').addEventListener('click', loadDeploy);
        $('opsExportDeploy').addEventListener('click', exportDeploy);
        $('opsDownloadDeploy').addEventListener('click', downloadDeploy);

        // cert landing config
        $('opsCertLoad').addEventListener('click', opsCertLoad);
        $('opsCertMake').addEventListener('click', opsCertMake);
        $('opsCertCopy').addEventListener('click', opsCertCopy);
        $('opsCertDownload').addEventListener('click', opsCertDownload);

        $('opsRules').addEventListener('click', (e)=>{
          const btn = e.target && e.target.closest && e.target.closest('button[data-act="del"]');
          if(!btn) return;
          const tr = btn.closest('tr');
          if(!tr) return;
          const idx = Number(tr.getAttribute('data-i')||-1);
          const cfg2 = readPatch();
          if(idx>=0 && Array.isArray(cfg2.rules)){
            cfg2.rules.splice(idx, 1);
            writePatch(cfg2);
            renderRules(cfg2);
            $('opsJson').value = JSON.stringify(cfg2, null, 2);
            patchMsg('ì‚­ì œë¨', false);
          }
        });

        // utilities
        $('opsOpenHome').addEventListener('click', ()=>{ window.open('/', '_blank', 'noopener'); });
        $('opsLogout').addEventListener('click', logout);

        $('opsClearRecent').addEventListener('click', ()=>{
          if(!confirm('ìµœê·¼ ì‚¬ìš© ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”?')) return;
          try{ localStorage.removeItem('vvip_recent_pages_v1'); }catch(e){}
          patchMsg('ìµœê·¼ ì‚¬ìš© ì´ˆê¸°í™” ì™„ë£Œ', false);
        });

        $('opsClearPersist').addEventListener('click', ()=>{
          if(!confirm('ìµœê·¼ ì…ë ¥(í¼ ì €ì¥) ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”?')) return;
          try{
            const keys = [];
            for(let i=0;i<localStorage.length;i++){
              const k = localStorage.key(i);
              if(k && k.indexOf('vvip_form_persist_v1:')===0) keys.push(k);
            }
            keys.forEach(k=>{ try{ localStorage.removeItem(k); }catch(e){} });
            try{ localStorage.removeItem('vvip_form_persist_v1_index'); }catch(e){}
          }catch(e){}
          patchMsg('ìµœê·¼ ì…ë ¥ ì´ˆê¸°í™” ì™„ë£Œ', false);
        });

        $('opsHardReload').addEventListener('click', ()=>{
          // Clear SW + caches best-effort then reload
          try{
            if('serviceWorker' in navigator && navigator.serviceWorker.getRegistrations){
              navigator.serviceWorker.getRegistrations().then(regs=>Promise.all(regs.map(r=>r.unregister()))).catch(()=>{});
            }
            if('caches' in window && caches.keys){
              caches.keys().then(keys=>Promise.all(keys.map(k=>caches.delete(k)))).catch(()=>{});
            }
          }catch(e){}
  
        setTimeout(()=>location.reload(), 250);
        });

        // --- CTA Smoke Check (popup-based; iframe blocked by security headers) ---
        const smokeRunBtn = $('opsSmokeRun');
        const smokeStopBtn = $('opsSmokeStop');
        const smokeBody = $('opsSmokeBody');
        const smokeJson = $('opsSmokeJson');
        const smokeStatus = $('opsSmokeStatus');

        const smoke = { running:false, stop:false, idx:0, queue:[], results:[], rows:{}, win:null, timer:null, pendingToken:'', pendingPath:'' };

        function smokeSetStatus(text, isErr){
          if(!smokeStatus) return;
          smokeStatus.textContent = text || '';
          smokeStatus.className = 'opsMsg' + (isErr ? ' opsErr' : '');
        }

        function smokeRow(token, path){
          if(!smokeBody) return;
          smoke.rows[token] = true;
          const tr = document.createElement('tr');
          tr.id = 'smk_' + token;
          tr.innerHTML = `
            <td><code>${esc(path)}</code></td>
            <td data-k="st">â€¦</td>
            <td data-k="er">0</td>
            <td data-k="cta">-</td>
            <td data-k="md">-</td>
            <td data-k="nt">-</td>
          `;
          smokeBody.appendChild(tr);
        }

        function smokeUpdate(token, patch){
          const tr = document.getElementById('smk_' + token);
          if(!tr) return;
          const set = (k, v)=>{
            const td = tr.querySelector('[data-k="'+k+'"]');
            if(td) td.textContent = v;
          };
          if(patch.st != null) set('st', patch.st);
          if(patch.er != null) set('er', patch.er);
          if(patch.cta != null) set('cta', patch.cta);
          if(patch.md != null) set('md', patch.md);
          if(patch.nt != null) set('nt', patch.nt);
        }

        function smokeEnsureWin(){
          try{
            if(smoke.win && !smoke.win.closed) return smoke.win;
          }catch(e){}
          try{
            smoke.win = window.open('about:blank', '88stSmokeCheck', 'popup,width=420,height=760');
            return smoke.win;
          }catch(e){
            return null;
          }
        }

        function smokeToken(){
          return 't' + Date.now().toString(36) + Math.random().toString(36).slice(2,8);
        }

        function smokeNext(){
          if(!smoke.running) return;
          if(smoke.stop || smoke.idx >= smoke.queue.length){
            smokeFinish();
            return;
          }

          const path = smoke.queue[smoke.idx];
          smoke.idx++;

          const token = smokeToken();
          smoke.pendingToken = token;
          smoke.pendingPath = path;

          smokeRow(token, path);
          smokeUpdate(token, { st: 'LOADING', nt: '' });

          const w = smokeEnsureWin();
          if(!w){
            smokeUpdate(token, { st:'POPUP BLOCKED', nt:'ë¸Œë¼ìš°ì € íŒì—… ì°¨ë‹¨ í•´ì œ í•„ìš”' });
            smokeSetStatus('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. 88st.cloud íŒì—… í—ˆìš© í›„ ë‹¤ì‹œ ì‹¤í–‰í•˜ì„¸ìš”.', true);
            smokeFinish(true);
            return;
          }

          smokeSetStatus(`ì§„í–‰: ${smoke.idx}/${smoke.queue.length}  ${path}`, false);

          const url = path + (path.indexOf('?')>=0 ? '&' : '?')
            + 'smoke=1'
            + '&smoke_token=' + encodeURIComponent(token)
            + '&smoke_origin=' + encodeURIComponent(location.origin)
            + '&t=' + Date.now();

          try{ w.location.href = url; }catch(e){}

          try{ clearTimeout(smoke.timer); }catch(e){}
          smoke.timer = setTimeout(()=>{
            smokeUpdate(token, { st:'TIMEOUT', nt:'ì‘ë‹µ ì‹œê°„ ì´ˆê³¼(9s)' });
            smoke.results.push({ token, path, ok:false, timeout:true });
            if(smokeJson) smokeJson.value = JSON.stringify(smoke.results, null, 2);
            try{ if(smoke.win && !smoke.win.closed) smoke.win.location.replace('about:blank'); }catch(e){}
            smokeNext();
          }, 9000);
        }

        function smokeFinish(isErr){
          smoke.running = false;
          smoke.stop = false;
          try{ clearTimeout(smoke.timer); }catch(e){}
          if(smokeRunBtn) smokeRunBtn.disabled = false;
          if(smokeStopBtn) smokeStopBtn.disabled = true;

          const fails = smoke.results.filter(r=>r && r.ok === false).length;
          const total = smoke.results.length || 0;
          smokeSetStatus(isErr ? 'ì¤‘ë‹¨ë¨' : (`ì™„ë£Œ: ${total}ê°œ ì¤‘ ì‹¤íŒ¨ ${fails}ê°œ`), !!(isErr || fails));

          try{
            if(smoke.win && !smoke.win.closed){
              // close after a short delay (optional)
              setTimeout(()=>{ try{ smoke.win.close(); }catch(e){} }, 250);
            }
          }catch(e){}
        }

        function smokeStart(){
          if(smoke.running) return;

          smoke.running = true;
          smoke.stop = false;
          smoke.idx = 0;
          smoke.results = [];
          smoke.rows = {};
          smoke.pendingToken = '';
          smoke.pendingPath = '';
          if(smokeBody) smokeBody.innerHTML = '';
          if(smokeJson) smokeJson.value = '';

          if(smokeRunBtn) smokeRunBtn.disabled = true;
          if(smokeStopBtn) smokeStopBtn.disabled = false;

          // Use quick links as smoke targets (dedupe)
          smoke.queue = (linkItems || []).map(x=>x.path).filter(p=>!!p && p !== '/ops/' && p !== '/ops');
          smoke.queue = smoke.queue.filter((p, i, a)=>a.indexOf(p) === i);

          smokeSetStatus('ì ê²€ ì‹œì‘â€¦ (íŒì—… ì°½ì„ ë‹«ì§€ ë§ˆì„¸ìš”)', false);

          const w = smokeEnsureWin();
          if(!w){
            smokeSetStatus('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. 88st.cloud íŒì—… í—ˆìš© í›„ ë‹¤ì‹œ ì‹¤í–‰í•˜ì„¸ìš”.', true);
            smokeFinish(true);
            return;
          }

          smokeNext();
        }

        function smokeStopNow(){
          smoke.stop = true;
          smokeSetStatus('ì¤‘ì§€ ìš”ì²­ë¨â€¦', true);
        }

        // One-time listener
        if(!window.__OPS_SMOKE_LISTENER){
          window.__OPS_SMOKE_LISTENER = 1;
          window.addEventListener('message', (e)=>{
            try{
              if(e.origin !== location.origin) return;
              const d = e.data || {};
              if(!d.__88st_smoke) return;

              const token = (d.token || '') + '';
              if(!token) return;

              // boot phase
              if(d.phase === 'boot'){
                if(smoke.rows[token]) smokeUpdate(token, { st:'BOOT' });
                return;
              }

              // final report
              if(!d.state || typeof d.ok !== 'boolean') return;

              if(token !== smoke.pendingToken){
                // ignore unexpected token (stale)
              }

              try{ clearTimeout(smoke.timer); }catch(e2){}

              const st = d.state || {};
              const chk = st.checks || {};
              const errCount = (st.errors ? st.errors.length : 0) + (st.rejections ? st.rejections.length : 0);

              const cta = (chk.cta_clickable != null && chk.cta_total != null) ? `${chk.cta_clickable}/${chk.cta_total}` : '-';
              const md = (st.path && st.path.indexOf('/cert')===0) ? (chk.cert_modal_opens ? 'OK' : (chk.cert_modal_exists ? 'FAIL' : 'N/A')) : 'N/A';

              const noteParts = [];
              if(!chk.track) noteParts.push('track ë¯¸ê²€ì¶œ');
              if(errCount) noteParts.push('JS ì—ëŸ¬');
              if((chk.cta_total || 0) > 0 && (chk.cta_clickable || 0) === 0) noteParts.push('CTA í´ë¦­ ë¶ˆê°€');
              if(st.path && st.path.indexOf('/cert')===0 && chk.cert_modal_exists && !chk.cert_modal_opens) noteParts.push('ì¸ì¦ ëª¨ë‹¬ ë¶ˆê°€');

              smokeUpdate(token, {
                st: d.ok ? 'PASS' : 'FAIL',
                er: String(errCount),
                cta: cta,
                md: md,
                nt: noteParts.join(' Â· ') || ''
              });

              smoke.results.push({ token, path: st.path, ok: !!d.ok, state: st });
              if(smokeJson) smokeJson.value = JSON.stringify(smoke.results, null, 2);

              // Unload popup ASAP to avoid slow-script warnings during batch checks.
              try{ if(smoke.win && !smoke.win.closed) smoke.win.location.replace('about:blank'); }catch(e3){}

              setTimeout(smokeNext, 180);
            }catch(err){
              // ignore
            }
          });
        }

        if(smokeRunBtn) smokeRunBtn.addEventListener('click', smokeStart);
        if(smokeStopBtn) smokeStopBtn.addEventListener('click', smokeStopNow);

      }

      // Boot
      enter.addEventListener('click', handleEnter);
      pw.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); handleEnter(); } });

      // If locked, show countdown hint
      if(isLocked()){
        const s = Math.ceil(lockLeftMs()/1000);
        setMsg('ì ê¸ˆ ìƒíƒœì…ë‹ˆë‹¤ ('+s+'s)', true);
      }

      // restore session
      try{
        if(sessionStorage.getItem(AUTH_KEY) === '1'){
          showConsole();
        }
      }catch(e){}
    })();
  </script>
</body>
</html>
