<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ===== SEO 기본 세팅 ===== -->
<title>88 | 스포츠 배당 분석기 · 배당 마진 계산기 · 인증 놀이터 안내</title>
<meta name="description" content="88 — 스포츠 배당 분석기와 배당 마진(오버라운드) 계산기를 무료로 제공합니다. 분석기 사용 안내와 인증 놀이터 정보를 한 곳에서 확인하세요.">
<link rel="canonical" href="https://88st.cloud/">
<meta name="robots" content="index,follow">

<!-- SNS 공유 -->
<meta property="og:type" content="website">
<meta property="og:site_name" content="88 (팔팔커뮤니티)">
<meta property="og:title" content="88 | 스포츠 배당 분석기 · 배당 마진 계산기 · 인증 놀이터">
<meta property="og:description" content="무료 분석기(마진/EV/확률) + 인증 놀이터 안내">
<meta property="og:url" content="https://88st.cloud/">

<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

<!-- ===== GA4 (원하면 ID만 교체) ===== -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KWT87FBY6S"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'G-KWT87FBY6S', { anonymize_ip: true });
</script>

<style>
*,
*::before,
*::after{ box-sizing:border-box; }

:root{
  --bg:#0b0b0b;
  --panel:#121212;
  --gold:#d4af37;
  --gold2:#f5e27a;
  --muted:#cfcfcf;
}

html{ scroll-behavior:smooth; }
body{
  margin:0;
  background:
    radial-gradient(1200px 500px at 50% -10%, rgba(212,175,55,.14), transparent 55%),
    radial-gradient(900px 500px at 10% 20%, rgba(90,160,255,.08), transparent 60%),
    linear-gradient(180deg, #07070a, var(--bg));
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,system-ui;
  color:#fff;
}

.notice-bar{
  position:sticky;
  top:0;
  z-index:1600;
  background:linear-gradient(135deg,var(--gold),var(--gold2));
  color:#000;
  font-weight:900;
  font-size:13px;
  padding:10px 12px;
  text-align:center;
  box-shadow:0 10px 30px rgba(0,0,0,.35);
}
.notice-bar a{ color:#000; text-decoration:none; }

#loader{
  position:fixed;
  inset:0;
  z-index:2000;
  background:
    radial-gradient(900px 500px at 50% 30%, rgba(212,175,55,.18), transparent 55%),
    linear-gradient(180deg,#07070a,#0b0b0b);
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  gap:14px;
}
#loader .logoWrap{
  width:min(170px, 52vw);
  aspect-ratio:1/1;
  display:flex;
  align-items:center;
  justify-content:center;
  filter: drop-shadow(0 0 24px rgba(212,175,55,.22));
}
#loader img{
  width:100%;
  height:100%;
  object-fit:contain;
  animation: pulse 1.4s ease-in-out infinite;
}
#loader .text{ font-weight:900; letter-spacing:.6px; color:#e9e9e9; opacity:.85; font-size:13px; }
@keyframes pulse{ 0%{ transform:scale(1); opacity:.85; } 50%{ transform:scale(1.03); opacity:1; } 100%{ transform:scale(1); opacity:.85; } }
#loader.hide{ opacity:0; pointer-events:none; transition: opacity .35s ease; }

.scam-popup{
  position:fixed; inset:0; background:rgba(0,0,0,.75);
  display:none; align-items:center; justify-content:center;
  z-index:3000; padding:18px;
}
.scam-box{
  background:rgba(17,17,17,.95);
  border:1px solid rgba(255,255,255,.08);
  border-radius:18px;
  padding:22px;
  width:100%;
  max-width:380px;
  text-align:center;
  box-shadow:0 18px 60px rgba(0,0,0,.75);
  backdrop-filter: blur(10px);
}
.scam-box h3{ color:#ff6b6b; margin:0 0 10px; font-weight:900; }
.scam-box p{ font-size:13px; color:#ddd; line-height:1.55; margin:0; }
.scam-box .btn{ margin-top:12px; padding:12px; border-radius:12px; background:linear-gradient(135deg,var(--gold),var(--gold2)); color:#000; font-weight:900; cursor:pointer; user-select:none; }

.header{ text-align:center; padding:18px 0 8px; }
.header .logoLink{ display:inline-flex; align-items:center; justify-content:center; text-decoration:none; }
.header .logoImg{
  width:min(160px, 44vw);
  height:auto;
  display:block;
  padding:10px;
  border-radius:18px;
  background:radial-gradient(120px 60px at 50% 40%, rgba(212,175,55,.15), transparent 70%);
  filter: drop-shadow(0 0 10px rgba(212,175,55,.25)) drop-shadow(0 0 24px rgba(212,175,55,.12));
  animation: logoFloat 3.2s ease-in-out infinite;
}
@keyframes logoFloat{ 0%,100%{ transform:translateY(0); } 50%{ transform:translateY(-2px); } }
.header .sub{ font-size:12px; color:#9a9a9a; margin-top:6px; }

.section-wrap{ max-width:1100px; margin:0 auto; padding:10px 14px 4px; }
.section{
  background:rgba(18,18,18,.85);
  border:1px solid rgba(255,255,255,.06);
  border-radius:18px;
  padding:14px;
  margin-bottom:14px;
  box-shadow:0 10px 26px rgba(0,0,0,.45);
  backdrop-filter: blur(10px);
}
.section .title{ font-weight:900; font-size:14px; color:var(--gold2); margin-bottom:8px; }
.badge{ display:inline-block; padding:4px 8px; border-radius:999px; font-size:11px; font-weight:900; color:#000; background:linear-gradient(135deg,var(--gold),var(--gold2)); margin-right:6px; }
.section .text{ color:var(--muted); font-size:13px; line-height:1.55; }

.two-col{ display:grid; gap:14px; align-items:start; }
@media(min-width:980px){ .two-col{ grid-template-columns: 1.25fr .75fr; } }
.col{ min-width:0; }

.insight-row{ display:flex; gap:8px; align-items:center; margin-top:10px; flex-wrap:wrap; }
select.insight-select{
  background:rgba(0,0,0,.35);
  color:#fff;
  border:1px solid rgba(255,255,255,.12);
  padding:10px 12px;
  border-radius:12px;
  font-weight:800;
  outline:none;
}
.insight-btn{ background:linear-gradient(135deg,var(--gold),var(--gold2)); border:none; color:#111; padding:10px 12px; border-radius:12px; font-weight:900; cursor:pointer; }

.section input{
  padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.35); color:#fff; font-weight:800; outline:none;
}

.seg-row{ display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px; }
.seg{ flex:1; min-width:140px; padding:10px 12px; border-radius:999px; border:1px solid rgba(255,255,255,.12); background:rgba(0,0,0,.25); color:#fff; font-weight:900; cursor:pointer; }
.seg.active{ background:linear-gradient(135deg,var(--gold),var(--gold2)); color:#111; border-color:transparent; }

.cta-row{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
.cta-row a{ flex:1; min-width:160px; }
.analyze-btn{
  position:relative;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  width:100%;
  padding:15px 16px;
  border-radius:18px;
  font-weight:900;
  text-decoration:none;
  text-align:left;
  transition: transform .16s ease, box-shadow .16s ease, filter .16s ease;
  overflow:hidden;
  user-select:none;
}
.analyze-btn .label{ display:block; line-height:1.05; }
.analyze-btn .sub{ display:block; margin-top:6px; font-size:11px; font-weight:900; opacity:.9; }
.analyze-btn .icon{ display:inline-flex; align-items:center; justify-content:center; }
.analyze-btn::before{
  content:"";
  position:absolute;
  inset:-2px;
  background:linear-gradient(120deg, rgba(255,255,255,.18), transparent 35%, rgba(255,255,255,.10));
  transform: translateX(-40%) skewX(-12deg);
  opacity:.65;
  transition: transform .55s ease;
}
.analyze-btn:hover{ transform: translateY(-2px); box-shadow:0 18px 44px rgba(0,0,0,.45); }
.analyze-btn:hover::before{ transform: translateX(40%) skewX(-12deg); }

.analyze-btn.primary{
  color:#0b0b0b;
  background:linear-gradient(135deg,var(--gold),var(--gold2));
  box-shadow:0 16px 40px rgba(212,175,55,.18);
}
.analyze-btn.primary:hover{ filter:brightness(1.03); }

.analyze-btn.secondary{
  color:#fff;
  background:linear-gradient(135deg,#2d7dff,#6bdcff);
  box-shadow:0 16px 40px rgba(80,160,255,.16);
}
.analyze-btn.secondary:hover{ filter:brightness(1.03); }
.analyze-btn .sub{ display:block; margin-top:4px; font-size:11px; font-weight:900; opacity:.9; }

.log{ display:grid; gap:8px; }
.log-item{
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.28);
  border-radius:14px;
  padding:10px 12px;
  display:flex;
  justify-content:space-between;
  gap:10px;
  align-items:flex-start;
}
.log-date{ font-weight:900; color:#f5e27a; font-size:12px; white-space:nowrap; }
.log-text{ color:#cfcfcf; font-size:13px; line-height:1.45; flex:1; }

.faq details{ border:1px solid rgba(255,255,255,.08); background:rgba(0,0,0,.28); border-radius:14px; padding:10px 12px; }
.faq details + details{ margin-top:10px; }
.faq summary{ cursor:pointer; font-weight:900; color:#fff; list-style:none; }
.faq summary::-webkit-details-marker{ display:none; }
.faq .a{ margin-top:8px; color:#cfcfcf; font-size:13px; line-height:1.55; }

.vendor-header{
  max-width:1100px;
  margin:14px auto 10px;
  padding:16px 14px;
  text-align:center;
  border-radius:18px;
  background:rgba(18,18,18,.85);
  border:1px solid rgba(255,255,255,.06);
  box-shadow:0 10px 26px rgba(0,0,0,.45);
  backdrop-filter: blur(10px);
  position:relative;
  overflow:hidden;
}
.vendor-header::before{
  content:"";
  position:absolute;
  inset:-40px;
  background:radial-gradient(700px 240px at 50% 0%, rgba(212,175,55,.20), transparent 60%);
  pointer-events:none;
}
.vendor-header h2{ position:relative; margin:0; font-size:18px; font-weight:900; color:var(--gold2); letter-spacing:.2px; }
.vendor-header p{ position:relative; margin:6px 0 0; font-size:13px; color:#a7a7a7; }
.pill-row{ position:relative; display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin-top:12px; }
.pill{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:9px 12px;
  border-radius:999px;
  font-weight:900;
  text-decoration:none;
  color:#0b0b0b;
  background:linear-gradient(135deg,var(--gold),var(--gold2));
  border:1px solid rgba(255,255,255,.12);
}
.pill:hover{ filter:brightness(1.03); }
.pill.ghost{
  background:rgba(255,255,255,.08);
  color:#e8e8e8;
  border:1px solid rgba(255,255,255,.14);
}

.vendor-tools{
  position:sticky;
  top:10px;
  z-index:80;
  max-width:1100px;
  margin:0 auto 10px;
  padding:10px 14px 12px;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(12,12,14,.72);
  backdrop-filter: blur(14px);
  box-shadow:0 18px 50px rgba(0,0,0,.45);
}
.vendor-tools::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius:inherit;
  pointer-events:none;
  background: radial-gradient(600px 140px at 40% 0%, rgba(212,175,55,.10), transparent 60%);
  opacity:.9;
}
.vendor-tools > *{ position:relative; }
@media (max-width:640px){
  .vendor-tools{ top:0; margin:0 auto 8px; border-radius:0; border-left:none; border-right:none; }
  .v-controls{ gap:8px; align-items:stretch; }
  .v-control{ min-width: calc(50% - 4px); flex:1; }
  .v-input{ padding:12px 12px; font-size:14px; }
  .v-toggle{ width:100%; justify-content:space-between; padding:12px 12px; border-radius:14px; border:1px solid rgba(255,255,255,.10); background:rgba(0,0,0,.18); }
}
.v-input{ width:100%; padding:12px 12px; border-radius:14px; border:1px solid rgba(255,255,255,.10); background:rgba(0,0,0,.28); color:#fff; outline:none; font-weight:800; }
.v-row{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
.v-chip{ padding:9px 12px; border-radius:999px; border:1px solid rgba(255,255,255,.10); background:rgba(0,0,0,.25); color:#fff; font-weight:900; cursor:pointer; transition: transform .14s ease, filter .14s ease, border-color .14s ease; }
.v-chip:hover{ transform: translateY(-1px); filter:brightness(1.03); border-color: rgba(255,255,255,.16); }
.v-chip.active{ background:linear-gradient(135deg,var(--gold),var(--gold2)); color:#111; border-color:transparent; }

/* ===== 새 컨트롤(배찌 제거 버전) ===== */
.v-controls{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; align-items:flex-end; }
.v-control{ display:flex; flex-direction:column; gap:6px; min-width:120px; }
.v-control label{ font-size:12px; color:rgba(255,255,255,.68); font-weight:800; letter-spacing:-.2px; }
.v-select{
  width:100%;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.28);
  color:#fff;
  outline:none;
  font-weight:900;
}
.v-select:focus{
  border-color:rgba(255,215,112,.55);
  box-shadow:0 0 0 3px rgba(255,215,112,.12);
}
.v-toggle{
  display:flex;
  gap:10px;
  align-items:center;
  padding:10px 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.22);
  cursor:pointer;
  user-select:none;
}
.v-toggle input{ display:none; }
.v-switch{
  width:46px;
  height:26px;
  border-radius:999px;
  background:rgba(255,255,255,.14);
  position:relative;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.12);
  transition: background .15s ease;
}
.v-switch::after{
  content:"";
  width:22px;
  height:22px;
  border-radius:50%;
  background:rgba(255,255,255,.86);
  position:absolute;
  top:2px;
  left:2px;
  transition: transform .15s ease;
}
.v-toggle input:checked + .v-switch{
  background:linear-gradient(135deg,var(--gold),var(--gold2));
}
.v-toggle input:checked + .v-switch::after{
  transform: translateX(20px);
}
.v-toggle-text{ font-weight:900; font-size:12px; color:#fff; }
.v-small{ margin-top:8px; font-size:12px; color:#a7a7a7; }
#evAutoHint{ display:none; }

.vendor-grid{ position:relative; display:grid; gap:14px; padding:0 14px 10px; max-width:1100px; margin:0 auto; }
.vendor-grid::before{
  content:"";
  position:absolute;
  inset:-18px;
  background:
    radial-gradient(900px 320px at 50% 0%, rgba(212,175,55,.12), transparent 60%),
    radial-gradient(700px 320px at 10% 20%, rgba(90,160,255,.10), transparent 60%);
  pointer-events:none;
  z-index:0;
}
.vendor-grid > .card{ position:relative; z-index:1; }
@media(max-width:767px){ .vendor-grid{ grid-template-columns:repeat(2, 1fr); } }
@media(min-width:768px) and (max-width:1023px){ .vendor-grid{ grid-template-columns:repeat(3, 1fr); } }
@media(min-width:1024px){ .vendor-grid{ grid-template-columns:repeat(4, 1fr); } }

.card{
  background:rgba(18,18,18,.85);
  border:1px solid rgba(255,255,255,.06);
  border-radius:18px;
  box-shadow:0 10px 30px rgba(0,0,0,.55);
  overflow:hidden;
  cursor:pointer;
  backdrop-filter: blur(10px);
  transition: transform .16s ease, box-shadow .16s ease, border-color .16s ease, filter .16s ease;
}
.card:hover{
  transform: translateY(-4px);
  border-color: rgba(245,226,122,.22);
  box-shadow:0 16px 46px rgba(0,0,0,.62);
  filter:brightness(1.02);
}
.tag-badge{
  position:absolute;
  top:10px;
  left:10px;
  z-index:2;
  padding:6px 10px;
  border-radius:999px;
  font-size:11px;
  font-weight:900;
  border:1px solid rgba(255,255,255,.16);
  backdrop-filter: blur(10px);
}
.tag-badge.rec{
  color:#0b0b0b;
  background:linear-gradient(135deg,var(--gold),var(--gold2));
}
.tag-badge.new{
  color:#00121a;
  background:linear-gradient(135deg,#2d7dff,#6bdcff);
}
.tag-badge.ad{
  color:#fff;
  background:rgba(255,255,255,.10);
}
.img-box{
  position:relative;
  width:100%;
  aspect-ratio: 4 / 5;
  background:#000;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
}
.img-box::before{
  content:"";
  position:absolute;
  inset:-18px;
  background-image:var(--bgimg);
  background-size:cover;
  background-position:center;
  filter:blur(20px);
  opacity:.42;
}
.img-box::after{
  content:"";
  position:absolute;
  inset:0;
  background:linear-gradient(180deg,rgba(0,0,0,.12),rgba(0,0,0,.62));
}
.img-box picture, .img-box img{
  position:relative;
  z-index:1;
  width:100%;
  height:100%;
}
.img-box img{ object-fit:contain; }

.content{ padding:10px 10px 12px; }
.site{ font-size:15px; font-weight:900; }
.desc{
  margin-top:6px;
  font-size:12px;
  color:#bdbdbd;
  line-height:1.35;
  min-height:32px;
  display:-webkit-box;
  -webkit-line-clamp:2;
  -webkit-box-orient:vertical;
  overflow:hidden;
}

.perk{
  margin-top:8px;
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:6px 10px;
  border-radius:999px;
  background:rgba(212,175,55,.12);
  border:1px solid rgba(212,175,55,.20);
  color:#f2d56b;
  font-size:11px;
  font-weight:900;
  max-width:100%;
}
.perk-text{
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  max-width:100%;
}

.quick-cta{
  position:absolute;
  left:10px;
  right:10px;
  bottom:10px;
  z-index:2;
  display:flex;
  gap:8px;
  opacity:0;
  transform: translateY(8px);
  transition: opacity .16s ease, transform .16s ease;
}
.card:hover .quick-cta,
.card:focus-within .quick-cta{
  opacity:1;
  transform: translateY(0);
}
.qbtn{
  flex:1;
  border-radius:999px;
  padding:10px 10px;
  font-weight:900;
  font-size:12px;
  background:rgba(0,0,0,.55);
  border:1px solid rgba(255,255,255,.14);
  color:#fff;
  backdrop-filter: blur(8px);
  cursor:pointer;
  transition: filter .14s ease, transform .14s ease, border-color .14s ease;
}
.qbtn:hover{ filter:brightness(1.06); border-color:rgba(255,255,255,.22); }
.qbtn:active{ transform: translateY(1px); }
.qbtn.primary{
  background:linear-gradient(135deg,var(--gold),var(--gold2));
  border-color:rgba(0,0,0,.18);
  color:#111;
}
@media (hover:none){
  .quick-cta{ opacity:1; transform:none; }
  .qbtn{ padding:9px 10px; font-size:11px; }
}

.img-box img{
  transition: transform .18s ease;
}
.card:hover .img-box img{
  transform: scale(1.04);
}

.code{ margin-top:8px; font-size:12px; color:var(--gold2); font-weight:900; }


.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.75);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
  padding:18px;
}
.popup-box{
  background:rgba(17,17,17,.95);
  border:1px solid rgba(255,255,255,.08);
  border-radius:18px;
  padding:22px;
  width:100%;
  max-width:380px;
  text-align:center;
  box-shadow:0 18px 60px rgba(0,0,0,.75);
  backdrop-filter: blur(10px);
}
.popup-box h2{ color:var(--gold2); margin:0 0 10px; font-weight:900; }
.btn{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:12px;
  font-weight:900;
  cursor:pointer;
  text-decoration:none;
  display:block;
  user-select:none;
}
.go{ background:linear-gradient(135deg,var(--gold),var(--gold2)); color:#0b0b0b; }
.copy{ background:#1f1f1f; color:#fff; border:1px solid rgba(255,255,255,.06); }
.more{ background:rgba(255,255,255,.08); color:#fff; border:1px solid rgba(255,255,255,.12); }
.telegram a{ display:block; margin-top:10px; color:#45b3ff; text-decoration:none; font-weight:900; }

.reason-box{
  margin-top:12px;
  padding:10px 12px;
  border-radius:14px;
  background:rgba(0,0,0,.28);
  border:1px solid rgba(255,255,255,.08);
  text-align:left;
}
.reason-title{ font-weight:900; color:#f5e27a; font-size:12px; margin:0 0 8px; }
.reason-line{ font-size:12px; color:#ddd; line-height:1.5; }
.reason-line + .reason-line{ margin-top:4px; }

/* 하단 랜딩 링크 아주 작게 */
.landing-seo {
  max-width:1100px;
  margin:36px auto 20px;
  padding:0 14px;
}
.landing-seo h3{ font-size:10px; color:#777; margin:0 0 6px; font-weight:700; }
.landing-seo .links{ display:flex; flex-wrap:wrap; gap:6px; }
.landing-seo a{
  font-size:10px;
  color:#9a9a9a;
  text-decoration:none;
  padding:5px 7px;
  border-radius:8px;
  background:rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.06);
}
.landing-seo a:hover{ color:#f5e27a; border-color:#f5e27a; }

/* 플로팅 CTA */
.fab{
  position:fixed;
  right:14px;
  bottom:14px;
  z-index:1700;
  display:flex;
  flex-direction:column;
  gap:8px;
}
.fab a{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:12px 12px;
  border-radius:999px;
  font-weight:900;
  text-decoration:none;
  background:linear-gradient(135deg,#1da1f2,#78d6ff);
  color:#00121a;
  box-shadow:0 12px 30px rgba(0,0,0,.45);
}
.fab a.secondary{
  background:rgba(255,255,255,.08);
  color:#fff;
  border:1px solid rgba(255,255,255,.12);
}

@media (prefers-reduced-motion: reduce){
  *{ scroll-behavior:auto !important; }
  .header .logoImg, #loader img{ animation:none !important; }
  .analyze-btn::before{ display:none !important; }
  .card, .analyze-btn, .v-chip{ transition:none !important; }
}


/* ===== 카드 액션(공유) ===== */
.card-actions{
  display:flex;
  justify-content:flex-end;
  gap:8px;
  margin-top:10px;
}
.mini-share{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:8px 10px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.06);
  color:#fff;
  font-size:12px;
  font-weight:900;
  cursor:pointer;
  user-select:none;
  transition:transform .14s ease, filter .14s ease, border-color .14s ease;
}
.mini-share:hover{
  transform: translateY(-1px);
  filter: brightness(1.05);
  border-color: rgba(255,255,255,.18);
}

/* ===== 공유 팝업 ===== */
.share-sub{ margin:6px 0 12px; color:#a7a7a7; font-size:12px; }
.share-preview{
  border-radius:16px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(0,0,0,.28);
  padding:12px;
}
#shareCanvas{
  width:100%;
  height:auto;
  display:block;
  border-radius:14px;
}
.share-row{
  display:flex;
  gap:10px;
  margin-top:12px;
  align-items:center;
}
.share-row input{
  flex:1;
}
.share-actions{
  display:flex;
  gap:10px;
  margin-top:10px;
  flex-wrap:wrap;
}
.btn.share{
  background:linear-gradient(135deg, rgba(212,175,55,.95), rgba(255,204,82,.95));
  color:#111;
  border:1px solid rgba(0,0,0,.1);
}

/* ===== FAQ ===== */
.faq-wrap{
  max-width:1100px;
  margin:20px auto 26px;
  padding:0 14px;
}
.faq-box{
  border:1px solid rgba(255,255,255,.10);
  background:rgba(255,255,255,.04);
  border-radius:18px;
  overflow:hidden;
}
.faq-box summary{
  cursor:pointer;
  list-style:none;
  padding:14px 14px;
  font-weight:900;
  color:#fff;
  display:flex;
  justify-content:space-between;
  gap:10px;
}
.faq-box summary::-webkit-details-marker{ display:none; }
.faq-box summary span{ color:#bdbdbd; font-weight:900; }
.faq-box .a{
  padding:0 14px 14px;
  color:#cfcfcf;
  font-size:13px;
  line-height:1.55;
}
.faq-box details{
  border-top:1px solid rgba(255,255,255,.08);
}
.faq-box details:first-child{ border-top:none; }


/* ===== 로컬 인사이트(가짜 방문자 대신) ===== */
.insights-wrap{ max-width:1100px; margin:18px auto 36px; padding:0 14px; }
.insights-head{ display:flex; align-items:flex-end; justify-content:space-between; gap:10px; margin:12px 0 10px; }
.insights-head .h{ font-size:16px; font-weight:900; letter-spacing:-.2px; }
.insights-head .sub{ color:var(--muted); font-size:12px; line-height:1.4; }
.insights-grid{ display:grid; gap:14px; }
@media(max-width:767px){ .insights-grid{ grid-template-columns:1fr; } }
@media(min-width:768px) and (max-width:1023px){ .insights-grid{ grid-template-columns:1fr 1fr; } }
@media(min-width:1024px){ .insights-grid{ grid-template-columns:1.1fr .9fr .9fr; } }

.stat-card{ cursor:default; }
.stat-card:hover{ transform:none; border-color:rgba(255,255,255,.06); box-shadow:0 10px 30px rgba(0,0,0,.55); filter:none; }
.stat-top{ padding:14px 14px 8px; }
.stat-title{ font-weight:900; font-size:14px; display:flex; align-items:center; gap:8px; }
.stat-meta{ color:var(--muted); font-size:12px; margin-top:4px; line-height:1.35; }
.stat-list{ padding:8px 14px 14px; display:grid; gap:10px; }
.stat-item{ display:flex; justify-content:space-between; gap:10px; align-items:center; }
.stat-left{ display:flex; align-items:center; gap:10px; min-width:0; }
.stat-rank{ width:18px; text-align:center; color:#f5e27a; font-weight:900; font-size:12px; flex:0 0 auto; }
.stat-link{ background:transparent; border:0; padding:0; color:#fff; font-size:13px; font-weight:800; cursor:pointer; text-align:left; max-width:100%; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.stat-link:hover{ text-decoration:underline; }
.stat-count{ color:var(--muted); font-size:12px; font-weight:800; flex:0 0 auto; }
.stat-actions{ padding:0 14px 14px; display:flex; gap:10px; flex-wrap:wrap; }
.small-btn{
  padding:8px 10px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(255,255,255,.06);
  color:#fff;
  font-size:12px;
  font-weight:900;
  cursor:pointer;
  user-select:none;
}
.small-btn:hover{ filter:brightness(1.08); border-color:rgba(255,255,255,.16); }
.small-btn:active{ transform: translateY(1px); }
.note-mini{ color:var(--muted); font-size:12px; padding:0 14px 14px; line-height:1.35; }

</style>

<script>
/* ===== 카드 데이터 (card9 추가) ===== */
const CARD_DATA = {
  card1:{ title:"B WIN", code:"AS88", link:"https://bwk999.com", telegram:"UZU59",
    benefit:"고액전용 USDT 무기명가입 수수료지원 / 모든게임 입금플러스",
    notice:"가입코드 미입력 시 혜택 적용 불가" },
  card2:{ title:"CAPS", code:"RUST", link:"https://caps-22.com", telegram:"UZU59",
    benefit:"고액전용 미겜 첫충 5% / 페이백 5% / 출석 30만원",
    notice:"가입코드 미입력 시 혜택 적용 불가" },
  card3:{ title:"BETZY", code:"BANGU", link:"https://b88-et.com", telegram:"UZU59",
    benefit:"스포츠 첫 10% / 미겜 첫 5% / 페이백 5%",
    notice:"가입코드 미입력 시 혜택 적용 불가" },
  card4:{ title:"VEGAS", code:"6789", link:"https://las403.com", telegram:"UZU59",
    benefit:"스포츠·미겜 입플 최대 30% / 카지노 입플",
    notice:"가입코드 미입력 시 혜택 적용 불가" },
  card5:{ title:"LULA BET", code:"ZZ99", link:"https://lula.ws", telegram:"PSC991",
    benefit:"원화·USDT 무기명가입 / 페이백 10%",
    notice:"가입코드 미입력 시 혜택 적용 불가" },
  card6:{ title:"CHOY BET", code:"TAN", link:"https://cy-40.com", telegram:"DY0302",
    benefit:"신규 30% / 매충 10% / 페이백 10%",
    notice:"가입코드 미입력 시 혜택 적용 불가" },

  card7:{ title:"광고/제휴 모집", code:"", link:"", telegram:"UZU59",
    benefit:"88 커뮤니티에 광고/제휴를 원하시면 문의 주세요.",
    notice:"광고 문의는 텔레그램 @UZU59 로만 진행합니다." },

  card8:{ title:"광고 자리 오픈", code:"", link:"", telegram:"UZU59",
    benefit:"배너/카드 광고 자리 오픈 · 합리적 조건",
    notice:"사칭 주의: 공식 관리자 @UZU59 단 하나" },

  card9:{ title:"RIO", code:"opop", link:"https://rio2.casino/?b=OPOP", telegram:"Aven47",
    benefit:"카지노 입플/페이백 중심 · 고액 유저 기준 혜택 안내",
    notice:"가입코드 미입력 시 혜택 적용이 어려울 수 있습니다." },
  card10:{ title:"RED HULK", code:"HERO", link:"https://rhk-777.com", telegram:"SDTR8",
    benefit:"신규 30% / 매충 10% / 페이백5% 콤프(1%/3%)%",
    notice:"가입코드 미입력 시 혜택 적용 불가" },
   card11:{ title:"TOP GUN", code:"GAS7", link:"https://topgun-88.com", telegram:"SDTR8",
    benefit:"신규 30% / 매충 10% / 페이백5% 콤프(1%/3%)%",
    notice:"가입코드 미입력 시 혜택 적용 불가" },
};

/* ===== 인사이트 (종목별) ===== */
const INSIGHTS_BY_SPORT = {
  "축구":[
    "배당이 1~2시간 내 급변하면 라인 조정 구간일 수 있습니다.",
    "무승부 배당이 갑자기 내려가면 시장은 '언더/조심'을 보는 경우가 많습니다.",
    "양팀 득점(BTTS) 라인이 흔들리면 선발/부상 뉴스 반영 가능성이 큽니다.",
    "전반 라인이 움직이면 초반 템포(압박/로테이션)를 체크하세요."
  ],
  "농구":[
    "핸디(스프레드)가 크게 움직이면 핵심 선수 결장/로테 반영일 수 있습니다.",
    "OU(언더오버) 하락은 페이스 다운/수비 지표 반영 가능성이 큽니다.",
    "백투백 일정은 4Q 클러치에서 체력 영향이 큽니다.",
    "홈코트 이점이 큰 팀은 초반 라인이 유리하게 잡히는 경우가 많습니다."
  ],
  "야구":[
    "선발 변경은 배당 구조가 통째로 바뀌니 최신 라인을 우선 확인하세요.",
    "불펜 소모가 큰 팀은 후반 이닝 변동성이 큽니다.",
    "바람/구장 특성은 OU에 크게 영향을 줍니다.",
    "승패보다 5이닝(1st5) 라인이 더 깔끔할 때가 있습니다."
  ],
  "배구":[
    "세트 핸디가 흔들리면 주전 로테/컨디션 이슈 가능성이 있습니다.",
    "서브/리시브 지표 차이가 크면 언더독도 세트를 가져갈 수 있습니다.",
    "원정 장거리 이동은 집중력 이슈로 초반 세트에 영향을 줄 수 있습니다.",
    "전력 차가 크면 OU보다 -1.5 세트가 더 안정적일 때가 있습니다."
  ],
  "e스포츠":[
    "맵 풀/밴픽 상성이 라인보다 중요할 때가 많습니다.",
    "로스터 교체 직후는 변동성이 커서 보수적으로 접근하세요.",
    "언더독이 특정 맵에서 강하면 세트/맵 핸디를 확인하세요.",
    "최근 5경기보다 상대전적/메타 적응력을 같이 보세요."
  ],
  "하키":[
    "골리(선발 골텐더) 변경은 승/OU에 큰 영향이 있습니다.",
    "백투백 원정은 수비 붕괴로 고득점 게임이 나올 수 있습니다.",
    "파워플레이 효율 차이는 언더독 변수로 작용합니다.",
    "초반 10분 라인이 흔들리면 경기 템포 이슈 가능성이 큽니다."
  ]
};

/* ===== 유틸: GA 이벤트/UTM 저장/UTM 붙이기 ===== */
const UTM_KEYS = ["utm_source","utm_medium","utm_campaign","utm_term","utm_content"];
function track(evt, params) {
  // GA4 event helper
  try {
    if (typeof window.gtag !== "function") return;

    const p = Object.assign({}, (params || {}));

    // DebugView toggle: add ?debug=1 or set localStorage "ga_debug" = "1"
    const sp = new URLSearchParams(location.search);
    const dbg = (sp.get("debug") === "1") || (localStorage.getItem("ga_debug") === "1");
    if (dbg && p.debug_mode === undefined) p.debug_mode = true;

    // Helpful common context (lightweight)
    if (p.page_path === undefined) p.page_path = location.pathname;
    if (p.page_title === undefined && document && document.title) p.page_title = document.title.slice(0, 80);

    // Backward/forward compatible parameter normalization (keep original keys too)
    if (evt === "cta_click") {
      if (p.cta && p.cta_id === undefined) p.cta_id = p.cta;
    }
    if (evt === "outbound_click") {
      if (p.type && p.outbound_type === undefined) p.outbound_type = p.type;
      if (p.destination_domain === undefined && typeof p.url === "string") {
        try { p.destination_domain = (new URL(p.url, location.href)).hostname; } catch(e) {}
      }
    }
    if (evt === "card_open") {
      if (p.title && p.card_title === undefined) p.card_title = p.title;
      if (p.tag && p.card_tag === undefined) p.card_tag = p.tag;
    }
    if (evt === "search") {
      if (p.search_term && p.query === undefined) p.query = p.search_term;
    }

    window.gtag("event", evt, p);
  } catch (e) {}
}
function saveUtmFromUrl() {
  const sp = new URLSearchParams(location.search);
  let has=false;
  const obj={};
  UTM_KEYS.forEach(k=>{
    const v = sp.get(k);
    if(v){ obj[k]=v; has=true; }
  });
  if(has){
    obj.__ts = Date.now();
    localStorage.setItem("88_utm", JSON.stringify(obj));
  }
}
function getUtmQuery() {
  try {
    const raw = localStorage.getItem("88_utm");
    if(!raw) return "";
    const obj = JSON.parse(raw);
    if(!obj || !obj.__ts) return "";
    // 14일 유지
    const TTL = 14*24*60*60*1000;
    if(Date.now() - obj.__ts > TTL) return "";
    const sp = new URLSearchParams();
    UTM_KEYS.forEach(k=>{ if(obj[k]) sp.set(k, obj[k]); });
    const qs = sp.toString();
    return qs ? ("?"+qs) : "";
  } catch(e) { return ""; }
}
function appendUtm(urlStr) {
  try {
    const u = new URL(urlStr, location.href);
    const existing = new URLSearchParams(u.search);
    const stored = new URLSearchParams(getUtmQuery().replace(/^\?/,""));
    UTM_KEYS.forEach(k=>{
      if(!existing.get(k) && stored.get(k)) existing.set(k, stored.get(k));
    });
    u.search = existing.toString();
    return u.toString();
  } catch(e) {
    return urlStr;
  }
}
</script>

<script>
  // ===== Site Config (EDIT THESE) =====
  // GA4_ID: GA4 Measurement ID (예: G-XXXXXXXXXX)
  // POPULAR_API: 전체 사용자 인기 데이터를 반환하는 API 엔드포인트(예: /api/popular)
  //   - 연동 전에는 비워두면(또는 "disabled") 로컬 집계(내 브라우저 기준)로만 표시됩니다.
  window.SITE_CONFIG = window.SITE_CONFIG || {
    GA4_ID: "G-KWT87FBY6S",
    POPULAR_API: "disabled"
  };

  // ===== GA4 bootstrap (dynamic inject) =====
  (function initGA4(){
    try{
      const id = (window.SITE_CONFIG && window.SITE_CONFIG.GA4_ID) || "";
      if(!id || id === "disabled" || /^G-XXXX/i.test(id) || id === "G-XXXXXXXXXX") return;

      // 이미 gtag 로드되어 있으면 중복 로드 방지
      if(document.querySelector('script[src*="gtag/js?id=' + encodeURIComponent(id) + '"]')) return;
      

      const s = document.createElement("script");
      s.async = true;
      s.src = "https://www.googletagmanager.com/gtag/js?id=" + encodeURIComponent(id);
      document.head.appendChild(s);

      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      window.gtag = window.gtag || gtag;
      gtag("js", new Date());
      gtag("config", id, { send_page_view: true });
    }catch(e){}
  })();
</script>

</head>

<body>

<div class="notice-bar">
  <a id="noticeLink" href="https://t.me/UZU59" target="_blank" rel="noopener">
    <span id="noticeText"></span>
  </a>
</div>

<div id="loader" aria-hidden="true">
  <div class="logoWrap">
    <img src="img/logo.png" alt="88 로고 로딩">
  </div>
  <div class="text">Loading...</div>
</div>

<div class="scam-popup" id="scamPopup" role="dialog" aria-modal="true" aria-label="사칭 주의 안내">
  <div class="scam-box">
    <h3>⚠️ 사칭 주의 안내</h3>
    <p>
      88 커뮤니티 공식 관리자 텔레그램은<br>
      <b>@UZU59</b> 단 하나입니다.<br><br>
      그 외 계정은 사칭일 수 있으니<br>
      반드시 주의해 주세요.
    </p>
    <div class="btn" onclick="closeScam()">확인</div>
  </div>
</div>

<h1 style="position:absolute;left:-9999px;">스포츠 배당 분석기와 배당 마진 계산기 | 88</h1>

<div class="header">
  <a class="logoLink" href="/" aria-label="홈으로 이동">
    <img class="logoImg" src="img/logo.png" alt="88 커뮤니티 로고">
  </a>
  <div class="sub">배당 마진·EV·확률을 10초 만에 — 분석부터 선택까지 한 번에.</div>
</div>

<div class="section-wrap">

  <!-- 메인 루트: 분석기 사용 -->
  <div class="section" id="analyzerSection">
    <div class="title"><span class="badge">MAIN</span>스포츠 배당 분석기</div>
    <div class="text">
      배당 흐름·마진(오버라운드)·EV를 <b>초간단</b>으로 확인하는 도구입니다.
      <span style="display:block;color:#9a9a9a;font-size:12px;margin-top:6px;">※ 도구는 참고용이며 결과를 보장하지 않습니다.</span>
    </div>
    <div class="cta-row">
      <a class="analyze-btn primary" href="/analysis/" data-cta="analysis">
        <span class="icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 3v18h18"></path>
            <path d="M7 14l3-3 3 2 5-6"></path>
          </svg>
        </span>
        <span class="label">분석기 사용<span class="sub">무료 · 초간단 · EV 확인</span></span>
      </a>
      <a class="analyze-btn secondary" href="#vendorTop" data-cta="vendors">
        <span class="icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 2l3 7 7 3-7 3-3 7-3-7-7-3 7-3 3-7z"></path>
          </svg>
        </span>
        <span class="label">인증놀이터 보기<span class="sub">카드 · 검색 · 인기순</span></span>
      </a>
    </div>
  </div>

  <div class="two-col">
    <div class="col">

      <div class="section">
        <div class="title"><span class="badge">TODAY</span>오늘의 인사이트</div>
        <div class="text" id="insight"></div>

        <div class="insight-row">
          <select class="insight-select" id="insightSport" aria-label="종목 선택">
            <option value="축구">축구</option>
            <option value="농구">농구</option>
            <option value="야구">야구</option>
            <option value="배구">배구</option>
            <option value="e스포츠">e스포츠</option>
            <option value="하키">하키</option>
          </select>
          <button class="insight-btn" type="button" onclick="refreshInsight()">인사이트 새로고침</button>
        </div>

        <div class="text" style="margin-top:8px;color:#9a9a9a;font-size:12px;">
          ※ 종목 선택은 참고용이며, 실제 결과를 보장하지 않습니다.
        </div>
      </div>

      <div class="section">
        <div class="title"><span class="badge">CHECK</span>배팅 전 체크리스트</div>
        <div class="text" id="checklistText"></div>
        <button class="insight-btn" type="button" onclick="refreshChecklist()" style="margin-top:10px;">체크리스트 새로고침</button>
        <div class="text" style="margin-top:8px;color:#9a9a9a;font-size:12px;">
          ※ 과몰입 방지/리스크 관리용 안내입니다.
        </div>
      </div>

      <div class="section">
        <div class="title"><span class="badge">TOOL</span>배당 마진 계산기 (초간단)</div>
        <div class="text" style="margin-bottom:10px;">
          배당을 입력하면 <b>북메이커 마진(수수료)</b>을 계산합니다. (참고용)
        </div>

        <div class="seg-row" role="tablist" aria-label="마진 계산기 유형">
          <button class="seg active" type="button" id="mMode2" onclick="setMarginMode('2')">2-way (승/패)</button>
          <button class="seg" type="button" id="mMode3" onclick="setMarginMode('3')">3-way (홈/무/원정)</button>
        </div>

        <div id="margin2" style="display:block;">
          <div style="display:grid; gap:10px;">
            <input id="m2A" inputmode="decimal" placeholder="승 배당 (예: 1.85)">
            <input id="m2B" inputmode="decimal" placeholder="패 배당 (예: 2.05)">
          </div>
        </div>

        <div id="margin3" style="display:none;">
          <div style="display:grid; gap:10px;">
            <input id="m3H" inputmode="decimal" placeholder="홈 배당 (예: 1.85)">
            <input id="m3D" inputmode="decimal" placeholder="무 배당 (예: 3.40)">
            <input id="m3A" inputmode="decimal" placeholder="원정 배당 (예: 4.20)">
          </div>
        </div>

        <button class="insight-btn" type="button" onclick="calcSimpleMargin()" style="margin-top:10px;">마진 계산</button>
        <div class="text" id="simpleMarginResult" style="font-weight:900;color:#f5e27a;margin-top:8px;"></div>
        <div class="text" id="simpleMarginHint" style="color:#bdbdbd;font-size:12px;"></div>
      </div>

    </div>

    <div class="col">

      <div class="section">
        <div class="title"><span class="badge">GUIDE</span>분석기 사용법 (초간단)</div>
        <div class="text">
          ① 종목 선택 → ② 배당 입력 → ③ 결과 확인<br>
          확률·배당 흐름·마진·EV를 한 번에 확인합니다.<br>
          ※ 분석기는 참고용입니다.
        </div>
      </div>

      <div class="section">
        <div class="title"><span class="badge">LOG</span>최근 업데이트</div>
        <div class="log" id="updateLog"></div>
        <div class="text" style="margin-top:10px;color:#9a9a9a;font-size:12px;">
          ※ 업데이트 내용은 운영 상황에 따라 변경될 수 있습니다.
        </div>
      </div>

      <div class="section faq" id="faq">
        <div class="title"><span class="badge">FAQ</span>자주 묻는 질문</div>

        <details>
          <summary>분석기/마진 계산기 결과가 무조건 맞나요?</summary>
          <div class="a">아니요. 본 도구는 배당/마진을 정리하는 <b>참고 도구</b>입니다. 적중을 보장하지 않으며 최종 판단은 본인 책임입니다.</div>
        </details>

        <details>
          <summary>공식 관리자(문의) 텔레그램은 어디인가요?</summary>
          <div class="a">공식 관리자 텔레그램은 <b>@UZU59</b> 단 하나입니다. 유사 계정은 사칭일 수 있으니 주의하세요.</div>
        </details>

        <details>
          <summary>광고/제휴 문의는 어떻게 하나요?</summary>
          <div class="a">아래 업체 카드 중 <b>광고/제휴</b> 카드를 클릭하면 문의용 텔레그램으로 연결됩니다.</div>
        </details>

        <details>
          <summary>가입코드(추천코드)를 꼭 입력해야 하나요?</summary>
          <div class="a">대부분 업체는 <b>가입 시 최초 1회</b>만 입력 가능하며, 미입력/삭제 시 혜택 적용이 어려울 수 있습니다.</div>
        </details>
      </div>

    </div>
  </div>

  <div class="section">
    <div class="title"><span class="badge">88</span>추천 기준</div>

    <div class="text">
      88은 단순히 링크를 모아두는 추천 페이지가 아닙니다.<br>
      사용자 의견과 운영 이력을 바탕으로, 장기적으로 문제 없이 이용 가능한 정보만 정리합니다.
    </div>

    <ul class="text" style="margin:10px 0 0; padding-left:18px;">
      <li>운영 안정성 및 장기 운영 이력</li>
      <li>조건/안내(혜택·코드) 명확성</li>
      <li>문의 및 대응 가능 여부</li>
      <li>이슈 발생 시 해결 가능성(커뮤니티 피드백)</li>
    </ul>

    <p class="text" style="margin-top:10px;">
      이 공간은 특정 업체를 강요하지 않고, 각자의 기준에 맞는 선택을 돕기 위한 안내를 목표로 합니다.
    </p>
  </div>

</div>

<div class="vendor-header" id="vendorTop">
  <h2>88 인증 놀이터</h2>
  <p>필요한 정보만 빠르게 확인할 수 있도록 정리했습니다</p>
  <div class="pill-row" aria-label="빠른 이동">
    <a class="pill" href="/analysis/" data-cta="vendor_to_analysis">분석기 바로가기</a>
    <a class="pill" href="#vendorGrid" data-cta="vendor_to_grid">카드 바로보기</a>
  </div>
</div>

<div class="vendor-tools" aria-label="카드 검색 및 필터">
  <input id="searchInput" class="v-input" placeholder="업체 검색 (예: CAPS, VEGAS, 페이백, USDT)" autocomplete="off">
  <div class="v-controls" aria-label="필터 및 정렬">
    <div class="v-control">
      <label for="filterSelect">카테고리</label>
      <select id="filterSelect" class="v-select">
        <option value="all">전체</option>
        <option value="rec">추천</option>
        <option value="new">신규</option>
        <option value="ad">광고/제휴</option>
      </select>
    </div>

    <div class="v-control">
      <label for="sortSelect">정렬</label>
      <select id="sortSelect" class="v-select">
        <option value="default">기본</option>
        <option value="pop">인기순</option>
      </select>
    </div>

    <label class="v-toggle" for="cleanToggle" aria-label="정제된 문구 토글">
      <input type="checkbox" id="cleanToggle">
      <span class="v-switch" aria-hidden="true"></span>
      <span class="v-toggle-text">정제된 문구</span>
    </label>
  </div>
  <div class="v-small" id="evAutoHint"></div>
  <div class="v-small" id="cleanHint">정제된 문구: 카드 혜택 문구를 짧고 깔끔하게 보여줍니다.</div>
</div>

<div class="vendor-grid" id="vendorGrid"></div>


<div class="insights-wrap" id="insights">
  <div class="insights-head">
    <div>
      <div class="h" id="insightHeadline">오늘의 인기</div>
      <div class="sub">방문자 수 대신, <b>이 사이트에서 실제로 많이 본/많이 검색한 항목</b>을 보여줍니다. </div>
    </div>
  </div>

  <div class="insights-grid">
    <div class="card stat-card" aria-label="오늘 많이 본 키워드">
      <div class="stat-top">
        <div class="stat-title">오늘 많이 본 키워드</div>
        <div class="stat-meta" id="insightKwMeta">검색창에 입력한 키워드 기준으로 집계됩니다. (데이터가 쌓이면 자동 갱신)</div>
      </div>
      <div class="stat-list" id="insightKeywords"></div>
</div>

    <div class="card stat-card" aria-label="오늘 많이 본 카드">
      <div class="stat-top">
        <div class="stat-title">오늘 많이 본 카드 TOP 5</div>
        <div class="stat-meta" id="insightCardMeta">카드 상세를 열어본 횟수 기준입니다. (로컬 집계)</div>
      </div>
      <div class="stat-list" id="insightCards"></div>
      <div class="note-mini">※ “인기순” 정렬은 카드 클릭 누적 기반, 이 영역은 “오늘 열람” 기반입니다.</div>
    </div>

    <div class="card stat-card" aria-label="빠른 도구">
      <div class="stat-top">
        <div class="stat-title">빠른 도구</div>
        <div class="stat-meta">자주 쓰는 계산기를 바로 실행하세요.</div>
      </div>
      <div class="stat-actions">
        <a class="small-btn" href="/analysis/" data-cta="quick_analysis">분석기</a>
        <a class="small-btn" href="/tool-margin/" data-cta="quick_margin">마진</a>
        <a class="small-btn" href="/tool-ev/" data-cta="quick_ev">EV</a>
        <a class="small-btn" href="/tool-odds/" data-cta="quick_odds">확률</a>
      </div>
      <div class="note-mini">팁: 라인/배당 흐름은 “기록(로그)”이 쌓여야 의미가 커집니다. 다음 업데이트에서 베팅 로그/대시보드를 붙이면 재방문이 확 올라갑니다.</div>
    </div>
  </div>
</div>



<div class="popup" id="cardPopup" role="dialog" aria-modal="true" aria-label="업체 상세">
  <div class="popup-box" role="document">
    <h2 id="pTitle"></h2>

    <p id="codeRow">가입코드 : <b id="pCode"></b></p>
    <p id="pBenefit" style="color:#f5e27a;font-size:13px;margin:10px 0 0;"></p>
    <p id="pNotice" style="color:#ff6b6b;font-size:12px;margin:8px 0 0;"></p>

    <div class="btn copy" id="copyBtn">가입코드 복사</div>
    <div class="btn share" id="shareBtn">공유하기</div>
    <a class="btn go" id="pLink" target="_blank" rel="noopener">사이트 이동</a>

    <div class="telegram">
      <a id="pTelegram" target="_blank" rel="noopener">텔레그램 문의</a>
    </div>

    <div class="btn more" id="moreRecBtn">다른 추천도 보기</div>

    <div class="reason-box" id="reasonBox" style="display:none;">
      <div class="reason-title" id="reasonTitle">안내</div>
      <div class="reason-line" id="reason1"></div>
      <div class="reason-line" id="reason2"></div>
      <div class="reason-line" id="reason3"></div>
    </div>

    <div class="btn copy" id="closeBtn">닫기</div>
  
</div>
</div>

<div class="popup" id="sharePopup" role="dialog" aria-modal="true" aria-label="공유 카드" style="display:none;">
  <div class="popup-box" role="document">
    <h2>공유하기</h2>
    <p class="share-sub">링크를 복사하거나, 이미지로 저장해서 공유할 수 있습니다.</p>

    <div class="share-preview">
      <canvas id="shareCanvas" width="1080" height="1080" aria-label="공유 이미지 미리보기"></canvas>
    </div>

    <div class="share-row">
      <input id="shareLink" class="v-input" readonly aria-label="공유 링크">
      <div class="btn copy" id="copyShareLinkBtn" style="min-width:120px;">링크 복사</div>
    </div>

    <div class="share-actions">
      <div class="btn go" id="downloadShareImgBtn">이미지 저장</div>
      <div class="btn copy" id="copyShareTextBtn">문구 복사</div>
    </div>

    <div class="btn copy" id="closeShareBtn">닫기</div>
  </div>
</div>

<div class="landing-seo">
  <h3>관련 정보</h3>
  <div class="links">
    <a href="/tool-margin/" data-cta="seo_margin">배당 마진 계산기</a>
    <a href="/tool-ev/" data-cta="seo_ev">EV 계산기</a>
    <a href="/tool-odds/" data-cta="seo_odds">배당↔확률 변환</a>
    
    <a href="/landing-a/">입플·보너스 분석기</a>
    <a href="/landing-b/">고액 유저 안내</a>
    <a href="/landing-c/">배당 마진·EV 계산</a>
    <a href="/landing-d/">배당 흐름 분석</a>
  </div>
</div>




<script type="application/ld+json" id="faqJsonLd">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "배당 마진(오버라운드)이 높으면 왜 불리한가요?",
      "acceptedAnswer": { "@type": "Answer", "text": "각 결과의 암시 확률 합이 100%를 넘는 만큼(오버라운드), 장기 기대값이 낮아집니다. 같은 추정 실력이라도 마진이 낮은 시장이 더 유리합니다." }
    },
    {
      "@type": "Question",
      "name": "EV(기대값) 계산은 어떻게 해석하나요?",
      "acceptedAnswer": { "@type": "Answer", "text": "추정 승률이 손익분기점(1/배당)보다 높으면 +EV, 낮으면 -EV입니다. 단기 결과와 별개로 장기 평균 관점의 지표입니다." }
    },
    {
      "@type": "Question",
      "name": "정제된 문구는 무엇이 달라지나요?",
      "acceptedAnswer": { "@type": "Answer", "text": "카드 혜택 문구를 요약/정리해 과도한 문장·중복 표현을 줄입니다. 가독성을 높이기 위한 표시 방식입니다." }
    },
    {
      "@type": "Question",
      "name": "결과를 공유하면 링크를 받은 사람도 같은 화면을 보나요?",
      "acceptedAnswer": { "@type": "Answer", "text": "공유 링크에는 해당 카드 ID가 포함되어, 접속 시 같은 업체 상세 팝업이 자동으로 열리도록 설계했습니다." }
    },
    {
      "@type": "Question",
      "name": "이 도구의 결과가 정답인가요?",
      "acceptedAnswer": { "@type": "Answer", "text": "아닙니다. 본 페이지는 정보 제공 및 리스크 관리 참고용입니다. 실제 결과를 보장하지 않으며, 과몰입을 피하고 책임감 있게 이용해 주세요." }
    }
  ]
}
</script>

<div class="fab" aria-label="빠른 이동">
  <a href="/analysis/" data-cta="fab_analysis">분석기</a>
  <a class="secondary" href="#vendorTop" data-cta="fab_vendors">놀이터</a>
</div>

<script>
/* ===== 로딩 화면 닫기(안전장치 포함) ===== */
function hideLoader() {
  const l = document.getElementById("loader");
  if(!l) return;
  l.classList.add("hide");
  setTimeout(()=>{ if(l && l.remove) l.remove(); }, 450);
}
window.addEventListener("load", hideLoader);
setTimeout(hideLoader, 2500);

/* ===== 날짜 키(로컬) ===== */
function dateKeyLocal() {
  const d = new Date();
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,"0");
  const day = String(d.getDate()).padStart(2,"0");
  return `${y}-${m}-${day}`;
}

/* ===== 사칭주의 팝업 (1일 1회) ===== */
(function() {
  const key="scam_popup_date";
  const today=dateKeyLocal();
  const el = document.getElementById("scamPopup");
  if(!el) return;
  if(localStorage.getItem(key)!==today) {
    el.style.display="flex";
  }
})();
function closeScam() {
  const today=dateKeyLocal();
  localStorage.setItem("scam_popup_date", today);
  const el = document.getElementById("scamPopup");
  if(el) el.style.display="none";
  track("scam_popup_close", {"page":"index"});
}

/* ===== 상단 공지 배너 자동 순환 ===== */
const NOTICE_LIST = [
  "🔔 88 공식 안내 · 관리자 사칭 주의 (@UZU59)",
  "📊 스포츠 배당 분석기 무료 제공 중",
  "🧮 배당 마진 계산기로 수수료 체크",
  "⭐ 인증 정보는 아래 카드에서 확인",
  "⚠️ 가입코드 미입력 시 혜택 적용 불가"
];
let noticeIndex = 0;
const noticeTextEl = document.getElementById("noticeText");
function rotateNotice() {
  if(noticeTextEl) noticeTextEl.innerText = NOTICE_LIST[noticeIndex];
  noticeIndex = (noticeIndex + 1) % NOTICE_LIST.length;
}
rotateNotice();
setInterval(rotateNotice, 4000);

/* ===== 인사이트 ===== */
function pickInsight(sport) {
  const arr = INSIGHTS_BY_SPORT[sport] || [];
  if(!arr.length) return "배당 흐름을 체크하고 라인 변화를 확인하세요.";
  return arr[Math.floor(Math.random()*arr.length)];
}
function refreshInsight() {
  const sEl = document.getElementById("insightSport");
  const sport = sEl ? sEl.value : "축구";
  const out = document.getElementById("insight");
  if(out) out.innerText = pickInsight(sport);
  localStorage.setItem("insightSport", sport);
}
(function initInsight() {
  const saved = localStorage.getItem("insightSport");
  const sel = document.getElementById("insightSport");
  if(saved && sel) sel.value = saved;
  refreshInsight();
})();

/* ===== 업데이트 로그 ===== */
const UPDATE_LOG = [
  { date:"02/01", text:"메인 CTA(분석기/놀이터) 정리" },
  { date:"02/01", text:"이미지 webp + lazy 로딩 지원" },
  { date:"02/01", text:"팝업 2차 CTA 추가(다른 추천도 보기)" }
];
(function renderLog() {
  const box = document.getElementById("updateLog");
  if(!box) return;
  box.innerHTML = UPDATE_LOG.map(x=>`
    <div class="log-item">
      <div class="log-date">${x.date}</div>
      <div class="log-text">${x.text}</div>
    </div>
  `).join("");
})();


/* ===== 체크리스트 ===== */
const CHECKLIST_POOL = [
  "라인 급변 경기(갑자기 내려간 배당)는 이유부터 확인하기",
  "마진(수수료) 높은 경기면 한 단계 보수적으로 접근하기",
  "1회 배팅금은 자본의 1~3% 범위로 제한하기",
  "선발/결장/로테 뉴스 체크 후 배당 변동 재확인하기",
  "연패/연승 팀은 ‘시장 과열’ 구간인지 먼저 보기",
  "변동성 큰 리그는 단폴/소액으로 테스트하기",
  "무리한 마틴/추격 배팅은 금지(손실 제한선 미리 설정)"
];
function refreshChecklist() {
  const pool = [...CHECKLIST_POOL].sort(()=>Math.random()-0.5);
  const pick = pool.slice(0,3);
  const el = document.getElementById("checklistText");
  if(el) el.innerHTML = "• " + pick.join("<br>• ");
}

/* ===== 마진 계산기 ===== */
let marginMode = "2";
function setMarginMode(mode) {
  marginMode = mode;
  const b2=document.getElementById("mMode2");
  const b3=document.getElementById("mMode3");
  const w2=document.getElementById("margin2");
  const w3=document.getElementById("margin3");
  if(!b2||!b3||!w2||!w3) return;
  if(mode==="2") {
    b2.classList.add("active"); b3.classList.remove("active");
    w2.style.display="block"; w3.style.display="none";
  } else {
    b3.classList.add("active"); b2.classList.remove("active");
    w3.style.display="block"; w2.style.display="none";
  }
}
function toNum(v) {
  const n = Number(String(v).replace(/,/g,"").trim());
  return Number.isFinite(n) ? n : NaN;
}
function calcSimpleMargin() {
  const out = document.getElementById("simpleMarginResult");
  const hint = document.getElementById("simpleMarginHint");
  if(!out||!hint) return;

  if(marginMode==="2") {
    const a=toNum(document.getElementById("m2A").value);
    const b=toNum(document.getElementById("m2B").value);
    if([a,b].some(x=>!Number.isFinite(x)||x<=1)) {
      out.innerText="배당 2개를 정확히 입력해 주세요. (1.01 이상)";
      hint.innerText="";
      return;
    }
    const imp = (1/a)+(1/b);
    const margin = (imp-1)*100;
    const fair = 1/imp;
    const pA=(1/a)*fair*100, pB=(1/b)*fair*100;
    out.innerText=`마진(수수료) : ${margin.toFixed(2)}%`;
    hint.innerHTML=`정규화 확률(참고): 승 ${pA.toFixed(1)}% / 패 ${pB.toFixed(1)}%<br>마진이 낮을수록 유리`;
  } else {
    const h=toNum(document.getElementById("m3H").value);
    const d=toNum(document.getElementById("m3D").value);
    const a=toNum(document.getElementById("m3A").value);
    if([h,d,a].some(x=>!Number.isFinite(x)||x<=1)) {
      out.innerText="배당 3개를 정확히 입력해 주세요. (1.01 이상)";
      hint.innerText="";
      return;
    }
    const imp=(1/h)+(1/d)+(1/a);
    const margin=(imp-1)*100;
    const fair=1/imp;
    const pH=(1/h)*fair*100, pD=(1/d)*fair*100, pA=(1/a)*fair*100;
    out.innerText=`마진(수수료) : ${margin.toFixed(2)}%`;
    hint.innerHTML=`정규화 확률(참고): 홈 ${pH.toFixed(1)}% / 무 ${pD.toFixed(1)}% / 원정 ${pA.toFixed(1)}%<br>마진이 낮을수록 유리`;
  }
}

/* ===== 카드 메타(필터/정렬용) ===== */
(function enrichCards() {
  const set = (id, patch)=>{ CARD_DATA[id] = Object.assign({tag:"rec", priority:"normal", recruit:false, reasons:[]}, CARD_DATA[id], patch); };

  set("card1", {tag:"rec", priority:"high", reasons:["운영 이력 중심 선별", "조건(입플/수수료) 안내가 명확", "문의 채널이 고정"]});
  set("card2", {tag:"rec", priority:"high", reasons:["혜택 구성(첫충/페이백) 확인 용이", "리워드형 혜택 포함", "문의 라인이 명확"]});
  set("card3", {tag:"rec", priority:"high", reasons:["스포츠/미겜 첫충 + 페이백", "조건/코드 안내가 명확", "커뮤니티 피드백 반영"]});
  set("card4", {tag:"rec", priority:"normal", reasons:["입플 폭이 넓어 선택지 다양", "혜택 분리 안내", "문의 채널 고정"]});
  set("card5", {tag:"new", priority:"normal", reasons:["원화/USDT 선택 가능", "페이백 비중 높은 편", "고액 유저 기준 확인"]});
  set("card6", {tag:"new", priority:"normal", reasons:["신규/매충/페이백 조합", "유지형 구성", "문의 라인이 명확"]});
  set("card7", {tag:"ad", priority:"ad", recruit:true, reasons:["광고 문의 전용", "배너/카드/문구 협의 가능", "텔레그램으로만 진행"]});
  set("card8", {tag:"ad", priority:"ad", recruit:true, reasons:["광고 문의 전용", "고정 노출/추가 옵션", "사칭 주의"]});
  set("card9", {tag:"new", priority:"normal", reasons:["입플/페이백 중심 안내", "고액 유저 기준 혜택", "문의 채널 고정"]});
  set("card10", {tag:"new", priority:"normal", reasons:["입플/페이백 중심 안내", "고액 유저 기준 혜택", "문의 채널 고정"]});
  set("card11", {tag:"new", priority:"normal", reasons:["입플/페이백 중심 안내", "고액 유저 기준 혜택", "문의 채널 고정"]});
})();

/* ===== 카드 렌더/필터/인기순 ===== */

/* ===== 로컬 인사이트(가짜 방문자 대신) ===== */
const STATS_KEY = "88_local_stats_v1";
function dayKeyLocal(){
  const d = new Date();
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,"0");
  const dd = String(d.getDate()).padStart(2,"0");
  return `${y}-${m}-${dd}`;
}
function loadStats(){
  try{
    const raw = localStorage.getItem(STATS_KEY);
    const s = raw ? JSON.parse(raw) : {};
    return ensureToday(s);
  }catch(e){
    return ensureToday({});
  }
}
function saveStats(s){
  try{ localStorage.setItem(STATS_KEY, JSON.stringify(s)); }catch(e){}
}
function ensureToday(s){
  const today = dayKeyLocal();
  if(!s || typeof s !== "object") s = {};
  if(s.day !== today){
    s.day = today;
    s.today = { views:{}, searches:{} };
  }
  if(!s.today) s.today = { views:{}, searches:{} };
  if(!s.today.views) s.today.views = {};
  if(!s.today.searches) s.today.searches = {};
  if(!s.total) s.total = { views:{}, searches:{} };
  if(!s.total.views) s.total.views = {};
  if(!s.total.searches) s.total.searches = {};
  return s;
}
function bumpObjCount(obj, key, inc=1){
  if(!key) return;
  obj[key] = (obj[key]||0) + inc;
}
function normKw(s){
  return String(s||"")
    .replace(/[\u0000-\u001f]/g," ")
    .trim();
}
function tokenize(q){
  const t = normKw(q);
  if(!t) return [];
  // 공백/쉼표/슬래시 기준, 짧은 토큰 제거
  return t.split(/[\s,\/|]+/g)
    .map(x=>x.trim())
    .filter(x=>x.length>=2)
    .slice(0, 12);
}
function bumpView(cardId){
  const s = loadStats();
  bumpObjCount(s.today.views, cardId, 1);
  bumpObjCount(s.total.views, cardId, 1);
  saveStats(s);
  renderInsights();
}
function bumpSearch(rawQuery){
  const s = loadStats();
  // GA4: recommended event name "search" with parameter "search_term"
  track("search", {"search_term": String(rawQuery||"").trim().slice(0,80), "results_count": document.querySelectorAll(".card[data-card]").length, "q_len": String(rawQuery||"").trim().length});
  const tokens = tokenize(rawQuery);
  if(!tokens.length) return;
  tokens.forEach(tok=>{
    // 영문/숫자는 대문자 정규화
    const key = tok.replace(/[a-z0-9]/gi, (c)=> c.toUpperCase());
    bumpObjCount(s.today.searches, key, 1);
    bumpObjCount(s.total.searches, key, 1);
  });
  saveStats(s);
  renderInsights();
}
function topN(obj, n=5){
  return Object.entries(obj||{})
    .sort((a,b)=> (b[1]-a[1]) || a[0].localeCompare(b[0]))
    .slice(0,n);
}
function renderLocalInsights(){
  const kwBox = document.getElementById("insightKeywords");
  const cardBox = document.getElementById("insightCards");
  const resetBtn = document.getElementById("insightResetBtn");
  if(!kwBox && !cardBox) return;

  const s = loadStats();

  // Keywords
  if(kwBox){
    const list = topN(s.today.searches, 10);
    if(list.length){
      kwBox.innerHTML = list.map(([kw,c],i)=>`
        <div class="stat-item">
          <div class="stat-left">
            <div class="stat-rank">${i+1}</div>
            <button class="stat-link" type="button" data-kw="${kw.replace(/"/g,'&quot;')}">${kw}</button>
          </div>
          <div class="stat-count">${c}</div>
        </div>
      `).join("");
    } else {
      // fallback: 추천 키워드(가짜 인기 아님)
      const fallback = ["CAPS","VEGAS","페이백","USDT","파워볼","키노","슬롯","미니게임"];
      kwBox.innerHTML = fallback.map((kw,i)=>`
        <div class="stat-item">
          <div class="stat-left">
            <div class="stat-rank">${i+1}</div>
            <button class="stat-link" type="button" data-kw="${kw}">${kw}</button>
          </div>
          <div class="stat-count">추천</div>
        </div>
      `).join("");
    }
  }

  // Cards
  if(cardBox){
    const list = topN(s.today.views, 5);
    if(list.length){
      cardBox.innerHTML = list.map(([id,c],i)=>{
        const title = (CARD_DATA[id]?.title)||id;
        return `
          <div class="stat-item">
            <div class="stat-left">
              <div class="stat-rank">${i+1}</div>
              <button class="stat-link" type="button" data-card="${id}">${title}</button>
            </div>
            <div class="stat-count">${c}</div>
          </div>
        `;
      }).join("");
    } else {
      cardBox.innerHTML = `<div class="note-mini" style="padding:12px 14px 14px;">아직 오늘 열어본 카드가 없습니다. 카드 상세를 열면 TOP 리스트가 자동으로 채워집니다.</div>`;
    }
  }

  // bindings
  document.querySelectorAll("[data-kw]").forEach(btn=>{
    btn.onclick = ()=>{
      const kw = btn.getAttribute("data-kw") || "";
      const input = document.getElementById("searchInput");
      if(input){ input.value = kw; renderGrid(); input.focus(); }
      track("insight_kw_click", {"kw": kw});
    };
  });
  document.querySelectorAll("[data-card]").forEach(btn=>{
    btn.onclick = ()=>{
      const id = btn.getAttribute("data-card");
      if(id) openCard(id);
      track("insight_card_click", {"card_id": id});
    };
  });

  if(resetBtn){
    resetBtn.onclick = ()=>{
      try{ localStorage.removeItem(STATS_KEY); }catch(e){}
      renderInsights();
      track("insight_reset", {});
    };
  }
}


// ===== Global Insights (전체 사용자 인기: GA4 Data API 등) =====
let __INSIGHTS_MODE = "auto"; // "auto" | "global" | "local"
let __GLOBAL_INSIGHTS_CACHE = null;
let __GLOBAL_INSIGHTS_AT = 0;

function hasGlobalInsights() {
  const api = (window.SITE_CONFIG && window.SITE_CONFIG.POPULAR_API) || "";
  return api && api !== "disabled" && !/^\s*$/.test(api);
}

function bindInsightButtons() {
  document.querySelectorAll("[data-kw]").forEach(btn=>{
    btn.onclick = ()=>{
      const kw = btn.getAttribute("data-kw") || "";
      const input = document.getElementById("searchInput");
      if(input){ input.value = kw; renderGrid(); input.focus(); }
      track("insight_kw_click", {"kw": kw});
    };
  });
  document.querySelectorAll("[data-card]").forEach(btn=>{
    btn.onclick = ()=>{
      const id = btn.getAttribute("data-card");
      if(id) openCard(id);
      track("insight_card_click", {"card_id": id});
    };
  });
}

function renderGlobalInsights(data) {
  const kwBox = document.getElementById("insightKeywords");
  const cardBox = document.getElementById("insightCards");
  const resetBtn = document.getElementById("insightResetBtn");
  const kwMeta = document.getElementById("insightKwMeta");
  const cardMeta = document.getElementById("insightCardMeta");
  const headline = document.getElementById("insightHeadline");

  if(headline){
    const date = data && data.date ? String(data.date) : "";
    headline.innerHTML = `오늘의 인기 <span class="pill">전체 사용자 기준</span>` + (date ? `<span class="pill ghost">${date}</span>` : "");
  }
  if(resetBtn) resetBtn.style.display = "none";
  if(kwMeta) kwMeta.textContent = "GA4 이벤트(검색) 기준으로 집계됩니다.";
  if(cardMeta) cardMeta.textContent = "GA4 이벤트(카드 열람) 기준으로 집계됩니다.";

  if(kwBox){
    const list = (data && Array.isArray(data.keywords)) ? data.keywords : [];
    if(list.length){
      kwBox.innerHTML = list.slice(0,10).map((it,i)=>{
        const kw = (it.term || it.keyword || "").toString();
        const c = (it.count ?? it.value ?? "").toString();
        return `
          <div class="stat-item">
            <div class="stat-left">
              <div class="stat-rank">${i+1}</div>
              <button class="stat-link" type="button" data-kw="${kw.replace(/"/g,'&quot;')}">${kw}</button>
            </div>
            <div class="stat-count">${c}</div>
          </div>
        `;
      }).join("");
    } else {
      kwBox.innerHTML = `<div class="stat-empty">아직 데이터가 충분히 쌓이지 않았어요.</div>`;
    }
  }

  if(cardBox){
    const list = (data && Array.isArray(data.cards)) ? data.cards : [];
    if(list.length){
      cardBox.innerHTML = list.slice(0,5).map((it,i)=>{
        const id = (it.id || it.card_id || "").toString();
        const c = (it.count ?? it.value ?? "").toString();
        const title = (CARD_DATA[id]?.title) || id;
        return `
          <div class="stat-item">
            <div class="stat-left">
              <div class="stat-rank">${i+1}</div>
              <button class="stat-link" type="button" data-card="${id}">${title}</button>
            </div>
            <div class="stat-count">${c}</div>
          </div>
        `;
      }).join("");
    } else {
      cardBox.innerHTML = `<div class="stat-empty">아직 데이터가 충분히 쌓이지 않았어요.</div>`;
    }
  }

  bindInsightButtons();
}

async function tryLoadGlobalInsights(force=false) {
  if(!hasGlobalInsights()) return false;
  if(!force && __GLOBAL_INSIGHTS_CACHE && (Date.now()-__GLOBAL_INSIGHTS_AT) < 60_000) return true;

  const api = window.SITE_CONFIG.POPULAR_API;
  try{
    const url = api.includes("?") ? (api + "&range=today") : (api + "?range=today");
    const res = await fetch(url, { cache: "no-store" });
    if(!res.ok) throw new Error("bad status");
    const data = await res.json();
    __GLOBAL_INSIGHTS_CACHE = data;
    __GLOBAL_INSIGHTS_AT = Date.now();
    __INSIGHTS_MODE = "global";
    renderGlobalInsights(data);
    return true;
  }catch(e){
    return false;
  }
}

function renderInsights() {
  if(__INSIGHTS_MODE === "global") {
    if(__GLOBAL_INSIGHTS_CACHE) renderGlobalInsights(__GLOBAL_INSIGHTS_CACHE);
    return;
  }
  renderLocalInsights();
}

async function initInsights() {
  // url param: ?insights=local 로 강제
  try{
    const u = new URL(location.href);
    const force = (u.searchParams.get("insights")||"").toLowerCase();
    if(force === "local"){ __INSIGHTS_MODE = "local"; renderLocalInsights(); return; }
  }catch(e){}
  const ok = await tryLoadGlobalInsights(true);
  if(!ok){ __INSIGHTS_MODE = "local"; renderLocalInsights(); }
}




const CLICK_KEY_PREFIX = "88_card_click_";
let currentFilter = "all";
let currentSort = "default";
let isCleanText = false;

function cleanBenefit(s) {
  const t = String(s||"")
    .replace(/[•]/g,"·")
    .replace(/\s*\/\s*/g," / ")
    .replace(/\s+/g," ")
    .trim();

  const max = 56;
  return t.length > max ? (t.slice(0, max-1) + "…") : t;
}


function norm(s){ return String(s||"").toLowerCase().replace(/\s+/g,""); }
function getClickCount(id){ return Number(localStorage.getItem(CLICK_KEY_PREFIX + id) || 0); }
function incCardClick(id){ localStorage.setItem(CLICK_KEY_PREFIX + id, String(getClickCount(id) + 1)); }

function cardSourcesById(id) {
  const n = String(id).replace("card","");
  return {
    jpg: `img/img${n}.jpg`,
    webp: `img/img${n}.webp`
  };
}

function renderGrid() {
  const grid = document.getElementById("vendorGrid");
  if(!grid) return;

  const q = norm(document.getElementById("searchInput")?.value || "");

  const ids = Object.keys(CARD_DATA);

  // 정렬: high 랜덤 -> normal 랜덤 -> 광고 마지막 (인기순은 별도)
  const high = ids.filter(id=>CARD_DATA[id].priority==="high");
  const normal = ids.filter(id=>CARD_DATA[id].priority==="normal");
  const ad = ids.filter(id=>CARD_DATA[id].priority==="ad");
  const shuffle = (arr)=> arr.slice().sort(()=>Math.random()-0.5);
  let base = [...shuffle(high), ...shuffle(normal), ...ad];

  let filtered = base.filter(id=>{
    const d = CARD_DATA[id];
    if(currentFilter==="rec" && d.tag!=="rec") return false;
    if(currentFilter==="new" && d.tag!=="new") return false;
    if(currentFilter==="ad"  && d.tag!=="ad") return false;

    if(q) {
      const hay = norm(`${d.title} ${d.code||""} ${d.benefit||""} ${d.notice||""}`);
      if(!hay.includes(q)) return false;
    }
    return true;
  });

  if(currentSort==="pop") {
    filtered.sort((a,b)=> getClickCount(b)-getClickCount(a));
  }

  grid.innerHTML = filtered.map(id=>{
    const d = CARD_DATA[id];
    const src = cardSourcesById(id);
const rawDesc = d.benefit ? d.benefit : "";
    // 혜택 문구에서 "첫 문장/첫 혜택"을 뽑아 하이라이트(검색/정렬 로직에는 영향 없음)
    const perk0 = (rawDesc || "").split("/")[0].split("·")[0].split("|")[0].trim();
    const perk = perk0 ? (isCleanText ? cleanBenefit(perk0) : perk0) : "";
    let restRaw = rawDesc;
    if(perk0) restRaw = rawDesc.replace(perk0, "");
    restRaw = (restRaw || "").replace(/^[\s\/·\-\|]+/, "").trim();
    const desc = restRaw ? (isCleanText ? cleanBenefit(restRaw) : restRaw)
                         : (isCleanText ? cleanBenefit(rawDesc) : rawDesc);

    return `
      <div class="card" data-card="${id}">
        <div class="img-box">
          <picture>
            <source type="image/webp" srcset="${src.webp}">
            <img src="${src.jpg}" loading="lazy" decoding="async" alt="${(d.title||"").replace(/"/g,'&quot;')}">
          </picture>

          <div class="quick-cta" aria-label="빠른 동작">
            <button class="qbtn primary" type="button" data-open="${id}" aria-label="${(d.title||"").replace(/"/g,'&quot;')} 자세히 보기">자세히</button>
            <button class="qbtn" type="button" data-share="${id}" aria-label="${(d.title||"").replace(/"/g,'&quot;')} 공유하기">공유</button>
          </div>
        </div>

        <div class="content">
          <div class="site">${d.title || ""}</div>
          ${perk ? ('<div class="perk"><span aria-hidden="true">🎁</span><span class="perk-text">' + perk + '</span></div>') : ''}
          <div class="desc">${desc}</div>
        </div>
      </div>
    `;
  }).join("");

  // blur bg 세팅 + 이미지 에러 대응
  document.querySelectorAll(".img-box").forEach(box=>{
    const img = box.querySelector("img");
    if(!img) return;
    const applyBg = ()=>{ box.style.setProperty("--bgimg", `url('${img.currentSrc || img.src}')`); };
    img.addEventListener("load", applyBg, { once:true });
    applyBg();
    img.onerror = ()=>{
      img.style.display="none";
      box.style.minHeight="130px";
    };
  });

  setChipActive();
  bindCardClicks();
}

function setChipActive() {
  // 기존 v-chip(배찌) UI 제거 → select / toggle 상태만 동기화
  const filterSel = document.getElementById("filterSelect");
  const sortSel   = document.getElementById("sortSelect");
  const cleanTgl  = document.getElementById("cleanToggle");
  if(filterSel) filterSel.value = currentFilter;
  if(sortSel)   sortSel.value   = currentSort;
  if(cleanTgl)  cleanTgl.checked = !!isCleanText;
}

function setFilter(key) {
  currentFilter = key || "all";
  setChipActive();
  renderGrid();
  if(currentFilter!=="all") {
    const top = document.getElementById("vendorTop");
    if(top) top.scrollIntoView({behavior:"smooth", block:"start"});
  }
  track("filter_change", {"filter": currentFilter, "results_count": document.querySelectorAll(".card[data-card]").length});
}

function setSort(key) {
  currentSort = key || "default";
  setChipActive();
  renderGrid();
  track("sort_change", {"sort": currentSort, "results_count": document.querySelectorAll(".card[data-card]").length});
}


function bindCardClicks() {
  document.querySelectorAll(".card[data-card]").forEach(el=>{
    el.onclick = ()=> openCard(el.dataset.card);
  });

  // '자세히' 버튼은 카드 전체 클릭과 동일 동작을 명확히 보여줍니다.
  document.querySelectorAll("[data-open]").forEach(btn=>{
    const open = (e)=>{
      e.preventDefault();
      e.stopPropagation();
      const id = btn.getAttribute("data-open");
      if(id) openCard(id);
    };
    btn.addEventListener("click", open);
    btn.addEventListener("keydown", (e)=>{
      if(e.key==="Enter" || e.key===" "){ open(e); }
    });
  });

  // 공유 버튼(카드 내부) 클릭은 팝업 오픈 대신 공유 팝업을 엽니다.
  document.querySelectorAll("[data-share]").forEach(btn=>{
    const open = (e)=>{
      e.preventDefault();
      e.stopPropagation();
      const id = btn.getAttribute("data-share");
      openShare(id);
    };
    btn.addEventListener("click", open);
    btn.addEventListener("keydown", (e)=>{
      if(e.key==="Enter" || e.key===" "){ open(e); }
    });
  });

}

(function bindControlsAndSearch() {
  const filterSel = document.getElementById("filterSelect");
  const sortSel   = document.getElementById("sortSelect");
  const cleanTgl  = document.getElementById("cleanToggle");
  const cleanHint = document.getElementById("cleanHint");

  // 상태 복원
  const savedFilter = sessionStorage.getItem("88_filter");
  const savedSort   = sessionStorage.getItem("88_sort");
  const savedClean  = sessionStorage.getItem("88_clean_text");

  if(savedFilter) currentFilter = savedFilter;
  if(savedFilter === "pop") { currentFilter = "all"; currentSort = "pop"; }
  if(savedSort)   currentSort   = savedSort;
  if(savedClean === "1") isCleanText = true;

  setChipActive();
  if(cleanHint) cleanHint.style.display = "block";

  if(filterSel) {
    filterSel.addEventListener("change", ()=>{
      sessionStorage.setItem("88_filter", filterSel.value);
      setFilter(filterSel.value);
    });
  }

  if(sortSel) {
    sortSel.addEventListener("change", ()=>{
      sessionStorage.setItem("88_sort", sortSel.value);
      setSort(sortSel.value);
    });
  }

  if(cleanTgl) {
    cleanTgl.addEventListener("change", ()=>{
      isCleanText = !!cleanTgl.checked;
      sessionStorage.setItem("88_clean_text", isCleanText ? "1" : "0");
      setChipActive();
      renderGrid();
      track("clean_text_toggle", {"state": isCleanText ? "on" : "off"});
    });
  }

  const input = document.getElementById("searchInput");
  if(input) {
    let kwTimer = null;
    input.addEventListener("input", ()=> {
      renderGrid();
      clearTimeout(kwTimer);
      const v = input.value;
      kwTimer = setTimeout(()=> bumpSearch(v), 900);
    });
    input.addEventListener("keydown", (e)=>{
      if(e.key === "Enter"){ bumpSearch(input.value); }
    });
  }
})();/* ===== 팝업 + 접근성 ===== */
let currentCode="";
let currentCardId="";
let lastFocusEl=null;

function openCard(id) {
  const d = CARD_DATA[id];
  if(!d) return;

  currentCardId = id;
  bumpView(id);
  incCardClick(id);
  track("card_open", {"card_id": id, "title": d.title || "", "tag": d.tag || "", "code": (d.code||"").slice(0,16)});

  const isRecruit = !!d.recruit;

  currentCode = (isRecruit ? "" : (d.code || ""));
  document.getElementById("pTitle").innerText = d.title || "";
  document.getElementById("pCode").innerText  = (d.code || "");

  document.getElementById("codeRow").style.display = isRecruit ? "none" : "block";
  document.getElementById("copyBtn").style.display = isRecruit ? "none" : "block";
  document.getElementById("pLink").style.display = isRecruit ? "none" : "block";

  // 혜택/주의
  const pBenefit = document.getElementById("pBenefit");
  const pNotice  = document.getElementById("pNotice");
  pBenefit.style.display = (d.benefit && !isRecruit) ? "block" : "none";
  pBenefit.innerText = (d.benefit && !isRecruit) ? ("혜택 : " + d.benefit) : "";
  pNotice.style.display = d.notice ? "block" : "none";
  pNotice.innerText = d.notice ? ("주의 : " + d.notice) : "";

  // 링크/텔레그램 (+UTM)
  const btnGo = document.getElementById("pLink");
  if(btnGo) {
    btnGo.href = d.link ? appendUtm(d.link) : "#";
  }

  const tg = (d.telegram || "UZU59").replace("@","");
  const pTelegram = document.getElementById("pTelegram");
  pTelegram.href = appendUtm("https://t.me/" + tg);
  pTelegram.innerText = isRecruit ? ("광고 문의 @" + tg) : ("텔레그램 문의 @" + tg);

  // 안내 3줄
  const rBox = document.getElementById("reasonBox");
  const rTitle = document.getElementById("reasonTitle");
  const r1 = document.getElementById("reason1");
  const r2 = document.getElementById("reason2");
  const r3 = document.getElementById("reason3");

  rBox.style.display = "block";
  if(isRecruit) {
    rTitle.innerText = "광고 문의 안내";
    r1.innerText = "• 광고/제휴 문의는 텔레그램으로만 진행합니다.";
    r2.innerText = "• 배너/카드/문구 구성은 협의 후 반영합니다.";
    r3.innerText = "• 문의: @" + tg;
  } else {
    const reasons = (d.reasons && d.reasons.length) ? d.reasons : ["안정성/이력 중심", "조건/안내가 비교적 명확", "문의 채널 고정"];
    rTitle.innerText = "안내";
    r1.innerText = "• " + (reasons[0] || "");
    r2.innerText = "• " + (reasons[1] || "");
    r3.innerText = "• " + (reasons[2] || "");
  }

  lastFocusEl = document.activeElement;
  const popup = document.getElementById("cardPopup");
  popup.style.display="flex";

  // 포커스 이동
  const focusTarget = document.getElementById("closeBtn");
  if(focusTarget) focusTarget.focus();
}

function closeCard() {
  const popup = document.getElementById("cardPopup");
  popup.style.display="none";
  if(lastFocusEl && lastFocusEl.focus) lastFocusEl.focus();
}

function copyCode() {
  if(!currentCode) return;
  navigator.clipboard.writeText(currentCode).then(()=>{
    alert("가입코드가 복사되었습니다");
    track("copy_code", {"code": currentCode, "card_id": currentCardId, "title": (CARD_DATA[currentCardId]?.title)||"", "tag": (CARD_DATA[currentCardId]?.tag)||""});
  }).catch(()=>{
    // fallback
    try {
      const t=document.createElement("textarea");
      t.value=currentCode;
      document.body.appendChild(t);
      t.select();
      document.execCommand("copy");
      t.remove();
      alert("가입코드가 복사되었습니다");
      track("copy_code", {"code": currentCode, "card_id": currentCardId, "title": (CARD_DATA[currentCardId]?.title)||"", "tag": (CARD_DATA[currentCardId]?.tag)||""});
    } catch(e) {}
  });
}

function copyToClipboard(text, okMsg) {
  if(!text) return;
  navigator.clipboard.writeText(text).then(()=>{
    if(okMsg) alert(okMsg);
  }).catch(()=>{
    // fallback
    try {
      const t=document.createElement("textarea");
      t.value=text;
      document.body.appendChild(t);
      t.select();
      document.execCommand("copy");
      t.remove();
      if(okMsg) alert(okMsg);
    } catch(e) {}
  });
}

function buildDeepLink(id) {
  try {
    const u = new URL(window.location.href);
    u.searchParams.set("v", id);
    return u.toString();
  } catch(e) {
    return window.location.href;
  }
}

function shareTextFor(id) {
  const d = CARD_DATA[id];
  if(!d) return "";
  const title = d.title || "";
  const benefit = cleanBenefit(d.benefit || "").replace(/\s+/g," ").trim();
  const code = d.code ? `가입코드: ${d.code}` : "";
  const link = buildDeepLink(id);
  return [`88 인증 놀이터 - ${title}`, benefit, code, link].filter(Boolean).join("\n");
}

function openShare(id) {
  const d = CARD_DATA[id];
  if(!d) return;

  currentCardId = id;

  const popup = document.getElementById("sharePopup");
  const link = buildDeepLink(id);
  const linkInput = document.getElementById("shareLink");
  if(linkInput) linkInput.value = link;

  drawShareCard(d, link);

  lastFocusEl = document.activeElement;
  if(popup) popup.style.display="flex";
  const focusTarget = document.getElementById("closeShareBtn");
  if(focusTarget) focusTarget.focus();

  track("share_open", {"card_id": id, "title": d.title || ""});
}

function closeShare() {
  const popup = document.getElementById("sharePopup");
  if(popup) popup.style.display="none";
  try { if(lastFocusEl) lastFocusEl.focus(); } catch(e) {}
}

function copyShareLink() {
  const link = document.getElementById("shareLink")?.value || "";
  copyToClipboard(link, "공유 링크가 복사되었습니다");
  track("share_copy_link", {"card_id": currentCardId});
}

function copyShareText() {
  const txt = shareTextFor(currentCardId);
  copyToClipboard(txt, "공유 문구가 복사되었습니다");
  track("share_copy_text", {"card_id": currentCardId});
}

function downloadShareImage() {
  const c = document.getElementById("shareCanvas");
  if(!c) return;
  const a = document.createElement("a");
  const safe = (CARD_DATA[currentCardId]?.title || "share").replace(/[^a-z0-9가-힣_-]+/gi, "_");
  a.download = `88_${safe}.png`;
  a.href = c.toDataURL("image/png");
  document.body.appendChild(a);
  a.click();
  a.remove();
  track("share_download_image", {"card_id": currentCardId});
}

function roundRect(ctx, x, y, w, h, r){
  const rr = Math.min(r, w/2, h/2);
  ctx.beginPath();
  ctx.moveTo(x+rr, y);
  ctx.arcTo(x+w, y, x+w, y+h, rr);
  ctx.arcTo(x+w, y+h, x, y+h, rr);
  ctx.arcTo(x, y+h, x, y, rr);
  ctx.arcTo(x, y, x+w, y, rr);
  ctx.closePath();
}

function wrapText(ctx, text, x, y, maxWidth, lineHeight, maxLines){
  const words = (text||"").split(" ");
  let line = "";
  let lineCount = 0;
  for(let n=0; n<words.length; n++){
    const testLine = line + (line ? " " : "") + words[n];
    const metrics = ctx.measureText(testLine);
    if(metrics.width > maxWidth && line){
      ctx.fillText(line, x, y + lineCount*lineHeight);
      line = words[n];
      lineCount++;
      if(maxLines && lineCount >= maxLines) return;
    } else {
      line = testLine;
    }
  }
  if(line && (!maxLines || lineCount < maxLines)){
    ctx.fillText(line, x, y + lineCount*lineHeight);
  }
}

function drawShareCard(d, link) {
  const c = document.getElementById("shareCanvas");
  if(!c) return;
  const ctx = c.getContext("2d");
  const W = c.width, H = c.height;

  ctx.clearRect(0,0,W,H);

  // 배경
  const g = ctx.createLinearGradient(0,0,W,H);
  g.addColorStop(0,"#0b0b0f");
  g.addColorStop(1,"#12121a");
  ctx.fillStyle = g;
  ctx.fillRect(0,0,W,H);

  // 글로우
  ctx.fillStyle = "rgba(212,175,55,0.12)";
  ctx.beginPath();
  ctx.ellipse(W*0.58, H*0.14, W*0.55, H*0.22, 0, 0, Math.PI*2);
  ctx.fill();

  ctx.fillStyle = "rgba(90,160,255,0.10)";
  ctx.beginPath();
  ctx.ellipse(W*0.32, H*0.22, W*0.46, H*0.18, 0, 0, Math.PI*2);
  ctx.fill();

  // 패널
  const pad = 72;
  const cardX = pad, cardY = pad, cardW = W - pad*2, cardH = H - pad*2;
  roundRect(ctx, cardX, cardY, cardW, cardH, 42);
  ctx.fillStyle = "rgba(255,255,255,0.06)";
  ctx.fill();
  ctx.strokeStyle = "rgba(255,255,255,0.10)";
  ctx.lineWidth = 2;
  ctx.stroke();

  // 헤더 pill
  const pillH = 64, pillW = 260;
  roundRect(ctx, cardX+44, cardY+44, pillW, pillH, 999);
  ctx.fillStyle = "rgba(212,175,55,0.95)";
  ctx.fill();

  ctx.fillStyle = "#111";
  ctx.font = "900 34px system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, Malgun Gothic, sans-serif";
  ctx.fillText("88 인증 놀이터", cardX+44+26, cardY+44+44);

  // 제목
  ctx.fillStyle = "#fff";
  ctx.font = "900 78px system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, Malgun Gothic, sans-serif";
  wrapText(ctx, (d.title||""), cardX+44, cardY+160, cardW-88, 88, 2);

  // 혜택
  const benefit = cleanBenefit(d.benefit||"").replace(/\s+/g," ").trim();
  ctx.fillStyle = "rgba(255,255,255,0.86)";
  ctx.font = "700 40px system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, Malgun Gothic, sans-serif";
  wrapText(ctx, benefit || "혜택 안내", cardX+44, cardY+360, cardW-88, 58, 3);

  // 코드/링크
  ctx.fillStyle = "rgba(255,255,255,0.75)";
  ctx.font = "800 36px system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, Malgun Gothic, sans-serif";
  const code = d.code ? `가입코드: ${d.code}` : "가입코드: (없음)";
  ctx.fillText(code, cardX+44, cardY+600);

  ctx.font = "700 28px system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, Malgun Gothic, sans-serif";
  const linkShort = (link||"").replace(/^https?:\/\//,'');
  wrapText(ctx, linkShort, cardX+44, cardY+655, cardW-88, 42, 2);

  // 안내
  ctx.fillStyle = "rgba(255,255,255,0.55)";
  ctx.font = "700 24px system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, Malgun Gothic, sans-serif";
  wrapText(ctx, "※ 정보 제공/참고용 · 과몰입 주의", cardX+44, cardY+cardH-88, cardW-88, 34, 2);
}


function jumpToRec() {
  closeCard();
  setFilter("rec");
  const top = document.getElementById("vendorTop");
  if(top) top.scrollIntoView({behavior:"smooth", block:"start"});
  track("popup_secondary_cta", {"action":"jump_to_rec"});
}

(function bindPopupControls() {
  const popup = document.getElementById("cardPopup");
  const box = popup?.querySelector(".popup-box");
  const closeBtn = document.getElementById("closeBtn");
  const copyBtn = document.getElementById("copyBtn");
  const shareBtn = document.getElementById("shareBtn");
  const moreBtn = document.getElementById("moreRecBtn");
  const goBtn = document.getElementById("pLink");
  const tgBtn = document.getElementById("pTelegram");

  const sharePopup = document.getElementById("sharePopup");
  const closeShareBtn = document.getElementById("closeShareBtn");
  const copyShareLinkBtn = document.getElementById("copyShareLinkBtn");
  const downloadShareImgBtn = document.getElementById("downloadShareImgBtn");
  const copyShareTextBtn = document.getElementById("copyShareTextBtn");

  if(closeBtn) closeBtn.addEventListener("click", closeCard);
  if(copyBtn) copyBtn.addEventListener("click", copyCode);
  if(shareBtn) shareBtn.addEventListener("click", ()=> openShare(currentCardId));
  if(moreBtn) moreBtn.addEventListener("click", jumpToRec);

  if(goBtn) goBtn.addEventListener("click", ()=> track("outbound_click", {"type":"site", "card_id": currentCardId, "title": (CARD_DATA[currentCardId]?.title)||"", "url": (document.getElementById("pLink")?.href)||"" }));
  if(tgBtn) tgBtn.addEventListener("click", ()=> track("outbound_click", {"type":"telegram", "card_id": currentCardId, "title": (CARD_DATA[currentCardId]?.title)||"", "url": (document.getElementById("pTelegram")?.href)||"" }));

  if(closeShareBtn) closeShareBtn.addEventListener("click", closeShare);
  if(copyShareLinkBtn) copyShareLinkBtn.addEventListener("click", copyShareLink);
  if(downloadShareImgBtn) downloadShareImgBtn.addEventListener("click", downloadShareImage);
  if(copyShareTextBtn) copyShareTextBtn.addEventListener("click", copyShareText);

  // 바깥 클릭 닫기
  if(popup) popup.addEventListener("click", (e)=>{
    if(e.target === popup) closeCard();
  });
  if(sharePopup) sharePopup.addEventListener("click", (e)=>{
    if(e.target === sharePopup) closeShare();
  });

  // ESC 닫기 + 포커스 트랩(최소)
  document.addEventListener("keydown", (e)=>{
    if(popup && popup.style.display==="flex") {
      if(e.key==="Escape") closeCard();
      if(e.key==="Tab") {
        const focusables = popup.querySelectorAll('a[href], button, [tabindex]:not([tabindex="-1"])');
        const list = Array.from(focusables).filter(el=>!el.hasAttribute("disabled") && el.offsetParent !== null);
        if(!list.length) return;
        const first = list[0];
        const last = list[list.length-1];
        if(e.shiftKey && document.activeElement===first) { e.preventDefault(); last.focus(); }
        else if(!e.shiftKey && document.activeElement===last) { e.preventDefault(); first.focus(); }
      }
    }
  });
})();

/* ===== +EV 감지 시 추천 필터 자동 ON (오늘만) ===== */
function maybeAutoRecFilter() {
  const ev = localStorage.getItem("88_ev_positive");
  const evDate = localStorage.getItem("88_ev_date");
  const today = dateKeyLocal();
  const hint = document.getElementById("evAutoHint");

  if(ev==="1" && evDate===today) {
    if(!sessionStorage.getItem("88_ev_autoon_done")) {
      sessionStorage.setItem("88_ev_autoon_done","1");
      currentFilter = "rec";
      if(hint) {
        hint.style.display="block";
        hint.innerText = "✅ 분석기에서 +EV가 감지되어 ‘추천’ 필터가 자동 활성화되었습니다. (오늘만)";
      }
      track("ev_autofilter", {"state":"on"});
    } else {
      if(hint) {
        hint.style.display="block";
        hint.innerText = "✅ 오늘 +EV 기록이 있어 ‘추천’ 필터를 빠르게 확인할 수 있습니다.";
      }
    }
  } else {
    if(hint) {
      hint.style.display="none";
      hint.innerText = "";
    }
  }
}

/* ===== CTA 트래킹 ===== */
(function bindCtas() {
  document.querySelectorAll("[data-cta]").forEach(el=>{
    el.addEventListener("click", ()=>{
      const cta = el.getAttribute("data-cta") || "";
      const txt = (el.textContent || "").replace(/\s+/g," ").trim().slice(0,60);
      let loc = "unknown";
      if(el.closest(".fab")) loc = "fab";
      else if(el.closest("#analyzerSection")) loc = "hero";
      else if(el.closest(".vendor-header")) loc = "vendor_header";
      else if(el.closest(".vendor-tools")) loc = "vendor_tools";
      else if(el.closest(".landing-seo")) loc = "footer_links";
      track("cta_click", {"cta": cta, "cta_location": loc, "cta_text": txt});
    });
  });
})();


function openFromUrl() {
  try {
    const u = new URL(window.location.href);
    const v = u.searchParams.get("v");
    if(v && CARD_DATA[v]) {
      openCard(v);
    }
  } catch(e) {}
}

/* ===== 초기화 ===== */
(function init() {
  saveUtmFromUrl();
  refreshChecklist();
  setMarginMode("2");
  maybeAutoRecFilter();
  renderGrid();
  initInsights();
  openFromUrl();
})();
</script>

</body>
</html>
