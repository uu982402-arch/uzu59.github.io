<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>스포츠 배당 분석기 | 88 커뮤니티</title>

<style>
*{box-sizing:border-box}
body{margin:0;background:#0b0b0b;color:#fff;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto}
.header{text-align:center;padding:14px 0}
.logo-img{width:160px;filter:drop-shadow(0 0 12px rgba(212,175,55,.25))}
.sub{font-size:12px;color:#9a9a9a}

.wrap{max-width:900px;margin:0 auto;padding:10px 14px 30px}
.card{background:#121212;border-radius:18px;padding:14px;margin-bottom:14px;box-shadow:0 10px 26px rgba(0,0,0,.45)}
.title{font-weight:900;color:#f5e27a;margin-bottom:10px;font-size:14px}

input,select,button{
  width:100%;padding:12px;border-radius:14px;
  border:1px solid rgba(255,255,255,.08);
  background:#0f0f0f;color:#fff;font-weight:800
}
button{cursor:pointer}

.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media(max-width:560px){.grid{grid-template-columns:1fr}}

.result{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.06);
border-radius:16px;padding:12px;margin-top:12px}

.kv{display:flex;justify-content:space-between;padding:6px 0;font-size:13px}
.good{color:#9bffb1}
.warn{color:#ff9b9b}

.hist-item{
  border:1px solid rgba(255,255,255,.08);
  border-radius:14px;padding:10px;
  display:flex;justify-content:space-between;
  margin-bottom:8px;cursor:pointer
}
.hist-item:hover{background:rgba(255,255,255,.04)}
.hist-right{font-weight:900}

.small{font-size:12px;color:#9a9a9a;margin-top:6px}
</style>
</head>

<body>

<div class="header">
  <img src="img/logo-88-community.png" class="logo-img">
  <div class="sub">스포츠 배당 분석기 · 판단 보조용</div>
</div>

<div class="wrap">

<!-- ✅ 배팅 체크리스트 -->
<div class="card">
  <div class="title">배팅 체크리스트</div>
  <div id="checkText"></div>
  <button onclick="refreshChecklist()" style="margin-top:8px">새로고침</button>
</div>

<!-- ✅ 고급 마진 계산기 -->
<div class="card">
  <div class="title">마진 계산기 (1X2 / 핸디 / 오버언더)</div>

  <select id="mType" onchange="onTypeChange()">
    <option value="1x2">1X2 (승/무/패)</option>
    <option value="handicap">핸디캡</option>
    <option value="ou">오버/언더</option>
  </select>

  <div id="m1x2" class="grid" style="margin-top:10px">
    <input id="oddsW" placeholder="승 배당">
    <input id="oddsD" placeholder="무 배당">
    <input id="oddsL" placeholder="패 배당">
  </div>

  <div id="mHandi" class="grid" style="display:none;margin-top:10px">
    <input id="hLine" placeholder="핸디 라인">
    <input id="hA" placeholder="A 배당">
    <input id="hB" placeholder="B 배당">
  </div>

  <div id="mOU" class="grid" style="display:none;margin-top:10px">
    <input id="oLine" placeholder="기준점">
    <input id="oOver" placeholder="오버 배당">
    <input id="oUnder" placeholder="언더 배당">
  </div>

  <label class="small">
    <input type="checkbox" id="asianOU"> 아시안 라인(푸시 근사)
  </label>

  <button onclick="calcMargin()" style="margin-top:10px">마진 계산</button>

  <div id="marginResult" class="result" style="display:none"></div>
</div>

<!-- ✅ 오늘 마진 낮은 TOP3 -->
<div class="card">
  <div class="title">오늘 마진 낮은 계산 TOP3</div>
  <div id="top3"></div>
</div>

<!-- ✅ 히스토리 -->
<div class="card">
  <div class="title">최근 계산 히스토리</div>
  <div id="history"></div>
</div>

</div>

<script>
/* ===== 체크리스트 ===== */
const CHECKS=[
 "라인 급변 경기 이유 확인",
 "마진 5% 이상 경기 주의",
 "1회 베팅 자본 3% 이내",
 "뉴스/로테 반영 여부 체크",
 "연패 팀 시장 과열 주의"
];
function refreshChecklist(){
  const pick=[...CHECKS].sort(()=>Math.random()-0.5).slice(0,3);
  checkText.innerHTML="• "+pick.join("<br>• ");
}
refreshChecklist();

/* ===== 마진 기준 ===== */
const RULE={
 "1x2":5,
 "handicap":3,
 "ou":4
};

const LS="88_margin_hist";

/* ===== UI 전환 ===== */
function onTypeChange(){
  m1x2.style.display=mType.value==="1x2"?"grid":"none";
  mHandi.style.display=mType.value==="handicap"?"grid":"none";
  mOU.style.display=mType.value==="ou"?"grid":"none";
}
onTypeChange();

/* ===== 계산 ===== */
function inv(x){return 1/Number(x)}
function calcMargin(){
  let type=mType.value, invSum=0, text="";
  if(type==="1x2"){
    invSum=inv(oddsW.value)+inv(oddsD.value)+inv(oddsL.value);
    text=`${oddsW.value} / ${oddsD.value} / ${oddsL.value}`;
  }
  if(type==="handicap"){
    invSum=inv(hA.value)+inv(hB.value);
    text=`${hA.value} / ${hB.value}`;
  }
  if(type==="ou"){
    invSum=inv(oOver.value)+inv(oUnder.value);
    if(asianOU.checked) invSum*=0.92;
    text=`Over ${oOver.value} / Under ${oUnder.value}`;
  }

  const margin=(invSum-1)*100;
  const good=margin<=RULE[type];

  marginResult.style.display="block";
  marginResult.innerHTML=`
    <div class="kv"><span>마진</span><b>${margin.toFixed(2)}%</b></div>
    <div class="kv"><span>판정</span>
    <b class="${good?"good":"warn"}">
    ${good?"낮음(유리)":"높음(주의)"}
    </b></div>`;

  saveHist({type,text,margin,ts:Date.now()});
}

/* ===== 히스토리 ===== */
function saveHist(o){
  let arr=JSON.parse(localStorage.getItem(LS)||"[]");
  arr.unshift(o); arr=arr.slice(0,20);
  localStorage.setItem(LS,JSON.stringify(arr));
  renderHist();
}

function renderHist(){
  let arr=JSON.parse(localStorage.getItem(LS)||"[]");
  history.innerHTML=arr.map((x,i)=>`
  <div class="hist-item" onclick="restore(${i})">
    <div>${x.text}</div>
    <div class="hist-right ${x.margin<=RULE[x.type]?"good":"warn"}">
    ${x.margin.toFixed(2)}%
    </div>
  </div>`).join("");
  renderTop3(arr);
}

function restore(i){
  const x=JSON.parse(localStorage.getItem(LS))[i];
  mType.value=x.type; onTypeChange();
  if(x.type==="1x2"){
    [oddsW.value,oddsD.value,oddsL.value]=x.text.split("/").map(s=>s.trim());
  }
  if(x.type==="handicap"){
    [hA.value,hB.value]=x.text.split("/").map(s=>s.trim());
  }
  if(x.type==="ou"){
    const n=x.text.match(/([\d.]+)/g);
    oOver.value=n[0]; oUnder.value=n[1];
  }
  calcMargin();
}

/* ===== TOP3 ===== */
function renderTop3(arr){
  const today=arr.filter(x=>Date.now()-x.ts<86400000)
    .sort((a,b)=>a.margin-b.margin).slice(0,3);
  top3.innerHTML=today.map(x=>`
    <div class="kv"><span>${x.text}</span>
    <b class="good">${x.margin.toFixed(2)}%</b></div>`).join("");
}

renderHist();
</script>
</body>
</html>
