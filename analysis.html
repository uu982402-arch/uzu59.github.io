<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>ìŠ¤í¬ì¸  ë°°ë‹¹ ë¶„ì„ê¸° | 88 ì»¤ë®¤ë‹ˆí‹°</title>
<meta name="description" content="ì¢…ëª©(ì¶•êµ¬/ë†êµ¬/ì•¼êµ¬/ë°°êµ¬/eìŠ¤í¬ì¸ /í•˜í‚¤)ë³„ ë°°ë‹¹ ì…ë ¥ìœ¼ë¡œ ë§ˆì§„ ì œê±° í™•ë¥ , ì˜¤ë²„ë¼ìš´ë“œ, ë°¸ë¥˜(EV), ê¶Œì¥ ë¹„ì¤‘(ë³´ìˆ˜ì  Kelly)ê¹Œì§€ ê³„ì‚°í•˜ëŠ” ë¶„ì„ê¸°ì…ë‹ˆë‹¤. (íŒë‹¨ ë³´ì¡°ìš©)" />
<link rel="canonical" href="https://88st.cloud/analysis.html" />
<meta name="robots" content="index,follow" />

<style>
*{box-sizing:border-box}
:root{
  --bg:#0b0b0b;
  --panel:#121212;
  --gold:#d4af37;
  --gold2:#f5e27a;
  --muted:#bdbdbd;
  --line:rgba(255,255,255,.08);
  --soft:rgba(255,255,255,.04);
}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto;
  background: radial-gradient(1200px 500px at 50% -10%, rgba(212,175,55,.12), transparent 55%),
              radial-gradient(900px 500px at 10% 20%, rgba(90,160,255,.07), transparent 60%),
              linear-gradient(180deg, #07070a, var(--bg));
  color:#fff;
}

/* ìƒë‹¨ ê³µì§€ ë°” */
.notice-bar{
  position:sticky; top:0; z-index:1600;
  background:linear-gradient(135deg,var(--gold),var(--gold2));
  color:#000; font-weight:900; font-size:13px;
  padding:10px 12px; text-align:center;
  box-shadow:0 10px 30px rgba(0,0,0,.35);
}
.notice-bar a{color:#000; text-decoration:none}

/* ì‚¬ì¹­ì£¼ì˜ íŒì—… (1ì¼ 1íšŒ) */
.scam-popup{
  position:fixed; inset:0; z-index:3000;
  background:rgba(0,0,0,.75);
  display:none; align-items:center; justify-content:center;
  padding:18px;
}
.scam-box{
  width:100%; max-width:380px;
  background:rgba(17,17,17,.95);
  border:1px solid rgba(255,255,255,.08);
  border-radius:18px; padding:22px; text-align:center;
  box-shadow:0 18px 60px rgba(0,0,0,.75);
  backdrop-filter: blur(10px);
}
.scam-box h3{margin:0 0 10px; color:#ff6b6b; font-weight:900}
.scam-box p{margin:0; font-size:13px; color:#ddd; line-height:1.55}
.scam-box .btnx{
  margin-top:12px; padding:12px; border-radius:12px;
  background:linear-gradient(135deg,var(--gold),var(--gold2));
  color:#000; font-weight:900; cursor:pointer; user-select:none;
}

/* ìƒë‹¨ */
.header{ text-align:center; padding:14px 0 10px; }
.logo-link{display:inline-block;text-decoration:none}
.logo-img{
  display:block; margin:0 auto 6px;
  width:180px; max-width:72%; height:auto;
  padding:10px;
  border-radius:18px;
  background:radial-gradient(120px 60px at 50% 40%, rgba(212,175,55,.15), transparent 70%);
  filter:
    drop-shadow(0 0 10px rgba(212,175,55,.25))
    drop-shadow(0 0 24px rgba(212,175,55,.12));
}
@media(max-width:480px){ .logo-img{width:140px;max-width:82%} }
.sub{ font-size:12px; color:#9a9a9a; }

/* ë ˆì´ì•„ì›ƒ */
.wrap{ max-width:900px; margin:0 auto; padding:10px 14px 28px; }
.card{
  background:rgba(18,18,18,.88);
  border:1px solid rgba(255,255,255,.06);
  border-radius:18px; padding:14px;
  box-shadow:0 10px 26px rgba(0,0,0,.45);
  margin-bottom:14px;
  backdrop-filter: blur(10px);
}
.title{ font-weight:900; color:var(--gold2); margin-bottom:10px; font-size:14px; }
.note{ color:var(--muted); font-size:12px; line-height:1.5; margin-top:8px; }
.small-hint{ font-size:11px; color:#8f8f8f; margin-top:6px; line-height:1.4; }

/* ì»¨íŠ¸ë¡¤ */
.controls{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
@media(max-width:560px){ .controls{ grid-template-columns:1fr; } }
.select, .textinput{
  width:100%;
  padding:12px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.08);
  background:#0f0f0f;
  color:#fff;
  outline:none;
  font-weight:800;
}
.textinput{ font-weight:700; }
.row2{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin-top:10px;
}
@media(max-width:560px){ .row2{ grid-template-columns:1fr; } }

/* ì…ë ¥ */
.grid{ display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px; }
@media(max-width:560px){ .grid{grid-template-columns:1fr} }
.field label{ display:block; font-size:12px; color:#bbb; margin:2px 0 6px; }
.field input{
  width:100%; padding:12px; border-radius:14px;
  border:1px solid rgba(255,255,255,.08);
  background:#0f0f0f; color:#fff; outline:none;
}
.field input::placeholder{color:#555}

/* ì„¹ì…˜ ë°•ìŠ¤ */
.box{
  margin-top:12px;
  padding:12px;
  border-radius:16px;
  background:rgba(255,255,255,.03);
  border:1px solid rgba(255,255,255,.06);
}
.box-title{
  font-weight:900;
  margin:0 0 8px;
  color:var(--gold2);
  font-size:13px;
}
.box-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.toggle{
  cursor:pointer;
  font-size:12px;
  color:#cfcfcf;
  user-select:none;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.25);
}

/* ì•¡ì…˜ */
.actions{ display:flex; gap:10px; margin-top:12px; flex-wrap:wrap; }
.btn{
  flex:1; min-width:160px;
  border:none; border-radius:14px; padding:12px;
  font-weight:900; cursor:pointer;
}
.primary{ background:linear-gradient(135deg,#1da1f2,#78d6ff); color:#00121a; }
.secondary{ background:#1f1f1f; color:#fff; border:1px solid rgba(255,255,255,.06); }
.gold{ background:linear-gradient(135deg,#d4af37,#f5e27a); color:#111; }

/* ê²°ê³¼ */
.result{
  background:rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.06);
  border-radius:16px;
  padding:12px;
  margin-top:12px;
}
.kv{
  display:flex; justify-content:space-between; gap:10px;
  padding:8px 0; border-bottom:1px solid rgba(255,255,255,.06);
  font-size:13px;
}
.kv:last-child{border-bottom:none}
.k{color:#cfcfcf}
.v{font-weight:900}
hr.sep{ border:none; height:1px; background:rgba(255,255,255,.06); margin:12px 0; }

/* ë§ˆì§„ ìƒíƒœ */
.m-bad{ color:#ffb3b3; }
.m-warn{ color:#ffe29b; }
.m-good{ color:#b7ffcf; }
.pill{
  display:inline-flex; align-items:center; gap:6px;
  padding:6px 10px;
  border-radius:999px;
  font-weight:900;
  font-size:12px;
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.25);
}
.pill.good{ color:#0b0b0b; background:linear-gradient(135deg,#7cffb3,#d5ffd9); border:none; }
.pill.warn{ color:#111; background:linear-gradient(135deg,#ffd36a,#ffe9b0); border:none; }
.pill.bad{ color:#111; background:linear-gradient(135deg,#ff7a7a,#ffb3b3); border:none; }

/* âœ… ì „í™˜ ì„¹ì…˜ */
.cta{
  margin-top:12px;
  padding:12px;
  border-radius:16px;
  background:rgba(212,175,55,.08);
  border:1px solid rgba(245,226,122,.22);
}
.cta b{ color:#f5e27a; }
.cta .btnrow{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
.cta a{
  flex:1; min-width:160px;
  display:block; text-align:center;
  padding:12px; border-radius:14px;
  text-decoration:none; font-weight:900;
}
.cta .goVendor{
  background:linear-gradient(135deg,#d4af37,#f5e27a);
  color:#111;
}
.cta .tg{
  background:#1f1f1f; color:#fff;
  border:1px solid rgba(255,255,255,.08);
}

  
/* ì²´í¬ë¦¬ìŠ¤íŠ¸ */
.bullets{ color:#cfcfcf; font-size:13px; line-height:1.55; }
.bullets b{ color:var(--gold2); }

/* íˆìŠ¤í† ë¦¬ */
.hist-item{
  display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
  padding:10px 12px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.22);
  cursor:pointer;
}
.hist-item + .hist-item{ margin-top:10px; }
.hist-left{ flex:1; min-width:0; }
.hist-top{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
.hist-title{ font-weight:900; font-size:13px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:100%; }
.hist-meta{ font-size:11px; color:#9a9a9a; }
.hist-right{
  display:flex; flex-direction:column; gap:8px; align-items:flex-end;
  min-width:110px;
}
.hist-mline{ font-size:12px; color:#cfcfcf; text-align:right; }
.hist-check{
  width:18px; height:18px;
  accent-color:#f5e27a;
}
.smallbtn{
  padding:8px 10px; border-radius:12px;
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.25);
  color:#fff; font-weight:900; cursor:pointer;
}

/* TOP3 */
.top3-empty{ font-size:12px; color:#9a9a9a; padding:4px 0; }

/* ë§í¬ */
.footer-links{ display:flex; gap:10px; margin-top:14px; flex-wrap:wrap; }
.linkbtn{
  flex:1; min-width:160px;
  display:block; text-align:center; padding:12px;
  border-radius:14px; text-decoration:none; font-weight:900;
  background:#1f1f1f; color:#fff;
  border:1px solid rgba(255,255,255,.06);
}
</style>
</head>

<body>

<!-- âœ… ìƒë‹¨ ê³µì§€/ì´ë²¤íŠ¸ ë°°ë„ˆ(ìë™ ìˆœí™˜) -->
<div class="notice-bar">
  <a id="noticeLink" href="https://t.me/UZU59" target="_blank" rel="noopener">
    <span id="noticeText"></span>
  </a>
</div>

<!-- âœ… ì‚¬ì¹­ì£¼ì˜ íŒì—… (1ì¼ 1íšŒ) -->
<div class="scam-popup" id="scamPopup">
  <div class="scam-box">
    <h3>âš ï¸ ì‚¬ì¹­ ì£¼ì˜ ì•ˆë‚´</h3>
    <p>
      88 ì»¤ë®¤ë‹ˆí‹° ê³µì‹ ê´€ë¦¬ì í…”ë ˆê·¸ë¨ì€<br>
      <b>@UZU59</b> ë‹¨ í•˜ë‚˜ì…ë‹ˆë‹¤.<br><br>
      ê·¸ ì™¸ ê³„ì •ì€ ì‚¬ì¹­ì¼ ìˆ˜ ìˆìœ¼ë‹ˆ<br>
      ë°˜ë“œì‹œ ì£¼ì˜í•´ ì£¼ì„¸ìš”.
    </p>
    <div class="btnx" onclick="closeScam()">í™•ì¸</div>
  </div>
</div>

<div class="header">
  <a class="logo-link" href="./" aria-label="í™ˆìœ¼ë¡œ ì´ë™">
    <img src="img/logo-88-community.png" alt="88 ì»¤ë®¤ë‹ˆí‹°" class="logo-img">
  </a>
  <div class="sub">ìŠ¤í¬ì¸  ë°°ë‹¹ ë¶„ì„ê¸° x ë§ˆì§„ ê³„ì‚°ê¸° </div>
</div>

<div class="wrap">

  <!-- âœ… ë°°íŒ… ì²´í¬ë¦¬ìŠ¤íŠ¸ (ëœë¤ 3ì¤„) -->
  <div class="card">
    <div class="title">ë°°íŒ… ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸ (ëœë¤ 3ì¤„)</div>
    <div class="bullets" id="checklistText"></div>
    <div class="actions" style="margin-top:10px;">
      <button class="btn secondary" onclick="refreshChecklist()">ì²´í¬ë¦¬ìŠ¤íŠ¸ ìƒˆë¡œê³ ì¹¨</button>
      <button class="btn secondary" onclick="scrollToId('settingsCard')">ë¶„ì„ê¸° ì…ë ¥ìœ¼ë¡œ ì´ë™</button>
    </div>
    <div class="small-hint">â€» ê³¼ëª°ì… ë°©ì§€/ë¦¬ìŠ¤í¬ ê´€ë¦¬ìš© ì•ˆë‚´ì…ë‹ˆë‹¤.</div>
  </div>

  <!-- âœ… ë§ˆì§„ ë‚®ì€ ê²½ê¸° ì˜ˆì‹œ/ê¸°ì¤€ ì•ˆë‚´ -->
  <div class="card">
    <div class="title">â€œë§ˆì§„ ë‚®ìŒâ€ íŒì • ê¸°ì¤€ (ì¢…ëª©/ìœ í˜•ë³„)</div>
    <div class="note" style="margin-top:0;">
      - ë§ˆì§„ì€ <b>ì˜¤ë²„ë¼ìš´ë“œ(ì—­ìˆ˜ í•© - 1)</b>ë¥¼ %ë¡œ í‘œì‹œí•œ ê°’ì…ë‹ˆë‹¤.<br>
      - ì¢…ëª©/ìœ í˜•(ë©”ì¸/OU/í•¸ë””)ì— ë”°ë¼ ì‹œì¥ ê´€í–‰ì´ ë‹¬ë¼ ê¸°ì¤€ì´ ë‹¤ë¥´ê²Œ ì ìš©ë©ë‹ˆë‹¤.<br>
      - OU ì•„ì‹œì•ˆ(í‘¸ì‹œ)ì€ <b>í‘¸ì‹œ í™•ë¥ ì„ 0~8% ì •ë„ë¡œ ê·¼ì‚¬</b>í•´ 3-way í˜•íƒœë¡œ ê³„ì‚°í•©ë‹ˆë‹¤. (ì°¸ê³ ìš©)
    </div>
    <div class="box">
      <div class="box-title">í˜„ì¬ ì„ íƒ ì¢…ëª© ê¸°ì¤€</div>
      <div id="marginRulePreview" class="note" style="margin-top:0;"></div>
    </div>
  </div>

  <!-- âœ… ì˜¤ëŠ˜ ë§ˆì§„ ë‚®ì€ TOP3 (ë©”ì¸/OU/í•¸ë”” ë¶„ë¦¬) -->
  <div class="card">
    <div class="title">ì˜¤ëŠ˜ ë§ˆì§„ ë‚®ì€ TOP3 (ìœ í˜•ë³„)</div>

    <div class="box">
      <div class="box-title">ë©”ì¸ ë°°ë‹¹ TOP3</div>
      <div id="top3Main"></div>
    </div>

    <div class="box">
      <div class="box-title">ì˜¤ë²„/ì–¸ë” TOP3</div>
      <div id="top3OU"></div>
    </div>

    <div class="box">
      <div class="box-title">í•¸ë””ìº¡ TOP3</div>
      <div id="top3Handicap"></div>
    </div>

    <div class="small-hint">â€» â€œì˜¤ëŠ˜â€ì€ ê¸°ê¸° ë‚ ì§œ ê¸°ì¤€ / localStorage ê¸°ë°˜ì…ë‹ˆë‹¤.</div>
  </div>

  <!-- âœ… ê¸°ì¡´ ë¶„ì„ê¸° ì¹´ë“œ (ê¸°ëŠ¥ 100% ìœ ì§€ + í†µí•© í™•ì¥) -->
  <div class="card" id="settingsCard">
    <div class="title">ì„¤ì •</div>

    <div class="controls">
      <select id="sport" class="select" onchange="onSportChange()">
        <option value="soccer">ì¶•êµ¬</option>
        <option value="basketball">ë†êµ¬</option>
        <option value="baseball">ì•¼êµ¬</option>
        <option value="volleyball">ë°°êµ¬</option>
        <option value="esports">eìŠ¤í¬ì¸ </option>
        <option value="hockey">í•˜í‚¤</option>
      </select>

      <select id="level" class="select" onchange="onLevelChange()">
        <option value="simple">ê°„ë‹¨</option>
        <option value="mid">ì¤‘ê¸‰</option>
        <option value="adv">ê³ ê¸‰</option>
      </select>
    </div>

    <!-- âœ… íŒ€/ë¦¬ê·¸ ì…ë ¥(ì„ íƒ) -->
    <div class="row2">
      <div>
        <input id="league" class="textinput" placeholder="ë¦¬ê·¸/ëŒ€íšŒëª… (ì„ íƒ)">
        <div class="small-hint">â€» ì…ë ¥í•˜ì§€ ì•Šì•„ë„ ë¶„ì„ ê°€ëŠ¥ / ê³µìœ  ì‹œ ì…ë ¥í•œ ë‚´ìš©ë§Œ í¬í•¨ë©ë‹ˆë‹¤.</div>
      </div>
      <div>
        <input id="teams" class="textinput" placeholder="íŒ€ëª… (ì„ íƒ) ì˜ˆ: ë§¨ì‹œí‹° vs ë¦¬ë²„í’€">
        <div class="small-hint">â€» íŒ€/ë¦¬ê·¸ëŠ” ì„ íƒì‚¬í•­ì…ë‹ˆë‹¤.</div>
      </div>
    </div>

    <div class="small-hint" id="sportHint" style="margin-top:10px;"></div>

    <!-- ===== ë©”ì¸ ì‹œì¥ ===== -->
    <div class="box">
      <div class="box-title" id="mainMarketTitle">ë©”ì¸ ë°°ë‹¹</div>

      <!-- 2-way -->
      <div id="main2" style="display:none;">
        <div class="grid">
          <div class="field">
            <label id="main2LabelA">ì„ íƒ A ë°°ë‹¹</label>
            <input id="main2OddsA" inputmode="decimal" placeholder="ì˜ˆ: 1.85">
          </div>
          <div class="field">
            <label id="main2LabelB">ì„ íƒ B ë°°ë‹¹</label>
            <input id="main2OddsB" inputmode="decimal" placeholder="ì˜ˆ: 2.05">
          </div>
        </div>
      </div>

      <!-- 3-way -->
      <div id="main3" style="display:none;">
        <div class="grid">
          <div class="field">
            <label id="main3LabelH">í™ˆ ë°°ë‹¹</label>
            <input id="main3OddsH" inputmode="decimal" placeholder="ì˜ˆ: 2.10">
          </div>
          <div class="field">
            <label id="main3LabelD">ë¬´ ë°°ë‹¹</label>
            <input id="main3OddsD" inputmode="decimal" placeholder="ì˜ˆ: 3.20">
          </div>
          <div class="field">
            <label id="main3LabelA">ì›ì • ë°°ë‹¹</label>
            <input id="main3OddsA" inputmode="decimal" placeholder="ì˜ˆ: 3.40">
          </div>
          <div class="field">
            <label> </label>
            <input disabled value="â€» ì¶•êµ¬ëŠ” 3ë°°ë‹¹ì´ ê¸°ë³¸ì…ë‹ˆë‹¤">
          </div>
        </div>
      </div>

      <!-- ì¤‘ê¸‰/ê³ ê¸‰: ë‚´ í™•ë¥ /ë² íŒ…ê¸ˆ -->
      <div id="valueInputs" style="display:none;">
        <div class="grid">
          <div class="field">
            <label id="myProbLabel">ë‚´ ì˜ˆìƒ í™•ë¥ (ì„ íƒ) %</label>
            <input id="myProb" inputmode="decimal" placeholder="ì˜ˆ: 55  ë˜ëŠ”  45,28,27">
            <div class="small-hint" id="myProbHint"></div>
          </div>
          <div class="field">
            <label>ë² íŒ…ê¸ˆ(ì„ íƒ)</label>
            <input id="stake" inputmode="numeric" placeholder="ì˜ˆ: 100000">
            <div class="small-hint">â€» ì…ë ¥ ì‹œ ê¸°ëŒ€ê°’(EV)ì„ ì› ë‹¨ìœ„ë¡œë„ í‘œì‹œí•©ë‹ˆë‹¤.</div>
          </div>
        </div>
      </div>

      <!-- âœ… ë©”ì¸ ë§ˆì§„ ìƒíƒœ (í†µí•© í‘œì‹œ) -->
      <div class="box" style="margin-top:10px;">
        <div class="box-head">
          <div class="box-title" style="margin:0;">ë©”ì¸ ë§ˆì§„ ìƒíƒœ</div>
          <div id="mainMarginPill" class="pill">ì…ë ¥ ëŒ€ê¸°</div>
        </div>
        <div class="small-hint" id="mainMarginHint"></div>
      </div>
    </div>

    <!-- ===== í•¸ë””ìº¡ (ì •ë°€ ì–‘ìª½ ë°°ë‹¹) ===== -->
    <div class="box" id="handicapBox" style="display:none;">
      <div class="box-head">
        <div class="box-title" style="margin:0;">í•¸ë””ìº¡ (ì •ë°€ ë§ˆì§„)</div>
        <div class="toggle" onclick="toggleBox('handicapBody')">ì ‘ê¸°/í¼ì¹˜ê¸°</div>
      </div>
      <div id="handicapBody">
        <div class="grid">
          <div class="field">
            <label>í•¸ë”” ë¼ì¸ (ì˜ˆ: -1.5, +3.5)</label>
            <input id="handicapLine" inputmode="decimal" placeholder="ì˜ˆ: -1.5">
          </div>
          <div class="field">
            <label>í™ˆ í•¸ë”” ë°°ë‹¹</label>
            <input id="handicapOddsHome" inputmode="decimal" placeholder="ì˜ˆ: 1.90">
          </div>
          <div class="field">
            <label>ì›ì • í•¸ë”” ë°°ë‹¹</label>
            <input id="handicapOddsAway" inputmode="decimal" placeholder="ì˜ˆ: 1.95">
          </div>
          <div class="field">
            <label> </label>
            <input disabled value="â€» ì–‘ìª½ ë°°ë‹¹ì´ ìˆì–´ì•¼ ì •ë°€ ë§ˆì§„ ê³„ì‚°ë©ë‹ˆë‹¤">
          </div>
        </div>

        <div class="box" style="margin-top:10px;">
          <div class="box-head">
            <div class="box-title" style="margin:0;">í•¸ë”” ë§ˆì§„ ìƒíƒœ</div>
            <div id="handicapMarginPill" class="pill">ì…ë ¥ ëŒ€ê¸°</div>
          </div>
          <div class="small-hint" id="handicapMarginHint"></div>
        </div>
      </div>
    </div>

    <!-- ===== ì˜¤ë²„ì–¸ë” ===== -->
    <div class="box" id="totalBox" style="display:none;">
      <div class="box-head">
        <div class="box-title" style="margin:0;">ì˜¤ë²„/ì–¸ë” (ì•„ì‹œì•ˆ í‘¸ì‹œ ê·¼ì‚¬ ì§€ì›)</div>
        <div class="toggle" onclick="toggleBox('totalBody')">ì ‘ê¸°/í¼ì¹˜ê¸°</div>
      </div>
      <div id="totalBody">
        <div class="grid">
          <div class="field">
            <label>ê¸°ì¤€ì  (ì˜ˆ: 2.5, 2.25, 2.0)</label>
            <input id="totalLine" inputmode="decimal" placeholder="ì˜ˆ: 2.25">
          </div>
          <div class="field">
            <label>ì˜¤ë²„ ë°°ë‹¹</label>
            <input id="overOdds" inputmode="decimal" placeholder="ì˜ˆ: 1.95">
          </div>
          <div class="field">
            <label>ì–¸ë” ë°°ë‹¹</label>
            <input id="underOdds" inputmode="decimal" placeholder="ì˜ˆ: 1.85">
          </div>
          <div class="field">
            <label>í‘¸ì‹œ í™•ë¥ (ê·¼ì‚¬) % (ì„ íƒ)</label>
            <input id="pushProb" inputmode="decimal" placeholder="ì˜ˆ: 5">
            <div class="small-hint">â€» ì •ìˆ˜/0.0 ë¼ì¸ì—ì„œ ì˜ë¯¸ê°€ í¼ Â· 0~8% ê¶Œì¥</div>
          </div>
          <div class="field">
            <label>ë‚´ ì˜ˆìƒ í™•ë¥ (ì˜¤ë²„) % (ê³ ê¸‰)</label>
            <input id="myOverProb" inputmode="decimal" placeholder="ì˜ˆ: 52">
          </div>
          <div class="field">
            <label> </label>
            <input disabled value="â€» 2.25/2.75ëŠ” í‘¸ì‹œê°€ ì ì–´ 0%ë¡œ ë‘ì–´ë„ ë¬´ë°©(ê·¼ì‚¬)">
          </div>
        </div>

        <div class="box" style="margin-top:10px;">
          <div class="box-head">
            <div class="box-title" style="margin:0;">ì˜¤ë²„/ì–¸ë” ë§ˆì§„ ìƒíƒœ</div>
            <div id="ouMarginPill" class="pill">ì…ë ¥ ëŒ€ê¸°</div>
          </div>
          <div class="small-hint" id="ouMarginHint"></div>
        </div>

        <div class="small-hint">â€» ê³ ê¸‰ì—ì„œ ë‚´ ì˜ˆìƒ í™•ë¥ (ì˜¤ë²„)ì„ ë„£ìœ¼ë©´ ì˜¤ë²„ EV/ë¹„ì¤‘ ê³„ì‚°ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
      </div>
    </div>

    <div class="actions">
      <button class="btn primary" onclick="calc()">ê³„ì‚°í•˜ê¸°</button>
      <button class="btn secondary" onclick="resetAll()">ì´ˆê¸°í™”</button>
      <button class="btn gold" onclick="copyResult()">ê²°ê³¼ ë³µì‚¬</button>
      <button class="btn secondary" onclick="shareResult()">ê³µìœ </button>
    </div>

    <div class="note">
      â€» ë³¸ ë„êµ¬ëŠ” â€œíŒë‹¨ ë³´ì¡°ìš©â€ì…ë‹ˆë‹¤. ìŠ¹ë¥ ì„ ë³´ì¥í•˜ì§€ ì•Šìœ¼ë©°, ì†ì‹¤ì„ ê°ë‹¹ ê°€ëŠ¥í•œ ë²”ìœ„ ë‚´ì—ì„œ ì´ìš©í•˜ì„¸ìš”.
    </div>

    <div class="result" id="result" style="display:none;"></div>
<!-- âœ… ë³´ì¦ì—…ì²´ ì „í™˜ ì„¹ì…˜ -->
<div class="cta" id="vendorCTA" style="display:none;">
  <div style="font-weight:900; margin-bottom:6px;">ğŸ“Œ ë¶„ì„ ë â†’ ì´ì œ ì„ íƒë§Œ ë‚¨ì•˜ìŠµë‹ˆë‹¤</div>
  <div style="font-size:13px; color:#cfcfcf; line-height:1.55;">
    <b>ê°™ì€ ë¶„ì„ì´ë¼ë„, ë°°íŒ… í™˜ê²½ì— ë”°ë¼ ê²°ê³¼ëŠ” ë‹¬ë¼ì§‘ë‹ˆë‹¤.</b><br>
    âœ” ì§€ì—° ì—†ëŠ” ë°°ë‹¹ ë°˜ì˜ Â· âœ” ì¶œê¸ˆ ì´ìŠˆ ì—†ëŠ” ê³³ Â· âœ” ê³ ì•¡ ìœ ì € ê¸°ì¤€ ê²€ì¦<br>
    ğŸ‘‰ <b>88 ì¸ì¦ ë†€ì´í„°</b>ì—ì„œ ì´ìš©í•˜ì„¸ìš”.
  </div>
  
  <div class="btnrow">
    <a class="goVendor" href="./#vendors">88 ì¸ì¦ ë†€ì´í„° ë³´ê¸°</a>
    <a class="tg" href="https://t.me/UZU59" target="_blank" rel="noopener">ë¬¸ì˜(í…”ë ˆê·¸ë¨)</a>
  </div>
</div>

    <div class="footer-links">
      <a class="linkbtn" href="./">í™ˆìœ¼ë¡œ</a>
      <a class="linkbtn" href="https://t.me/UZU59" target="_blank" rel="noopener">ë¬¸ì˜ (í…”ë ˆê·¸ë¨)</a>
    </div>
  </div>

  <!-- âœ… ìµœê·¼ ê³„ì‚° íˆìŠ¤í† ë¦¬ + ë¹„êµ -->
  <div class="card">
    <div class="title">ìµœê·¼ ê³„ì‚° íˆìŠ¤í† ë¦¬ (í´ë¦­ â†’ ì…ë ¥ ë³µì› + ì¦‰ì‹œ ì¬ê³„ì‚°)</div>

    <div class="actions" style="margin-top:0;">
      <button class="btn secondary" onclick="clearHistory()">íˆìŠ¤í† ë¦¬ ì „ì²´ ì‚­ì œ</button>
      <button class="btn secondary" onclick="renderHistory()">ìƒˆë¡œê³ ì¹¨</button>
    </div>

    <div class="box">
      <div class="box-title">ìµœê·¼ 20ê°œ</div>
      <div id="historyList"></div>
      <div class="small-hint">â€» ë¹„êµëŠ” ì²´í¬ë°•ìŠ¤ 2ê°œ ì„ íƒ í›„ â€œë¹„êµí•˜ê¸°â€ ë²„íŠ¼</div>
    </div>

    <div class="actions" style="margin-top:10px;">
      <button class="btn secondary" onclick="compareSelected()">ì„ íƒ 2ê°œ ë¹„êµ</button>
    </div>

    <div class="result" id="compareResult" style="display:none;"></div>
  </div>

</div>

<script>
/* =========================
   ìƒë‹¨ ë°°ë„ˆ + ì‚¬ì¹­ì£¼ì˜(1ì¼ 1íšŒ)
========================= */
const NOTICE_LIST = [
  "ğŸ”” 88 ì»¤ë®¤ë‹ˆí‹° ê³µì‹ ì•ˆë‚´ Â· ê´€ë¦¬ì ì‚¬ì¹­ ì£¼ì˜ (@UZU59)",
  "ğŸ“Š ë¶„ì„ê¸°: ë§ˆì§„ ì œê±° í™•ë¥  Â· EV Â· ë¹„ì¤‘(ë³´ìˆ˜ì  Kelly) ì œê³µ",
  "ğŸ§® OU/í•¸ë”” ì •ë°€ ë§ˆì§„ + íˆìŠ¤í† ë¦¬/Top3 ìë™ ì •ë¦¬",
  "âš ï¸ ê³¼ëª°ì… ë°©ì§€: ì²´í¬ë¦¬ìŠ¤íŠ¸ í™•ì¸ í›„ ì´ìš©í•˜ì„¸ìš”"
];
let noticeIndex=0;
function rotateNotice(){
  const el=document.getElementById("noticeText");
  if(!el) return;
  el.innerText = NOTICE_LIST[noticeIndex];
  noticeIndex = (noticeIndex+1)%NOTICE_LIST.length;
}
rotateNotice();
setInterval(rotateNotice, 4000);

(function(){
  const key="scam_popup_date";
  const today=new Date().toISOString().slice(0,10);
  if(localStorage.getItem(key)!==today){
    document.getElementById("scamPopup").style.display="flex";
  }
})();
function closeScam(){
  const today=new Date().toISOString().slice(0,10);
  localStorage.setItem("scam_popup_date",today);
  document.getElementById("scamPopup").style.display="none";
}
function scrollToId(id){
  const el=document.getElementById(id);
  if(!el) return;
  el.scrollIntoView({behavior:"smooth", block:"start"});
}

/* =========================
   ì²´í¬ë¦¬ìŠ¤íŠ¸ (ëœë¤ 3ì¤„)
========================= */
const CHECKLIST_POOL = [
  "ë¼ì¸ ê¸‰ë³€ ê²½ê¸°(ê°‘ìê¸° ë‚´ë ¤ê°„ ë°°ë‹¹)ëŠ” <b>ì´ìœ ë¶€í„°</b> í™•ì¸í•˜ê¸°",
  "ë§ˆì§„(ìˆ˜ìˆ˜ë£Œ) ë†’ì€ ê²½ê¸°ë©´ <b>í•œ ë‹¨ê³„ ë³´ìˆ˜ì ìœ¼ë¡œ</b> ì ‘ê·¼í•˜ê¸°",
  "1íšŒ ë°°íŒ…ê¸ˆì€ ìë³¸ì˜ <b>1~3%</b> ë²”ìœ„ë¡œ ì œí•œí•˜ê¸°",
  "ì„ ë°œ/ê²°ì¥/ë¡œí…Œ ë‰´ìŠ¤ ì²´í¬ í›„ ë°°ë‹¹ ë³€ë™ <b>ì¬í™•ì¸</b>í•˜ê¸°",
  "ì—°íŒ¨/ì—°ìŠ¹ íŒ€ì€ ì‹œì¥ <b>ê³¼ì—´ êµ¬ê°„</b>ì¸ì§€ ë¨¼ì € ë³´ê¸°",
  "ë³€ë™ì„± í° ë¦¬ê·¸ëŠ” <b>ë‹¨í´/ì†Œì•¡</b>ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ê¸°"
];
function refreshChecklist(){
  const pool=[...CHECKLIST_POOL].sort(()=>Math.random()-0.5);
  const pick=pool.slice(0,3);
  document.getElementById("checklistText").innerHTML = "â€¢ " + pick.join("<br>â€¢ ");
}
refreshChecklist();

/* =========================
   ìƒíƒœ/ì €ì¥ (ê¸°ì¡´ ìœ ì§€)
========================= */
const LS_KEY = "88_analysis_multi_v2";
let LAST_TEXT = "";

/* âœ… íˆìŠ¤í† ë¦¬ ì €ì¥ */
const HIST_KEY = "88_analysis_history_v1";
const HIST_MAX = 20;

/* =========================
   ì¢…ëª© ì„¤ì • (ê¸°ì¡´ ìœ ì§€ + í™•ì¥)
========================= */
const SPORT_CFG = {
  soccer: {
    name: "ì¶•êµ¬",
    main: "3way",
    labels: {H:"í™ˆ", D:"ë¬´", A:"ì›ì •"},
    hint: "ì¶•êµ¬ëŠ” ê¸°ë³¸ 3ë°°ë‹¹(í™ˆ/ë¬´/ì›ì •). ì¤‘ê¸‰/ê³ ê¸‰ì—ì„œ ì˜¤ë²„ì–¸ë”ë¥¼ ê°™ì´ ë³´ëŠ” ê±¸ ì¶”ì²œí•©ë‹ˆë‹¤.",
    template: { openHandicap:false, openTotal:true }
  },
  basketball: {
    name:"ë†êµ¬",
    main:"2way",
    labels:{A:"ìŠ¹", B:"íŒ¨"},
    hint:"ë†êµ¬ëŠ” 2ë°°ë‹¹(ìŠ¹/íŒ¨) ì¤‘ì‹¬. ì¤‘ê¸‰/ê³ ê¸‰ì—ì„œëŠ” í•¸ë””+ì˜¤ë²„ì–¸ë”ë¥¼ í•¨ê»˜ ì¶”ì²œ.",
    template: { openHandicap:true, openTotal:true }
  },
  baseball: {
    name:"ì•¼êµ¬",
    main:"2way",
    labels:{A:"ìŠ¹", B:"íŒ¨"},
    hint:"ì•¼êµ¬ëŠ” ìŠ¹/íŒ¨(2ë°°ë‹¹) + ì˜¤ë²„ì–¸ë”/í•¸ë””(ëŸ°ë¼ì¸)ë¥¼ í•¨ê»˜ ë³´ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.",
    template: { openHandicap:true, openTotal:true }
  },
  volleyball: {
    name:"ë°°êµ¬",
    main:"2way",
    labels:{A:"ìŠ¹", B:"íŒ¨"},
    hint:"ë°°êµ¬ëŠ” 2ë°°ë‹¹(ìŠ¹/íŒ¨) ì¤‘ì‹¬. ì¤‘ê¸‰/ê³ ê¸‰ì—ì„œ í•¸ë””/OUë¥¼ í•¨ê»˜ í™•ì¸í•˜ì„¸ìš”.",
    template: { openHandicap:true, openTotal:true }
  },
  esports: {
    name:"eìŠ¤í¬ì¸ ",
    main:"2way",
    labels:{A:"ìŠ¹", B:"íŒ¨"},
    hint:"eìŠ¤í¬ì¸ ëŠ” ë§¤ì¹˜ ìŠ¹/íŒ¨(2ë°°ë‹¹) ì¤‘ì‹¬. ê³ ê¸‰ì—ì„œ EV/ë¹„ì¤‘ ê³„ì‚°ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.",
    template: { openHandicap:false, openTotal:false }
  },
  hockey: {
    name:"í•˜í‚¤",
    main:"2way",
    labels:{A:"ìŠ¹", B:"íŒ¨"},
    hint:"í•˜í‚¤ëŠ” 2ë°°ë‹¹(ìŠ¹/íŒ¨) ê¸°ë³¸. ì¤‘ê¸‰/ê³ ê¸‰ì—ì„œ ì˜¤ë²„ì–¸ë”ê°€ ë„ì›€ì´ ë©ë‹ˆë‹¤.",
    template: { openHandicap:false, openTotal:true }
  }
};

function $(id){ return document.getElementById(id); }
function val(id){ const el=$(id); return el?el.value:""; }
function setVal(id,v){ const el=$(id); if(el && v!=null) el.value=v; }

/* âœ… ì €ì¥/ë³µì›(ê¸°ì¡´ + ì‹ ê·œ ì…ë ¥ í¬í•¨) */
function saveState(){
  const state = {
    sport: val("sport"),
    level: val("level"),
    league: val("league"),
    teams: val("teams"),
    main2OddsA: val("main2OddsA"),
    main2OddsB: val("main2OddsB"),
    main3OddsH: val("main3OddsH"),
    main3OddsD: val("main3OddsD"),
    main3OddsA: val("main3OddsA"),
    myProb: val("myProb"),
    stake: val("stake"),
    handicapLine: val("handicapLine"),
    handicapOddsHome: val("handicapOddsHome"),
    handicapOddsAway: val("handicapOddsAway"),
    totalLine: val("totalLine"),
    overOdds: val("overOdds"),
    underOdds: val("underOdds"),
    myOverProb: val("myOverProb"),
    pushProb: val("pushProb"),
    handicapCollapsed: isCollapsed("handicapBody"),
    totalCollapsed: isCollapsed("totalBody")
  };
  localStorage.setItem(LS_KEY, JSON.stringify(state));
}
function loadState(){
  try{
    const raw = localStorage.getItem(LS_KEY);
    if(!raw) return;
    const s = JSON.parse(raw);

    if(s.sport) setVal("sport", s.sport);
    if(s.level) setVal("level", s.level);

    onSportChange(true);
    onLevelChange(true);

    setVal("league", s.league);
    setVal("teams", s.teams);
    setVal("main2OddsA", s.main2OddsA);
    setVal("main2OddsB", s.main2OddsB);
    setVal("main3OddsH", s.main3OddsH);
    setVal("main3OddsD", s.main3OddsD);
    setVal("main3OddsA", s.main3OddsA);
    setVal("myProb", s.myProb);
    setVal("stake", s.stake);
    setVal("handicapLine", s.handicapLine);
    setVal("handicapOddsHome", s.handicapOddsHome);
    setVal("handicapOddsAway", s.handicapOddsAway);
    setVal("totalLine", s.totalLine);
    setVal("overOdds", s.overOdds);
    setVal("underOdds", s.underOdds);
    setVal("myOverProb", s.myOverProb);
    setVal("pushProb", s.pushProb);

    if(typeof s.handicapCollapsed === "boolean") setCollapsed("handicapBody", s.handicapCollapsed);
    if(typeof s.totalCollapsed === "boolean") setCollapsed("totalBody", s.totalCollapsed);
  }catch(e){}
}

/* ì…ë ¥ ì´ë²¤íŠ¸ ìë™ ì €ì¥ */
[
  "sport","level","league","teams",
  "main2OddsA","main2OddsB","main3OddsH","main3OddsD","main3OddsA",
  "myProb","stake",
  "handicapLine","handicapOddsHome","handicapOddsAway",
  "totalLine","overOdds","underOdds","myOverProb","pushProb"
].forEach(id=>{
  const el=$(id);
  if(el) el.addEventListener("input", saveState);
});

/* =========================
   ë§ˆì§„ ê¸°ì¤€(ì¢…ëª©/ìœ í˜•ë³„)
   - ê°’ì€ â€œë§ˆì§„%â€ ê¸°ì¤€
========================= */
const MARGIN_RULES = {
  soccer: {
    main: { low: 4.0, ok: 7.0 },      // 3wayëŠ” ë³´í†µ ë” ë†’ìŒ
    ou:   { low: 3.5, ok: 6.5 },
    handicap:{ low: 3.5, ok: 6.5 }
  },
  basketball: {
    main: { low: 3.0, ok: 6.0 },
    ou:   { low: 3.0, ok: 6.0 },
    handicap:{ low: 3.0, ok: 6.0 }
  },
  baseball: {
    main: { low: 3.2, ok: 6.2 },
    ou:   { low: 3.2, ok: 6.2 },
    handicap:{ low: 3.2, ok: 6.2 }
  },
  volleyball: {
    main: { low: 3.0, ok: 6.0 },
    ou:   { low: 3.0, ok: 6.0 },
    handicap:{ low: 3.0, ok: 6.0 }
  },
  esports: {
    main: { low: 3.5, ok: 7.0 },
    ou:   { low: 3.5, ok: 7.0 },
    handicap:{ low: 3.5, ok: 7.0 }
  },
  hockey: {
    main: { low: 3.2, ok: 6.2 },
    ou:   { low: 3.2, ok: 6.2 },
    handicap:{ low: 3.2, ok: 6.2 }
  }
};

function getRule(sport, market){
  const s = MARGIN_RULES[sport] || MARGIN_RULES.soccer;
  return s[market] || {low:3.5, ok:6.5};
}

function marginStatus(sport, market, marginPct){
  const rule = getRule(sport, market);
  if(marginPct <= rule.low) return {label:"ë§ˆì§„ ë‚®ìŒ", cls:"good"};
  if(marginPct <= rule.ok)  return {label:"ë³´í†µ", cls:"warn"};
  return {label:"ê³ ë§ˆì§„", cls:"bad"};
}
function setPill(pillEl, hintEl, sport, market, marginPct){
  if(!pillEl || !hintEl){
    return;
  }
  if(marginPct==null){
    pillEl.className = "pill";
    pillEl.textContent = "ì…ë ¥ ëŒ€ê¸°";
    hintEl.textContent = "";
    return;
  }
  const st = marginStatus(sport, market, marginPct);
  pillEl.className = "pill " + st.cls;
  pillEl.textContent = `${st.label} Â· ${marginPct.toFixed(2)}%`;
  const rule = getRule(sport, market);
  hintEl.textContent = `ê¸°ì¤€: ë‚®ìŒ â‰¤ ${rule.low.toFixed(1)}% / ë³´í†µ â‰¤ ${rule.ok.toFixed(1)}% / ê·¸ ì´ìƒ ê³ ë§ˆì§„`;
}

function updateRulePreview(){
  const sport = val("sport") || "soccer";
  const m = getRule(sport,"main");
  const ou = getRule(sport,"ou");
  const hd = getRule(sport,"handicap");
  const name = (SPORT_CFG[sport]?.name) || "ì¶•êµ¬";
  $("marginRulePreview").innerHTML =
    `<b>${name}</b> ê¸°ì¤€<br>` +
    `ë©”ì¸: ë‚®ìŒ â‰¤ ${m.low.toFixed(1)}% / ë³´í†µ â‰¤ ${m.ok.toFixed(1)}%<br>` +
    `OU: ë‚®ìŒ â‰¤ ${ou.low.toFixed(1)}% / ë³´í†µ â‰¤ ${ou.ok.toFixed(1)}%<br>` +
    `í•¸ë””: ë‚®ìŒ â‰¤ ${hd.low.toFixed(1)}% / ë³´í†µ â‰¤ ${hd.ok.toFixed(1)}%`;
}

/* =========================
   UI: í…œí”Œë¦¿ + ë‚œì´ë„ (ê¸°ì¡´ ìœ ì§€)
========================= */
function onSportChange(silent){
  const sport = val("sport");
  const cfg = SPORT_CFG[sport] || SPORT_CFG.soccer;

  $("sportHint").innerText = `ì„ íƒ ì¢…ëª©: ${cfg.name} Â· ${cfg.hint}`;

  const is3 = cfg.main === "3way";
  $("main2").style.display = is3 ? "none" : "block";
  $("main3").style.display = is3 ? "block" : "none";
  $("mainMarketTitle").innerText = is3 ? "ë©”ì¸ ë°°ë‹¹ (í™ˆ/ë¬´/ì›ì •)" : "ë©”ì¸ ë°°ë‹¹ (ìŠ¹/íŒ¨)";

  if(!is3){
    $("main2LabelA").innerText = `${cfg.labels.A} ë°°ë‹¹`;
    $("main2LabelB").innerText = `${cfg.labels.B} ë°°ë‹¹`;
  }else{
    $("main3LabelH").innerText = `${cfg.labels.H} ë°°ë‹¹`;
    $("main3LabelD").innerText = `${cfg.labels.D} ë°°ë‹¹`;
    $("main3LabelA").innerText = `${cfg.labels.A} ë°°ë‹¹`;
  }

  applyTemplate();
  updateMyProbHints(cfg, val("level"));
  updateRulePreview();

  // ë§ˆì§„ pill ì´ˆê¸° ê°±ì‹ 
  updateMarginPills();

  if(!silent) hideResult();
  saveState();
}

function onLevelChange(silent){
  const level = val("level");
  $("valueInputs").style.display = (level === "simple") ? "none" : "block";
  $("handicapBox").style.display = (level === "simple") ? "none" : "block";
  $("totalBox").style.display = (level === "simple") ? "none" : "block";

  const cfg = SPORT_CFG[val("sport")] || SPORT_CFG.soccer;
  updateMyProbHints(cfg, level);
  applyTemplate();

  updateMarginPills();

  if(!silent) hideResult();
  saveState();
}

function updateMyProbHints(cfg, level){
  const is3 = cfg.main === "3way";
  if(level === "simple"){
    $("myProbLabel").innerText = "ë‚´ ì˜ˆìƒ í™•ë¥ (ì„ íƒ) %";
    $("myProbHint").innerText = "";
    return;
  }
  if(is3){
    $("myProbLabel").innerText = `ë‚´ ì˜ˆìƒ í™•ë¥ (${cfg.labels.H}/${cfg.labels.D}/${cfg.labels.A}) % (ì„ íƒ)`;
    $("myProbHint").innerText = `ì‰¼í‘œë¡œ 3ê°œ ì…ë ¥ (ì˜ˆ: 45,28,27) Â· í•© 100 ê¶Œì¥`;
  }else{
    $("myProbLabel").innerText = `ë‚´ ì˜ˆìƒ í™•ë¥ (${cfg.labels.A}) % (ì„ íƒ)`;
    $("myProbHint").innerText = `ì˜ˆ: 55 (ë‹¨ì¼ ê°’) Â· EV/ê¶Œì¥ë¹„ì¤‘ ê³„ì‚°ìš©`;
  }
}

function applyTemplate(){
  const level = val("level");
  const cfg = SPORT_CFG[val("sport")] || SPORT_CFG.soccer;
  if(level === "simple") return;
  setCollapsed("handicapBody", !cfg.template.openHandicap);
  setCollapsed("totalBody", !cfg.template.openTotal);
}

/* ì ‘ê¸°/í¼ì¹˜ê¸° */
function toggleBox(id){
  const now = isCollapsed(id);
  setCollapsed(id, !now);
  saveState();
}
function isCollapsed(id){
  const el = $(id);
  return el ? el.style.display === "none" : false;
}
function setCollapsed(id, collapsed){
  const el = $(id);
  if(!el) return;
  el.style.display = collapsed ? "none" : "block";
}

/* =========================
   ê³„ì‚° ë¡œì§ (ê¸°ì¡´ 100% ìœ ì§€ + í†µí•© í™•ì¥)
========================= */
function parseOdds(v){
  if(!v) return null;
  const x = Number(String(v).replace(/,/g,".").trim());
  if(!isFinite(x) || x<=1) return null;
  return x;
}
function parsePct(v){
  if(v==null || v==="") return null;
  const x = Number(String(v).replace(/,/g,".").trim());
  if(!isFinite(x) || x<0 || x>100) return null;
  return x/100;
}
function parsePctList(str){
  if(!str) return null;
  const parts = str.split(",").map(s=>s.trim()).filter(Boolean);
  if(parts.length !== 3) return null;
  const p1=parsePct(parts[0]), p2=parsePct(parts[1]), p3=parsePct(parts[2]);
  if(p1==null || p2==null || p3==null) return null;
  return [p1,p2,p3];
}
function parseMoney(v){
  if(!v) return null;
  const x = Number(String(v).replace(/[^\d]/g,""));
  if(!isFinite(x) || x<=0) return null;
  return x;
}
function pct(x){ return (x*100).toFixed(1) + "%"; }
function money(x){
  const n = Math.round(x);
  return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + "ì›";
}
function expectedValue(stake, p, odds){
  return stake * (p*(odds-1) - (1-p));
}
function quarterKelly(p, odds){
  const b = odds - 1;
  const f = (p*odds - 1) / b;
  const q = f/4;
  return Math.max(0, Math.min(0.25, q));
}
function levelLabel(level){
  return level==="simple" ? "ê°„ë‹¨" : (level==="mid" ? "ì¤‘ê¸‰" : "ê³ ê¸‰");
}

/* ===== ë§ˆì§„ ê³„ì‚°(í†µí•©) ===== */
function calcMainMargin(sport){
  const cfg = SPORT_CFG[sport] || SPORT_CFG.soccer;
  if(cfg.main === "2way"){
    const a = parseOdds(val("main2OddsA"));
    const b = parseOdds(val("main2OddsB"));
    if(a==null || b==null) return null;
    const over = (1/a) + (1/b);
    return { over, margin:(over-1)*100 };
  }else{
    const h = parseOdds(val("main3OddsH"));
    const d = parseOdds(val("main3OddsD"));
    const a = parseOdds(val("main3OddsA"));
    if(h==null || d==null || a==null) return null;
    const over = (1/h)+(1/d)+(1/a);
    return { over, margin:(over-1)*100 };
  }
}
function calcHandicapMargin(){
  const h = parseOdds(val("handicapOddsHome"));
  const a = parseOdds(val("handicapOddsAway"));
  if(h==null || a==null) return null;
  const over = (1/h) + (1/a);
  return { over, margin:(over-1)*100 };
}

/* âœ… OU ì•„ì‹œì•ˆ(í‘¸ì‹œ) 3-way ê·¼ì‚¬:
   - pushProb(ì„ íƒ)ì´ ìˆìœ¼ë©´: OverWin, UnderWin, Push í•©ì˜ ì˜¤ë²„ë¼ìš´ë“œ ê³„ì‚°
   - pushProb ì—†ìœ¼ë©´ 0ìœ¼ë¡œ ê°„ì£¼(ì¼ë°˜ 2-wayì²˜ëŸ¼)
*/
function calcOUMargin(){
  const lineStr = String(val("totalLine")||"").trim();
  const o = parseOdds(val("overOdds"));
  const u = parseOdds(val("underOdds"));
  if(!lineStr || o==null || u==null) return null;

  let pushP = parsePct(val("pushProb")); // 0~1
  if(pushP==null) pushP = 0;

  // 0.25/0.75 ë¼ì¸ì—ì„  í‘¸ì‹œ ì˜í–¥ì´ ìƒëŒ€ì ìœ¼ë¡œ ì ì–´ ê¸°ë³¸ 0ì„ ê¶Œì¥ (í•˜ì§€ë§Œ ì…ë ¥í•˜ë©´ ë°˜ì˜)
  const lineNum = Number(lineStr.replace(/,/g,"."));
  const frac = Math.abs(lineNum - Math.trunc(lineNum));
  const isQuarter = (Math.abs(frac-0.25)<1e-9) || (Math.abs(frac-0.75)<1e-9);
  if(isQuarter && pushP>0.08) pushP = 0.08;

  // ìŠ¹ë¦¬(ì •ì‚°) í™•ë¥ ì˜ implied (í‘¸ì‹œ ì œì™¸)
  const impliedOverWin = (1 - pushP) / o;
  const impliedUnderWin = (1 - pushP) / u;

  const overround = impliedOverWin + impliedUnderWin + pushP;
  return { over: overround, margin:(overround-1)*100, pushP };
}

/* âœ… ë§ˆì§„ pill ì‹¤ì‹œê°„ ê°±ì‹  */
function updateMarginPills(){
  const sport = val("sport") || "soccer";
  const main = calcMainMargin(sport);
  const hd = calcHandicapMargin();
  const ou = calcOUMargin();

  setPill($("mainMarginPill"), $("mainMarginHint"), sport, "main", main?main.margin:null);
  setPill($("handicapMarginPill"), $("handicapMarginHint"), sport, "handicap", hd?hd.margin:null);
  setPill($("ouMarginPill"), $("ouMarginHint"), sport, "ou", ou?ou.margin:null);
}

/* =========================
   ê²°ê³¼ ë Œë” + ì €ì¥(íˆìŠ¤í† ë¦¬/Top3)
========================= */
function renderResult(sportName, level, rows, copyLines){
  const box = $("result");
  const html = rows.map(([k,v])=>{
    let cls = "";
    if(String(k).includes("íŒë‹¨")){
      cls = String(v).includes("-EV") ? "m-bad" : "m-good";
    }
    return `<div class="kv"><div class="k">${k}</div><div class="v ${cls}">${v}</div></div>`;
  }).join("");

  box.innerHTML = `
    <div style="font-weight:900;margin-bottom:6px;">${sportName} Â· ${levelLabel(level)} ê²°ê³¼</div>
    ${html}
    <hr class="sep">
    <div style="font-size:12px;color:#9a9a9a;line-height:1.5;">
      â€» ë§ˆì§„ ì œê±° í™•ë¥ ì€ ë°°ë‹¹ì˜ ì—­ìˆ˜ë¥¼ ì •ê·œí™”í•´ í•©ì´ 100%ê°€ ë˜ë„ë¡ ë§Œë“  ê°’ì…ë‹ˆë‹¤.<br>
      â€» EV/ë¹„ì¤‘ì€ ì‚¬ìš©ìê°€ ì…ë ¥í•œ â€œë‚´ ì˜ˆìƒ í™•ë¥ â€ ê¸°ë°˜ì˜ ì°¸ê³  ì§€í‘œì´ë©° ìŠ¹ë¥ ì„ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
      â€» OU í‘¸ì‹œ(ì•„ì‹œì•ˆ)ëŠ” í‘¸ì‹œ í™•ë¥ ì„ ê·¼ì‚¬ ì…ë ¥í•´ 3-way í˜•íƒœë¡œ ê³„ì‚°í•©ë‹ˆë‹¤. (ì°¸ê³ ìš©)
    </div>
  `;
  box.style.display = "block";

  copyLines.push(`ì£¼ì†Œ: https://88st.cloud/analysis.html`);
  LAST_TEXT = copyLines.join("\n") + "\n\n" + rows.map(r=>`${r[0]}: ${r[1]}`).join("\n");
}

function showError(msg){
  const box = $("result");
  box.innerHTML = `<div class="kv"><div class="k">ì•ˆë‚´</div><div class="v m-bad">${msg}</div></div>`;
  box.style.display = "block";
  LAST_TEXT = `[88 ì»¤ë®¤ë‹ˆí‹°] ì•ˆë‚´\n${msg}\nì£¼ì†Œ: https://88st.cloud/analysis.html`;
}
function hideResult(){
  const box = $("result");
  box.style.display = "none";
  box.innerHTML = "";
  LAST_TEXT = "";
}

/* =========================
   âœ… ê¸°ì¡´ calc() (ê¸°ëŠ¥ ìœ ì§€) + í†µí•© í™•ì¥(ë§ˆì§„/íˆìŠ¤í† ë¦¬)
========================= */
function calc(){
  const sport = val("sport");
  const level = val("level");
  const cfg = SPORT_CFG[sport] || SPORT_CFG.soccer;
  const is3 = cfg.main === "3way";

  const rows = [];
  const copyLines = [];
  copyLines.push(`[88 ì»¤ë®¤ë‹ˆí‹°] ${cfg.name} ë¶„ì„ (${levelLabel(level)})`);

  // ë¦¬ê·¸/íŒ€(ì„ íƒ)
  const league = val("league").trim();
  const teams  = val("teams").trim();
  if(league) copyLines.push(`ë¦¬ê·¸: ${league}`);
  if(teams)  copyLines.push(`ê²½ê¸°: ${teams}`);

  // ---- ë©”ì¸ ì‹œì¥ ----
  let mainMargin = null;

  if(!is3){
    const a = parseOdds(val("main2OddsA"));
    const b = parseOdds(val("main2OddsB"));
    if(a==null || b==null) return showError("ë©”ì¸ ë°°ë‹¹ì„ 1.01 ì´ìƒ ìˆ«ìë¡œ ì…ë ¥í•´ì¤˜.");

    const ia=1/a, ib=1/b;
    const over = ia+ib;
    mainMargin = (over-1)*100;

    const pa=ia/over, pb=ib/over;

    rows.push([`ë§ˆì§„ ì œê±° í™•ë¥ (${cfg.labels.A})`, pct(pa)]);
    rows.push([`ë§ˆì§„ ì œê±° í™•ë¥ (${cfg.labels.B})`, pct(pb)]);
    rows.push(["ì˜¤ë²„ë¼ìš´ë“œ(ë§ˆì§„ ì¶”ì •)", over.toFixed(4)]);

    // âœ… ì¢…ëª©/ìœ í˜•ë³„ ë§ˆì§„ íŒì •
    const st = marginStatus(sport,"main",mainMargin);
    rows.push(["ë©”ì¸ ë§ˆì§„ íŒì •", `<span class="${st.cls==='good'?'m-good':(st.cls==='warn'?'m-warn':'m-bad')}">${st.label} (${mainMargin.toFixed(2)}%)</span>`]);

    copyLines.push(`ë©”ì¸ ë°°ë‹¹(${cfg.labels.A}/${cfg.labels.B}): ${a} / ${b}`);

    if(level !== "simple"){
      const myP = parsePct(val("myProb"));
      const stake = parseMoney(val("stake"));

      if(myP!=null){
        const evPer1 = (myP*(a-1) - (1-myP));
        rows.push([`ë‚´ ì˜ˆìƒ í™•ë¥ (${cfg.labels.A})`, pct(myP)]);
        rows.push(["EV(1ì›ë‹¹)", (evPer1*100).toFixed(2) + "%"]);
        copyLines.push(`ë‚´ ì˜ˆìƒ í™•ë¥ (${cfg.labels.A}): ${(myP*100).toFixed(1)}%`);
        if(stake!=null){
          rows.push(["ê¸°ëŒ€ê°’(EV)", money(expectedValue(stake, myP, a))]);
          copyLines.push(`ë² íŒ…ê¸ˆ: ${money(stake)}`);
        }
        if(level === "adv"){
          const k = quarterKelly(myP, a);
          rows.push(["ê¶Œì¥ ë¹„ì¤‘(ë³´ìˆ˜ì  1/4 Kelly)", (k*100).toFixed(1) + "%"]);
          rows.push(["íŒë‹¨", evPer1>0 ? "ë°¸ë¥˜(+EV) ê°€ëŠ¥ì„±" : "ë°¸ë¥˜(-EV) ê°€ëŠ¥ì„±"]);
        }else{
          rows.push(["íŒë‹¨", evPer1>0 ? "ë°¸ë¥˜(+EV) ê°€ëŠ¥ì„±" : "ë°¸ë¥˜(-EV) ê°€ëŠ¥ì„±"]);
        }
      }else{
        rows.push(["Tip", "ì¤‘ê¸‰/ê³ ê¸‰ì—ì„œëŠ” 'ë‚´ ì˜ˆìƒ í™•ë¥ 'ì„ ì…ë ¥í•˜ë©´ EVê°€ ê³„ì‚°ë©ë‹ˆë‹¤. (ì„ íƒì‚¬í•­)"]);
      }
    }
  }else{
    const h = parseOdds(val("main3OddsH"));
    const d = parseOdds(val("main3OddsD"));
    const a = parseOdds(val("main3OddsA"));
    if(h==null || d==null || a==null) return showError("ë©”ì¸ ë°°ë‹¹(í™ˆ/ë¬´/ì›ì •)ì„ 1.01 ì´ìƒ ìˆ«ìë¡œ ì…ë ¥í•´ì¤˜.");

    const ih=1/h, id=1/d, ia=1/a;
    const over = ih+id+ia;
    mainMargin = (over-1)*100;

    const ph=ih/over, pd=id/over, pa=ia/over;

    rows.push([`ë§ˆì§„ ì œê±° í™•ë¥ (${cfg.labels.H})`, pct(ph)]);
    rows.push([`ë§ˆì§„ ì œê±° í™•ë¥ (${cfg.labels.D})`, pct(pd)]);
    rows.push([`ë§ˆì§„ ì œê±° í™•ë¥ (${cfg.labels.A})`, pct(pa)]);
    rows.push(["ì˜¤ë²„ë¼ìš´ë“œ(ë§ˆì§„ ì¶”ì •)", over.toFixed(4)]);

    const st = marginStatus(sport,"main",mainMargin);
    rows.push(["ë©”ì¸ ë§ˆì§„ íŒì •", `<span class="${st.cls==='good'?'m-good':(st.cls==='warn'?'m-warn':'m-bad')}">${st.label} (${mainMargin.toFixed(2)}%)</span>`]);

    copyLines.push(`ë©”ì¸ ë°°ë‹¹(${cfg.labels.H}/${cfg.labels.D}/${cfg.labels.A}): ${h} / ${d} / ${a}`);

    if(level !== "simple"){
      const my = parsePctList(val("myProb"));
      const stake = parseMoney(val("stake"));

      if(my){
        const evH = (my[0]*(h-1) - (1-my[0]));
        const evD = (my[1]*(d-1) - (1-my[1]));
        const evA = (my[2]*(a-1) - (1-my[2]));

        rows.push([`ë‚´ ì˜ˆìƒ í™•ë¥ (${cfg.labels.H}/${cfg.labels.D}/${cfg.labels.A})`,
          `${pct(my[0])} / ${pct(my[1])} / ${pct(my[2])}`]);

        rows.push(["EV(í™ˆ/ë¬´/ì›ì •, 1ì›ë‹¹)", `${(evH*100).toFixed(2)}% / ${(evD*100).toFixed(2)}% / ${(evA*100).toFixed(2)}%`]);

        const best = [
          {k:cfg.labels.H, ev:evH, odds:h, p:my[0]},
          {k:cfg.labels.D, ev:evD, odds:d, p:my[1]},
          {k:cfg.labels.A, ev:evA, odds:a, p:my[2]}
        ].sort((x,y)=>y.ev-x.ev)[0];

        rows.push(["ê°€ì¥ ë†’ì€ EV", `${best.k} (${(best.ev*100).toFixed(2)}%)`]);
        if(stake!=null) rows.push(["ê¸°ëŒ€ê°’(EV, ìµœê³  EV ê¸°ì¤€)", money(expectedValue(stake, best.p, best.odds))]);

        if(level === "adv"){
          rows.push(["ê¶Œì¥ ë¹„ì¤‘(ë³´ìˆ˜ì  1/4 Kelly, ìµœê³  EV ê¸°ì¤€)", (quarterKelly(best.p, best.odds)*100).toFixed(1) + "%"]);
          rows.push(["íŒë‹¨", best.ev>0 ? "ë°¸ë¥˜(+EV) ê°€ëŠ¥ì„±" : "ë°¸ë¥˜(-EV) ê°€ëŠ¥ì„±"]);
        }else{
          rows.push(["íŒë‹¨", best.ev>0 ? "ë°¸ë¥˜(+EV) ê°€ëŠ¥ì„±" : "ë°¸ë¥˜(-EV) ê°€ëŠ¥ì„±"]);
        }

        copyLines.push(`ë‚´ ì˜ˆìƒ í™•ë¥ : ${(my[0]*100).toFixed(1)}% / ${(my[1]*100).toFixed(1)}% / ${(my[2]*100).toFixed(1)}%`);
        if(stake!=null) copyLines.push(`ë² íŒ…ê¸ˆ: ${money(stake)}`);
      }else{
        rows.push(["Tip", "ì¤‘ê¸‰/ê³ ê¸‰ì—ì„œëŠ” ë‚´ ì˜ˆìƒ í™•ë¥ (ì˜ˆ: 45,28,27)ì„ ì…ë ¥í•˜ë©´ EVê°€ ê³„ì‚°ë©ë‹ˆë‹¤. (ì„ íƒì‚¬í•­)"]);
      }
    }
  }

  // ---- ì¤‘ê¸‰/ê³ ê¸‰: ì˜¤ë²„ì–¸ë” ----
  let ouMargin = null;
  let ouOverround = null;
  if(level !== "simple"){
    const tLine = val("totalLine").trim();
    const oOdds = parseOdds(val("overOdds"));
    const uOdds = parseOdds(val("underOdds"));

    if(tLine && oOdds!=null && uOdds!=null){
      const ou = calcOUMargin();
      if(ou){
        ouMargin = ou.margin;
        ouOverround = ou.over;

        // ê¸°ì¡´ í™•ë¥ (2-way ì •ê·œí™”) í‘œì‹œ ìœ ì§€ + í‘¸ì‹œ ê·¼ì‚¬ ì•ˆë‚´
        const io=1/oOdds, iu=1/uOdds;
        const over2 = io+iu;
        const pOver = io/over2, pUnder = iu/over2;

        rows.push([`ì˜¤ë²„/ì–¸ë”(ê¸°ì¤€ ${tLine}) ë§ˆì§„ ì œê±° í™•ë¥ (2-way ì°¸ê³ )`, `ì˜¤ë²„ ${pct(pOver)} / ì–¸ë” ${pct(pUnder)}`]);
        rows.push([`ì˜¤ë²„/ì–¸ë” ì˜¤ë²„ë¼ìš´ë“œ(í‘¸ì‹œ ê·¼ì‚¬ í¬í•¨)`, ouOverround.toFixed(4)]);

        const st2 = marginStatus(sport,"ou",ouMargin);
        rows.push(["OU ë§ˆì§„ íŒì •", `<span class="${st2.cls==='good'?'m-good':(st2.cls==='warn'?'m-warn':'m-bad')}">${st2.label} (${ouMargin.toFixed(2)}%)</span>`]);

        copyLines.push(`ì˜¤ë²„ì–¸ë” ${tLine}: ì˜¤ë²„ ${oOdds} / ì–¸ë” ${uOdds}`);
        const pushPct = (ou.pushP*100).toFixed(1);
        copyLines.push(`í‘¸ì‹œ í™•ë¥ (ê·¼ì‚¬): ${pushPct}%`);

        // ê³ ê¸‰ EV(ì˜¤ë²„)
        const myOver = parsePct(val("myOverProb"));
        if(level === "adv" && myOver!=null){
          const stake = parseMoney(val("stake")) || null;
          const evPer1 = (myOver*(oOdds-1) - (1-myOver));
          rows.push([`ë‚´ ì˜ˆìƒ í™•ë¥ (ì˜¤ë²„)`, pct(myOver)]);
          rows.push([`ì˜¤ë²„ EV(1ì›ë‹¹)`, (evPer1*100).toFixed(2) + "%"]);
          if(stake!=null) rows.push([`ì˜¤ë²„ ê¸°ëŒ€ê°’(EV)`, money(expectedValue(stake, myOver, oOdds))]);
          rows.push([`ì˜¤ë²„ ê¶Œì¥ ë¹„ì¤‘(1/4 Kelly)`, (quarterKelly(myOver, oOdds)*100).toFixed(1) + "%"]);
          rows.push([`ì˜¤ë²„ íŒë‹¨`, evPer1>0 ? "ë°¸ë¥˜(+EV) ê°€ëŠ¥ì„±" : "ë°¸ë¥˜(-EV) ê°€ëŠ¥ì„±"]);
        }
      }
    }
  }

  // ---- ì¤‘ê¸‰/ê³ ê¸‰: í•¸ë”” (ì •ë°€ ë§ˆì§„ë§Œ í†µí•© í‘œì‹œ) ----
  let handicapMargin = null;
  let handicapOverround = null;
  if(level !== "simple"){
    const hLine = val("handicapLine").trim();
    const hH = parseOdds(val("handicapOddsHome"));
    const hA = parseOdds(val("handicapOddsAway"));
    if(hLine && hH!=null && hA!=null){
      const hd = calcHandicapMargin();
      if(hd){
        handicapMargin = hd.margin;
        handicapOverround = hd.over;
        rows.push([`í•¸ë””ìº¡(ë¼ì¸ ${hLine}) ì˜¤ë²„ë¼ìš´ë“œ`, handicapOverround.toFixed(4)]);
        const st3 = marginStatus(sport,"handicap",handicapMargin);
        rows.push(["í•¸ë”” ë§ˆì§„ íŒì •", `<span class="${st3.cls==='good'?'m-good':(st3.cls==='warn'?'m-warn':'m-bad')}">${st3.label} (${handicapMargin.toFixed(2)}%)</span>`]);
        copyLines.push(`í•¸ë”” ${hLine}: í™ˆ ${hH} / ì›ì • ${hA}`);
      }
    }
  }

  // âœ… ê²°ê³¼ ë Œë”
  renderResult(cfg.name, level, rows, copyLines);
  saveState();

  // âœ… ë§ˆì§„ pill ê°±ì‹ 
  updateMarginPills();

  // âœ… íˆìŠ¤í† ë¦¬ ì €ì¥ (ì…ë ¥ ë³µì› + ì¦‰ì‹œ ì¬ê³„ì‚° ì§€ì›)
  saveHistoryRecord({
    sport,
    level,
    league, teams,
    mainMargin,
    ouMargin,
    handicapMargin,
    margins: {
      main: mainMargin!=null ? { margin: mainMargin } : null,
      ou: ouMargin!=null ? { margin: ouMargin } : null,
      handicap: handicapMargin!=null ? { margin: handicapMargin } : null
    },
    snapshot: snapshotInputs(),
    ts: Date.now()
  });

  // âœ… íˆìŠ¤í† ë¦¬/Top3 ê°±ì‹ 
  renderHistory();
  renderSeparatedTop3();
}

/* âœ… ì…ë ¥ ìŠ¤ëƒ…ìƒ· */
function snapshotInputs(){
  return {
    sport: val("sport"),
    level: val("level"),
    league: val("league"),
    teams: val("teams"),
    main2OddsA: val("main2OddsA"),
    main2OddsB: val("main2OddsB"),
    main3OddsH: val("main3OddsH"),
    main3OddsD: val("main3OddsD"),
    main3OddsA: val("main3OddsA"),
    myProb: val("myProb"),
    stake: val("stake"),
    handicapLine: val("handicapLine"),
    handicapOddsHome: val("handicapOddsHome"),
    handicapOddsAway: val("handicapOddsAway"),
    totalLine: val("totalLine"),
    overOdds: val("overOdds"),
    underOdds: val("underOdds"),
    myOverProb: val("myOverProb"),
    pushProb: val("pushProb"),
    handicapCollapsed: isCollapsed("handicapBody"),
    totalCollapsed: isCollapsed("totalBody")
  };
}

/* âœ… ìŠ¤ëƒ…ìƒ· ë³µì› + ì¦‰ì‹œ ì¬ê³„ì‚° */
function restoreInputs(snap){
  if(!snap) return;
  setVal("sport", snap.sport || "soccer");
  setVal("level", snap.level || "simple");
  onSportChange(true);
  onLevelChange(true);

  setVal("league", snap.league || "");
  setVal("teams", snap.teams || "");
  setVal("main2OddsA", snap.main2OddsA || "");
  setVal("main2OddsB", snap.main2OddsB || "");
  setVal("main3OddsH", snap.main3OddsH || "");
  setVal("main3OddsD", snap.main3OddsD || "");
  setVal("main3OddsA", snap.main3OddsA || "");
  setVal("myProb", snap.myProb || "");
  setVal("stake", snap.stake || "");
  setVal("handicapLine", snap.handicapLine || "");
  setVal("handicapOddsHome", snap.handicapOddsHome || "");
  setVal("handicapOddsAway", snap.handicapOddsAway || "");
  setVal("totalLine", snap.totalLine || "");
  setVal("overOdds", snap.overOdds || "");
  setVal("underOdds", snap.underOdds || "");
  setVal("myOverProb", snap.myOverProb || "");
  setVal("pushProb", snap.pushProb || "");

  if(typeof snap.handicapCollapsed === "boolean") setCollapsed("handicapBody", snap.handicapCollapsed);
  if(typeof snap.totalCollapsed === "boolean") setCollapsed("totalBody", snap.totalCollapsed);

  saveState();
  updateMarginPills();
  calc(); // âœ… ì¦‰ì‹œ ì¬ê³„ì‚°
  toast("íˆìŠ¤í† ë¦¬ ì…ë ¥ ë³µì› + ì¬ê³„ì‚° ì™„ë£Œ");
  scrollToId("settingsCard");
}

/* =========================
   íˆìŠ¤í† ë¦¬ ì €ì¥/ë¡œë“œ/í‘œì‹œ
========================= */
function loadHistory(){
  try{
    const raw = localStorage.getItem(HIST_KEY);
    if(!raw) return [];
    const arr = JSON.parse(raw);
    return Array.isArray(arr) ? arr : [];
  }catch(e){ return []; }
}
function saveHistory(arr){
  localStorage.setItem(HIST_KEY, JSON.stringify(arr.slice(0, HIST_MAX)));
}
function getTodayKey(){
  return new Date().toISOString().slice(0,10);
}
function saveHistoryRecord(rec){
  const hist = loadHistory();

  // dayKey ì¶”ê°€
  rec.dayKey = getTodayKey();

  // ë§¨ ì•ì— ì¶”ê°€
  hist.unshift(rec);

  // ë™ì¼ ì…ë ¥ì´ ì—°ì†ìœ¼ë¡œ ìŒ“ì´ëŠ” ê±¸ ì•½ê°„ ë°©ì§€(ë°”ë¡œ ì§ì „ê³¼ ìŠ¤ëƒ…ìƒ·ì´ ì™„ì „ ë™ì¼í•˜ë©´ ë®ì–´ì“°ê¸°)
  if(hist.length >= 2){
    const a = JSON.stringify(hist[0].snapshot || {});
    const b = JSON.stringify(hist[1].snapshot || {});
    if(a === b){
      hist.splice(1,1);
    }
  }

  saveHistory(hist);
}

function fmtTime(ts){
  const d = new Date(ts);
  const hh = String(d.getHours()).padStart(2,"0");
  const mm = String(d.getMinutes()).padStart(2,"0");
  return `${hh}:${mm}`;
}
function pickTitle(snap){
  const league = (snap.league||"").trim();
  const teams = (snap.teams||"").trim();
  if(teams) return teams;
  if(league) return league;
  return "ë¶„ì„";
}
function marginLine(rec){
  const parts=[];
  if(rec.margins?.main?.margin!=null) parts.push(`ë©”ì¸ ${rec.margins.main.margin.toFixed(2)}%`);
  if(rec.margins?.ou?.margin!=null) parts.push(`OU ${rec.margins.ou.margin.toFixed(2)}%`);
  if(rec.margins?.handicap?.margin!=null) parts.push(`í•¸ë”” ${rec.margins.handicap.margin.toFixed(2)}%`);
  return parts.join(" Â· ") || "ë§ˆì§„ ì •ë³´ ì—†ìŒ";
}
function renderHistory(){
  const box = $("historyList");
  if(!box) return;
  const hist = loadHistory();
  if(!hist.length){
    box.innerHTML = `<div class="top3-empty">íˆìŠ¤í† ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤. ê³„ì‚°í•˜ê¸°ë¥¼ ëˆŒëŸ¬ ì €ì¥í•˜ì„¸ìš”.</div>`;
    return;
  }
  box.innerHTML = hist.slice(0,HIST_MAX).map((rec, idx)=>{
    const cfg = SPORT_CFG[rec.sport] || SPORT_CFG.soccer;
    const t = pickTitle(rec.snapshot||{});
    const when = fmtTime(rec.ts);
    return `
      <div class="hist-item" onclick="onHistoryClick(${idx})" title="í´ë¦­í•˜ë©´ ì…ë ¥ ë³µì› + ì¬ê³„ì‚°">
        <div class="hist-left">
          <div class="hist-top">
            <div class="hist-title">${t}</div>
            <div class="pill ${marginStatus(rec.sport,'main',(rec.margins?.main?.margin??999)).cls}" style="transform:scale(.92); transform-origin:left;">
              ${cfg.name} Â· ${levelLabel(rec.level)} Â· ${when}
            </div>
          </div>
          <div class="hist-meta">${marginLine(rec)}</div>
        </div>
        <div class="hist-right" onclick="event.stopPropagation();">
          <label class="hist-mline">ë¹„êµ ì„ íƒ</label>
          <input class="hist-check" type="checkbox" value="${idx}">
          <button class="smallbtn" onclick="event.stopPropagation(); restoreInputs(loadHistory()[${idx}].snapshot)">ë³µì›</button>
        </div>
      </div>
    `;
  }).join("");
}
function onHistoryClick(idx){
  const h = loadHistory();
  const rec = h[idx];
  if(!rec) return;
  restoreInputs(rec.snapshot);
}
function clearHistory(){
  if(!confirm("íˆìŠ¤í† ë¦¬ë¥¼ ëª¨ë‘ ì‚­ì œí• ê¹Œìš”?")) return;
  localStorage.removeItem(HIST_KEY);
  renderHistory();
  renderSeparatedTop3();
  $("compareResult").style.display="none";
}

/* =========================
   TOP3 (ë©”ì¸/OU/í•¸ë”” ë¶„ë¦¬)
========================= */
function fillTop3(id, arr, key){
  const el=$(id);
  if(!el) return;
  if(!arr.length){
    el.innerHTML = `<div class="top3-empty">ë°ì´í„° ì—†ìŒ</div>`;
    return;
  }
  el.innerHTML = arr.slice(0,3).map((x,i)=>{
    const m = x.margins[key].margin;
    const snap = x.snapshot || {};
    const title = pickTitle(snap);
    const pill = marginStatus(x.sport, key==="main"?"main":(key==="ou"?"ou":"handicap"), m);
    return `
      <div class="kv">
        <div class="k">${i+1}. ${title}</div>
        <div class="v ${pill.cls==='good'?'m-good':(pill.cls==='warn'?'m-warn':'m-bad')}">${m.toFixed(2)}%</div>
      </div>
    `;
  }).join("");
}
function renderSeparatedTop3(){
  const hist = loadHistory();
  const today = getTodayKey();

  const main=[], ou=[], hd=[];
  hist.filter(x=>x.dayKey===today).forEach(x=>{
    if(x.margins?.main?.margin!=null) main.push(x);
    if(x.margins?.ou?.margin!=null) ou.push(x);
    if(x.margins?.handicap?.margin!=null) hd.push(x);
  });

  main.sort((a,b)=>a.margins.main.margin - b.margins.main.margin);
  ou.sort((a,b)=>a.margins.ou.margin - b.margins.ou.margin);
  hd.sort((a,b)=>a.margins.handicap.margin - b.margins.handicap.margin);

  fillTop3("top3Main", main, "main");
  fillTop3("top3OU", ou, "ou");
  fillTop3("top3Handicap", hd, "handicap");
}

/* =========================
   ë¹„êµ(2ê°œ ë‚˜ë€íˆ)
========================= */
function compareSelected(){
  const checks=[...document.querySelectorAll(".hist-check:checked")];
  if(checks.length!==2) return alert("ë¹„êµí•  2ê°œë¥¼ ì„ íƒí•˜ì„¸ìš”. (ì •í™•íˆ 2ê°œ)");
  const hist = loadHistory();
  const a = hist[Number(checks[0].value)];
  const b = hist[Number(checks[1].value)];
  if(!a || !b) return;

  const aName = pickTitle(a.snapshot||{});
  const bName = pickTitle(b.snapshot||{});
  const aCfg = SPORT_CFG[a.sport] || SPORT_CFG.soccer;
  const bCfg = SPORT_CFG[b.sport] || SPORT_CFG.soccer;

  function fmtM(x){
    if(x==null) return "-";
    return x.toFixed(2) + "%";
  }

  $("compareResult").innerHTML = `
    <div style="font-weight:900;margin-bottom:6px;">ë¹„êµ ê²°ê³¼</div>

    <div class="kv"><div class="k">A</div><div class="v">${aCfg.name} Â· ${levelLabel(a.level)} Â· ${aName}</div></div>
    <div class="kv"><div class="k">B</div><div class="v">${bCfg.name} Â· ${levelLabel(b.level)} Â· ${bName}</div></div>

    <hr class="sep">

    <div class="kv"><div class="k">ë©”ì¸ ë§ˆì§„</div><div class="v">${fmtM(a.margins?.main?.margin)} / ${fmtM(b.margins?.main?.margin)}</div></div>
    <div class="kv"><div class="k">OU ë§ˆì§„</div><div class="v">${fmtM(a.margins?.ou?.margin)} / ${fmtM(b.margins?.ou?.margin)}</div></div>
    <div class="kv"><div class="k">í•¸ë”” ë§ˆì§„</div><div class="v">${fmtM(a.margins?.handicap?.margin)} / ${fmtM(b.margins?.handicap?.margin)}</div></div>

    <div class="note">
      â€» ë¹„êµëŠ” â€œì €ì¥ëœ ë‹¹ì‹œ ì…ë ¥â€ ê¸°ì¤€ì…ë‹ˆë‹¤. íˆìŠ¤í† ë¦¬ í´ë¦­ ì‹œ ì…ë ¥ ë³µì› + ì¦‰ì‹œ ì¬ê³„ì‚° ê°€ëŠ¥í•©ë‹ˆë‹¤.
    </div>
  `;
  $("compareResult").style.display="block";
  scrollToId("compareResult");
}

/* =========================
   ì´ˆê¸°í™”/ê³µìœ /ë³µì‚¬ (ê¸°ì¡´ ìœ ì§€)
========================= */
function resetAll(){
  [
    "league","teams",
    "main2OddsA","main2OddsB","main3OddsH","main3OddsD","main3OddsA",
    "myProb","stake",
    "handicapLine","handicapOddsHome","handicapOddsAway",
    "totalLine","overOdds","underOdds","myOverProb","pushProb"
  ].forEach(id=>{ const el=$(id); if(el) el.value=""; });

  hideResult();
  localStorage.removeItem(LS_KEY);
  updateMarginPills();
}
async function copyResult(){
  if(!LAST_TEXT) return showError("ë¨¼ì € 'ê³„ì‚°í•˜ê¸°'ë¥¼ ëˆŒëŸ¬ ê²°ê³¼ë¥¼ ë§Œë“  ë’¤ ë³µì‚¬í•  ìˆ˜ ìˆì–´ìš”.");
  try{
    await navigator.clipboard.writeText(LAST_TEXT);
    toast("ê²°ê³¼ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
  }catch(e){
    prompt("ì•„ë˜ ë‚´ìš©ì„ ë³µì‚¬í•˜ì„¸ìš”:", LAST_TEXT);
  }
}
async function shareResult(){
  if(!LAST_TEXT) return showError("ë¨¼ì € 'ê³„ì‚°í•˜ê¸°'ë¥¼ ëˆŒëŸ¬ ê²°ê³¼ë¥¼ ë§Œë“  ë’¤ ê³µìœ í•  ìˆ˜ ìˆì–´ìš”.");
  try{
    if(navigator.share){
      await navigator.share({ title:"88 ì»¤ë®¤ë‹ˆí‹° ë¶„ì„ ê²°ê³¼", text: LAST_TEXT });
    }else{
      await copyResult();
    }
  }catch(e){}
}

/* í† ìŠ¤íŠ¸ */
let toastTimer=null;
function toast(msg){
  let el=document.getElementById("toast88");
  if(!el){
    el=document.createElement("div");
    el.id="toast88";
    el.style.cssText="position:fixed;left:50%;bottom:22px;transform:translateX(-50%);background:rgba(0,0,0,.85);color:#fff;padding:10px 12px;border-radius:12px;font-size:12px;z-index:3000;border:1px solid rgba(255,255,255,.08)";
    document.body.appendChild(el);
  }
  el.textContent=msg;
  el.style.opacity="1";
  if(toastTimer) clearTimeout(toastTimer);
  toastTimer=setTimeout(()=>{ el.style.opacity="0"; }, 1400);
}

/* =========================
   ì‹¤ì‹œê°„ ë§ˆì§„ pill ì—…ë°ì´íŠ¸(ì…ë ¥ì‹œ)
========================= */
[
  "main2OddsA","main2OddsB","main3OddsH","main3OddsD","main3OddsA",
  "handicapOddsHome","handicapOddsAway",
  "totalLine","overOdds","underOdds","pushProb"
].forEach(id=>{
  const el=$(id);
  if(el) el.addEventListener("input", updateMarginPills);
});

/* =========================
   ì´ˆê¸° êµ¬ë™
========================= */
function boot(){
  loadState();
  if(!localStorage.getItem(LS_KEY)){
    setVal("sport","soccer");
    setVal("level","simple");
  }
  onSportChange(true);
  onLevelChange(true);

  // ì´ˆê¸° ë Œë”
  renderHistory();
  renderSeparatedTop3();
  updateRulePreview();
  updateMarginPills();
}
boot();
</script>

</body>
</html>
