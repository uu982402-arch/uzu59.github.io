<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>스포츠 배당 분석기 | 88 커뮤니티</title>
<meta name="description" content="종목(축구/농구/야구/배구/e스포츠/하키)별 배당 입력으로 마진 제거 확률, 오버라운드, 밸류(EV), 권장 비중(보수적 Kelly)까지 계산하는 분석기입니다. (판단 보조용)" />
<link rel="canonical" href="https://88st.cloud/analysis.html" />
<meta name="robots" content="index,follow" />

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto;
  background:#0b0b0b;
  color:#fff;
}

/* 상단 */
.header{ text-align:center; padding:14px 0 10px; }
.logo-link{display:inline-block;text-decoration:none}
.logo-img{
  display:block; margin:0 auto 6px;
  width:180px; max-width:72%; height:auto;
  filter:drop-shadow(0 0 10px rgba(212,175,55,.25));
}
@media(max-width:480px){ .logo-img{width:140px;max-width:82%} }
.sub{ font-size:12px; color:#9a9a9a; }

/* 레이아웃 */
.wrap{ max-width:900px; margin:0 auto; padding:10px 14px 28px; }
.card{
  background:#121212; border-radius:18px; padding:14px;
  box-shadow:0 10px 26px rgba(0,0,0,.45);
  margin-bottom:14px;
}
.title{ font-weight:900; color:#f5e27a; margin-bottom:10px; font-size:14px; }
.note{ color:#bdbdbd; font-size:12px; line-height:1.5; margin-top:8px; }
.small-hint{ font-size:11px; color:#8f8f8f; margin-top:6px; line-height:1.4; }

/* 컨트롤 */
.controls{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
@media(max-width:560px){ .controls{ grid-template-columns:1fr; } }
.select, .textinput{
  width:100%;
  padding:12px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.08);
  background:#0f0f0f;
  color:#fff;
  outline:none;
  font-weight:800;
}
.textinput{ font-weight:700; }
.row2{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin-top:10px;
}
@media(max-width:560px){ .row2{ grid-template-columns:1fr; } }

/* 입력 */
.grid{ display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px; }
@media(max-width:560px){ .grid{grid-template-columns:1fr} }
.field label{ display:block; font-size:12px; color:#bbb; margin:2px 0 6px; }
.field input{
  width:100%; padding:12px; border-radius:14px;
  border:1px solid rgba(255,255,255,.08);
  background:#0f0f0f; color:#fff; outline:none;
}
.field input::placeholder{color:#555}

/* 섹션 박스 */
.box{
  margin-top:12px;
  padding:12px;
  border-radius:16px;
  background:rgba(255,255,255,.03);
  border:1px solid rgba(255,255,255,.06);
}
.box-title{
  font-weight:900;
  margin:0 0 8px;
  color:#f5e27a;
  font-size:13px;
}
.box-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.toggle{
  cursor:pointer;
  font-size:12px;
  color:#cfcfcf;
  user-select:none;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.25);
}

/* 액션 */
.actions{ display:flex; gap:10px; margin-top:12px; flex-wrap:wrap; }
.btn{
  flex:1; min-width:160px;
  border:none; border-radius:14px; padding:12px;
  font-weight:900; cursor:pointer;
}
.primary{ background:linear-gradient(135deg,#1da1f2,#78d6ff); color:#00121a; }
.secondary{ background:#1f1f1f; color:#fff; border:1px solid rgba(255,255,255,.06); }
.gold{ background:linear-gradient(135deg,#d4af37,#f5e27a); color:#111; }

/* 결과 */
.result{
  background:rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.06);
  border-radius:16px;
  padding:12px;
  margin-top:12px;
}
.kv{
  display:flex; justify-content:space-between; gap:10px;
  padding:8px 0; border-bottom:1px solid rgba(255,255,255,.06);
  font-size:13px;
}
.kv:last-child{border-bottom:none}
.k{color:#cfcfcf}
.v{font-weight:900}
.warn{color:#ffb3b3}
.good{color:#b7ffcf}

hr.sep{
  border:none; height:1px; background:rgba(255,255,255,.06);
  margin:12px 0;
}

.footer-links{ display:flex; gap:10px; margin-top:14px; flex-wrap:wrap; }
.linkbtn{
  flex:1; min-width:160px;
  display:block; text-align:center; padding:12px;
  border-radius:14px; text-decoration:none; font-weight:900;
  background:#1f1f1f; color:#fff;
  border:1px solid rgba(255,255,255,.06);
}
</style>
</head>

<body>
<div class="header">
  <a class="logo-link" href="./" aria-label="홈으로 이동">
    <img src="img/logo-88-community.png" alt="88 커뮤니티" class="logo-img">
  </a>
  <div class="sub">스포츠 배당 분석기 (템플릿 · 선택입력 · 판단 보조용)</div>
</div>

<div class="wrap">
  <div class="card">
    <div class="title">설정</div>

    <div class="controls">
      <select id="sport" class="select" onchange="onSportChange()">
        <option value="soccer">축구</option>
        <option value="basketball">농구</option>
        <option value="baseball">야구</option>
        <option value="volleyball">배구</option>
        <option value="esports">e스포츠</option>
        <option value="hockey">하키</option>
      </select>

      <select id="level" class="select" onchange="onLevelChange()">
        <option value="simple">간단</option>
        <option value="mid">중급</option>
        <option value="adv">고급</option>
      </select>
    </div>

    <!-- ✅ 팀/리그 입력(선택) -->
    <div class="row2">
      <div>
        <input id="league" class="textinput" placeholder="리그/대회명 (선택)">
        <div class="small-hint">※ 입력하지 않아도 분석 가능 / 공유 시 입력한 내용만 포함됩니다.</div>
      </div>
      <div>
        <input id="teams" class="textinput" placeholder="팀명 (선택) 예: 맨시티 vs 리버풀">
        <div class="small-hint">※ 팀/리그는 선택사항입니다.</div>
      </div>
    </div>

    <div class="small-hint" id="sportHint" style="margin-top:10px;"></div>

    <!-- ===== 메인 시장 ===== -->
    <div class="box">
      <div class="box-title" id="mainMarketTitle">메인 배당</div>

      <!-- 2-way -->
      <div id="main2" style="display:none;">
        <div class="grid">
          <div class="field">
            <label id="main2LabelA">선택 A 배당</label>
            <input id="main2OddsA" inputmode="decimal" placeholder="예: 1.85">
          </div>
          <div class="field">
            <label id="main2LabelB">선택 B 배당</label>
            <input id="main2OddsB" inputmode="decimal" placeholder="예: 2.05">
          </div>
        </div>
      </div>

      <!-- 3-way -->
      <div id="main3" style="display:none;">
        <div class="grid">
          <div class="field">
            <label id="main3LabelH">홈 배당</label>
            <input id="main3OddsH" inputmode="decimal" placeholder="예: 2.10">
          </div>
          <div class="field">
            <label id="main3LabelD">무 배당</label>
            <input id="main3OddsD" inputmode="decimal" placeholder="예: 3.20">
          </div>
          <div class="field">
            <label id="main3LabelA">원정 배당</label>
            <input id="main3OddsA" inputmode="decimal" placeholder="예: 3.40">
          </div>
          <div class="field">
            <label> </label>
            <input disabled value="※ 축구는 3배당이 기본입니다">
          </div>
        </div>
      </div>

      <!-- 중급/고급: 내 확률/베팅금 -->
      <div id="valueInputs" style="display:none;">
        <div class="grid">
          <div class="field">
            <label id="myProbLabel">내 예상 확률(선택) %</label>
            <input id="myProb" inputmode="decimal" placeholder="예: 55  또는  45,28,27">
            <div class="small-hint" id="myProbHint"></div>
          </div>
          <div class="field">
            <label>베팅금(선택)</label>
            <input id="stake" inputmode="numeric" placeholder="예: 100000">
            <div class="small-hint">※ 입력 시 기대값(EV)을 원 단위로도 표시합니다.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== 핸디캡 ===== -->
    <div class="box" id="handicapBox" style="display:none;">
      <div class="box-head">
        <div class="box-title" style="margin:0;">핸디캡 (선택)</div>
        <div class="toggle" onclick="toggleBox('handicapBody')">접기/펼치기</div>
      </div>
      <div id="handicapBody">
        <div class="grid">
          <div class="field">
            <label>핸디 라인 (예: -1.5, +3.5)</label>
            <input id="handicapLine" inputmode="decimal" placeholder="예: -1.5">
          </div>
          <div class="field">
            <label>핸디 배당</label>
            <input id="handicapOdds" inputmode="decimal" placeholder="예: 1.90">
          </div>
        </div>
        <div class="small-hint">※ 고급 정확도를 원하면 “양쪽 배당(핸디 승/패)”이 있어야 더 정밀합니다.</div>
      </div>
    </div>

    <!-- ===== 오버언더 ===== -->
    <div class="box" id="totalBox" style="display:none;">
      <div class="box-head">
        <div class="box-title" style="margin:0;">오버/언더 (선택)</div>
        <div class="toggle" onclick="toggleBox('totalBody')">접기/펼치기</div>
      </div>
      <div id="totalBody">
        <div class="grid">
          <div class="field">
            <label>기준점 (예: 2.5, 7.5)</label>
            <input id="totalLine" inputmode="decimal" placeholder="예: 2.5">
          </div>
          <div class="field">
            <label>오버 배당</label>
            <input id="overOdds" inputmode="decimal" placeholder="예: 1.95">
          </div>
          <div class="field">
            <label>언더 배당</label>
            <input id="underOdds" inputmode="decimal" placeholder="예: 1.85">
          </div>
          <div class="field">
            <label>내 예상 확률(오버) % (고급)</label>
            <input id="myOverProb" inputmode="decimal" placeholder="예: 52">
          </div>
        </div>
        <div class="small-hint">※ 고급에서 내 예상 확률(오버)을 넣으면 오버 EV/비중 계산이 가능합니다.</div>
      </div>
    </div>

    <div class="actions">
      <button class="btn primary" onclick="calc()">계산하기</button>
      <button class="btn secondary" onclick="resetAll()">초기화</button>
      <button class="btn gold" onclick="copyResult()">결과 복사</button>
      <button class="btn secondary" onclick="shareResult()">공유</button>
    </div>

    <div class="note">
      ※ 본 도구는 “판단 보조용”입니다. 승률을 보장하지 않으며, 손실을 감당 가능한 범위 내에서 이용하세요.
    </div>

    <div class="result" id="result" style="display:none;"></div>

    <div class="footer-links">
      <a class="linkbtn" href="./">홈으로</a>
      <a class="linkbtn" href="https://t.me/UZU59" target="_blank" rel="noopener">문의 (텔레그램)</a>
    </div>
  </div>
</div>

<script>
/* =========================
   상태/저장
========================= */
const LS_KEY = "88_analysis_multi_v2";
let LAST_TEXT = "";

const SPORT_CFG = {
  soccer: {
    name: "축구",
    main: "3way",
    labels: {H:"홈", D:"무", A:"원정"},
    hint: "축구는 기본 3배당(홈/무/원정). 중급/고급에서 오버언더를 같이 보는 걸 추천합니다.",
    template: { openHandicap:false, openTotal:true }  // ✅ 축구는 OU 펼침
  },
  basketball: {
    name:"농구",
    main:"2way",
    labels:{A:"승", B:"패"},
    hint:"농구는 2배당(승/패) 중심. 중급/고급에서는 핸디+오버언더를 함께 추천.",
    template: { openHandicap:true, openTotal:true }   // ✅ 펼침
  },
  baseball: {
    name:"야구",
    main:"2way",
    labels:{A:"승", B:"패"},
    hint:"야구는 승/패(2배당) + 오버언더/핸디(런라인)를 함께 보는 경우가 많습니다.",
    template: { openHandicap:true, openTotal:true }
  },
  volleyball: {
    name:"배구",
    main:"2way",
    labels:{A:"승", B:"패"},
    hint:"배구는 2배당(승/패) 중심. 중급/고급에서 핸디/OU를 함께 확인하세요.",
    template: { openHandicap:true, openTotal:true }
  },
  esports: {
    name:"e스포츠",
    main:"2way",
    labels:{A:"승", B:"패"},
    hint:"e스포츠는 매치 승/패(2배당) 중심. 고급에서 EV/비중 계산이 가능합니다.",
    template: { openHandicap:false, openTotal:false } // ✅ e스포츠는 기본 접기
  },
  hockey: {
    name:"하키",
    main:"2way",
    labels:{A:"승", B:"패"},
    hint:"하키는 2배당(승/패) 기본. 중급/고급에서 오버언더가 도움이 됩니다.",
    template: { openHandicap:false, openTotal:true }  // ✅ OU 펼침
  }
};

function $(id){ return document.getElementById(id); }
function val(id){ const el=$(id); return el?el.value:""; }
function setVal(id,v){ const el=$(id); if(el && v!=null) el.value=v; }

function saveState(){
  const state = {
    sport: val("sport"),
    level: val("level"),
    league: val("league"),
    teams: val("teams"),
    main2OddsA: val("main2OddsA"),
    main2OddsB: val("main2OddsB"),
    main3OddsH: val("main3OddsH"),
    main3OddsD: val("main3OddsD"),
    main3OddsA: val("main3OddsA"),
    myProb: val("myProb"),
    stake: val("stake"),
    handicapLine: val("handicapLine"),
    handicapOdds: val("handicapOdds"),
    totalLine: val("totalLine"),
    overOdds: val("overOdds"),
    underOdds: val("underOdds"),
    myOverProb: val("myOverProb"),
    // 접힘 상태도 저장
    handicapCollapsed: isCollapsed("handicapBody"),
    totalCollapsed: isCollapsed("totalBody")
  };
  localStorage.setItem(LS_KEY, JSON.stringify(state));
}
function loadState(){
  try{
    const raw = localStorage.getItem(LS_KEY);
    if(!raw) return;
    const s = JSON.parse(raw);

    if(s.sport) setVal("sport", s.sport);
    if(s.level) setVal("level", s.level);

    // 먼저 템플릿 반영
    onSportChange(true);
    onLevelChange(true);

    setVal("league", s.league);
    setVal("teams", s.teams);
    setVal("main2OddsA", s.main2OddsA);
    setVal("main2OddsB", s.main2OddsB);
    setVal("main3OddsH", s.main3OddsH);
    setVal("main3OddsD", s.main3OddsD);
    setVal("main3OddsA", s.main3OddsA);
    setVal("myProb", s.myProb);
    setVal("stake", s.stake);
    setVal("handicapLine", s.handicapLine);
    setVal("handicapOdds", s.handicapOdds);
    setVal("totalLine", s.totalLine);
    setVal("overOdds", s.overOdds);
    setVal("underOdds", s.underOdds);
    setVal("myOverProb", s.myOverProb);

    // 접힘 상태 복원
    if(typeof s.handicapCollapsed === "boolean") setCollapsed("handicapBody", s.handicapCollapsed);
    if(typeof s.totalCollapsed === "boolean") setCollapsed("totalBody", s.totalCollapsed);
  }catch(e){}
}

/* 입력 이벤트 자동 저장 */
[
  "sport","level","league","teams",
  "main2OddsA","main2OddsB","main3OddsH","main3OddsD","main3OddsA",
  "myProb","stake",
  "handicapLine","handicapOdds",
  "totalLine","overOdds","underOdds","myOverProb"
].forEach(id=>{
  const el=$(id);
  if(el) el.addEventListener("input", saveState);
});

/* =========================
   UI: 템플릿 + 난이도
========================= */
function onSportChange(silent){
  const sport = val("sport");
  const cfg = SPORT_CFG[sport] || SPORT_CFG.soccer;

  $("sportHint").innerText = `선택 종목: ${cfg.name} · ${cfg.hint}`;

  const is3 = cfg.main === "3way";
  $("main2").style.display = is3 ? "none" : "block";
  $("main3").style.display = is3 ? "block" : "none";
  $("mainMarketTitle").innerText = is3 ? "메인 배당 (홈/무/원정)" : "메인 배당 (승/패)";

  if(!is3){
    $("main2LabelA").innerText = `${cfg.labels.A} 배당`;
    $("main2LabelB").innerText = `${cfg.labels.B} 배당`;
  }else{
    $("main3LabelH").innerText = `${cfg.labels.H} 배당`;
    $("main3LabelD").innerText = `${cfg.labels.D} 배당`;
    $("main3LabelA").innerText = `${cfg.labels.A} 배당`;
  }

  // 템플릿 적용(중급/고급일 때만 펼침/접기 강제)
  applyTemplate();

  // 내확률 힌트 업데이트
  updateMyProbHints(cfg, val("level"));

  if(!silent) hideResult();
  saveState();
}

function onLevelChange(silent){
  const level = val("level");
  $("valueInputs").style.display = (level === "simple") ? "none" : "block";
  $("handicapBox").style.display = (level === "simple") ? "none" : "block";
  $("totalBox").style.display = (level === "simple") ? "none" : "block";

  const cfg = SPORT_CFG[val("sport")] || SPORT_CFG.soccer;
  updateMyProbHints(cfg, level);

  // ✅ 레벨 바뀌면 템플릿 다시 적용
  applyTemplate();

  if(!silent) hideResult();
  saveState();
}

function updateMyProbHints(cfg, level){
  const is3 = cfg.main === "3way";
  if(level === "simple"){
    $("myProbLabel").innerText = "내 예상 확률(선택) %";
    $("myProbHint").innerText = "";
    return;
  }
  if(is3){
    $("myProbLabel").innerText = `내 예상 확률(${cfg.labels.H}/${cfg.labels.D}/${cfg.labels.A}) % (선택)`;
    $("myProbHint").innerText = `쉼표로 3개 입력 (예: 45,28,27) · 합 100 권장`;
  }else{
    $("myProbLabel").innerText = `내 예상 확률(${cfg.labels.A}) % (선택)`;
    $("myProbHint").innerText = `예: 55 (단일 값) · EV/권장비중 계산용`;
  }
}

/* 템플릿: 종목별 OU/핸디 기본 펼침 */
function applyTemplate(){
  const level = val("level");
  const cfg = SPORT_CFG[val("sport")] || SPORT_CFG.soccer;
  if(level === "simple"){
    // 간단 모드는 박스 숨김이니 상태 건드릴 필요 X
    return;
  }
  setCollapsed("handicapBody", !cfg.template.openHandicap);
  setCollapsed("totalBody", !cfg.template.openTotal);
}

/* 접기/펼치기 */
function toggleBox(id){
  const now = isCollapsed(id);
  setCollapsed(id, !now);
  saveState();
}
function isCollapsed(id){
  const el = $(id);
  return el ? el.style.display === "none" : false;
}
function setCollapsed(id, collapsed){
  const el = $(id);
  if(!el) return;
  el.style.display = collapsed ? "none" : "block";
}

/* =========================
   계산 로직
========================= */
function parseOdds(v){
  if(!v) return null;
  const x = Number(String(v).replace(/,/g,".").trim());
  if(!isFinite(x) || x<=1) return null;
  return x;
}
function parsePct(v){
  if(v==null || v==="") return null;
  const x = Number(String(v).replace(/,/g,".").trim());
  if(!isFinite(x) || x<0 || x>100) return null;
  return x/100;
}
function parsePctList(str){
  if(!str) return null;
  const parts = str.split(",").map(s=>s.trim()).filter(Boolean);
  if(parts.length !== 3) return null;
  const p1=parsePct(parts[0]), p2=parsePct(parts[1]), p3=parsePct(parts[2]);
  if(p1==null || p2==null || p3==null) return null;
  return [p1,p2,p3];
}
function parseMoney(v){
  if(!v) return null;
  const x = Number(String(v).replace(/[^\d]/g,""));
  if(!isFinite(x) || x<=0) return null;
  return x;
}
function pct(x){ return (x*100).toFixed(1) + "%"; }
function money(x){
  const n = Math.round(x);
  return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + "원";
}
function expectedValue(stake, p, odds){
  return stake * (p*(odds-1) - (1-p));
}
function quarterKelly(p, odds){
  const b = odds - 1;
  const f = (p*odds - 1) / b;
  const q = f/4;
  return Math.max(0, Math.min(0.25, q));
}
function marginText(over){
  if(over>1.10) return "마진이 큰 편";
  if(over>1.06) return "일반 수준(상단)";
  if(over>1.03) return "일반 수준";
  return "마진이 낮은 편";
}
function levelLabel(level){
  return level==="simple" ? "간단" : (level==="mid" ? "중급" : "고급");
}

function calc(){
  const sport = val("sport");
  const level = val("level");
  const cfg = SPORT_CFG[sport] || SPORT_CFG.soccer;
  const is3 = cfg.main === "3way";

  const rows = [];
  const copyLines = [];
  copyLines.push(`[88 커뮤니티] ${cfg.name} 분석 (${levelLabel(level)})`);

  // ✅ 리그/팀(선택) — 입력한 경우만 공유 텍스트에 포함
  const league = val("league").trim();
  const teams  = val("teams").trim();
  if(league) copyLines.push(`리그: ${league}`);
  if(teams)  copyLines.push(`경기: ${teams}`);

  // ---- 메인 시장 ----
  if(!is3){
    const a = parseOdds(val("main2OddsA"));
    const b = parseOdds(val("main2OddsB"));
    if(a==null || b==null) return showError("메인 배당을 1.01 이상 숫자로 입력해줘.");

    const ia=1/a, ib=1/b;
    const over = ia+ib;
    const pa=ia/over, pb=ib/over;

    rows.push([`마진 제거 확률(${cfg.labels.A})`, pct(pa)]);
    rows.push([`마진 제거 확률(${cfg.labels.B})`, pct(pb)]);
    rows.push(["오버라운드(마진 추정)", over.toFixed(4)]);
    rows.push(["해석", marginText(over)]);

    copyLines.push(`메인 배당(${cfg.labels.A}/${cfg.labels.B}): ${a} / ${b}`);

    if(level !== "simple"){
      const myP = parsePct(val("myProb"));
      const stake = parseMoney(val("stake"));

      if(myP!=null){
        const evPer1 = (myP*(a-1) - (1-myP));
        rows.push([`내 예상 확률(${cfg.labels.A})`, pct(myP)]);
        rows.push(["EV(1원당)", (evPer1*100).toFixed(2) + "%"]);
        copyLines.push(`내 예상 확률(${cfg.labels.A}): ${(myP*100).toFixed(1)}%`);
        if(stake!=null){
          rows.push(["기대값(EV)", money(expectedValue(stake, myP, a))]);
          copyLines.push(`베팅금: ${money(stake)}`);
        }
        if(level === "adv"){
          const k = quarterKelly(myP, a);
          rows.push(["권장 비중(보수적 1/4 Kelly)", (k*100).toFixed(1) + "%"]);
          rows.push(["판단", evPer1>0 ? "밸류(+EV) 가능성" : "밸류(-EV) 가능성"]);
        }else{
          rows.push(["판단", evPer1>0 ? "밸류(+EV) 가능성" : "밸류(-EV) 가능성"]);
        }
      }else{
        rows.push(["Tip", "중급/고급에서는 '내 예상 확률'을 입력하면 EV가 계산됩니다. (선택사항)"]);
      }
    }
  }else{
    const h = parseOdds(val("main3OddsH"));
    const d = parseOdds(val("main3OddsD"));
    const a = parseOdds(val("main3OddsA"));
    if(h==null || d==null || a==null) return showError("메인 배당(홈/무/원정)을 1.01 이상 숫자로 입력해줘.");

    const ih=1/h, id=1/d, ia=1/a;
    const over = ih+id+ia;
    const ph=ih/over, pd=id/over, pa=ia/over;

    rows.push([`마진 제거 확률(${cfg.labels.H})`, pct(ph)]);
    rows.push([`마진 제거 확률(${cfg.labels.D})`, pct(pd)]);
    rows.push([`마진 제거 확률(${cfg.labels.A})`, pct(pa)]);
    rows.push(["오버라운드(마진 추정)", over.toFixed(4)]);
    rows.push(["해석", marginText(over)]);

    copyLines.push(`메인 배당(${cfg.labels.H}/${cfg.labels.D}/${cfg.labels.A}): ${h} / ${d} / ${a}`);

    if(level !== "simple"){
      const my = parsePctList(val("myProb"));
      const stake = parseMoney(val("stake"));

      if(my){
        const evH = (my[0]*(h-1) - (1-my[0]));
        const evD = (my[1]*(d-1) - (1-my[1]));
        const evA = (my[2]*(a-1) - (1-my[2]));

        rows.push([`내 예상 확률(${cfg.labels.H}/${cfg.labels.D}/${cfg.labels.A})`,
          `${pct(my[0])} / ${pct(my[1])} / ${pct(my[2])}`]);

        rows.push(["EV(홈/무/원정, 1원당)", `${(evH*100).toFixed(2)}% / ${(evD*100).toFixed(2)}% / ${(evA*100).toFixed(2)}%`]);

        const best = [
          {k:cfg.labels.H, ev:evH, odds:h, p:my[0]},
          {k:cfg.labels.D, ev:evD, odds:d, p:my[1]},
          {k:cfg.labels.A, ev:evA, odds:a, p:my[2]}
        ].sort((x,y)=>y.ev-x.ev)[0];

        rows.push(["가장 높은 EV", `${best.k} (${(best.ev*100).toFixed(2)}%)`]);
        if(stake!=null) rows.push(["기대값(EV, 최고 EV 기준)", money(expectedValue(stake, best.p, best.odds))]);

        if(level === "adv"){
          rows.push(["권장 비중(보수적 1/4 Kelly, 최고 EV 기준)", (quarterKelly(best.p, best.odds)*100).toFixed(1) + "%"]);
          rows.push(["판단", best.ev>0 ? "밸류(+EV) 가능성" : "밸류(-EV) 가능성"]);
        }else{
          rows.push(["판단", best.ev>0 ? "밸류(+EV) 가능성" : "밸류(-EV) 가능성"]);
        }

        copyLines.push(`내 예상 확률: ${(my[0]*100).toFixed(1)}% / ${(my[1]*100).toFixed(1)}% / ${(my[2]*100).toFixed(1)}%`);
        if(stake!=null) copyLines.push(`베팅금: ${money(stake)}`);
      }else{
        rows.push(["Tip", "중급/고급에서는 내 예상 확률(예: 45,28,27)을 입력하면 EV가 계산됩니다. (선택사항)"]);
      }
    }
  }

  // ---- 중급/고급: 오버언더 EV(고급) ----
  if(level !== "simple"){
    const tLine = val("totalLine").trim();
    const oOdds = parseOdds(val("overOdds"));
    const uOdds = parseOdds(val("underOdds"));
    const myOver = parsePct(val("myOverProb"));

    if(tLine && oOdds!=null && uOdds!=null){
      const io=1/oOdds, iu=1/uOdds;
      const over = io+iu;
      const pOver = io/over, pUnder = iu/over;

      rows.push([`오버/언더(기준 ${tLine}) 마진 제거 확률`, `오버 ${pct(pOver)} / 언더 ${pct(pUnder)}`]);
      rows.push([`오버/언더 오버라운드`, over.toFixed(4)]);
      copyLines.push(`오버언더 ${tLine}: 오버 ${oOdds} / 언더 ${uOdds}`);

      if(level === "adv" && myOver!=null){
        const stake = parseMoney(val("stake")) || null;
        const evPer1 = (myOver*(oOdds-1) - (1-myOver));
        rows.push([`내 예상 확률(오버)`, pct(myOver)]);
        rows.push([`오버 EV(1원당)`, (evPer1*100).toFixed(2) + "%"]);
        if(stake!=null) rows.push([`오버 기대값(EV)`, money(expectedValue(stake, myOver, oOdds))]);
        rows.push([`오버 권장 비중(1/4 Kelly)`, (quarterKelly(myOver, oOdds)*100).toFixed(1) + "%"]);
        rows.push([`오버 판단`, evPer1>0 ? "밸류(+EV) 가능성" : "밸류(-EV) 가능성"]);
      }
    }
  }

  renderResult(cfg.name, level, rows, copyLines);
  saveState();
}

/* 결과 */
function renderResult(sportName, level, rows, copyLines){
  const box = $("result");
  const html = rows.map(([k,v])=>{
    const cls = (k.includes("판단")) ? (String(v).includes("-EV") ? "warn":"good") : "";
    return `<div class="kv"><div class="k">${k}</div><div class="v ${cls}">${v}</div></div>`;
  }).join("");

  box.innerHTML = `
    <div style="font-weight:900;margin-bottom:6px;">${sportName} · ${levelLabel(level)} 결과</div>
    ${html}
    <hr class="sep">
    <div style="font-size:12px;color:#9a9a9a;line-height:1.5;">
      ※ 마진 제거 확률은 배당의 역수를 정규화해 합이 100%가 되도록 만든 값입니다.<br>
      ※ EV/비중은 사용자가 입력한 “내 예상 확률” 기반의 참고 지표이며 승률을 보장하지 않습니다.
    </div>
  `;
  box.style.display = "block";

  copyLines.push(`주소: https://88st.cloud/analysis.html`);
  LAST_TEXT = copyLines.join("\n") + "\n\n" + rows.map(r=>`${r[0]}: ${r[1]}`).join("\n");
}

function showError(msg){
  const box = $("result");
  box.innerHTML = `<div class="kv"><div class="k">안내</div><div class="v warn">${msg}</div></div>`;
  box.style.display = "block";
  LAST_TEXT = `[88 커뮤니티] 안내\n${msg}\n주소: https://88st.cloud/analysis.html`;
}
function hideResult(){
  const box = $("result");
  box.style.display = "none";
  box.innerHTML = "";
  LAST_TEXT = "";
}
function resetAll(){
  [
    "league","teams",
    "main2OddsA","main2OddsB","main3OddsH","main3OddsD","main3OddsA",
    "myProb","stake",
    "handicapLine","handicapOdds",
    "totalLine","overOdds","underOdds","myOverProb"
  ].forEach(id=>{ const el=$(id); if(el) el.value=""; });

  hideResult();
  localStorage.removeItem(LS_KEY);
}

/* 공유/복사 */
async function copyResult(){
  if(!LAST_TEXT) return showError("먼저 '계산하기'를 눌러 결과를 만든 뒤 복사할 수 있어요.");
  try{
    await navigator.clipboard.writeText(LAST_TEXT);
    toast("결과가 복사되었습니다.");
  }catch(e){
    prompt("아래 내용을 복사하세요:", LAST_TEXT);
  }
}
async function shareResult(){
  if(!LAST_TEXT) return showError("먼저 '계산하기'를 눌러 결과를 만든 뒤 공유할 수 있어요.");
  try{
    if(navigator.share){
      await navigator.share({ title:"88 커뮤니티 분석 결과", text: LAST_TEXT });
    }else{
      await copyResult();
    }
  }catch(e){}
}

/* 토스트 */
let toastTimer=null;
function toast(msg){
  let el=document.getElementById("toast88");
  if(!el){
    el=document.createElement("div");
    el.id="toast88";
    el.style.cssText="position:fixed;left:50%;bottom:22px;transform:translateX(-50%);background:rgba(0,0,0,.85);color:#fff;padding:10px 12px;border-radius:12px;font-size:12px;z-index:3000;border:1px solid rgba(255,255,255,.08)";
    document.body.appendChild(el);
  }
  el.textContent=msg;
  el.style.opacity="1";
  if(toastTimer) clearTimeout(toastTimer);
  toastTimer=setTimeout(()=>{ el.style.opacity="0"; }, 1400);
}

/* 초기 구동 */
function boot(){
  loadState();
  // 기본값(처음 방문)
  if(!localStorage.getItem(LS_KEY)){
    setVal("sport","soccer");
    setVal("level","simple");
  }
  onSportChange(true);
  onLevelChange(true);
}
boot();
</script>
</body>
</html>
